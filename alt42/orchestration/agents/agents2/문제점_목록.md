# Orchestration13 Agents 개발 중 문제점 목록

**작성일**: 2025-01-27  
**분석 대상**: `C:\alt42\orchestration13\agents`  
**상태**: 개발 중

---

## 📋 목차

1. [코드 품질 문제](#1-코드-품질-문제)
2. [미완성 구현](#2-미완성-구현)
3. [데이터베이스 관련 문제](#3-데이터베이스-관련-문제)
4. [온톨로지 통합 문제](#4-온톨로지-통합-문제)
5. [표준화 미완료](#5-표준화-미완료)
6. [에러 처리 불일치](#6-에러-처리-불일치)
7. [문서화 문제](#7-문서화-문제)
8. [아키텍처 문제](#8-아키텍처-문제)

---

## 1. 코드 품질 문제

### 1.1 파일 크기 초과 (Critical)

**문제**: 프로젝트 규칙(500줄 제한) 위반

**영향받는 파일**:
- `agent01_onboarding/onboarding_learningtype.php` - **1,227줄** (245% 초과)
  - PHP 로직: ~170줄 (14%)
  - 인라인 CSS: 325줄 (26.5%)
  - HTML: ~278줄 (22.7%)
  - 인라인 JS: 454줄 (37%)

**해결 필요**:
- CSS 추출 → `ui/onboarding_learningtype.css`
- JavaScript 추출 → `ui/onboarding_learningtype.js`
- 질문 데이터 추출 → `includes/questions_data.php`
- 비즈니스 로직 추출 → `services/learning_assessment_service.php`

**참고**: `agent01_onboarding/CLEANUP_PLAN.md`에 상세 계획 있음

---

### 1.2 인라인 CSS/JavaScript (Medium)

**문제**: HTML 파일에 인라인으로 포함된 CSS/JS

**영향받는 파일**:
- `agent01_onboarding/index.php` - 98줄 CSS, 112줄 JS
- `agent01_onboarding/onboarding_info.php` - 약 100줄 CSS (추정)
- `agent01_onboarding/test_integration.php` - 40줄 JS

**영향**:
- 브라우저 캐싱 불가능
- 유지보수 어려움
- 코드 재사용 불가

**해결 필요**:
- CSS 파일로 분리
- JavaScript 파일로 분리
- 외부 파일로 링크

---

### 1.3 혼합된 관심사 (Medium)

**문제**: 단일 파일에 여러 책임이 혼재

**예시**: `onboarding_learningtype.php`
- 세션 관리
- AJAX 라우팅
- 데이터 구조
- HTML 렌더링
- 클라이언트 사이드 로직

**해결 필요**: Service Layer 패턴 도입

---

## 2. 미완성 구현

### 2.1 Agent02 - 데이터 접근 미구현 (High)

**파일**: `agent02_exam_schedule/rules/data_access.php`

**TODO 항목**:
```php
// Line 316: 학원 정보 테이블에서 데이터 조회
// TODO: 학원 정보 테이블에서 데이터 조회

// Line 324: 학원 진도 테이블에서 데이터 조회
// TODO: 학원 진도 테이블에서 데이터 조회

// Line 331: 학원 과제 테이블에서 데이터 조회
// TODO: 학원 과제 테이블에서 데이터 조회

// Line 343: 학원 모의고사 테이블에서 데이터 조회
// TODO: 학원 모의고사 테이블에서 데이터 조회

// Line 375: 학원 진도와 학교 진도 비교 로직 구현
// TODO: 학원 진도와 학교 진도 비교 로직 구현

// Line 420: 학교 진도 정보 수집 및 비교
// TODO: 학교 진도 정보 수집 및 비교
```

**영향**: Agent02가 학원 정보, 진도, 과제, 모의고사 데이터를 활용하지 못함

---

### 2.2 dataindex.php - 서버 연동 미구현 (Medium)

**파일**: `agent_orchestration/dataindex.php`

**TODO 항목**:
```javascript
// Line 2156: Inputtype 변경 시 서버에 변경사항 전송
// TODO: 서버에 변경사항 전송

// Line 2205: 상태 변경 시 서버에 변경사항 전송
// TODO: 서버에 변경사항 전송

// Line 2269: Rules.yaml 적용 여부 변경 시 서버에 변경사항 전송
// TODO: 서버에 변경사항 전송
```

**영향**: UI에서 변경한 내용이 서버에 저장되지 않음

---

## 3. 데이터베이스 관련 문제

### 3.1 테이블 존재 여부 확인 부족 (High)

**문제**: 테이블 존재 확인 없이 조회 시도

**영향받는 파일**:
- `agent01_onboarding/agent.php` (수정됨, FIXES.md 참고)
- 기타 여러 파일

**해결 방법**:
```php
if ($DB->get_manager()->table_exists(new xmldb_table('table_name'))) {
    // 테이블 조회
}
```

---

### 3.2 필드명 불일치 (High)

**문제**: 실제 테이블 스키마와 코드의 필드명 불일치

**예시**:
- `userid` vs `user_id` (alt42_student_profiles 테이블)
- 인코딩 문제로 인한 TODO 주석의 한글 깨짐

**참고**: `agent01_onboarding/FIXES.md`에 상세 설명 있음

---

### 3.3 DB 테이블 미생성 가능성 (Medium)

**문제**: 필수 테이블이 생성되지 않았을 수 있음

**확인 필요 테이블**:
- `mdl_alt42o_onboarding_reports`
- `mdl_alt42_student_profiles`
- `mdl_abessi_mbtilog`
- `mdl_alt42_academy_info` (Agent02)
- `mdl_alt42_academy_progress` (Agent02)
- `mdl_alt42_academy_homework` (Agent02)
- `mdl_alt42_academy_mock_exam` (Agent02)

**해결 도구**: `agent01_onboarding/fix_db.php` (Agent01용)

---

## 4. 온톨로지 통합 문제

### 4.1 프론트엔드 UI 표시 누락 (High)

**문제**: 백엔드에서 생성한 온톨로지 결과가 프론트엔드에 표시되지 않음

**파일**: `agent22_module_improvement/ui/agent_garden.js`

**현재 상태**:
- 백엔드: ✅ 온톨로지 결과 생성 및 저장 완료
- 백엔드: ✅ `response['ontology_strategy']`, `response['ontology_procedure']`에 저장
- 프론트엔드: ❌ 해당 데이터 확인 및 표시 코드 없음

**해결 필요**:
```javascript
// 온톨로지 전략 표시
if (responseData.ontology_strategy) {
    // 전략 정보를 시각적으로 표시
}

// 온톨로지 절차 표시
if (responseData.ontology_procedure) {
    // 절차 단계를 시각적으로 표시
}
```

**참고**: `agent01_onboarding/ontology/ONTOLOGY_INTEGRATION_ISSUES.md`에 상세 분석 있음

---

### 4.2 OntologyActionHandler 생성자 파라미터 불일치 (Fixed)

**상태**: ✅ 수정 완료 (이전 버전 호환성 처리)

**파일**: 
- `agent01_onboarding/ontology/OntologyActionHandler.php`
- `agent02_exam_schedule/ontology/OntologyActionHandler.php`

**이전 문제**:
- 호출: `new OntologyActionHandler($agentId, $context, $studentId)`
- 실제 생성자: `__construct(array $context = [], ?int $studentId = null)`

**현재 상태**: 생성자에 `$agentId` 파라미터 추가 및 이전 버전 호환성 처리 완료

---

## 5. 표준화 미완료

### 5.1 Agent02 데이터 매핑 분석 표준화 미완료 (Medium)

**문제**: Agent02만 표준 템플릿 미적용

**상태**: 16개 에이전트 중 15개 완료, Agent02만 미완료

**미구현 항목**:
- `checkDataAccessUsage()` 함수 추가 필요
- DB 실제 데이터 존재 여부 확인 로직 추가 필요
- `inRulesNotInDataAccess` 계산 로직 변경 필요
- HTML 출력에 DB 실제 데이터 섹션 추가 필요

**참고**: `NEXT_WORK_PLAN.md`에 상세 계획 있음

**예상 소요 시간**: 30분

---

### 5.2 에러 메시지 형식 불일치 (Low)

**문제**: 에러 로깅 형식이 파일마다 다름

**예시**:
```php
// 형식 1
error_log("Error: " . $e->getMessage());

// 형식 2
error_log("[Agent01] Error in {$file}:{$line} - {$message}");

// 형식 3
error_log("Error in agent.php line " . __LINE__ . ": " . $e->getMessage());
```

**해결 필요**: 중앙화된 에러 핸들러 도입

**참고**: `agent01_onboarding/CLEANUP_PLAN.md`에 `AgentErrorHandler` 클래스 설계 있음

---

## 6. 에러 처리 불일치

### 6.1 예외 처리 패턴 불일치 (Medium)

**문제**: 파일마다 예외 처리 방식이 다름

**예시**:
- 일부 파일: try-catch로 모든 예외 처리
- 일부 파일: 예외 처리 없음
- 일부 파일: 선택적 예외 처리

**영향**: 일관성 없는 에러 처리로 디버깅 어려움

---

### 6.2 에러 응답 형식 불일치 (Medium)

**문제**: JSON 에러 응답 형식이 파일마다 다름

**예시**:
```php
// 형식 1
['error' => $e->getMessage()]

// 형식 2
['success' => false, 'error' => $message]

// 형식 3
['success' => false, 'error' => $message, 'file' => __FILE__, 'line' => __LINE__]
```

**해결 필요**: 표준화된 에러 응답 형식 정의

---

## 7. 문서화 문제

### 7.1 문서 분산 (Medium)

**문제**: 관련 문서가 여러 파일에 분산되어 있음

**Agent01 예시**:
- `FIXES.md` - 305줄
- `debug_guide.md` - 272줄
- `integration_guide.md` - 180줄
- `mbti_integration.md` - 373줄
- `agent01_onboarding.md` - 22줄
- `의사결정 지식.md` - 34줄

**총**: 1,186줄, 6개 파일

**해결 필요**: 통합 README.md 생성 및 아카이브 폴더로 이동

**참고**: `agent01_onboarding/CLEANUP_PLAN.md`에 통합 계획 있음

---

### 7.2 한글 인코딩 문제 (Low)

**문제**: 일부 TODO 주석에서 한글이 깨져 표시됨

**예시**: `agent02_exam_schedule/rules/data_access.php`
```php
// TODO: ?�원 ?�보 ?�이블에???�이??조회
```

**원인**: 파일 인코딩 불일치

---

## 8. 아키텍처 문제

### 8.1 Service Layer 부재 (Medium)

**문제**: Controller → Database 직접 연결

**현재 구조**:
```
Controller → Database
```

**권장 구조**:
```
Controller → Service → Repository → Database
```

**영향**:
- 비즈니스 로직 테스트 어려움
- 로직 재사용 불가
- HTTP와 비즈니스 로직 결합

**참고**: `agent01_onboarding/CLEANUP_PLAN.md`에 아키텍처 개선 계획 있음

---

### 8.2 에이전트 실행 방식 불일치 (Medium)

**문제**: 에이전트마다 실행 방식이 다름

**현재 상태**:
- Agent01, Agent02, Agent04: rules.yaml 사용 ✅
- 나머지 에이전트: 시뮬레이션 응답 (실제 구현 없음) ❌

**파일**: `agent22_module_improvement/ui/agent_garden.service.php`

**영향**: Agent03, Agent05~Agent21이 실제 기능 없이 시뮬레이션만 수행

---

### 8.3 공통 함수 부재 (Low)

**문제**: 중복 코드가 여러 파일에 존재

**예시**:
- 테이블 존재 확인 로직
- 에러 로깅 로직
- 데이터 타입 식별 로직

**해결 필요**: 공통 함수 추출 (DRY 원칙)

---

## 9. 우선순위별 요약

### 🔥 Critical (즉시 수정 필요)
1. **Agent01 - onboarding_learningtype.php 리팩토링** (1,227줄 → 500줄 이하)
2. **Agent02 - 데이터 접근 함수 구현** (6개 TODO)
3. **온톨로지 결과 프론트엔드 표시** (UI 누락)

### ⚡ High (단기 수정 필요)
4. **Agent02 - 표준화 완료** (데이터 매핑 분석)
5. **DB 테이블 존재 확인 로직 추가** (전체 파일)
6. **에러 처리 표준화** (중앙화된 핸들러)

### 💡 Medium (중기 개선)
7. **인라인 CSS/JS 추출** (Agent01)
8. **Service Layer 도입** (아키텍처 개선)
9. **문서 통합** (6개 파일 → 1개 README)

### 📝 Low (장기 개선)
10. **공통 함수 추출** (DRY 원칙)
11. **한글 인코딩 문제 해결** (TODO 주석)
12. **나머지 에이전트 실제 구현** (Agent03, Agent05~Agent21)

---

## 10. 참고 문서

- `agent01_onboarding/FIXES.md` - 오류 수정 내역
- `agent01_onboarding/CLEANUP_PLAN.md` - 코드 정리 계획
- `agent01_onboarding/ontology/ONTOLOGY_INTEGRATION_ISSUES.md` - 온톨로지 통합 문제
- `NEXT_WORK_PLAN.md` - 다음 작업 계획
- `agent_orchestration/dataindex.php` - 데이터 매핑 분석 도구

---

**마지막 업데이트**: 2025-01-27


