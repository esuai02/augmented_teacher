# Rules for Agent 07 - Interaction Targeting
# 현직 수학선생님 수준의 90% 달성을 위한 룰 정의

version: "2.0"
scenario: "interaction_targeting"
description: "학생과의 상호작용을 최적의 타이밍과 상황에서 타겟팅하는 에이전트"
last_updated: "2025-01-27"
target_level: "현직 수학선생님 수준의 90%"

rules:
  # ============================================
  # Step 1: 상황 식별 및 우선순위 결정
  # ============================================
  
  - rule_id: "S1_R1_real_time_concern"
    name: "실시간 고민 상황 감지"
    priority: 1
    condition:
      - "학생 질문/도움 요청 있음"
    action:
      - "상황 = '실시간 고민'"
      - "우선순위 = 최우선"
      - "즉시_개입 = true"
    confidence: 0.95
    rationale: "학생이 즉시 도움을 요청하면 최우선으로 대응해야 함"
    
  - rule_id: "S1_R2_pomodoro_situation"
    name: "포모도르 상황 감지"
    priority: 2
    condition:
      - "포모도르 세션 활성 상태"
    action:
      - "상황 = '포모도르 상황 중 선택'"
      - "우선순위 = 높음"
      - "IF (포모도르 경과 >= 20분 AND 집중도 < 5) THEN 하위_상황 = '집중도_하락'"
      - "IF (포모도르 경과 >= 15분 AND 성취감 < 3) THEN 하위_상황 = '동기_부여_필요'"
    confidence: 0.90
    rationale: "포모도르 세션 중 실시간 상태 모니터링 및 개입 필요"
    
  - rule_id: "S1_R3_class_preparation"
    name: "수업준비 상황 감지"
    priority: 2
    condition:
      - "학습 시작 전"
      - "(학원 수업 예정 OR 학교 수업 예정)"
    action:
      - "상황 = '수업준비'"
      - "우선순위 = 높음"
      - "IF (학원 수업 예정) THEN 하위_상황 = '학원_수업_준비'"
      - "IF (학교 수업 예정) THEN 하위_상황 = '학교_수업_준비'"
    confidence: 0.85
    rationale: "수업 준비는 학습 효과 극대화를 위해 중요"
    
  - rule_id: "S1_R4_goal_setting"
    name: "목표 설정 상황 감지"
    priority: 3
    condition:
      - "(오늘 목표 없음 OR 오늘 목표 변경됨) OR (주간 목표 없음 OR 주간 목표 변경됨) OR (분기 목표 없음 OR 분기 목표 변경됨)"
    action:
      - "IF (오늘 목표 관련) THEN 상황 = '오늘목표 설정', 우선순위 = 중간"
      - "IF (주간 목표 관련) THEN 상황 = '주간목표 설정', 우선순위 = 낮음"
      - "IF (분기 목표 관련) THEN 상황 = '분기목표 수립', 우선순위 = 낮음"
    confidence: 0.80
    rationale: "목표 설정은 학습 계획의 기초"
    
  - rule_id: "S1_R5_reflection_situation"
    name: "귀가검사 상황 감지"
    priority: 3
    condition:
      - "(학습 마무리 시점 AND 귀가검사 전) OR (귀가검사 실행 시점)"
    action:
      - "IF (학습 마무리 시점) THEN 상황 = '귀가검사 준비', 우선순위 = 중간"
      - "IF (귀가검사 실행) THEN 상황 = '귀가검사 상황', 우선순위 = 중간"
    confidence: 0.85
    rationale: "학습 마무리 및 회고는 다음 학습을 위한 중요 단계"
    
  - rule_id: "S1_R6_curriculum_design"
    name: "커리큘럼 설계 상황 감지"
    priority: 4
    condition:
      - "커리큘럼 조정 필요 OR 장기 목표 재설정"
    action:
      - "상황 = '장기목표(커리큘럼) 설계'"
      - "우선순위 = 낮음"
    confidence: 0.75
    rationale: "장기 커리큘럼은 주기적으로 조정 필요"
    
  # ============================================
  # Step 2: 수학 학습 단계별 타겟팅
  # ============================================
  
  - rule_id: "S2_R1_concept_learning"
    name: "개념 학습 단계 타겟팅"
    priority: 1
    condition:
      - "현재_학습_단계 == '개념 학습'"
    action:
      - "권장_모드 = ['도제학습', '탐구학습']"
      - "IF (학생_수준 == '하위권') THEN 우선_모드 = '도제학습'"
      - "IF (학생_수준 == '상위권') THEN 우선_모드 = '탐구학습'"
      - "최적_타이밍 = '집중도 >= 7 AND 에너지 >= 보통'"
      - "회피_타이밍 = '에너지 == 낮음 OR 집중도 < 5'"
    confidence: 0.90
    rationale: "개념 학습은 집중도 높을 때, 도제학습/탐구학습 모드 효과적"
    
  - rule_id: "S2_R2_type_practice"
    name: "유형 연습 단계 타겟팅"
    priority: 1
    condition:
      - "현재_학습_단계 == '유형 연습'"
    action:
      - "권장_모드 = ['단기미션', '자기주도']"
      - "IF (학생_수준 == '하위권') THEN 우선_모드 = '단기미션'"
      - "IF (학생_수준 == '상위권') THEN 우선_모드 = '자기주도'"
      - "최적_타이밍 = '에너지 >= 보통 AND 집중도 >= 6'"
    confidence: 0.90
    rationale: "유형 연습은 목표 설정 및 성취 강조, 단기미션/자기주도 모드 효과적"
    
  - rule_id: "S2_R3_advanced_problem"
    name: "심화 문제 단계 타겟팅"
    priority: 1
    condition:
      - "현재_학습_단계 == '심화 문제'"
    action:
      - "권장_모드 = ['자기성찰', '맞춤학습']"
      - "IF (학생_수준 == '하위권') THEN 우선_모드 = '맞춤학습'"
      - "IF (학생_수준 == '상위권') THEN 우선_모드 = '자기성찰'"
      - "최적_타이밍 = '에너지 == 높음 AND 집중도 >= 7'"
      - "회피_타이밍 = '에너지 == 낮음 OR 집중도 < 6'"
    confidence: 0.90
    rationale: "심화 문제는 에너지 충분할 때, 자기성찰/맞춤학습 모드 효과적"
    
  - rule_id: "S2_R4_past_exam"
    name: "기출 문제 단계 타겟팅"
    priority: 1
    condition:
      - "현재_학습_단계 == '기출 문제'"
    action:
      - "권장_모드 = ['시험대비', '시간성찰']"
      - "IF (시험_Dday <= 7) THEN 우선_모드 = '시험대비'"
      - "ELSE 우선_모드 = '시간성찰'"
      - "최적_타이밍 = '시험_Dday <= 14'"
    confidence: 0.90
    rationale: "기출 문제는 시험 D-day 고려, 시험대비/시간성찰 모드 효과적"
    
  # ============================================
  # Step 3: 단원별 특성 기반 타겟팅
  # ============================================
  
  - rule_id: "S2_R5_unit_characteristics"
    name: "단원별 특성 기반 타겟팅"
    priority: 1
    condition:
      - "현재_단원 정보 있음"
    action:
      - "함수 단원: 특성='추상적', 권장_모드=['도제학습', '탐구학습']"
      - "통계 단원: 특성='실용적', 권장_모드=['맞춤학습', '단기미션']"
      - "도형 단원: 특성='시각적', 권장_모드=['도제학습', '탐구학습']"
      - "방정식 단원: 특성='계산적', 권장_모드=['단기미션', '자기주도']"
    confidence: 0.85
    rationale: "단원별 특성에 맞는 모드 선택이 효과적"
    
  - rule_id: "S2_R6_unit_mastery"
    name: "단원별 학생 수준 고려"
    priority: 1
    condition:
      - "단원_정답률 정보 있음"
    action:
      - "IF (단원_정답률 < 0.5) THEN 단원_수준 = '취약', 모드_조정 = '도제학습 우선'"
      - "IF (단원_정답률 >= 0.7) THEN 단원_수준 = '강함', 모드_조정 = '자기주도/자기성찰 우선'"
      - "ELSE 단원_수준 = '보통', 모드_조정 = '단기미션/맞춤학습 우선'"
    confidence: 0.85
    rationale: "단원별 학생 수준에 맞는 모드 조정 필요"
    
  # ============================================
  # Step 4: 오류 유형별 타겟팅
  # ============================================
  
  - rule_id: "S2_R7_error_type"
    name: "계산 실수 vs 개념 오류 구분"
    priority: 1
    condition:
      - "오류_패턴 정보 있음"
    action:
      - "IF (계산_실수_비율 >= 0.6) THEN 오류_유형 = '계산_실수', 모드 = '단기미션', 내용 = '반복 연습'"
      - "IF (개념_오류_비율 >= 0.6) THEN 오류_유형 = '개념_오류', 모드 = '도제학습', 내용 = '개념 재학습'"
      - "ELSE 오류_유형 = '혼합', 모드 = '맞춤학습', 내용 = '종합적 개선'"
    confidence: 0.85
    rationale: "오류 유형별 맞춤 전략 필요"
    
  # ============================================
  # Step 5: 학생 수준별 타겟팅
  # ============================================
  
  - rule_id: "S2_R8_low_level_student"
    name: "하위권 학생 타겟팅"
    priority: 1
    condition:
      - "학생_수준 == '하위권'"
    action:
      - "모드_우선순위 = ['도제학습', '맞춤학습', '단기미션']"
      - "회피_모드 = ['자기주도', '자기성찰']"
      - "톤 = '격려 중심, 성취감 강조'"
      - "내용 = '기초 개념, 작은 목표, 반복 연습'"
    confidence: 0.90
    rationale: "하위권 학생은 기초 설명 및 격려 중심 필요"
    
  - rule_id: "S2_R9_mid_level_student"
    name: "중위권 학생 타겟팅"
    priority: 1
    condition:
      - "학생_수준 == '중위권'"
    action:
      - "모드_우선순위 = ['단기미션', '맞춤학습', '자기주도']"
      - "톤 = '목표 설정, 단계별 가이드'"
      - "내용 = '유형 연습, 오답 정리, 목표 달성'"
    confidence: 0.90
    rationale: "중위권 학생은 목표 설정 및 단계별 가이드 효과적"
    
  - rule_id: "S2_R10_high_level_student"
    name: "상위권 학생 타겟팅"
    priority: 1
    condition:
      - "학생_수준 == '상위권'"
    action:
      - "모드_우선순위 = ['자기성찰', '자기주도', '탐구학습']"
      - "톤 = '도전 중심, 성장 마인드셋'"
      - "내용 = '심화 문제, 변형 문제, 창의 문제'"
    confidence: 0.90
    rationale: "상위권 학생은 독립 학습 및 도전 문제 효과적"
    
  # ============================================
  # Step 6: 학원 수업 맥락 고려
  # ============================================
  
  - rule_id: "S2_R11_academy_prep"
    name: "학원 수업 전 예습 타겟팅"
    priority: 1
    condition:
      - "학원_수업_예정 AND 현재_시간 < 학원_수업_시간 - 2시간"
    action:
      - "모드 = ['맞춤학습', '도제학습', '단기미션']"
      - "목적 = '예습 가이드'"
      - "내용 = '오늘 배울 단원 개념 미리보기, 기본 문제 풀기'"
      - "타이밍 = '수업 2시간 전까지'"
    confidence: 0.85
    rationale: "학원 수업 전 예습은 학습 효과 극대화"
    
  - rule_id: "S2_R12_academy_review"
    name: "학원 수업 후 복습 타겟팅"
    priority: 1
    condition:
      - "학원_수업_완료 AND 현재_시간 >= 학원_수업_시간 + 1시간"
    action:
      - "모드 = ['자기주도', '도제학습', '자기성찰']"
      - "목적 = '복습 안내'"
      - "내용 = '오늘 배운 내용 정리, 연습 문제 풀기'"
      - "타이밍 = '수업 후 1시간 이후 (당일 또는 다음날)'"
      - "IF (수업_후_당일) THEN 우선순위 = 높음"
    confidence: 0.85
    rationale: "학원 수업 후 복습은 당일이 효과적"
    
  # ============================================
  # Step 7: 시험 D-day 맥락 고려
  # ============================================
  
  - rule_id: "S2_R13_exam_dday"
    name: "시험 D-day별 타겟팅 조정"
    priority: 1
    condition:
      - "시험_Dday 정보 있음"
    action:
      - "IF (시험_Dday <= 3) THEN 모드_우선순위 = ['시험대비', '시간성찰'], 내용 = '기출 문제 중심'"
      - "IF (시험_Dday <= 7) THEN 모드_우선순위 = ['시험대비', '단기미션'], 내용 = '취약 단원 집중'"
      - "IF (시험_Dday <= 14) THEN 모드_우선순위 = ['맞춤학습', '단기미션'], 내용 = '전체 범위 학습'"
    confidence: 0.90
    rationale: "시험 D-day에 따라 타겟팅 전략 조정 필요"
    
  # ============================================
  # Step 8: 타이밍 최적화
  # ============================================
  
  - rule_id: "S3_R1_time_slot"
    name: "시간대별 타겟팅"
    priority: 1
    condition:
      - "현재_시간대 정보 있음"
    action:
      - "아침 (6-9시): 최적_활동 = '개념 학습', 권장_모드 = ['도제학습', '탐구학습', '단기미션']"
      - "오전 (9-12시): 최적_활동 = '개념 학습, 유형 연습', 권장_모드 = ['도제학습', '단기미션']"
      - "오후 (12-18시): 최적_활동 = '유형 연습, 심화 문제', 권장_모드 = ['단기미션', '자기주도', '맞춤학습']"
      - "저녁 (18-22시): 최적_활동 = '복습, 정리', 권장_모드 = ['자기주도', '자기성찰', '시간성찰']"
      - "밤 (22시 이후): 최적_활동 = '가벼운 복습', 권장_모드 = ['자기주도', '시간성찰']"
    confidence: 0.85
    rationale: "시간대별 최적 활동 및 모드 다름"
    
  - rule_id: "S3_R2_energy_focus"
    name: "에너지/집중도 기반 타이밍 조정"
    priority: 1
    condition:
      - "에너지_레벨 AND 집중도 정보 있음"
    action:
      - "IF (에너지 == 높음 AND 집중도 >= 7) THEN 최적_활동 = '어려운 과제', 권장_모드 = ['도제학습', '탐구학습', '자기성찰']"
      - "IF (에너지 == 보통 AND 집중도 >= 6) THEN 최적_활동 = '보통 과제', 권장_모드 = ['단기미션', '자기주도', '맞춤학습']"
      - "IF (에너지 == 낮음 OR 집중도 < 5) THEN 최적_활동 = '가벼운 과제', 권장_모드 = ['자기주도', '시간성찰'], 회피_활동 = '어려운 과제'"
    confidence: 0.90
    rationale: "에너지/집중도에 따라 활동 난이도 조정 필요"
    
  # ============================================
  # Step 9: 최종 모드 선정
  # ============================================
  
  - rule_id: "S3_R3_mode_selection"
    name: "모드 우선순위 종합 계산"
    priority: 1
    condition:
      - "모든_판단_기준_완료"
    action:
      - "모드_점수 계산: 학습_단계별(30점) + 단원별(20점) + 학생_수준별(20점) + 시간대별(15점) + 에너지_집중도(10점) + 학원_수업_맥락(5점)"
      - "최종_모드 = 모드_점수 최고점 모드"
    confidence: 0.85
    rationale: "다양한 기준을 종합하여 최적 모드 선정"
    
  # ============================================
  # 예외 처리
  # ============================================
  
  - rule_id: "EXCEPTION_R1_low_data_quality"
    name: "데이터 부족 시 기본 타겟팅"
    priority: 0
    condition:
      - "데이터_완성도 < 0.6"
    action:
      - "기본_타겟팅_사용 = true"
      - "기본_모드 = '맞춤학습'"
      - "로그_기록 = '데이터 부족으로 기본 타겟팅 사용'"
    confidence: 0.70
    rationale: "데이터 부족 시에도 기본 기능 제공"
    
  - rule_id: "EXCEPTION_R2_multiple_situations"
    name: "다중 상황 발생 시 우선순위 적용"
    priority: 0
    condition:
      - "여러_상황_동시_발생"
    action:
      - "최종_상황 = 우선순위_가장_높은_상황"
      - "보조_상황 = 다음_우선순위_상황"
      - "로그_기록 = '다중 상황 발생, 우선순위 적용'"
    confidence: 0.80
    rationale: "다중 상황 발생 시 우선순위에 따라 결정"

default_rule:
  rule_id: "default"
  action:
    - "상황 = '오늘목표 설정'"
    - "모드 = '맞춤학습'"
    - "타이밍 = '현재 시간대'"
  confidence: 0.50
  rationale: "기본값: 가장 범용적인 상황 및 모드"
