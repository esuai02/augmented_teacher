# Persona-based Response Rules for Agent 03 - Goals Analysis
# Version: 1.0
# Purpose: 목표 분석 및 달성 전략 최적화를 위한 페르소나 기반 룰셋
# Reference: ontology.jsonld, personas.md, contextlist.md

version: "1.0"
scenario: "goal_analysis_persona_response"
description: "학생 목표 분석 페르소나 식별 및 맞춤형 목표 달성 전략 제공"

# ============================================================
# SECTION 1: 목표 관련 페르소나 식별 룰
# ============================================================

persona_identification_rules:

  # === G0: 목표 설정 단계 페르소나 ===

  - rule_id: "PI_G0_001_ambitious_overreacher"
    priority: 92
    description: "야심찬 과목표 설정자(G0_P1) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["전교 1등", "올백", "100점", "전부 다", "완벽하게", "최고"]
        - field: "goal_count"
          operator: ">="
          value: 10
        - field: "goal_difficulty_ratio"
          operator: ">="
          value: 0.8
    action:
      - "identify_persona: 'G0_P1'"
      - "set_tone: 'Gentle'"
      - "prioritize_intervention: 'GapAnalysis'"
      - "suggest_realistic_adjustment: true"
    confidence: 0.88
    rationale: "과도한 목표 수와 높은 난이도는 현실적 조정이 필요한 신호"

  - rule_id: "PI_G0_002_vague_dreamer"
    priority: 90
    description: "모호한 목표 설정자(G0_P2) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["그냥 잘하고 싶어", "어떻게든", "뭔가", "대충", "좀 나아지게"]
        - field: "goal_specificity"
          operator: "<="
          value: "low"
        - field: "lacks_measurable_criteria"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G0_P2'"
      - "set_tone: 'Professional'"
      - "prioritize_intervention: 'GoalSetting'"
      - "guide_smart_criteria: true"
    confidence: 0.86
    rationale: "모호한 표현과 측정 가능 기준 부재는 SMART 목표 설정 지원 필요"

  - rule_id: "PI_G0_003_external_driven"
    priority: 88
    description: "외부 동기 기반 목표 설정자(G0_P3) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["부모님이", "선생님이", "친구가", "해야 해서", "시켜서", "다들"]
        - field: "motivation_source"
          operator: "=="
          value: "external"
        - field: "lacks_personal_connection"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G0_P3'"
      - "set_tone: 'Collaborative'"
      - "prioritize_intervention: 'GoalSetting'"
      - "explore_intrinsic_motivation: true"
    confidence: 0.85
    rationale: "외부 요인 언급은 내재적 동기 탐색이 필요한 신호"

  - rule_id: "PI_G0_004_realistic_planner"
    priority: 86
    description: "현실적 계획자(G0_P4) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - AND:
        - field: "goal_specificity"
          operator: ">="
          value: "medium"
        - field: "mentions_timeline"
          operator: "=="
          value: true
        - field: "acknowledges_constraints"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G0_P4'"
      - "set_tone: 'Professional'"
      - "prioritize_intervention: 'PlanDesign'"
      - "refine_existing_plan: true"
    confidence: 0.87
    rationale: "구체적 목표와 현실적 인식은 계획 정교화 지원에 적합"

  - rule_id: "PI_G0_005_fear_based_avoider"
    priority: 93
    description: "두려움 기반 목표 회피자(G0_P5) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["못할 것 같", "무서워", "실패하면", "안 되면", "자신 없어"]
        - field: "sets_minimal_goals"
          operator: "=="
          value: true
        - field: "avoids_challenging_goals"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G0_P5'"
      - "set_tone: 'Encouraging'"
      - "prioritize_intervention: 'EmotionalSupport'"
      - "build_confidence: true"
    confidence: 0.90
    rationale: "실패 두려움 표현은 정서적 지원과 자신감 구축이 필요"

  - rule_id: "PI_G0_006_strategic_optimizer"
    priority: 84
    description: "전략적 최적화 추구자(G0_P6) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["효율적", "최적화", "우선순위", "전략", "분석", "데이터"]
        - field: "asks_optimization_questions"
          operator: "=="
          value: true
        - field: "requests_metrics"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G0_P6'"
      - "set_tone: 'Professional'"
      - "prioritize_intervention: 'PlanDesign'"
      - "provide_analytical_framework: true"
    confidence: 0.86
    rationale: "분석적 접근 요청은 데이터 기반 전략 지원에 적합"

  # === G1: 목표 진행 중 페르소나 ===

  - rule_id: "PI_G1_001_consistent_achiever"
    priority: 85
    description: "꾸준한 달성자(G1_P1) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G1"
      - AND:
        - field: "goal_progress_rate"
          operator: ">="
          value: 70
        - field: "consistency_score"
          operator: ">="
          value: "high"
        - field: "on_track_ratio"
          operator: ">="
          value: 0.8
    action:
      - "identify_persona: 'G1_P1'"
      - "set_tone: 'Professional'"
      - "prioritize_intervention: 'SkillBuilding'"
      - "suggest_stretch_goals: true"
    confidence: 0.88
    rationale: "높은 달성률과 꾸준함은 더 도전적인 목표 설정 기회"

  - rule_id: "PI_G1_002_struggling_perseverer"
    priority: 91
    description: "어려움 속 인내자(G1_P2) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G1"
      - AND:
        - field: "goal_progress_rate"
          operator: "<"
          value: 50
        - field: "effort_level"
          operator: ">="
          value: "high"
        - field: "user_message"
          operator: "contains_any"
          value: ["열심히 하는데", "노력하는데", "계속 해보는데", "포기 안 해"]
    action:
      - "identify_persona: 'G1_P2'"
      - "set_tone: 'Warm'"
      - "prioritize_intervention: 'EmotionalSupport'"
      - "acknowledge_effort: true"
      - "analyze_obstacles: true"
    confidence: 0.89
    rationale: "노력에도 불구한 낮은 진행률은 방법 개선과 정서 지원 필요"

  - rule_id: "PI_G1_003_inconsistent_starter"
    priority: 88
    description: "일관성 없는 시작자(G1_P3) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G1"
      - OR:
        - field: "consistency_score"
          operator: "<="
          value: "low"
        - field: "abandoned_goals_ratio"
          operator: ">="
          value: 0.5
        - field: "user_message"
          operator: "contains_any"
          value: ["또 못 했어", "까먹었어", "다시 시작", "새로 해볼게"]
    action:
      - "identify_persona: 'G1_P3'"
      - "set_tone: 'Gentle'"
      - "prioritize_intervention: 'BehaviorModification'"
      - "simplify_goals: true"
      - "build_habit_system: true"
    confidence: 0.87
    rationale: "낮은 일관성은 습관 형성과 목표 단순화 필요"

  - rule_id: "PI_G1_004_overloaded_multitasker"
    priority: 94
    description: "과부하 멀티태스커(G1_P4) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G1"
      - OR:
        - field: "active_goal_count"
          operator: ">="
          value: 8
        - field: "user_message"
          operator: "contains_any"
          value: ["너무 많아", "감당이 안", "다 못 해", "시간이 없어", "벅차"]
        - field: "shows_overwhelm"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G1_P4'"
      - "set_tone: 'Calm'"
      - "prioritize_intervention: 'GapAnalysis'"
      - "prioritize_goals: true"
      - "suggest_goal_reduction: true"
    confidence: 0.92
    rationale: "과도한 목표 수와 압도감은 우선순위 조정이 시급"

  - rule_id: "PI_G1_005_near_completion"
    priority: 83
    description: "완료 직전 목표 보유자(G1_P5) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G1"
      - AND:
        - field: "goals_near_completion"
          operator: ">="
          value: 2
        - field: "goal_progress_rate"
          operator: ">="
          value: 80
    action:
      - "identify_persona: 'G1_P5'"
      - "set_tone: 'Encouraging'"
      - "prioritize_intervention: 'SkillBuilding'"
      - "prepare_completion_celebration: true"
      - "suggest_next_goals: true"
    confidence: 0.85
    rationale: "완료 직전 목표들은 마무리 동기 부여와 다음 단계 준비 필요"

  # === G2: 목표 정체/위기 상황 페르소나 ===

  - rule_id: "PI_G2_001_plateau_frustrated"
    priority: 90
    description: "정체 좌절형(G2_P1) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G2"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["왜 안 늘어", "제자리", "변화가 없어", "답답해", "막혀"]
        - field: "progress_stagnant_weeks"
          operator: ">="
          value: 3
        - field: "emotional_state"
          operator: "=="
          value: "frustrated"
    action:
      - "identify_persona: 'G2_P1'"
      - "set_tone: 'Warm'"
      - "prioritize_intervention: 'GapAnalysis'"
      - "analyze_plateau_causes: true"
      - "suggest_strategy_pivot: true"
    confidence: 0.89
    rationale: "장기 정체와 좌절감은 전략 전환과 정서 지원 필요"

  - rule_id: "PI_G2_002_giving_up"
    priority: 97
    description: "포기 직전형(G2_P2) 식별 - 최우선"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G2"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["포기할래", "안 할래", "그만둘래", "소용없어", "못하겠어"]
        - field: "shows_giving_up"
          operator: "=="
          value: true
        - field: "goal_abandonment_intent"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G2_P2'"
      - "set_tone: 'Warm'"
      - "set_pace: 'very_slow'"
      - "prioritize_intervention: 'EmotionalSupport'"
      - "focus_on_small_wins: true"
      - "remove_pressure: true"
    confidence: 0.95
    rationale: "포기 의사 표현은 즉각적인 정서 지원과 목표 재조정 필요"

  - rule_id: "PI_G2_003_comparison_distressed"
    priority: 89
    description: "비교 고통형(G2_P3) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G2"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["친구는 벌써", "다른 애들", "나만 못해", "뒤처져", "비교"]
        - field: "comparison_with_peers"
          operator: "=="
          value: true
        - field: "self_esteem_low"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G2_P3'"
      - "set_tone: 'Warm'"
      - "prioritize_intervention: 'EmotionalSupport'"
      - "emphasize_personal_growth: true"
      - "discourage_comparison: true"
    confidence: 0.88
    rationale: "타인 비교와 자존감 저하는 개인 성장 관점 전환 필요"

  - rule_id: "PI_G2_004_external_blocker"
    priority: 86
    description: "외부 장애 직면형(G2_P4) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G2"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["시간이 없어서", "학교 때문에", "시험 기간이라", "바빠서", "상황이"]
        - field: "reports_external_barriers"
          operator: "=="
          value: true
        - field: "schedule_conflicts"
          operator: ">="
          value: 2
    action:
      - "identify_persona: 'G2_P4'"
      - "set_tone: 'Collaborative'"
      - "prioritize_intervention: 'PlanDesign'"
      - "adapt_to_constraints: true"
      - "find_micro_opportunities: true"
    confidence: 0.84
    rationale: "외부 장애 보고는 현실적 일정 조정과 미시 기회 탐색 필요"

  # === G3: 목표 재설정 상황 페르소나 ===

  - rule_id: "PI_G3_001_reflective_adjuster"
    priority: 85
    description: "성찰적 조정자(G3_P1) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G3"
      - AND:
        - field: "user_message"
          operator: "contains_any"
          value: ["다시 생각해보니", "조정해야", "너무 무리였어", "현실적으로"]
        - field: "accepts_adjustment"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G3_P1'"
      - "set_tone: 'Professional'"
      - "prioritize_intervention: 'GoalSetting'"
      - "guide_smart_adjustment: true"
    confidence: 0.87
    rationale: "자발적 조정 의사는 목표 재설정 지원에 최적"

  - rule_id: "PI_G3_002_defensive_rationalizer"
    priority: 88
    description: "방어적 합리화형(G3_P2) 식별"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G3"
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["원래 목표가", "그건 아니었어", "그냥 해본", "별로 중요하지"]
        - field: "minimizes_original_goal"
          operator: "=="
          value: true
        - field: "rationalizes_failure"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'G3_P2'"
      - "set_tone: 'Gentle'"
      - "prioritize_intervention: 'EmotionalSupport'"
      - "acknowledge_effort_first: true"
      - "gentle_reality_check: true"
    confidence: 0.86
    rationale: "합리화 패턴은 정서적 안전 확보 후 현실 점검 필요"

  # === 위기 상황 페르소나 (최우선) ===

  - rule_id: "PI_CRISIS_001_goal_anxiety"
    priority: 100
    description: "목표 불안 위기형 식별 - 즉시 개입"
    conditions:
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["압박감", "스트레스", "잠이 안 와", "불안해", "걱정돼", "무서워"]
        - field: "emotional_state"
          operator: "=="
          value: "anxiety"
        - field: "stress_indicators"
          operator: ">="
          value: 3
    action:
      - "identify_persona: 'CRISIS_P1'"
      - "set_tone: 'Warm'"
      - "set_pace: 'very_slow'"
      - "prioritize_intervention: 'SafetyNet'"
      - "pause_goal_discussion: true"
      - "provide_emotional_support: true"
    confidence: 0.96
    rationale: "목표 관련 불안은 즉각적인 정서 안정이 최우선"

  - rule_id: "PI_CRISIS_002_burnout_signs"
    priority: 100
    description: "번아웃 징후 감지 - 긴급 개입"
    conditions:
      - OR:
        - field: "user_message"
          operator: "contains_any"
          value: ["지쳤어", "힘들어", "다 그만두고 싶어", "의욕이 없어", "무기력"]
        - field: "shows_burnout"
          operator: "=="
          value: true
        - field: "motivation_drop_significant"
          operator: "=="
          value: true
    action:
      - "identify_persona: 'CRISIS_P2'"
      - "set_tone: 'Warm'"
      - "set_pace: 'very_slow'"
      - "prioritize_intervention: 'CrisisIntervention'"
      - "suggest_rest: true"
      - "reduce_all_goals: true"
    confidence: 0.97
    rationale: "번아웃 징후는 목표 축소와 휴식이 최우선"

# ============================================================
# SECTION 2: 목표 분석 응답 생성 룰
# ============================================================

response_generation_rules:

  # === 목표 현황 분석 응답 ===

  - rule_id: "RG_001_goal_status_overview"
    priority: 92
    description: "목표 현황 분석 결과 전달"
    conditions:
      - field: "request_type"
        operator: "=="
        value: "goal_status_analysis"
    action:
      - "load_goal_metrics"
      - "identify_dominant_persona"
      - "generate_status_response"
    response_templates:
      G1_P1:
        opening: "목표 달성 현황이 아주 좋네요!"
        body: "현재 {active_goals}개 목표 중 {completion_rate}%가 진행 중이에요. 특히 {top_category} 영역에서 뛰어난 성과를 보이고 있어요."
        closing: "이 페이스 유지하면서, 다음 도전도 생각해볼까요?"
      G1_P2:
        opening: "열심히 노력하고 있는 게 보여요."
        body: "목표 달성이 쉽지 않지만, {effort_indicator}에서 노력이 드러나요. {obstacle_area}가 어려운 것 같은데, 함께 방법을 찾아봐요."
        closing: "지금처럼 포기하지 않는 게 중요해요."
      G1_P4:
        opening: "목표가 많이 쌓여 있네요."
        body: "현재 {active_goals}개 목표가 동시에 진행 중이에요. {overloaded_categories}에 집중이 분산되어 있어요."
        closing: "가장 중요한 것부터 우선순위를 정해볼까요?"
      G2_P1:
        opening: "최근 진행이 조금 멈춘 것 같아요."
        body: "{stagnant_goals}개 목표가 {weeks}주째 정체 중이에요. 이건 흔한 일이에요. 방법을 바꿔볼 시점인 것 같아요."
        closing: "새로운 접근을 같이 찾아봐요."

  # === 목표 품질 피드백 ===

  - rule_id: "RG_002_goal_quality_feedback"
    priority: 90
    description: "설정된 목표의 품질 분석 피드백"
    conditions:
      - field: "request_type"
        operator: "=="
        value: "goal_quality_check"
    action:
      - "analyze_goal_quality"
      - "generate_quality_feedback"
    response_templates:
      high_quality:
        opening: "잘 설정된 목표예요!"
        body: "구체적({specificity_score}점), 측정 가능({measurable_score}점), 달성 가능({achievable_score}점), 관련성({relevant_score}점), 기한({timebound_score}점) 모두 좋아요."
        closing: "이대로 진행하면 돼요."
      needs_specificity:
        opening: "목표가 조금 모호해요."
        body: "'{goal_text}'을 더 구체적으로 만들어볼까요? 예를 들어 '언제까지, 무엇을, 어느 정도'로 정해보면 좋겠어요."
        closing: "구체적일수록 달성하기 쉬워요."
      needs_timeline:
        opening: "기한이 없는 목표네요."
        body: "언제까지 달성할지 정하면 동기부여가 더 돼요. {suggested_deadline} 정도는 어떨까요?"
        closing: "기한을 정하면 계획을 세우기 쉬워요."
      too_ambitious:
        opening: "멋진 목표지만, 조금 조정해볼까요?"
        body: "현재 상황에서 이 목표는 {difficulty_level}로 보여요. 중간 단계를 추가하면 성공 확률이 높아져요."
        closing: "작은 성공을 쌓아가는 게 더 효과적이에요."

  # === 카테고리 균형 분석 ===

  - rule_id: "RG_003_category_balance"
    priority: 88
    description: "목표 카테고리 균형 분석 결과"
    conditions:
      - field: "request_type"
        operator: "=="
        value: "category_balance_analysis"
    action:
      - "analyze_category_distribution"
      - "generate_balance_feedback"
    response_templates:
      balanced:
        opening: "목표가 균형 있게 분포되어 있어요."
        body: "{categories_summary} 다양한 영역에서 성장하고 있네요."
        closing: "이런 균형이 전체적인 발전에 도움이 돼요."
      concentrated:
        opening: "목표가 한 영역에 집중되어 있어요."
        body: "{dominant_category}에 {concentration_rate}%가 몰려 있어요. 다른 영역도 고려해볼까요?"
        closing: "균형 잡힌 성장도 중요해요."
      neglected_area:
        opening: "{neglected_category} 영역에 목표가 없네요."
        body: "이 영역도 성장에 중요할 수 있어요. 작은 목표부터 추가해볼까요?"
        closing: "모든 영역이 연결되어 있어요."

# ============================================================
# SECTION 3: 포괄형 질문 응답 룰
# ============================================================

comprehensive_question_rules:

  # === 포괄형 질문 1: 목표 설정 전략 ===

  - rule_id: "CQ_001_goal_setting_strategy"
    priority: 95
    description: "효과적인 목표 설정 방법 안내"
    conditions:
      - field: "question_type"
        operator: "=="
        value: "comprehensive_goal_setting"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "어떻게 목표"
        - field: "user_message"
          operator: "contains"
          value: "목표 세우"
    action:
      - "load_student_context"
      - "identify_dominant_persona"
      - "generate_goal_setting_guide"
    response_structure:
      intro_by_persona:
        high_anxiety: "목표 설정, 어렵게 생각하지 않아도 돼요."
        high_confidence: "좋은 목표가 좋은 결과를 만들어요."
        low_motivation: "작고 재미있는 목표부터 시작해볼까요?"
        balanced: "효과적인 목표 설정 방법을 알려드릴게요."
      body_components:
        - section: "SMART 기준"
          content:
            - "Specific(구체적): 무엇을 달성할지 명확하게"
            - "Measurable(측정 가능): 성공을 어떻게 알 수 있는지"
            - "Achievable(달성 가능): 현실적으로 가능한 수준"
            - "Relevant(관련성): 왜 이 목표가 중요한지"
            - "Time-bound(기한): 언제까지 달성할지"
        - section: "페르소나별 팁"
          persona_tips:
            G0_P1: "큰 목표는 중간 마일스톤으로 나눠보세요."
            G0_P2: "숫자로 측정할 수 있게 만들어보세요."
            G0_P5: "100% 달성보다 시작이 중요해요."
      closing_by_persona:
        high_emotional: "편안하게 천천히 정해봐요."
        analytical: "데이터를 참고해서 결정해도 좋아요."

  # === 포괄형 질문 2: 목표 달성 전략 ===

  - rule_id: "CQ_002_achievement_strategy"
    priority: 95
    description: "목표 달성을 위한 전략 안내"
    conditions:
      - field: "question_type"
        operator: "=="
        value: "comprehensive_achievement"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "어떻게 달성"
        - field: "user_message"
          operator: "contains"
          value: "목표 이루"
    action:
      - "load_goal_data"
      - "generate_achievement_strategy"
    response_structure:
      intro_by_persona:
        G1_P1: "지금처럼 하면 충분해요. 더 효율적인 방법도 있어요."
        G1_P2: "포기하지 않는 게 가장 중요해요. 방법을 바꿔볼까요?"
        G1_P3: "일관성을 높이는 방법을 찾아봐요."
        G1_P4: "덜어내는 것도 전략이에요."
      body_components:
        - section: "실행 전략"
          strategies:
            - "목표를 작은 단계로 분해하기"
            - "매일 조금씩 진행하기"
            - "진행 상황 기록하기"
            - "장애물 미리 예측하고 대비하기"
        - section: "동기 유지"
          tips:
            - "왜 이 목표가 중요한지 기억하기"
            - "작은 성공 축하하기"
            - "진행 과정을 시각화하기"

  # === 포괄형 질문 3: 목표 조정 가이드 ===

  - rule_id: "CQ_003_goal_adjustment_guide"
    priority: 95
    description: "목표 조정이 필요할 때 가이드"
    conditions:
      - field: "question_type"
        operator: "=="
        value: "comprehensive_adjustment"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "목표 바꿔"
        - field: "user_message"
          operator: "contains"
          value: "조정해"
    action:
      - "assess_adjustment_need"
      - "generate_adjustment_guide"
    response_structure:
      intro: "목표를 조정하는 건 실패가 아니에요. 성장의 일부예요."
      body_components:
        - section: "언제 조정이 필요한가"
          indicators:
            - "상황이 크게 바뀌었을 때"
            - "목표가 더 이상 의미 없을 때"
            - "현실적으로 불가능해졌을 때"
            - "더 중요한 목표가 생겼을 때"
        - section: "어떻게 조정하는가"
          methods:
            - "목표 수준 조정 (높이기/낮추기)"
            - "기한 조정 (연장/단축)"
            - "방법 변경 (접근법 수정)"
            - "완전 재설정 (새 목표로 대체)"

# ============================================================
# SECTION 4: 상황별 맞춤 질문 응답 룰
# ============================================================

situation_specific_rules:

  # === 새 목표 설정 상황 ===

  - rule_id: "SS_G0_001_new_goal_support"
    priority: 90
    description: "새 목표 설정 시 페르소나별 지원"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G0"
      - field: "action_type"
        operator: "=="
        value: "create_goal"
    response_by_persona:
      G0_P1:
        approach: "현실적 조정 제안"
        message: "멋진 목표예요! 중간 단계를 추가하면 더 확실히 달성할 수 있어요. {suggested_milestones}"
      G0_P2:
        approach: "구체화 가이드"
        message: "좋은 방향이에요! 조금 더 구체적으로 만들어볼까요? 언제까지 무엇을 얼마나 할지 정해봐요."
      G0_P5:
        approach: "안심 + 작은 시작"
        message: "시작하는 것만으로도 대단해요! 처음엔 작게 시작해도 괜찮아요. {smaller_version}"

  # === 진행 중 점검 상황 ===

  - rule_id: "SS_G1_001_progress_check"
    priority: 90
    description: "목표 진행 중 점검 피드백"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G1"
      - field: "action_type"
        operator: "=="
        value: "progress_check"
    response_by_persona:
      G1_P1:
        approach: "인정 + 다음 도전"
        message: "훌륭해요! {achievement_summary} 다음 목표도 도전해볼까요?"
      G1_P2:
        approach: "노력 인정 + 장애물 분석"
        message: "열심히 하고 있네요. {obstacle_analysis} 함께 해결 방법을 찾아봐요."
      G1_P4:
        approach: "우선순위 제안"
        message: "많은 목표를 동시에 하고 있네요. 가장 중요한 {priority_goal}에 집중하면 어떨까요?"

  # === 정체 상황 개입 ===

  - rule_id: "SS_G2_001_stagnation_intervention"
    priority: 92
    description: "목표 정체 시 개입"
    conditions:
      - field: "situation"
        operator: "=="
        value: "G2"
      - field: "stagnation_detected"
        operator: "=="
        value: true
    response_by_persona:
      G2_P1:
        approach: "공감 + 전략 전환"
        message: "진행이 멈춘 느낌이 들 수 있어요. 이건 정상이에요. 다른 방법을 시도해볼까요?"
      G2_P2:
        approach: "정서 지원 + 작은 성공"
        message: "지금 힘들다는 거 알아요. 잠시 쉬어도 괜찮아요. 아주 작은 것 하나만 해볼까요?"
      G2_P3:
        approach: "비교 중단 + 개인 성장"
        message: "다른 사람과 비교하지 않아도 돼요. 지난 나와 비교하면 {personal_growth}만큼 성장했어요."

# ============================================================
# SECTION 5: 톤 및 페이스 조절 룰
# ============================================================

tone_pace_rules:

  - rule_id: "TP_001_goal_anxiety_high"
    priority: 100
    description: "목표 불안이 높은 학생 - 톤/페이스 조절"
    conditions:
      - field: "goal_anxiety_level"
        operator: ">="
        value: "high"
    action:
      - "set_tone: 'Warm'"
      - "set_pace: 'slow'"
      - "reduce_goal_pressure"
      - "emphasize_process_over_outcome"
    message_modifications:
      opening: "목표 얘기 전에, 지금 기분이 어때요?"
      transitions: "천천히 하나씩 봐볼까요? 급할 거 없어요."
      closing: "오늘은 여기까지만 해도 충분해요."

  - rule_id: "TP_002_achievement_oriented"
    priority: 80
    description: "성취 지향 학생 - 데이터 중심 응답"
    conditions:
      - field: "goal_orientation"
        operator: "=="
        value: "achievement"
      - field: "information_preference"
        operator: "=="
        value: "detailed"
    action:
      - "set_tone: 'Professional'"
      - "set_pace: 'normal'"
      - "include_metrics"
      - "provide_actionable_insights"
    message_modifications:
      opening: "목표 달성 현황을 분석해봤어요."
      transitions: "다음으로, 데이터를 보면..."
      closing: "추가 분석이 필요하면 말씀해주세요."

  - rule_id: "TP_003_overwhelmed"
    priority: 95
    description: "과부하 상태 학생 - 단순화"
    conditions:
      - field: "shows_overwhelm"
        operator: "=="
        value: true
    action:
      - "set_tone: 'Calm'"
      - "set_pace: 'slow'"
      - "simplify_all_recommendations"
      - "suggest_goal_reduction"
    message_modifications:
      opening: "많이 힘들죠? 괜찮아요."
      transitions: "지금 가장 중요한 것 하나만 생각해봐요."
      closing: "나머지는 나중에 해도 돼요."

# ============================================================
# SECTION 6: 페르소나 전환 감지 룰
# ============================================================

persona_transition_rules:

  - rule_id: "PT_001_motivation_drop"
    priority: 92
    description: "동기 저하 감지 - 페르소나 전환"
    conditions:
      - field: "response_enthusiasm_change"
        operator: "=="
        value: "decreased"
      - field: "goal_engagement_drop"
        operator: "=="
        value: true
    action:
      - "reassess_persona"
      - "shift_to_encouragement_mode"
      - "explore_motivation_blockers"
      - "log_transition: 'motivation_drop'"

  - rule_id: "PT_002_success_momentum"
    priority: 85
    description: "성공 모멘텀 감지 - 긍정적 전환"
    conditions:
      - field: "recent_completions"
        operator: ">="
        value: 2
      - field: "confidence_increase"
        operator: "=="
        value: true
    action:
      - "reassess_persona"
      - "suggest_stretch_goals"
      - "celebrate_achievements"
      - "log_transition: 'success_momentum'"

  - rule_id: "PT_003_burnout_warning"
    priority: 98
    description: "번아웃 경고 감지 - 긴급 전환"
    conditions:
      - OR:
        - field: "workload_increase_sudden"
          operator: "=="
          value: true
        - field: "response_quality_drop"
          operator: "=="
          value: true
        - field: "mentions_exhaustion"
          operator: "=="
          value: true
    action:
      - "reassess_persona"
      - "shift_to_crisis_mode"
      - "suggest_goal_pause"
      - "prioritize_wellbeing"
      - "log_transition: 'burnout_warning'"

# ============================================================
# DEFAULT FALLBACK
# ============================================================

default_rule:
  rule_id: "default"
  action:
    - "use_balanced_tone"
    - "maintain_supportive_environment"
    - "continue_persona_observation"
    - "track_goal_metrics"
  message: "목표 상황을 파악하면서 맞춤형으로 진행할게요."
  confidence: 0.5

# ============================================================
# 관련 DB 테이블:
# - at_student_goals: 학생 목표 정보
# - at_goal_progress: 목표 진행 상황
# - at_goal_categories: 목표 카테고리
# - at_persona_rules: 페르소나 규칙
# - at_agent_persona_state: 에이전트별 페르소나 상태
# - at_persona_log: 페르소나 처리 로그
#
# 파일 위치:
# /mnt/c/1 Project/augmented_teacher/alt42/orchestration/agents/agent03_goals_analysis/persona_system/rules.yaml
# ============================================================
