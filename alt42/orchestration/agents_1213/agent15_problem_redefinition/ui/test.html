<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent 15 í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-section h2 {
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            opacity: 0.9;
        }

        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Agent 15 í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

    <!-- íŒŒì¼ ì¡´ì¬ í™•ì¸ -->
    <div class="test-section">
        <h2>1. íŒŒì¼ ì¡´ì¬ í™•ì¸</h2>
        <div id="file-check-status">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        <button onclick="checkFiles()">íŒŒì¼ í™•ì¸</button>
    </div>

    <!-- JavaScript ë¡œë“œ í™•ì¸ -->
    <div class="test-section">
        <h2>2. JavaScript ë¡œë“œ í™•ì¸</h2>
        <div id="js-check-status">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        <button onclick="checkJavaScriptFunctions()">í•¨ìˆ˜ í™•ì¸</button>
    </div>

    <!-- ì»´í¬ë„ŒíŠ¸ í†µí•© í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>3. ì»´í¬ë„ŒíŠ¸ í†µí•© í…ŒìŠ¤íŠ¸</h2>
        <div id="component-status">ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ PHP ì„œë²„ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>
        <p class="code">
            ì ‘ì†: <a class="link" href="index.php" target="_blank">https://mathking.kr/moodle/local/augmented_teacher/alt42/orchestration/agents/agent15_problem_redefinition/ui/index.php</a>
        </p>
    </div>

    <!-- API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ -->
    <div class="test-section">
        <h2>4. API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸</h2>
        <div id="api-check-status">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        <button onclick="checkAPIEndpoints()">API í™•ì¸</button>
        <div id="api-details" style="margin-top: 10px;"></div>
    </div>

    <!-- ì‚¬ìš©ì ID í™•ì¸ -->
    <div class="test-section">
        <h2>5. ì‚¬ìš©ì ID ì„¤ì •</h2>
        <div id="userid-status" class="status info">
            <strong>currentUserId:</strong> <span id="current-userid">ë¡œë“œ ì¤‘...</span>
        </div>
        <button onclick="setTestUserId()">í…ŒìŠ¤íŠ¸ ìœ ì € ID ì„¤ì • (userid=2)</button>
    </div>

    <!-- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>6. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸</h2>
        <div id="storage-status">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        <button onclick="testLocalStorage()">ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearLocalStorage()">ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”</button>
    </div>

    <script>
        // ì‚¬ìš©ì ID ì„¤ì •
        window.currentUserId = 2;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            updateUserIdDisplay();
            checkJavaScriptFunctions();
        });

        // ì‚¬ìš©ì ID í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateUserIdDisplay() {
            document.getElementById('current-userid').textContent = window.currentUserId || 'ì„¤ì • ì•ˆë¨';
        }

        // í…ŒìŠ¤íŠ¸ ìœ ì € ID ì„¤ì •
        function setTestUserId() {
            window.currentUserId = 2;
            updateUserIdDisplay();
            showStatus('userid-status', 'âœ… í…ŒìŠ¤íŠ¸ ìœ ì € IDê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤: 2', 'success');
        }

        // íŒŒì¼ ì¡´ì¬ í™•ì¸
        async function checkFiles() {
            const files = [
                'problem_redefinition_panel.php',
                'problem_redefinition_functions.js',
                'index.php',
                'README.md'
            ];

            const statusDiv = document.getElementById('file-check-status');
            statusDiv.innerHTML = '';

            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const status = response.ok ? 'âœ…' : 'âŒ';
                    const className = response.ok ? 'success' : 'error';
                    statusDiv.innerHTML += `<div class="status ${className}">${status} ${file} (${response.status})</div>`;
                } catch (error) {
                    statusDiv.innerHTML += `<div class="status error">âŒ ${file} (ì ‘ê·¼ ë¶ˆê°€)</div>`;
                }
            }
        }

        // JavaScript í•¨ìˆ˜ í™•ì¸
        function checkJavaScriptFunctions() {
            const functions = [
                'agent15FetchProblemRedefinition',
                'agent15SaveProblemRedefinition',
                'agent15LoadSavedRedefinition',
                'initializeAgent15ProblemRedefinition'
            ];

            const statusDiv = document.getElementById('js-check-status');
            statusDiv.innerHTML = '';

            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                const status = exists ? 'âœ…' : 'âŒ';
                const className = exists ? 'success' : 'error';
                statusDiv.innerHTML += `<div class="status ${className}">${status} ${funcName}()</div>`;
            });
        }

        // API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
        async function checkAPIEndpoints() {
            const apis = [
                '/moodle/local/augmented_teacher/alt42/orchestration/api/collect_workflow_data.php',
                '/moodle/local/augmented_teacher/alt42/orchestration/api/problem_redefinition_api.php'
            ];

            const statusDiv = document.getElementById('api-check-status');
            const detailsDiv = document.getElementById('api-details');
            statusDiv.innerHTML = '<div class="status info">API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ ì¤‘...</div>';
            detailsDiv.innerHTML = '';

            for (const api of apis) {
                try {
                    const response = await fetch(api, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ userId: window.currentUserId || 2 })
                    });

                    const status = response.ok ? 'âœ…' : 'âš ï¸';
                    const className = response.ok ? 'success' : 'info';
                    detailsDiv.innerHTML += `<div class="status ${className}">${status} ${api.split('/').pop()} (${response.status})</div>`;
                } catch (error) {
                    detailsDiv.innerHTML += `<div class="status error">âŒ ${api.split('/').pop()} (${error.message})</div>`;
                }
            }

            statusDiv.innerHTML = '<div class="status success">âœ… API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ ì™„ë£Œ</div>';
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸
        function testLocalStorage() {
            const userId = window.currentUserId || 2;
            const testKey = `agent15_redefinition_${userId}`;
            const testData = {
                userId: userId,
                content: 'í…ŒìŠ¤íŠ¸ ë¬¸ì œ ì¬ì •ì˜ ë‚´ìš©',
                timestamp: new Date().toISOString()
            };

            try {
                localStorage.setItem(testKey, JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem(testKey));

                if (retrieved && retrieved.content === testData.content) {
                    showStatus('storage-status', 'âœ… ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ', 'success');
                } else {
                    showStatus('storage-status', 'âŒ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ë¶ˆì¼ì¹˜', 'error');
                }
            } catch (error) {
                showStatus('storage-status', `âŒ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”
        function clearLocalStorage() {
            const userId = window.currentUserId || 2;
            const testKey = `agent15_redefinition_${userId}`;

            try {
                localStorage.removeItem(testKey);
                showStatus('storage-status', 'âœ… ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } catch (error) {
                showStatus('storage-status', `âŒ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // JavaScript íŒŒì¼ ë™ì  ë¡œë“œ ì‹œë„
        const script = document.createElement('script');
        script.src = 'problem_redefinition_functions.js?v=' + Date.now();
        script.onload = function() {
            console.log('âœ… problem_redefinition_functions.js ë¡œë“œ ì„±ê³µ');
            checkJavaScriptFunctions();
        };
        script.onerror = function() {
            console.log('âŒ problem_redefinition_functions.js ë¡œë“œ ì‹¤íŒ¨');
            showStatus('js-check-status', 'âŒ JavaScript íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        };
        document.head.appendChild(script);
    </script>
</body>
</html>
