
요청 요지: 이 에이전트는 **대한민국 초중고 수학학원 시스템**에 특화되어, 매주 첫 수업(또는 요청 시) 실행되고, 시험 8주 전부터 해당 시점 전략 수립을 시작하며, 풍부한 개인 변수와 가상 시뮬레이션으로 "실행 가능 + 수용 가능한" 최적 학습 플랜을 생성한다는 거지?
핵심 과제: **학원-학교-집 학습 연계** + 시간예산·난이도·정서/동기·목표점수·콘텐츠 소요시간을 수치화 → 시뮬레이션 → 선택과 집중. 
 
# Agent 02 실행 스펙(운영 규칙)

## 1) 트리거 & 타임라인

* 실행 트리거: (a) 매주 첫 수업 시작 T0, (b) 사용자가 “전략 갱신” 요청, (c) 시험 D=56일(8주) 진입 시 자동.
* 운영 주기: 매주 재평가(Weekly Replan) + 이벤트성 갱신(컨디션 급변, 범위 공지 변경, 모의고사 결과).
* 메뉴 자동 매핑: 오늘 날짜 기준으로 D-day 구간을 계산해 8개 메뉴 중 하나로 자동 진입(방학/없음 포함).

## 2) 입력 변수(정규화 기준 포함) - 수학학원 시스템 특화

* 학습자 프로필: 학년(g), **학원 등급(반)(a_grade)**, MBTI(m), 목표점수(t), **목표 학원 등수(a_rank_target)**, 시험 중요도(w), 동기부여(s), 정서상태(e)
* 준비상태: 현재 실력 레벨 L∈[0,1], 취약 단원/유형 분포 V(unit_i → p_i), 실전 경험 r(모의/대회), **학원 모의고사 등수(a_rank_current)**
* **학원 정보 (핵심)**:
  * 학원명, 학원 수업 일정 A_schedule, 학원 진도 A_progress(현재 단원, 예상 진도)
  * 학원 과제 A_hw{교재명, 단원별 과제량, 완료율, 소요시간}
  * 학원 모의고사 일정 A_mock_schedule, 학원 선생님 피드백 A_teacher_feedback
* 리소스: 사용하는 교재 세트 R (**학원 교재: 쎈, 개념원리, RPM, 블랙라벨 등 포함**), 기출 세트 G(**학원 모의고사 기출 포함**), 스튜디오/문항 뱅크 B
* 시간 제약: 하루 가능 시간 H_d, 주간 가능 시간 H_w, **학원 수업 시간 A_class_time**, 불가 요일/블록 U
* 대화 신호: 부모님 대화 요약 P (기대/제약/지원), **학원 선생님 피드백 A_teacher**, 학생 수용성 힌트 A_h (싫어하는 방식, 선호 채널)
* 운영 규칙: 단계 순서 기본값 S₀ = [개념→유형→심화→기출] (**학원 교재 단계별: 개념원리 → 쎈 A/B → 쎈 C/블랙라벨 → 기출**)

정규화 예:

* 중요도 w∈{상:1.0, 중:0.7, 하:0.4}, 동기 s∈[0,1], 정서 e∈[-1,1]
* 단원 난이도 d_i∈[0.8,1.4] (교내 기준 1.0, 고난도 1.2~1.4)

## 3) 시간예산 & 콘텐츠 소요시간 산정 (수학학원 시스템 특화)

* 일/주 시간예산: H_w = Σ(가용 블록 - 학원 수업 시간 A_class_time)×집중계수 c_focus, c_focus = 1−fatigue(누적)
* **학원-집 학습 시간 배분**:
  * 학원 수업 전 예습 시간: A_prep_time = H_d × 0.15 (학원 수업 이해도 향상)
  * 학원 수업 후 복습 시간: A_review_time = H_d × 0.20 (학원 수업 내용 정리)
  * 학원 과제 수행 시간: A_hw_time = Σ(T_hw_i × 과제량_i × 완료율_i)
  * 남은 집 학습 시간: H_home = H_d - A_class_time - A_prep_time - A_review_time - A_hw_time
* 콘텐츠 소요시간 추정 (**학원 교재별**):

  * 개념(unit i): T_c(i)=k_c·pages_i·d_i·α(L) (**개념원리 기준**)
  * 유형: T_t(i)=k_t·sets_i·d_i·β(L) (**쎈 A/B단계, RPM Easy/Normal 기준**)
  * 심화: T_h(i)=k_h·items_i·d_i·γ(L) (**쎈 C단계, RPM Hard, 블랙라벨 기준**)
  * 기출: T_g(range)=k_g·papers·δ(L) (**학원 모의고사 기출 + 학교 기출**)
* L(현재 실력)이 낮을수록 α,β,γ,δ 증가. MBTI·선호도에 따라 분량/형식 가중(예: N/S는 노트정리, T/F는 설명형 피드백 비중 조절).
* **학원 교재별 평균 소요 시간** (경험값):
  * 쎈 A단계: 30분/10문제, B단계: 45분/10문제, C단계: 60분/10문제
  * 개념원리 개념: 20분/페이지, 유형: 15분/문제
  * RPM Easy: 25분/10문제, Normal: 35분/10문제, Hard: 50분/10문제

## 4) 목표점수 역산(Required Gain)

* 현재 점수 E_now, 목표 t, 시험 가중 w → 필요 개선 Δ= (t−E_now)·w
* 단원별 기여도 g_i를 산정(출제비중×취약도) → 우선순위 π_i = g_i / T_total(i)
* 컷라인 안정화 규칙: 핵심 단원군(상위 30% g_i)을 선제 확보 후, 잔여시간으로 변별력 단원 투입.

## 5) 전략 생성 파이프라인(시뮬레이션 포함)

1. **베이스 플랜 생성**: S₀(개념→유형→심화→기출)로 시간예산 내 배치.
2. **우선순위 할당**: π_i 상위부터 슬롯 채우기(“필수→핵심→보강”).
3. **학습-정리-실전 조합 최적화**:

   * 조합 벡터 z = (a_c, a_t, a_h, a_g) 비율 합=1, 구간별 권장 비율(메뉴별 디폴트)로 초기화.
4. **가상 시뮬레이션**(Monte-Carlo/그리디 혼합):

   * 학습효율 함수 E_stage(hr) = base(stage)×f(L,d_i,e,s)×스페이싱효과
   * 1주 단위로 z를 미세 조정하며 기대점수 증가 Δ̂ 최대화, 변동성(피로, 이탈) 패널티 최소화.
5. **수용성 검사(Feasibility)**:

   * 학생 수용 점수 A = w_method·선호적합 + w_load·부하수준 + w_routine·루틴 일관성
   * A ≥ θ(예: 0.7) 미만이면, 난이도·분량·형식(해설 방식/매체) 조정.
6. **정서/동기 보정**: e<0 또는 s<0.5면, “짧은 성공경험 모듈 + 시각 보상 루프” 삽입.
7. **시간 초과/미달 처리**: 초과 시 변별력 낮은 꼬리 과제 제거, 미달 시 워밍업/복습 청킹 삽입.
8. **리스크 헤지**: 기출 라이트 세트(소단위) 조기 배치 + 전주/전일 리허설 고정.
9. **주간 리플랜**: 결과 KPI(정답률, 소요시간 편차, 인지부하 자기보고)로 다음 주 z 재학습.

### 기대효과 모델(간단 수식)

* 단원 i, 단계 s에서 1시간 투자 기대득점: G(i,s)=w_i·E_s·(1−overlap_penalty)
* 스페이싱 스케줄: FSRS/Anki 류 간격 근사(1-2-4-7일)로 미니리뷰 자동 배치.

## 6) 메뉴별 디폴트 비율 z (가이드) - 수학학원 시스템 특화

* D>10일: 개념 0.35 / 유형 0.35 / 심화 0.10 / 기출 0.10 / **학원 과제 0.10** (학원 과제 우선순위 반영)
* D4~10일: 개념 0.25 / 유형 0.35 / 심화 0.10 / 기출 0.15 / **학원 과제 0.15** (학원 과제 비중 증가)
* D≤3일: 개념 0.05 / 유형 0.20 / 심화 0.10 / 기출 0.45 / **학원 과제 0.20** (학원 교재 최종 복습)
* 방학: 선행 포함(개념↑, 심화↑), **학원 선행 학습 30%** (학원 진도 예습)
* 시험없음: 루틴 유지(개념·유형 균형), **학원 과제 40%** (학원 수업 이해도 향상 중심)

## 7) 출력(학생이 "실행할 만한" 형태) - 수학학원 시스템 특화

* **주간 타임블록표**: 요일×블록, 각 블록 목표·콘텐츠·예상시간 (**학원 수업 시간 포함, 학원 수업 전후 예습/복습 시간 명시**).
* **우선순위 리스트**: 단원 Top/N, 취약 유형 큐, **학원 과제 우선순위**, **학원 교재 단계별 진도**.
* **학원-학교-집 시간 배분표**: 학원 수업, 학교 수업, 집 학습 시간 통합 관리.
* **학원 교재별 학습 계획**: 쎈 A/B/C단계, 개념원리, RPM 등 단계별 학습 계획.
* **훈련 모듈**: 워밍업(5~10분)→핵심(40~60분)→리허설(10~20분) 고정 리듬 (**학원 수업 전 예습, 학원 수업 후 복습 포함**).
* **정서/동기 루틴**: 짧은 성공과제, 시각적 진행률, 보상 트리거, **학원 등수 향상 목표**.
* **KPI**: 단계별 정답률, 실제/예상 소요시간, 리텐션 체크(퀴즈/서술 스피드), **학원 과제 완료율**, **학원 수업 이해도**, **학원 모의고사 등수**.
* **전략 요약 카드**: 오늘 해야 할 3가지 (**학원 과제 포함**), 이번 주 리스크 2가지, 회복 전략 1가지, **학원 수업 전후 학습 포인트**.

## 8) 저장/인터페이스(테이블 확장)

* 테이블 `mdl_alt42g_exam_strategies` 확장 필드:

  * `student_id`, `exam_id`, `d_day`, `profile_json`(학년/목표/MBTI/동기/정서/대화요약),
  * **`academy_json`(학원명/학원등급/학원진도/학원과제/학원모의고사일정/학원선생님피드백)**,
  * `weakness_map`, `resource_set`(**학원교재 포함**), `time_budget`(**학원수업시간 포함**), `stage_mix`(z),
  * `sim_params`(가중치, 임계값), `feasibility_score`, `kpi_baseline`(**학원과제완료율/학원등수 포함**),
  * `generated_strategy`, `strategy_summary`, `created_at`, `updated_at`.
* API: `POST /exam/strategy/generate`, `PUT /exam/strategy/replan`, `GET /exam/strategy/:id`
* UI: 메뉴 선택→변수 슬라이더/체크→전략 미리보기→“학생 수용성 점검” 체크리스트→확정.

## 9) 의사코드(핵심 루프)

```pseudo
onTrigger():
  ctx = collectInputs()
  menu = mapDdayToMenu(ctx.today, ctx.exam_date)
  z = defaultMix(menu)
  base = makeBasePlan(ctx, z)

  repeat until converge or iter=K:
    sim = simulate(base, ctx.L, ctx.V, ctx.e, ctx.s)
    A = acceptance(sim, ctx.preferences)
    if A < theta:
      base = adjustForAcceptance(base, ctx)
    base = refineByGainPerHour(base, sim.gain, ctx.time_budget)

  plan = finalize(base)
  save(plan, KPIs, scores)
  return planSummary(plan)
```

## 10) 예시(요약형, D-27일, 목표 92점, 중요도 상, 약점: 함수/도형)

* 주간예산 540분(=90×6일), 권장 z: 개념0.30/유형0.40/심화0.15/기출0.15
* 배치:

  * 월/수/금: 함수 개념 30′ + 유형 40′ + 기출 라이트 20′
  * 화/목: 도형 유형 50′ + 심화 30′ + 리텐션퀴즈 10′
  * 토: 전범위 미니모의 60′ + 오답정리 30′
* KPI: 함수·도형 유형 정답률 이번 주 +12% 목표, 실제시간 편차 ±15% 이내.

## 11) 안전장치 & Fallback

* API 실패/정보 부족: 메뉴별 기본 전략 템플릿 + 단원 비중 표준 분포로 즉시 제공.
* 과부하 감지(실제/예상 소요시간 >1.3배 2회 연속): 다음 주 z에서 개념/심화 감축, 기출·유형을 짧게 쪼개 배치.
* 정서 급락(e<-0.4): “성공경험 모듈” 15분 고정 삽입 후 난이도 재상향.
 