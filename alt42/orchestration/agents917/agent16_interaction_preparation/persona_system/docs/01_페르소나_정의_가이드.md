# 페르소나 정의 가이드

## 1. 개요

이 가이드는 Agent16의 페르소나를 정의하고 수정하는 방법을 설명합니다.
페르소나는 AI 에이전트의 인격, 톤, 개입 전략을 결정합니다.

---

## 2. 페르소나 구성 요소

### 2.1 필수 속성

| 속성 | 설명 | 예시 |
|------|------|------|
| persona_id | 고유 식별자 | A16_P1, A16_P2 |
| name | 페르소나 이름 | "체계적 가이드" |
| worldview | 연결된 세계관 | curriculum |
| tone | 톤 스타일 | Professional |
| intervention | 개입 전략 | GuidedDiscovery |
| priority | 우선순위 (1-9) | 1 |

### 2.2 선택 속성

| 속성 | 설명 | 예시 |
|------|------|------|
| description | 역할 설명 | "정규 교육과정 안내자" |
| triggers | 추가 트리거 | ["교과서", "단원"] |
| response_templates | 응답 템플릿 | {...} |

---

## 3. 페르소나 정의 파일

### 3.1 personas.md (문서)

마크다운 형식의 인간 가독성 높은 문서입니다.

```markdown
### A16_P1: 체계적 가이드 (커리큘럼)

**세계관**: 커리큘럼 - 체계적인 학습 과정 기반

**역할 설명**:
정규 교육과정에 따른 체계적인 학습을 안내하는 역할입니다.

**톤 스타일**: Professional
- 명확하고 체계적인 설명
- 학습 목표와 성취기준 제시

**개입 전략**: GuidedDiscovery
- 단원별 학습 목표 제시
- 선수학습 확인 및 연결

**트리거 키워드**: 정규과정, 단원, 학기, 교과서

**예시 응답**:
이번 단원은 [단원명]으로, 이전에 배운 [선수학습]과 연결됩니다.
```

### 3.2 ontology.jsonld (시맨틱 데이터)

JSON-LD 형식의 기계 가독성 높은 정의입니다.

```json
{
  "@id": "persona:A16_P1",
  "@type": "persona:Persona",
  "name": "체계적 가이드",
  "persona:id": "A16_P1",
  "description": "정규 교육과정에 따른 체계적인 학습 안내자",
  "hasWorldview": "worldview:Curriculum",
  "hasTone": "tone:Professional",
  "hasIntervention": "intervention:GuidedDiscovery",
  "priority": 1
}
```

---

## 4. 새 페르소나 추가하기

### 4.1 단계별 절차

**Step 1**: 세계관 확인
```php
// 먼저 연결할 세계관이 존재하는지 확인
$worldviews = $engine->getWorldviews();
```

**Step 2**: Agent16PersonaEngine.php 수정
```php
// $personas 배열에 추가
private $personas = [
    // 기존 페르소나들...

    'A16_P10' => [
        'persona_id' => 'A16_P10',
        'persona_name' => '새 페르소나',
        'worldview' => 'new_worldview',
        'tone' => 'NewTone',
        'intervention' => 'NewIntervention',
        'priority' => 10
    ]
];
```

**Step 3**: personas.md 문서화
```markdown
### A16_P10: 새 페르소나 (새 세계관)

**세계관**: 새 세계관 - 설명

**역할 설명**:
새 페르소나의 역할과 목적을 설명합니다.

**톤 스타일**: NewTone
- 특성 1
- 특성 2
```

**Step 4**: ontology.jsonld 추가
```json
{
  "@id": "persona:A16_P10",
  "@type": "persona:Persona",
  "name": "새 페르소나",
  "persona:id": "A16_P10",
  "hasWorldview": "worldview:NewWorldview",
  "hasTone": "tone:NewTone",
  "hasIntervention": "intervention:NewIntervention",
  "priority": 10
}
```

---

## 5. 톤 스타일 정의

### 5.1 기본 톤 스타일

| Tone ID | 한글명 | 특성 |
|---------|--------|------|
| Professional | 전문적 | 명확, 체계적, 권위 있음 |
| Supportive | 지원적 | 따뜻, 격려, 공감적 |
| Analytical | 분석적 | 논리적, 전략적, 데이터 기반 |
| Motivational | 동기부여 | 활기참, 열정적, 성취 지향 |
| Reflective | 성찰적 | 사려깊음, 질문 중심, 여유 |
| Empowering | 역량강화 | 자율 존중, 선택 제공 |
| Mentoring | 멘토링 | 경험 공유, 시범, 단계적 전수 |
| Practical | 실용적 | 구체적, 효율 중심 |
| Curious | 호기심 | 탐구적, 발견 지향 |

### 5.2 새 톤 추가

```json
// ontology.jsonld에 추가
{
  "@id": "tone:NewTone",
  "@type": "tone:ToneStyle",
  "name": "새 톤",
  "description": "톤의 특성과 사용 상황 설명"
}
```

---

## 6. 개입 전략 정의

### 6.1 기본 개입 전략

| 전략 ID | 한글명 | 설명 |
|---------|--------|------|
| GuidedDiscovery | 안내된 발견 | 체계적 개념 전달 |
| PersonalizedGuidance | 맞춤형 안내 | 개인 특성 기반 |
| StrategicSupport | 전략적 지원 | 목표 달성 전략 |
| DirectGuidance | 직접 안내 | 명확한 지시 |
| SocraticQuestioning | 소크라테스식 질문 | 질문으로 사고 유도 |
| ScaffoldedSupport | 단계적 지원 | 필요시 점진적 지원 |
| ModelingAndExplanation | 시범 및 설명 | 전문가 사고 시연 |
| TimeAwareness | 시간 인식 | 시간 관리 |
| InquiryBased | 탐구 기반 | 가설-검증 과정 |

### 6.2 새 전략 추가

```json
// ontology.jsonld에 추가
{
  "@id": "intervention:NewStrategy",
  "@type": "intervention:InterventionStrategy",
  "name": "새 전략",
  "description": "전략의 상세 설명"
}
```

---

## 7. 페르소나 우선순위

### 7.1 우선순위 원칙

1. **낮은 숫자 = 높은 우선순위**
2. 동일 신뢰도의 세계관이 감지되면 우선순위가 높은 페르소나 선택
3. 새 페르소나는 기존 범위 외의 우선순위 부여 권장

### 7.2 현재 우선순위

```
A16_P1 (커리큘럼)     : 1 (최고 우선순위)
A16_P2 (맞춤학습)     : 2
A16_P3 (시험대비)     : 3
A16_P4 (단기미션)     : 4
A16_P5 (자기성찰)     : 5
A16_P6 (자기주도)     : 6
A16_P7 (도제학습)     : 7
A16_P8 (시간성찰)     : 8
A16_P9 (탐구학습)     : 9 (최저 우선순위)
```

---

## 8. 검증 및 테스트

### 8.1 페르소나 로드 확인

```php
$engine = new Agent16PersonaEngine('agent16');
$personas = $engine->getPersonas();

foreach ($personas as $id => $persona) {
    echo "{$id}: {$persona['persona_name']}\n";
}
```

### 8.2 API로 테스트

```bash
# 세계관 목록 확인
curl 'https://mathking.kr/.../api/chat.php?action=worldviews'

# 특정 메시지로 페르소나 선택 테스트
curl -X POST '.../api/chat.php' \
  -d '{"action": "detect_worldview", "message": "시험 준비"}'
```

---

## 9. 문제 해결

### 9.1 페르소나가 로드되지 않음

```php
// 로그 확인
error_log("[Agent16] Persona load failed: " . __FILE__ . ":" . __LINE__);

// 파일 경로 확인
$path = __DIR__ . '/../personas/personas.md';
if (!file_exists($path)) {
    error_log("File not found: $path");
}
```

### 9.2 잘못된 페르소나 선택

1. 세계관 트리거 키워드 확인
2. 우선순위 충돌 확인
3. 신뢰도 계산 로직 점검

---

## 10. 모범 사례

1. **일관된 네이밍**: A16_P{N} 형식 유지
2. **문서 동기화**: 코드 변경 시 personas.md, ontology.jsonld 동시 업데이트
3. **테스트 우선**: 새 페르소나 추가 전 세계관 트리거 테스트
4. **점진적 추가**: 한 번에 하나의 페르소나만 추가

---

*이 문서는 페르소나 정의 및 관리 방법을 설명합니다.*
*관련: [00_시스템_개요.md](./00_시스템_개요.md), [02_세계관_설정_가이드.md](./02_세계관_설정_가이드.md)*
