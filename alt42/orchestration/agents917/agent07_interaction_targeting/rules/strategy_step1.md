# Strategy Step 1: 학생 상태 파악 및 정보 수집

> **목적**: 상호작용 타겟팅에 필요한 모든 정보를 수집하고 분석  
> **출력**: 타겟팅 의사결정을 위한 종합 컨텍스트 데이터

---

## 1. 필수 정보 수집 체크리스트

### 1.1 기본 학생 정보
- [ ] 학생 ID, 학년, 학기 정보
- [ ] 현재 날짜 및 시간
- [ ] 요일 정보 (평일/주말/방학)

**데이터 소스**: Agent 01 (온보딩), 시스템 시간

### 1.2 수학 학습 상태 (필수)

#### 1.2.1 현재 학습 단원 정보
- [ ] 현재 학교 수업 진도 (단원명, 페이지)
- [ ] 현재 학원 수업 진도 (단원명, 페이지)
- [ ] 다음 수업 예정 단원
- [ ] 최근 완료한 단원 목록

**데이터 소스**: 
- 학생설문 또는 선생님 체크리스트 입력
- Agent 04 (활동유형) - 현재 학습 활동 정보
- Agent 14 (오답노트) - 최근 풀이한 단원 정보

**데이터 없을 경우**: 
```
학생설문: "지금 학교에서 어떤 단원을 배우고 있나요?"
선생님 체크리스트: "현재 학습 단원: [입력]"
```

#### 1.2.2 현재 학습 단계
- [ ] 개념 학습 단계 여부
- [ ] 유형 연습 단계 여부
- [ ] 심화 문제 단계 여부
- [ ] 기출 문제 단계 여부

**판단 기준**:
- 개념 학습: 새 단원 시작, 교과서 읽기, 개념 설명 활동
- 유형 연습: 문제집 풀이, 유형별 연습
- 심화 문제: 심화 문제집, 변형 문제
- 기출 문제: 과거 기출, 모의고사

**데이터 소스**: Agent 04 (활동유형) - 현재 활동 분석

**데이터 없을 경우**:
```
학생설문: "지금 어떤 단계로 공부하고 있나요? (개념/유형/심화/기출)"
```

#### 1.2.3 단원별 학생 수준
- [ ] 현재 단원 정답률 (%)
- [ ] 단원별 취약 유형 목록
- [ ] 계산 실수 vs 개념 오류 비율
- [ ] 문제 유형별 성취도 (기본형/유형/심화)

**데이터 소스**: 
- Agent 14 (오답노트) - 단원별 오답 분석
- Agent 10 (학습내용) - 최근 성취도

**데이터 없을 경우**:
```
학생설문: "현재 단원에서 문제를 풀 때 정답률이 어느 정도인가요?"
선생님 체크리스트: "현재 단원 정답률: [입력]%"
```

#### 1.2.4 학생 수준 분류
- [ ] 하위권 / 중위권 / 상위권 분류
- [ ] 수학 학습 스타일 (계산형/개념형/응용형)

**판단 기준**:
- 하위권: 정답률 < 50%, 기본 개념 미흡
- 중위권: 정답률 50-70%, 유형 연습 필요
- 상위권: 정답률 > 70%, 심화 문제 가능

**데이터 소스**: Agent 01 (온보딩), Agent 14 (오답노트)

**데이터 없을 경우**:
```
학생설문: "수학 성적이 어느 정도인가요? (하위권/중위권/상위권)"
선생님 체크리스트: "학생 수준: [하위권/중위권/상위권]"
```

### 1.3 시간 및 에너지 상태

#### 1.3.1 현재 시간대 정보
- [ ] 시간 (HH:MM)
- [ ] 시간대 분류 (아침/오전/오후/저녁/밤)
- [ ] 요일 (평일/주말)

**데이터 소스**: 시스템 시간

#### 1.3.2 학생 에너지/집중도 상태
- [ ] 현재 집중도 (1-10점)
- [ ] 현재 에너지 레벨 (낮음/보통/높음)
- [ ] 감정 상태 (긍정/중립/부정)

**데이터 소스**: 
- Agent 05 (학습감정) - 현재 감정 상태
- Agent 08 (침착도) - 스트레스/안정도
- 포모도르 타이머 - 집중도 추적

**데이터 없을 경우**:
```
학생설문: "지금 집중도가 어느 정도인가요? (1-10점)"
"지금 기분이 어떤가요? (좋음/보통/안좋음)"
```

#### 1.3.3 학습 리듬 패턴 (선택)
- [ ] 학생별 최적 학습 시간대 (오전/오후/저녁)
- [ ] 단원별 최적 학습 시간대 기록
- [ ] 최근 학습 패턴 (언제 어떤 활동이 효과적이었는지)

**데이터 소스**: 
- Agent 10 (학습내용) - 과거 학습 로그 분석
- 효과성 로그 (상호작용 반응 데이터)

**데이터 없을 경우**: 기본값 사용 (오전: 개념, 오후: 유형, 저녁: 복습)

### 1.4 상황 맥락 정보

#### 1.4.1 시험 D-day 정보
- [ ] 다음 시험까지 남은 일수
- [ ] 시험 범위 (단원 목록)
- [ ] 목표 점수

**데이터 소스**: Agent 02 (시험계획) - D-day 정보

**데이터 없을 경우**:
```
학생설문: "다음 시험이 언제인가요? 시험 범위는?"
```

#### 1.4.2 학원 수업 맥락
- [ ] 오늘 학원 수업 예정 여부
- [ ] 수업 시간
- [ ] 수업 진도 (예정 단원)
- [ ] 수업 전/후 상태

**데이터 소스**: 학생설문 또는 선생님 체크리스트

**데이터 없을 경우**:
```
학생설문: "오늘 학원 수업이 있나요? 몇 시에 무엇을 배울 예정인가요?"
선생님 체크리스트: "학원 수업 정보: [입력]"
```

#### 1.4.3 현재 학습 상황
- [ ] 지금 무엇을 하고 있는지 (학습 중/휴식 중/고민 중)
- [ ] 현재 포모도르 세션 진행 여부
- [ ] 포모도르 경과 시간 (분)

**데이터 소스**: 
- Agent 03 (포모도르 일기) - 포모도르 로그
- 시스템 상태

### 1.5 목표 및 진도 정보

#### 1.5.1 목표 정보
- [ ] 분기 목표 (Agent 06)
- [ ] 주간 목표 (Agent 06)
- [ ] 오늘 목표 (Agent 06)

**데이터 소스**: Agent 06 (목표 분석)

#### 1.5.2 진도 정보
- [ ] 오늘 목표 대비 진도 (%)
- [ ] 주간 목표 대비 진도 (%)
- [ ] 남은 시간 및 작업량

**데이터 소스**: Agent 14 (현재 위치)

### 1.6 상호작용 효과성 데이터 (선택, 고도화)

#### 1.6.1 과거 효과성 로그
- [ ] 학생별 효과적 상호작용 모드 (도제학습/단기미션 등)
- [ ] 상황별 효과적 모드 매칭
- [ ] 최근 상호작용 반응도

**데이터 소스**: 상호작용 효과성 로그 (향후 구축)

**데이터 없을 경우**: 기본 룰 사용

---

## 2. 정보 검증 및 품질 확인

### 2.1 필수 정보 결측 확인
```
IF (현재 학습 단원 정보 없음) THEN
    → 학생설문 또는 선생님 체크리스트 입력 요청
    → 입력 완료까지 대기 또는 기본값 사용
END IF

IF (현재 학습 단계 정보 없음) THEN
    → Agent 04에서 활동 정보 조회
    → 활동 정보 없으면 학생설문 요청
END IF

IF (단원별 학생 수준 정보 없음) THEN
    → Agent 14에서 오답 분석 조회
    → 데이터 없으면 학생설문 요청
END IF
```

### 2.2 데이터 품질 검증
- 수집된 데이터의 신뢰도 확인
- 최신성 확인 (최근 7일 이내 데이터 우선)
- 일관성 확인 (여러 소스 간 데이터 일치 여부)

### 2.3 데이터 보완 전략
- 데이터 없을 경우: 학생설문 또는 선생님 체크리스트 입력
- 부분 데이터: 기본값 또는 추정값 사용
- 불확실 데이터: 신뢰도 낮음 표시 후 Step 2에 전달

---

## 3. 종합 컨텍스트 데이터 구조

### 3.1 출력 데이터 구조
```yaml
targeting_context:
  student_info:
    student_id: int
    grade: int
    current_date: datetime
    day_of_week: string
    
  math_learning_state:
    current_unit: string          # 현재 학습 단원
    current_stage: string         # 개념/유형/심화/기출
    unit_mastery: float           # 단원 정답률 (0-1)
    student_level: string         # 하위권/중위권/상위권
    learning_style: string        # 계산형/개념형/응용형
    weak_types: []                # 취약 유형 목록
    error_pattern:                # 오류 패턴
      calculation_error_rate: float
      concept_error_rate: float
      
  time_energy_state:
    current_time: datetime
    time_of_day: string           # 아침/오전/오후/저녁/밤
    focus_level: int              # 1-10
    energy_level: string          # 낮음/보통/높음
    emotion_state: string         # 긍정/중립/부정
    learning_rhythm:              # 학습 리듬 패턴
      optimal_time_slots: []
      unit_optimal_times: {}
      
  context_info:
    exam_dday: int                # 시험까지 남은 일수
    exam_scope: []                # 시험 범위 단원 목록
    academy_class:                # 학원 수업 정보
      has_class_today: bool
      class_time: datetime
      unit_to_learn: string
      status: string              # 수업 전/수업 후/없음
    current_activity: string      # 현재 활동 상태
    pomodoro_status:              # 포모도르 상태
      is_active: bool
      elapsed_minutes: int
      
  goals_progress:
    quarterly_goal: object
    weekly_goal: object
    daily_goal: object
    daily_progress: float         # 오늘 목표 대비 진도
    remaining_time: int           # 남은 시간 (분)
    
  effectiveness_data:            # 효과성 데이터 (선택)
    preferred_modes: []           # 학생별 효과적 모드
    mode_situation_match: {}      # 상황-모드 매칭
    
  data_quality:
    completeness: float           # 데이터 완성도 (0-1)
    reliability: float            # 신뢰도 (0-1)
    missing_fields: []            # 결측 필드 목록
```

---

## 4. Step 2 전달 조건

### 4.1 최소 요구사항
다음 정보가 모두 수집되어야 Step 2로 진행:
- [x] 학생 기본 정보
- [x] 현재 학습 단원 (또는 기본값)
- [x] 현재 학습 단계 (또는 추정)
- [x] 현재 시간 및 에너지 상태
- [x] 상황 맥락 (9가지 상황 중 최소 1개)

### 4.2 데이터 품질 기준
- 완성도 ≥ 0.6 (60% 이상 정보 수집)
- 신뢰도 ≥ 0.5 (절반 이상 신뢰 가능한 데이터)

### 4.3 Step 2 전달 프로세스
```
정보 수집 완료
  ↓
데이터 검증 및 품질 확인
  ↓
완성도 < 0.6 → 추가 정보 수집 요청
  ↓
완성도 ≥ 0.6 → Step 2로 전달
```

---

## 5. 에러 처리

### 5.1 데이터 수집 실패
- **파일**: `rules/data.php`
- **위치**: `getInteractionTargetingContext()` 함수
- **처리**: 에러 로그 기록 후 기본값 사용

### 5.2 학생설문 응답 없음
- **처리**: 기본값 사용 또는 선생님 체크리스트 입력 대기
- **타임아웃**: 24시간 (그동안 기본값 사용)

### 5.3 다른 에이전트 데이터 조회 실패
- **처리**: 해당 에이전트 데이터 없이 진행, 신뢰도 낮음 표시

---

**Last Updated**: 2025-01-27  
**버전**: 1.0  
**작성자**: AI Assistant

