# PRD: Agent04 온톨로지 결과 응답 생성 통합

**생성일**: 2025-01-27  
**버전**: 1.0  
**상태**: 초안

---

## 1. Introduction/Overview

Agent04의 온톨로지 엔진이 생성한 보강 방안, 추론 결과 등을 사용자에게 의미 있게 전달하기 위해, 온톨로지 결과를 응답 메시지에 통합하는 기능이 필요합니다.

현재 온톨로지 엔진은 보강 방안을 생성하지만, 이 결과가 사용자에게 표시되는 응답 메시지에 포함되지 않습니다. 이 PRD는 온톨로지 결과를 응답 생성 로직에 통합하여 사용자가 보강 방안을 확인할 수 있도록 하는 기능을 정의합니다.

### 문제 정의

1. **온톨로지 결과 미반영**: 온톨로지 엔진이 생성한 보강 방안이 응답 메시지에 포함되지 않음
2. **추론 결과 미표시**: 의미 기반 추론 결과(심각도, 보강 전략 등)가 사용자에게 표시되지 않음
3. **구조화된 정보 부재**: 보강 방안이 텍스트 메시지가 아닌 구조화된 형태로 제공되지 않음

---

## 2. Goals

1. **온톨로지 결과 추출**
   - `decision['ontology_results']`에서 보강 방안, 추론 결과 추출
   - 구조화된 데이터를 텍스트 메시지로 변환

2. **응답 메시지 통합**
   - 기존 룰 기반 응답에 온톨로지 결과 추가
   - 보강 방안을 사용자 친화적인 형태로 표시

3. **구조화된 데이터 제공**
   - JSON 응답에 온톨로지 결과를 별도 필드로 포함
   - 프론트엔드에서 구조화된 데이터 활용 가능하도록

---

## 3. User Stories

### US-1: 취약점 분석 결과 확인 시
**As a** 학습자  
**I want** 온톨로지 기반으로 생성된 보강 방안을 명확하게 확인할 수 있도록  
**So that** 어떤 부분을 보강해야 하는지 정확히 알 수 있다

### US-2: 보강 방안 확인 시
**As a** 학습자  
**I want** 보강 방안이 구조화된 형태로 제공되도록  
**So that** 보강 전략, 권장 방법, 권장 콘텐츠 등을 명확히 구분하여 확인할 수 있다

### US-3: 추론 결과 확인 시
**As a** 학습자  
**I want** 취약점의 심각도와 우선순위를 확인할 수 있도록  
**So that** 어떤 취약점을 먼저 보강해야 하는지 판단할 수 있다

---

## 4. Functional Requirements

### FR-1: 온톨로지 결과 추출
- **FR-1.1**: `decision['ontology_results']` 배열에서 보강 방안 인스턴스 추출
- **FR-1.2**: 보강 방안의 프로퍼티 추출 (`weakpointDescription`, `rootCause`, `reinforcementStrategy` 등)
- **FR-1.3**: 추론 결과 추출 (`inferredSeverity`, `inferredStrategy`, `inferredPriority` 등)
- **FR-1.4**: 실행 계획 추출 (`ReinforcementPlanExecutionPlan` 인스턴스)

### FR-2: 응답 메시지 생성
- **FR-2.1**: 보강 방안 설명을 사용자 친화적인 텍스트로 변환
- **FR-2.2**: 근본 원인 분석 결과를 메시지에 포함
- **FR-2.3**: 보강 전략을 메시지에 포함
- **FR-2.4**: 권장 방법 및 콘텐츠를 메시지에 포함
- **FR-2.5**: 심각도 및 우선순위를 메시지에 포함

### FR-3: 구조화된 데이터 제공
- **FR-3.1**: JSON 응답에 `reinforcement_plan` 필드 추가
- **FR-3.2**: JSON 응답에 `reasoning_results` 필드 추가
- **FR-3.3**: JSON 응답에 `execution_plan` 필드 추가
- **FR-3.4**: 각 필드는 구조화된 객체 형태로 제공

### FR-4: 기존 응답과 통합
- **FR-4.1**: 기존 룰 기반 응답 메시지에 온톨로지 결과 추가
- **FR-4.2**: 온톨로지 결과가 없을 경우 기존 동작 유지
- **FR-4.3**: 온톨로지 결과와 기존 응답의 중복 제거

---

## 5. Non-Goals (Out of Scope)

1. **UI 변경**: 프론트엔드 UI 변경은 포함하지 않음 (데이터만 제공)
2. **온톨로지 엔진 수정**: 온톨로지 엔진 자체는 수정하지 않음
3. **룰 엔진 수정**: 룰 엔진 자체는 수정하지 않음

---

## 6. Technical Considerations

### 6.1 Agent01 참조
- Agent01의 `generateResponseFromActions` 메서드를 참조하여 구현
- Agent01의 온톨로지 결과 통합 방식을 Agent04에 적용

### 6.2 메시지 포맷
- 보강 방안은 마크다운 형식으로 제공 (필요시)
- 구조화된 데이터는 JSON 형식으로 제공

### 6.3 에러 처리
- 온톨로지 결과가 없을 경우 기본 동작 유지
- 온톨로지 결과 파싱 실패 시 에러 로깅 및 기본 동작 유지

---

## 7. Success Metrics

1. **온톨로지 결과 포함율**: 취약점 탐지 시 온톨로지 결과가 응답에 포함되는 비율 100%
2. **사용자 만족도**: 보강 방안의 명확성 및 유용성 평가
3. **에러 발생률**: 응답 생성 중 에러 발생률 5% 이하

---

## 8. Open Questions

1. 보강 방안을 어떤 형식으로 표시할 것인가? (텍스트, 마크다운, 구조화된 JSON)
2. 여러 취약점이 탐지된 경우 어떻게 표시할 것인가?
3. 추론 결과의 신뢰도를 표시할 것인가?

---

**문서 버전**: 1.0  
**최종 수정일**: 2025-01-27  
**작성자**: Agent04 Development Team

