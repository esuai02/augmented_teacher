# Rules for Agent 15 - Problem Redefinition
# 현직 수학선생님 수준 개선 버전 (90% 목표)
# Generated at: 2025-01-21
# Source: agent15_problem_redefinition_mission.md + agent15_problem_redefinition_questions.md + 현직 선생님 체크리스트 기반 확장
# Ontology Mapping: alphatutor_ontology.owl
# - 핵심 온톨로지: ProblemRedefinition, RoutineCollapseRecovery, StructuralProblemDiagnosis
# - 관련 온톨로지: MathUnitVulnerability, MathErrorTypeClassification, StudentLevelDifferentiation, 
#   AcademyContext, RootCauseAnalysis, MathStudyTimeAllocation, TimeManagementFailure,
#   MathLearningStyleMismatch, StandardCodeClassification, ComprehensiveMathRedefinition,
#   CollaborativeProblemSolving, PrerequisiteUnitAnalysis, MathAnxietyRedefinition, MathRecoveryFailure

version: "2.0"
scenario: "problem_redefinition"
description: "학생의 문제를 재정의하고 표준진단 항목과 연결하여 우선순위 3개를 선정하며, 수학 학습 특화 분석을 포함한 맞춤형 개선 방안 제시"

rules:
  # ========== S0: 문제 재정의를 위한 필수 정보 수집 룰 ==========
  
  - rule_id: "S0_R1_comprehensive_data_collection"
    priority: 99
    description: "문제 재정의를 위한 종합 데이터 수집 및 검증"
    conditions:
      - OR:
        - field: "trigger_scenario"
          operator: "in"
          value: ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8", "S9", "S10"]
    action:
      - "collect_data: 'agent_data'"
      - "validate: 'Step 1~15 모든 에이전트 데이터 수집 완료 여부 확인'"
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'data_completeness_check'"
      - "display_message: '문제 재정의를 위해 모든 관련 데이터를 수집하고 검증합니다.'"
    confidence: 0.98
    rationale: "S0: 종합적인 문제 재정의를 위한 필수 데이터 수집"
  
  - rule_id: "S0_R2_math_unit_vulnerability_collection"
    priority: 98
    description: "수학 단원별 취약점 정보 수집 (선생님 체크리스트/텍스트 입력)"
    conditions:
      - field: "math_unit_vulnerability"
        operator: "=="
        value: null
      - OR:
        - field: "trigger_scenario"
          operator: "in"
          value: ["S1", "S3", "S7"]
        - field: "agent_data.agent11_data"
          operator: "!="
          value: null
    action:
      - "collect_info: 'math_unit_vulnerability'"
      - "load_db: 'math_unit_relations.yaml'"
      - "validate: '단원별 취약점 정보는 단원명, 취약 유형(개념/계산/응용), 빈도, 심각도를 포함해야 합니다'"
      - "display_message: '수학 단원별 취약점을 파악하여 문제 재정의의 핵심 근거로 활용합니다.'"
      - "question: '학생이 어려워하는 수학 단원과 취약 유형을 알려주세요. (예: 함수 단원 개념 이해 부족, 계산 실수 빈번 등)'"
    confidence: 0.97
    rationale: "S0: 수학 특화 문제 재정의의 핵심 - 단원별 취약점 파악"
  
  - rule_id: "S0_R3_math_error_type_classification"
    priority: 97
    description: "수학 오류 유형 분류 수집 (계산 실수 vs 개념 오류 vs 응용 실패)"
    conditions:
      - field: "math_error_types"
        operator: "=="
        value: null
      - OR:
        - field: "trigger_scenario"
          operator: "=="
          value: "S3"
        - field: "agent_data.agent11_data.error_pattern"
          operator: "!="
          value: null
    action:
      - "collect_info: 'math_error_types'"
      - "analyze: 'error_type_classification'"
      - "validate: '오류 유형은 계산 실수, 개념 오류, 응용 실패, 시간 부족으로 분류되어야 합니다'"
      - "display_message: '수학 오류 유형을 정확히 분류하여 각 유형별 맞춤형 문제 재정의를 수행합니다.'"
      - "question: '학생의 오답을 분석해보면 어떤 유형이 많나요? (계산 실수, 개념 이해 부족, 문제 유형 적용 실패, 시간 부족)'"
    confidence: 0.96
    rationale: "S0: 수학 특화 문제 재정의 - 계산 실수와 개념 오류는 완전히 다른 대응 전략 필요"
  
  - rule_id: "S0_R4_academy_context_collection"
    priority: 96
    description: "학원 맥락 정보 수집 (학원 수업 이해도, 학원 과제 완료율, 학원 진도)"
    conditions:
      - field: "academy_context"
        operator: "=="
        value: null
      - field: "agent_data.agent01_data.academy_name"
        operator: "!="
        value: null
    action:
      - "collect_info: 'academy_context'"
      - "validate: '학원 맥락 정보는 학원 수업 이해도, 학원 과제 완료율, 학원 진도, 학원 선생님 피드백을 포함해야 합니다'"
      - "display_message: '학원 수업 이해도와 진도를 파악하여 학원 맥락을 반영한 문제 재정의를 수행합니다.'"
      - "question: '학원 수업을 이해하고 있나요? 학원 과제 완료율은 어느 정도인가요? 학원 진도는 학교 진도보다 빠른가요, 느린가요?'"
    confidence: 0.95
    rationale: "S0: 수학학원 시스템 특화 - 학원 맥락은 문제 재정의의 핵심 요소"
  
  - rule_id: "S0_R5_student_level_quantification"
    priority: 95
    description: "학생 수준 정량화 수집 (전체 수준, 단원별 수준, 최근 성적 추이)"
    conditions:
      - field: "student_level"
        operator: "=="
        value: null
    action:
      - "collect_info: 'student_level'"
      - "analyze: 'level_quantification'"
      - "validate: '학생 수준은 전체 수준(하위권/중위권/상위권), 단원별 수준, 최근 성적 추이를 포함해야 합니다'"
      - "display_message: '학생의 수학 수준을 정량화하여 수준별 차별화된 문제 재정의를 수행합니다.'"
      - "question: '학생의 현재 수학 수준은 어느 정도인가요? (하위권/중위권/상위권) 각 단원별로 수준이 다른가요?'"
    confidence: 0.94
    rationale: "S0: 학생 수준별 차별화 문제 재정의의 기초"
  
  # ========== S1: 학습 성과 하락 탐지 관련 룰 ==========
  
  - rule_id: "S1_R1_math_specific_performance_decline"
    priority: 95
    description: "수학 특화 성과 하락 분석 (단원별 점수 하락, 오류 유형 증가)"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S1"
      - field: "agent_data.agent10_data.concept_scores"
        operator: "!="
        value: null
      - field: "agent_data.agent11_data.error_pattern"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'unit_specific_decline_pattern'"
      - "analyze: 'error_type_increase_pattern'"
      - "redefine_problem: 'math_specific_root_cause'"
      - "map_diagnosis: 'C01,C07,C09'"
      - "generate_description: 'math_specific_performance_decline_redefinition'"
      - "display_message: '수학 단원별 성과 하락 패턴과 오류 유형 증가를 분석하여 수학 특화 문제로 재정의합니다.'"
    confidence: 0.93
    rationale: "S1: 수학 특화 문제 재정의 - 단원별/오류 유형별 분석 필수"
  
  - rule_id: "S1_R2_unit_vulnerability_based_redefinition"
    priority: 94
    description: "단원별 취약점 기반 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S1"
      - field: "math_unit_vulnerability"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'prerequisite_unit_check'"
      - "analyze: 'related_units_impact'"
      - "redefine_problem: 'unit_vulnerability_redefinition'"
      - "map_diagnosis: 'C01,C07'"
      - "prioritize: 3"
      - "generate_description: 'unit_based_problem_redefinition'"
      - "display_message: '취약 단원을 분석하고 선행 단원 완료 여부를 확인하여 단원별 문제로 재정의합니다. 예: 함수 단원 취약 → 함수 개념 재학습 문제로 재정의'"
    confidence: 0.92
    rationale: "S1: 단원별 취약점 기반 문제 재정의 - 선생님 체크리스트 기반"
  
  - rule_id: "S1_R3_student_level_differentiated_redefinition"
    priority: 93
    description: "학생 수준별 차별화 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S1"
      - field: "student_level.overall_level"
        operator: "!="
        value: null
    action:
      - "analyze: 'level_based_redefinition_strategy'"
      - "redefine_problem: 'level_differentiated_redefinition'"
      - "map_diagnosis: 'level_specific_diagnosis_codes'"
      - "prioritize: 3"
      - "generate_description: 'student_level_differentiated_redefinition'"
      - "display_message: '학생 수준에 따라 문제 재정의를 차별화합니다. 하위권: 개념 이해 문제 → 개념 재학습 문제로 재정의, 상위권: 심화 문제 해결 능력 문제 → 변형 문제 연습 문제로 재정의'"
    confidence: 0.91
    rationale: "S1: 학생 수준별 차별화 - 하위권/중위권/상위권별 다른 재정의 전략"
  
  # ========== S2: 학습이탈 경고 감지 관련 룰 ==========
  
  - rule_id: "S2_R1_academy_context_dropout_redefinition"
    priority: 94
    description: "학원 맥락 반영 학습이탈 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S2"
      - field: "academy_context.academy_class_understanding"
        operator: "<"
        value: 0.5
    action:
      - "redefine_problem: 'academy_context_dropout'"
      - "map_diagnosis: 'C04,C06'"
      - "prioritize: 3"
      - "generate_description: 'academy_dropout_redefinition'"
      - "display_message: '학원 수업 이해 못함이 원인인 경우 → 예습/복습 문제로 재정의합니다.'"
    confidence: 0.92
    rationale: "S2: 학원 맥락 반영 - 학원 수업 이해 못함은 예습/복습 문제로 재정의"
  
  # ========== S3: 동일 오답 반복 관련 룰 ==========
  
  - rule_id: "S3_R1_math_error_type_based_redefinition"
    priority: 96
    description: "수학 오류 유형별 문제 재정의 (계산 실수 vs 개념 오류)"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S3"
      - field: "math_error_types.calculation_error"
        operator: ">="
        value: 3
    action:
      - "redefine_problem: 'calculation_error_redefinition'"
      - "map_diagnosis: 'C02'"
      - "prioritize: 1"
      - "generate_description: 'calculation_error_redefinition'"
      - "display_message: '계산 실수가 반복되는 경우 → 계산 연습 강화 문제로 재정의합니다. 풀이 과정 단계별 확인, 검산 습관화, 계산 문제 집중 연습을 제안합니다.'"
    confidence: 0.94
    rationale: "S3: 계산 실수는 반복 연습으로, 개념 오류는 개념 재학습으로 완전히 다른 대응 필요"
  
  - rule_id: "S3_R2_concept_error_based_redefinition"
    priority: 95
    description: "개념 오류 기반 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S3"
      - field: "math_error_types.concept_error"
        operator: ">="
        value: 2
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'prerequisite_concept_check'"
      - "redefine_problem: 'concept_error_redefinition'"
      - "map_diagnosis: 'C01,C07'"
      - "prioritize: 1"
      - "generate_description: 'concept_error_redefinition'"
      - "display_message: '개념 오류가 발생한 경우 → 개념 재학습 문제로 재정의합니다. 해당 개념을 처음부터 다시 학습하고, 선행 개념이 부족한 경우 선행 개념부터 보완합니다.'"
    confidence: 0.93
    rationale: "S3: 개념 오류는 개념 재학습과 선행 개념 보완으로 개선 가능"
  
  - rule_id: "S3_R3_unit_specific_error_redefinition"
    priority: 94
    description: "단원별 오답 패턴 기반 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S3"
      - field: "agent_data.agent11_data.unit_error_pattern"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'unit_error_analysis'"
      - "redefine_problem: 'unit_specific_error_redefinition'"
      - "map_diagnosis: 'C01,C07'"
      - "prioritize: 3"
      - "generate_description: 'unit_error_redefinition'"
      - "display_message: '특정 단원에서 오답이 반복되는 경우 → 해당 단원 개념 재학습 문제로 재정의합니다. 예: 함수 단원 오답 반복 → 함수 개념 재학습 문제로 재정의'"
    confidence: 0.92
    rationale: "S3: 단원별 취약점 기반 문제 재정의"
  
  # ========== S4: 루틴 불안정 관련 룰 ==========
  
  - rule_id: "S4_R1_math_study_time_allocation_redefinition"
    priority: 93
    description: "수학 학습 시간 배분 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S4"
      - field: "agent_data.agent07_data.pomodoro_completion_rate"
        operator: "<"
        value: 0.5
      - field: "math_unit_vulnerability"
        operator: "!="
        value: null
      - field: "alt42_goinghome.pomodoro"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'unit_study_time_allocation'"
      - "analyze: 'pomodoro_session_pattern'"
      - "redefine_problem: 'math_time_allocation_redefinition'"
      - "map_diagnosis: 'C05,C09'"
      - "prioritize: 3"
      - "generate_description: 'math_time_allocation_redefinition'"
      - "display_message: '루틴 불안정이 수학 학습 시간 배분 문제로 확인된 경우 → 단원별 학습 시간 재배분 문제로 재정의합니다. 포모도로 세션 패턴을 분석하여 집중 리듬을 파악합니다.'"
    confidence: 0.91
    rationale: "S4: 수학 특화 시간 배분 문제 재정의 - alt42_goinghome.pomodoro 데이터 활용"
  
  # ========== S5: 시간관리 실패 관련 룰 ==========
  
  - rule_id: "S5_R1_academy_homework_time_redefinition"
    priority: 92
    description: "학원 과제 시간 관리 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S5"
      - field: "academy_context.academy_homework_completion_rate"
        operator: "<"
        value: 0.8
    action:
      - "redefine_problem: 'academy_homework_time_redefinition'"
      - "map_diagnosis: 'C05,C09'"
      - "prioritize: 2"
      - "generate_description: 'academy_homework_time_redefinition'"
      - "display_message: '학원 과제 완료율이 낮은 경우 → 학원 과제 시간 관리 문제로 재정의합니다. 학원 과제 우선순위 상향 조정을 제안합니다.'"
    confidence: 0.90
    rationale: "S5: 학원 맥락 반영 - 학원 과제는 학원 수업 이해도와 직결"
  
  # ========== S6: 정서/동기 저하 관련 룰 ==========
  
  - rule_id: "S6_R1_math_anxiety_based_redefinition"
    priority: 91
    description: "수학 불안 기반 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S6"
      - field: "agent_data.agent05_data.math_anxiety_level"
        operator: ">="
        value: 0.7
      - OR:
        - field: "alt42_goinghome.pace_anxiety"
          operator: ">="
          value: 7
        - field: "alt42_goinghome.calmness"
          operator: "<="
          value: 3
    action:
      - "redefine_problem: 'math_anxiety_redefinition'"
      - "analyze: 'pace_anxiety_pattern'"
      - "analyze: 'calmness_trend'"
      - "map_diagnosis: 'C06'"
      - "prioritize: 1"
      - "generate_description: 'math_anxiety_redefinition'"
      - "display_message: '수학 불안이 동기 저하의 원인인 경우 → 수학 불안 완화 문제로 재정의합니다. 학습 속도 불안(pace_anxiety)과 차분함(calmness) 지표를 분석하여 작은 성공 경험 설계, 쉬운 문제부터 시작하는 전략을 제안합니다.'"
    confidence: 0.89
    rationale: "S6: 수학 특화 정서 문제 재정의 - alt42_goinghome.pace_anxiety, calmness 데이터 활용"
  
  # ========== S7: 개념 이해 부진 관련 룰 ==========
  
  - rule_id: "S7_R1_unit_prerequisite_based_redefinition"
    priority: 97
    description: "선행 단원 미완료 기반 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S7"
      - field: "agent_data.agent10_data.concept_test_scores"
        operator: "<"
        value: 0.6
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'prerequisite_unit_completion_check'"
      - "redefine_problem: 'prerequisite_unit_redefinition'"
      - "map_diagnosis: 'C01,C07'"
      - "prioritize: 1"
      - "generate_description: 'prerequisite_unit_redefinition'"
      - "display_message: '개념 이해 부진이 선행 단원 미완료로 확인된 경우 → 선행 단원 재학습 문제로 재정의합니다. 예: 함수 이해 부족 → 방정식 재학습 문제로 재정의'"
    confidence: 0.95
    rationale: "S7: 단원 선후관계 고려 - 방정식을 먼저 해야 함수를 제대로 할 수 있음"
  
  - rule_id: "S7_R2_unit_concept_understanding_redefinition"
    priority: 96
    description: "단원별 개념 이해도 기반 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S7"
      - field: "math_unit_vulnerability.concept_understanding"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'unit_concept_mastery'"
      - "redefine_problem: 'unit_concept_redefinition'"
      - "map_diagnosis: 'C01,C07'"
      - "prioritize: 3"
      - "generate_description: 'unit_concept_redefinition'"
      - "display_message: '특정 단원에서 개념 이해가 부진한 경우 → 해당 단원 개념 재학습 문제로 재정의합니다.'"
    confidence: 0.94
    rationale: "S7: 단원별 개념 이해도 기반 문제 재정의"
  
  # ========== S8: 교사 피드백 경고 관련 룰 ==========
  
  - rule_id: "S8_R1_teacher_feedback_math_specific_redefinition"
    priority: 95
    description: "교사 피드백 기반 수학 특화 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S8"
      - field: "agent_data.agent06_data.teacher_feedback"
        operator: "contains"
        value: ["기본기 부족", "집중력 저하", "패턴 반복"]
    action:
      - "analyze: 'teacher_feedback_math_specific_analysis'"
      - "redefine_problem: 'teacher_feedback_math_redefinition'"
      - "map_diagnosis: 'C01,C02,C07'"
      - "prioritize: 3"
      - "generate_description: 'teacher_feedback_math_redefinition'"
      - "display_message: '교사 피드백을 수학 특화 문제로 재정의합니다. 기본기 부족 → 기본 개념 재학습 문제로, 집중력 저하 → 수학 학습 집중 시간 단축 문제로 재정의합니다.'"
    confidence: 0.93
    rationale: "S8: 교사 피드백 기반 수학 특화 문제 재정의"
  
  # ========== S9: 전략 불일치 관련 룰 ==========
  
  - rule_id: "S9_R1_math_learning_style_mismatch_redefinition"
    priority: 92
    description: "수학 학습 스타일 불일치 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S9"
      - field: "agent_data.agent01_data.math_learning_style"
        operator: "!="
        value: null
      - field: "agent_data.agent04_data.actual_learning_behavior"
        operator: "!="
        value: null
    action:
      - "analyze: 'math_learning_style_mismatch'"
      - "redefine_problem: 'math_style_mismatch_redefinition'"
      - "map_diagnosis: 'C03,C05'"
      - "prioritize: 2"
      - "generate_description: 'math_style_mismatch_redefinition'"
      - "display_message: '수학 학습 스타일과 실제 행동이 불일치하는 경우 → 학습 스타일 정렬 문제로 재정의합니다. 계산형 학생이 개념만 공부하는 경우 계산 연습 강화 문제로 재정의합니다.'"
    confidence: 0.90
    rationale: "S9: 수학 학습 스타일 불일치 문제 재정의"
  
  # ========== S10: 회복 실패 관련 룰 ==========
  
  - rule_id: "S10_R1_math_study_recovery_redefinition"
    priority: 91
    description: "수학 학습 회복 실패 문제 재정의"
    conditions:
      - field: "trigger_scenario"
        operator: "=="
        value: "S10"
      - field: "agent_data.agent12_data.recovery_rate"
        operator: "<"
        value: 0.5
      - OR:
        - field: "alt42_goinghome.missed_opportunity"
          operator: "!="
          value: null
        - field: "alt42_goinghome.inefficiency"
          operator: "!="
          value: null
    action:
      - "redefine_problem: 'math_recovery_redefinition'"
      - "analyze: 'missed_opportunity_pattern'"
      - "analyze: 'inefficiency_root_cause'"
      - "map_diagnosis: 'C05,C09'"
      - "prioritize: 3"
      - "generate_description: 'math_recovery_redefinition'"
      - "display_message: '휴식 후 수학 학습 집중도가 회복되지 않는 경우 → 수학 학습 회복 루틴 재설계 문제로 재정의합니다. 학생이 인식한 놓친 기회(missed_opportunity)와 비효율성(inefficiency)을 분석하여 근본 원인을 파악합니다.'"
    confidence: 0.89
    rationale: "S10: 수학 학습 회복 실패 문제 재정의 - alt42_goinghome.missed_opportunity, inefficiency 데이터 활용"
  
  # ========== 종합 문제 재정의 룰 ==========
  
  - rule_id: "COMP_R1_comprehensive_math_specific_redefinition"
    priority: 98
    description: "수학 특화 종합 문제 재정의 (모든 데이터 통합)"
    conditions:
      - field: "agent_data"
        operator: "!="
        value: null
      - field: "math_unit_vulnerability"
        operator: "!="
        value: null
      - field: "student_level"
        operator: "!="
        value: null
      - field: "academy_context"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'comprehensive_math_analysis'"
      - "redefine_problem: 'comprehensive_math_redefinition'"
      - "map_diagnosis: 'comprehensive_diagnosis_mapping'"
      - "prioritize: 3"
      - "generate_description: 'comprehensive_math_problem_redefinition'"
      - "display_message: '모든 데이터를 통합하여 수학 특화 종합 문제 재정의를 수행합니다. 단원별 취약점, 오류 유형, 학생 수준, 학원 맥락을 모두 반영합니다.'"
    confidence: 0.96
    rationale: "COMP: 수학 특화 종합 문제 재정의 - 현직 선생님 수준의 통합 분석"
  
  - rule_id: "COMP_R2_standard_diagnosis_mapping"
    priority: 97
    description: "표준진단 항목 매핑 (수학 특화 진단코드 포함)"
    conditions:
      - field: "redefined_problem"
        operator: "!="
        value: null
    action:
      - "load_db: 'standard_diagnosis_codes.yaml'"
      - "map_diagnosis: 'problem_to_diagnosis_mapping'"
      - "validate: '표준진단 항목은 C01(개념 이해 부족), C02(계산 실수), C03(학습 스타일 불일치), C04(동기 저하), C05(시간 관리 실패), C06(정서 문제), C07(단원별 취약점), C08(루틴 불안정), C09(회복 실패) 중 선택되어야 합니다'"
      - "prioritize: 3"
      - "generate_description: 'diagnosis_mapping_result'"
      - "display_message: '재정의된 문제를 표준진단 항목과 매핑하여 우선순위 3개를 선정합니다.'"
    confidence: 0.95
    rationale: "COMP: 표준진단 항목 매핑 - 수학 특화 진단코드 포함"
  
  - rule_id: "COMP_R3_customized_improvement_ideas"
    priority: 96
    description: "학생 맞춤형 개선 아이디어 생성 (수학 특화)"
    conditions:
      - field: "prioritized_problems"
        operator: "!="
        value: null
      - field: "student_level"
        operator: "!="
        value: null
      - field: "alt42_goinghome.positive_moment"
        operator: "!="
        value: null
    action:
      - "analyze: 'student_specific_improvement_ideas'"
      - "analyze: 'positive_moment_success_pattern'"
      - "generate_description: 'customized_math_improvement_ideas'"
      - "display_message: '학생의 수준, 단원별 취약점, 오류 유형을 반영하여 고도로 맞춤화된 수학 학습 개선 아이디어를 생성합니다. 학생이 인식한 긍정적 순간(positive_moment)을 분석하여 성공 패턴을 활용합니다.'"
    confidence: 0.94
    rationale: "COMP: 학생 맞춤형 개선 아이디어 - 수학 특화 요소 반영, alt42_goinghome.positive_moment 데이터 활용"

# Default fallback rule
default_rule:
  rule_id: "default"
  action:
    - "display_message: '문제 재정의를 위한 데이터를 분석 중입니다. 추가 정보가 필요할 수 있습니다.'"
  confidence: 0.5
  rationale: "기본 루틴 적용 - 조건 불일치 시 사용"

# ========== 데이터 소스 정의 ==========
data_sources:
  # 귀가검사 테이블 (alt42_goinghome)
  alt42_goinghome:
    description: "하교 전 학습 상태 설문 데이터"
    type: "survey_json"
    fields:
      calmness:
        type: "integer"
        range: "1-10"
        description: "학습 마무리 시점의 차분함/안정도"
        usage: "정서 상태 판단, 문제 재정의 시 감정 요인 분석"
      pomodoro:
        type: "json"
        description: "포모도로 세션 수행 데이터"
        usage: "집중 리듬 분석, 루틴 불안정 문제 재정의"
      inefficiency:
        type: "text"
        description: "학생이 인식한 학습 비효율성 내용"
        usage: "학습 방법 문제 재정의, 근본 원인 분석"
      missed_opportunity:
        type: "text"
        description: "오늘 학습에서 놓쳤다고 느끼는 기회"
        usage: "회복 실패 분석, 문제 재정의 시 성찰 유도"
      positive_moment:
        type: "text"
        description: "오늘 학습에서 긍정적이었던 순간"
        usage: "동기 저하 시 성공 패턴 활용, 개선 아이디어 생성"
      pace_anxiety:
        type: "integer"
        range: "1-10"
        description: "학습 속도에 대한 불안 정도"
        usage: "수학 불안 재정의, 심리적 지원 타이밍 결정"