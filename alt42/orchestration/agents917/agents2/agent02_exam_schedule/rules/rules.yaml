# Auto-generated rules.yaml for exam_schedule_agent
# Generated at: 2025-11-03
# Source: agent02_exam_schedule_questions.md → natural request extension

version: "2.0"
scenario: "exam_schedule_agent"
description: "시험 일정 기반 학습 전략 수립 및 계획 조정 - 선생님 수준 99% 도달"
updated: "2025-01-27"

rules:
  # ========== S0: 시험 계획 수립을 위한 필수 정보 수집 룰 ==========
  - rule_id: "S0_R1_student_grade_collection"
    priority: 99
    description: "학생의 학년 정보 수집 및 검증"
    conditions:
      - field: "student_grade"
        operator: "=="
        value: null
      - OR:
        - field: "semester_start_flag"
          operator: "=="
          value: true
        - field: "d_day"
          operator: "<="
          value: 56
    action:
      - "collect_info: 'student_grade'"
      - "validate: '학년 정보는 1학년부터 3학년까지의 범위여야 합니다'"
      - "display_message: '정확한 시험 준비 계획을 위해 학년 정보가 필요합니다. 현재 학년을 알려주세요.'"
      - "question: '현재 몇 학년이신가요? (1학년/2학년/3학년)'"
    confidence: 0.98
    rationale: "S0: 학년별 시험 범위와 난이도가 다르므로 계획 수립 전 필수 정보"
  
  - rule_id: "S0_R2_exam_subject_collection"
    priority: 98
    description: "시험 과목 정보 수집 및 검증"
    conditions:
      - field: "exam_subjects"
        operator: "=="
        value: null
      - OR:
        - field: "d_day"
          operator: "<="
          value: 56
        - field: "d_day"
          operator: ">="
          value: 50
    action:
      - "collect_info: 'exam_subjects'"
      - "validate: '시험 과목은 배열 형태로 저장되며 각 과목명과 시험 범위 정보를 포함해야 합니다'"
      - "display_message: '시험 과목과 범위 정보를 수집하여 정확한 학습 계획을 수립합니다.'"
      - "question: '이번 시험에서 보는 과목은 무엇인가요? 각 과목의 시험 범위도 함께 알려주세요.'"
    confidence: 0.97
    rationale: "S0: 과목별 특성과 범위에 따른 맞춤형 계획 수립 필수"
  
  - rule_id: "S0_R3_exam_scope_detailed_collection"
    priority: 97
    description: "시험 범위 상세 정보 수집 (단원별, 페이지별)"
    conditions:
      - field: "exam_subjects"
        operator: "!="
        value: null
      - field: "exam_scope_details"
        operator: "=="
        value: null
      - OR:
        - field: "d_day"
          operator: "<="
          value: 56
        - field: "d_day"
          operator: ">="
          value: 50
    action:
      - "collect_info: 'exam_scope_details'"
      - "analyze: 'scope_coverage_analysis'"
      - "validate: '시험 범위는 단원명, 페이지 범위, 주요 개념을 포함해야 합니다'"
      - "display_message: '시험 범위의 상세 정보를 수집하여 단원별 학습량을 정확히 산정합니다.'"
      - "question: '각 과목별로 시험 범위가 구체적으로 어떻게 되나요? (예: 수학 1단원~3단원, 국어 30~50페이지)'"
    confidence: 0.96
    rationale: "S0: 범위 상세 정보가 있어야 학습량 계산과 시간 배분이 정확해짐"
  
  - rule_id: "S0_R4_textbook_collection"
    priority: 96
    description: "사용 중인 교재 정보 수집 및 검증"
    conditions:
      - field: "textbooks"
        operator: "=="
        value: null
      - OR:
        - field: "semester_start_flag"
          operator: "=="
          value: true
        - field: "d_day"
          operator: "<="
          value: 56
    action:
      - "collect_info: 'textbooks'"
      - "validate: '교재 정보는 과목별 교재명, 출판사, 출판년도, 현재 학습 진도(페이지/단원)를 포함해야 합니다'"
      - "display_message: '사용 중인 교재 정보를 수집하여 교재 기반 학습 계획을 수립합니다.'"
      - "question: '각 과목별로 사용 중인 교재가 무엇인가요? (교재명, 출판사, 현재까지 학습한 진도)'"
    confidence: 0.95
    rationale: "S0: 교재 특성에 따른 학습 방법과 진도 계획 수립 필수"
  
  - rule_id: "S0_R5_content_materials_collection"
    priority: 95
    description: "보조 학습 컨텐츠 및 자료 정보 수집"
    conditions:
      - field: "textbooks"
        operator: "!="
        value: null
      - field: "content_materials"
        operator: "=="
        value: null
      - OR:
        - field: "semester_start_flag"
          operator: "=="
          value: true
        - field: "d_day"
          operator: "<="
          value: 56
    action:
      - "collect_info: 'content_materials'"
      - "analyze: 'content_resource_mapping'"
      - "validate: '컨텐츠 정보는 문제집, 기출문제집, 온라인 강의, 보충 자료 등 학습에 사용하는 모든 자료를 포함해야 합니다'"
      - "display_message: '보조 학습 컨텐츠 정보를 수집하여 다양한 자료를 활용한 통합 학습 계획을 수립합니다.'"
      - "question: '교재 외에 사용 중인 학습 자료가 있나요? (문제집, 기출문제집, 온라인 강의, 보충 자료 등)'"
    confidence: 0.94
    rationale: "S0: 다양한 학습 자료 활용 계획 수립을 위한 필수 정보"
  
  - rule_id: "S0_R6_content_usage_pattern_collection"
    priority: 94
    description: "컨텐츠별 학습 패턴 및 소요 시간 정보 수집"
    conditions:
      - field: "content_materials"
        operator: "!="
        value: null
      - field: "content_usage_pattern"
        operator: "=="
        value: null
    action:
      - "collect_info: 'content_usage_pattern'"
      - "analyze: 'learning_efficiency_by_content'"
      - "validate: '컨텐츠별 학습 패턴은 각 자료 유형별 평균 소요 시간, 학습 효과, 선호도 정보를 포함해야 합니다'"
      - "display_message: '컨텐츠별 학습 패턴을 분석하여 효율적인 자료 활용 계획을 수립합니다.'"
      - "question: '각 학습 자료를 사용할 때 평균적으로 얼마나 시간이 걸리나요? 어떤 자료가 가장 효과적이라고 느끼시나요?'"
    confidence: 0.93
    rationale: "S0: 자료별 효율성을 고려한 현실적인 시간 배분 계획 수립"
  
  - rule_id: "S0_R7_comprehensive_exam_planning_prerequisites"
    priority: 98
    description: "시험 계획 수립을 위한 필수 정보 종합 검증 및 수집"
    conditions:
      - OR:
        - field: "semester_start_flag"
          operator: "=="
          value: true
        - field: "d_day"
          operator: "<="
          value: 56
        - field: "d_day"
          operator: ">="
          value: 50
      - OR:
        - field: "student_grade"
          operator: "=="
          value: null
        - field: "exam_subjects"
          operator: "=="
          value: null
        - field: "textbooks"
          operator: "=="
          value: null
    action:
      - "analyze: 'missing_prerequisite_info'"
      - "generate_description: 'exam_planning_prerequisites_checklist'"
      - "recommend_path: '필수 정보 수집 완료 후 시험 준비 계획 수립 진행'"
      - "display_message: '시험 준비 계획을 정확하게 수립하기 위해 다음 정보가 필요합니다: 학년, 시험 과목 및 범위, 사용 교재, 학습 컨텐츠 정보'"
      - "validate_all: ['student_grade', 'exam_subjects', 'exam_scope_details', 'textbooks', 'content_materials']"
    confidence: 0.97
    rationale: "S0: 필수 정보가 모두 수집되어야 정확한 시험 준비 계획 수립 가능"
  
  - rule_id: "S0_R9_academy_info_collection"
    priority: 97
    description: "수학학원 정보 수집 (학원 진도, 학원 과제, 학원 모의고사 일정)"
    conditions:
      - field: "academy_name"
        operator: "=="
        value: null
      - OR:
        - field: "semester_start_flag"
          operator: "=="
          value: true
        - field: "d_day"
          operator: "<="
          value: 56
    action:
      - "collect_info: 'academy_info'"
      - "validate: '학원 정보는 학원명, 학원 등급(반), 학원 수업 일정, 학원 진도, 학원 과제 정보를 포함해야 합니다'"
      - "display_message: '수학학원 정보를 수집하여 학원-학교-집 학습을 연계한 계획을 수립합니다.'"
      - "question: '다니고 있는 수학학원이 있나요? 학원명, 학원 반(등급), 학원 수업 일정을 알려주세요.'"
    confidence: 0.96
    rationale: "S0: 수학학원 시스템 특화 - 학원 정보는 필수"
  
  - rule_id: "S0_R10_academy_progress_collection"
    priority: 96
    description: "학원 수업 진도 정보 수집 (현재 진행 단원, 예상 진도)"
    conditions:
      - field: "academy_name"
        operator: "!="
        value: null
      - field: "academy_current_unit"
        operator: "=="
        value: null
    action:
      - "collect_info: 'academy_progress'"
      - "analyze: 'academy_school_progress_alignment'"
      - "validate: '학원 진도 정보는 현재 진행 단원, 예상 진도, 학교 진도와의 관계를 포함해야 합니다'"
      - "display_message: '학원 수업 진도를 파악하여 학교 진도와 연계한 학습 계획을 수립합니다.'"
      - "question: '학원에서 지금 어떤 단원을 배우고 있나요? 이번 학기/방학에 학원에서 어떤 진도로 나갈 예정인가요? 학교 진도보다 빠른가요, 느린가요?'"
    confidence: 0.95
    rationale: "S0: 학원-학교 진도 연계 필수"
  
  - rule_id: "S0_R11_academy_homework_collection"
    priority: 95
    description: "학원 과제 정보 수집 (교재별 과제, 완료율, 소요 시간)"
    conditions:
      - field: "academy_name"
        operator: "!="
        value: null
      - field: "academy_homework"
        operator: "=="
        value: null
    action:
      - "collect_info: 'academy_homework'"
      - "analyze: 'homework_completion_pattern'"
      - "validate: '학원 과제 정보는 교재명(쎈, 개념원리, RPM 등), 단원별 과제량, 평균 완료율, 소요 시간을 포함해야 합니다'"
      - "display_message: '학원 과제 정보를 수집하여 학원 과제 우선순위를 반영한 학습 계획을 수립합니다.'"
      - "question: '학원에서 내주는 과제는 무엇인가요? (쎈, 개념원리, RPM, 블랙라벨 등) 보통 얼마나 시간이 걸리나요? 완료율은 어느 정도인가요?'"
    confidence: 0.94
    rationale: "S0: 학원 과제는 학습 계획의 핵심 요소"
  
  - rule_id: "S0_R12_academy_mock_exam_collection"
    priority: 94
    description: "학원 모의고사 일정 및 결과 정보 수집"
    conditions:
      - field: "academy_name"
        operator: "!="
        value: null
      - field: "academy_mock_exam_schedule"
        operator: "=="
        value: null
    action:
      - "collect_info: 'academy_mock_exam'"
      - "analyze: 'academy_school_exam_alignment'"
      - "validate: '학원 모의고사 정보는 일정, 목표 등수, 과거 등수, 학교 시험과의 관계를 포함해야 합니다'"
      - "display_message: '학원 모의고사 일정을 파악하여 학교 시험과 통합 관리할 수 있도록 계획을 수립합니다.'"
      - "question: '학원에서 모의고사나 테스트를 보나요? 일정이 어떻게 되나요? 목표 등수는 있나요?'"
    confidence: 0.93
    rationale: "S0: 학원 모의고사와 학교 시험 통합 관리 필수"
  
  - rule_id: "S0_R13_academy_teacher_feedback_collection"
    priority: 93
    description: "학원 선생님 피드백 및 조언 정보 수집"
    conditions:
      - field: "academy_name"
        operator: "!="
        value: null
      - field: "academy_teacher_feedback"
        operator: "=="
        value: null
    action:
      - "collect_info: 'academy_teacher_feedback'"
      - "analyze: 'teacher_feedback_integration'"
      - "validate: '학원 선생님 피드백은 학습 방향, 보완할 단원, 특별 지도 계획을 포함해야 합니다'"
      - "display_message: '학원 선생님의 피드백을 반영하여 학습 계획에 통합합니다.'"
      - "question: '학원 선생님이 최근에 해주신 조언이나 피드백이 있나요? (예: 쎈 C단계 집중, 블랙라벨 추가, 보충 수업 등)'"
    confidence: 0.92
    rationale: "S0: 학원 선생님 피드백은 전문적 조언이므로 반영 필수"
  
  - rule_id: "S0_R8_info_based_precise_planning"
    priority: 99
    description: "수집된 정보 기반 정교한 시험 준비 계획 수립 (수학학원 시스템 통합 + 단원 연계성)"
    conditions:
      - field: "student_grade"
        operator: "!="
        value: null
      - field: "exam_subjects"
        operator: "!="
        value: null
      - field: "exam_scope_details"
        operator: "!="
        value: null
      - field: "textbooks"
        operator: "!="
        value: null
      - field: "content_materials"
        operator: "!="
        value: null
      - OR:
        - field: "d_day"
          operator: "<="
          value: 56
        - field: "d_day"
          operator: ">="
          value: 50
    action:
      - "load_db: 'math_unit_relations.yaml'"  # 단원 연계성 DB 로드
      - "load_db: 'math_textbook_db.yaml'"  # 수학 교과서 단원 DB 로드 (난이도, 학습시간, 출제비중 등)
      - "analyze: 'unit_prerequisite_verification'"  # 단원 선후관계 검증
      - "analyze: 'unit_learning_order_optimization'"  # 단원 학습 순서 최적화
      - "analyze: 'related_units_simultaneous_learning'"  # 연계 단원 동시 학습 전략
      - "analyze: 'unit_difficulty_time_allocation'"  # 단원별 난이도 기반 학습 시간 배분
      - "analyze: 'unit_exam_weight_based_priority'"  # 단원별 출제 비중 기반 우선순위 설정
      - "analyze: 'grade_level_appropriate_planning'"
      - "analyze: 'subject_specific_strategy_mapping'"
      - "analyze: 'scope_based_content_allocation'"
      - "analyze: 'textbook_content_integration'"
      - "analyze: 'textbook_characteristics_mapping'"  # 교재별 특성 DB 활용
      - "analyze: 'content_material_optimization'"
      - "analyze: 'academy_school_home_integration'"
      - "analyze: 'academy_homework_priority_allocation'"
      - "analyze: 'academy_mock_exam_alignment'"
      - "generate_description: 'precise_exam_preparation_plan_with_academy_and_unit_relations'"
      - "recommend_path: '단원 선후관계 검증 → 학습 순서 최적화 → 단원별 난이도/출제비중 기반 시간 배분 → 학년-과목-범위-교재-컨텐츠-학원 정보 통합 분석 기반 정교한 학습 계획'"
      - "display_message: '수집된 정보와 단원 연계성 DB, 단원별 난이도/학습시간/출제비중 DB를 종합하여 선후관계를 고려한 최적 학습 순서로 학원-학교-집 학습을 연계한 정교한 시험 준비 계획을 수립합니다.'"
    confidence: 0.98
    rationale: "S0: 모든 필수 정보가 수집되었을 때 최고 우선순위로 정교한 계획 수립 실행 (수학학원 시스템 통합 + 단원 연계성 + 단원별 DB 반영) - 선생님 수준 99% 도달"
  
  - rule_id: "S0_R14_unit_prerequisite_verification"
    priority: 98
    description: "시험 범위 단원의 선후관계 검증 및 학습 순서 최적화"
    conditions:
      - field: "exam_scope_details"
        operator: "!="
        value: null
      - field: "student_grade"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'unit_prerequisite_check'"  # 각 단원의 선행 단원 완료 여부 확인
      - "analyze: 'missing_prerequisite_units'"  # 미완료 선행 단원 식별
      - "recommend_path: '선행 단원 완료 → 후속 단원 학습 순서로 재조정'"
      - "display_message: '시험 범위 단원들의 선후관계를 검증하여 선행 단원을 먼저 학습하고 후속 단원을 학습하는 최적 순서로 계획을 조정합니다.'"
      - "question: '시험 범위에 포함된 단원 중 선행 단원이 완료되지 않은 경우, 선행 단원을 먼저 학습하는 것이 효과적입니다. 선행 단원 학습 계획을 추가할까요?'"
    confidence: 0.95
    rationale: "S0: 단원 선후관계는 수학 학습의 핵심 - 방정식을 먼저 해야 함수를 제대로 할 수 있음"
  
  - rule_id: "S0_R15_related_units_simultaneous_learning"
    priority: 97
    description: "연계 단원 동시 학습 전략 제안"
    conditions:
      - field: "exam_scope_details"
        operator: "!="
        value: null
      - field: "unit_relations_db"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"
      - "analyze: 'related_units_identification'"  # 연계 단원 식별
      - "analyze: 'simultaneous_learning_benefit'"  # 동시 학습 효과 분석
      - "recommend_path: '연계 단원 동시 학습 전략 (예: 함수+그래프, 일차함수+연립방정식, 이차함수+이차방정식)'"
      - "display_message: '함수와 그래프, 일차함수와 연립방정식 등 연계 단원을 함께 학습하면 이해도가 높아집니다. 연계 단원 동시 학습 계획을 제안합니다.'"
    confidence: 0.94
    rationale: "S0: 연계 단원 동시 학습은 현직 선생님의 핵심 전략 - 함수와 그래프는 같이 공부하면 효과적"
  
  - rule_id: "S0_R16_unit_difficulty_time_allocation"
    priority: 96
    description: "단원별 난이도 및 학습 시간 DB 기반 현실적 시간 배분"
    conditions:
      - field: "exam_scope_details"
        operator: "!="
        value: null
      - field: "student_grade"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_textbook_db.yaml'"
      - "analyze: 'unit_difficulty_retrieval'"  # 단원별 난이도 조회
      - "analyze: 'unit_study_time_calculation'"  # 단원별 학습 시간 산정 (개념+유형+심화)
      - "analyze: 'student_level_time_adjustment'"  # 학생 수준별 시간 조정 (하위권 +50%, 상위권 -30%)
      - "analyze: 'total_time_feasibility_check'"  # 총 학습 시간 현실성 검증
      - "recommend_path: '단원별 난이도 기반 학습 시간 배분 → 학생 수준별 조정 → 현실성 검증'"
      - "display_message: '단원별 난이도와 평균 학습 시간을 기반으로 현실적인 학습 시간을 배분합니다. (예: 함수 단원 평균 9시간, 하위권은 13.5시간, 상위권은 6.3시간)'"
      - "question: '함수 단원은 평균 9시간이 필요합니다. 현재 수준에 맞춰 시간을 조정하겠습니다. 하위권이면 더 시간이 필요하고, 상위권이면 시간을 줄일 수 있습니다.'"
    confidence: 0.95
    rationale: "S0: 단원별 난이도/학습시간 DB는 현직 선생님의 핵심 경험 지식 - 함수는 평균 8시간, 통계는 4시간"
  
  - rule_id: "S0_R17_textbook_characteristics_strategy"
    priority: 95
    description: "교재별 특성 DB 기반 교재 선택 및 활용 전략"
    conditions:
      - field: "textbooks"
        operator: "!="
        value: null
      - field: "student_level"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_textbook_db.yaml'"
      - "analyze: 'textbook_characteristics_mapping'"  # 교재별 특성 매핑 (쎈, 개념원리, RPM 등)
      - "analyze: 'student_level_textbook_match'"  # 학생 수준별 교재 적합성 평가
      - "analyze: 'textbook_usage_strategy'"  # 교재별 활용 전략 제안
      - "recommend_path: '학생 수준별 교재 선택 → 교재별 특성 반영 활용 전략'"
      - "display_message: '교재별 특성을 반영하여 학생 수준에 맞는 교재 선택과 활용 전략을 제안합니다. (예: 하위권은 개념원리 중심, 중위권은 쎈 A/B단계, 상위권은 쎈 C단계+블랙라벨)'"
      - "question: '현재 사용 중인 교재는 무엇인가요? 학생 수준에 맞는 교재 활용 방법을 제안하겠습니다.'"
    confidence: 0.94
    rationale: "S0: 교재별 특성 DB는 현직 선생님의 핵심 지식 - 쎈은 유형 많고, 개념원리는 설명 좋고"
  
  # ========== S1: 새 학기/방학 시작 직후 관련 룰 ==========
  
  - rule_id: "S1_R1_semester_start_favorite_subject"
    priority: 95
    description: "새 학기/방학 시작 시 가장 잘하고 싶은 과목 및 이유 파악"
    conditions:
      - field: "semester_start_flag"
        operator: "=="
        value: true
      - field: "favorite_subject"
        operator: "!="
        value: null
      - field: "favorite_subject_reason"
        operator: "!="
        value: null
    action:
      - "generate_description: 'favorite_subject_analysis'"
      - "recommend_path: '장기 로드맵 설정 - 선호 과목 중심 학습 계획'"
      - "display_message: '가장 잘하고 싶은 과목에 대한 목표와 이유를 바탕으로 장기 학습 계획을 수립합니다.'"
    confidence: 0.92
    rationale: "S1: 학생의 동기와 목표를 파악하여 장기 계획의 방향성을 설정"

  - rule_id: "S1_R2_semester_start_study_reflection"
    priority: 93
    description: "지난 학기 공부 방식 반성 및 개선점 도출"
    conditions:
      - field: "semester_start_flag"
        operator: "=="
        value: true
      - field: "previous_study_methods.keep"
        operator: "!="
        value: null
      - field: "previous_study_methods.change"
        operator: "!="
        value: null
    action:
      - "analyze: 'study_method_reflection'"
      - "recommend_path: '효과적 방법 유지 + 개선점 반영 학습 전략'"
      - "display_message: '지난 학기에서 효과적이었던 방법은 유지하고, 개선이 필요한 부분을 반영한 학습 계획을 설계합니다.'"
    confidence: 0.9
    rationale: "S1: 성찰 기반 학습 방법 최적화"

  - rule_id: "S1_R3_semester_start_time_budget"
    priority: 94
    description: "하루 공부 가능 시간 예산 확인 및 주간 계획 수립"
    conditions:
      - field: "semester_start_flag"
        operator: "=="
        value: true
      - field: "daily_study_hours"
        operator: ">="
        value: 0
    action:
      - "analyze: 'time_budget_allocation'"
      - "recommend_path: '시간 예산 기반 주간 학습 스케줄 설계'"
      - "display_message: '하루 공부 가능 시간을 바탕으로 주간 학습 스케줄을 설계합니다.'"
    confidence: 0.91
    rationale: "S1: 시간 자원 기반 현실적 계획 수립"

  - rule_id: "S1_R4_semester_start_parent_expectations"
    priority: 92
    description: "부모님 기대 및 걱정 사항 반영"
    conditions:
      - field: "semester_start_flag"
        operator: "=="
        value: true
      - field: "parent_expectations"
        operator: "!="
        value: null
      - field: "parent_concerns"
        operator: "!="
        value: null
    action:
      - "generate_description: 'parent_context_integration'"
      - "recommend_path: '가정 맥락 반영 학습 계획'"
      - "display_message: '부모님의 기대와 걱정을 고려하여 학습 계획에 반영합니다.'"
    confidence: 0.89
    rationale: "S1: 가정 환경 맥락을 학습 계획에 통합"

  - rule_id: "S1_R5_comprehensive_semester_plan"
    priority: 96
    description: "새 학기/방학 시작 시 종합적 장기 계획 수립 (수학학원 시스템 통합)"
    conditions:
      - field: "semester_start_flag"
        operator: "=="
        value: true
      - field: "favorite_subject"
        operator: "!="
        value: null
      - field: "daily_study_hours"
        operator: "!="
        value: null
      - field: "previous_study_methods"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_school_progress_alignment'"
      - "analyze: 'academy_homework_integration'"
      - "generate_description: 'comprehensive_semester_roadmap_with_academy'"
      - "recommend_path: '학원-학교 연계 장기 로드맵 + 학원 선행 학습 계획 + 과목별 균형 설정'"
      - "display_message: '새 학기(방학) 시작을 위해 학원 진도와 학교 진도를 연계한 장기 로드맵과 학원 선행 학습 계획을 포함한 종합 학습 계획을 수립합니다.'"
    confidence: 0.93
    rationale: "S1: 새 학기 시작 시 최우선 종합 계획 수립 (수학학원 시스템 통합)"
  
  - rule_id: "S1_R6_academy_prep_review_planning"
    priority: 94
    description: "학원 수업 전 예습 및 수업 후 복습 계획 수립"
    conditions:
      - field: "semester_start_flag"
        operator: "=="
        value: true
      - field: "academy_name"
        operator: "!="
        value: null
      - field: "academy_current_unit"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_prep_review_routine'"
      - "recommend_path: '학원 수업 전 예습 + 학원 수업 후 복습 + 학원 과제 수행 시간 배분'"
      - "display_message: '학원 수업 전 예습과 수업 후 복습 시간을 배분하여 학원 수업 이해도를 높이는 계획을 수립합니다.'"
    confidence: 0.92
    rationale: "S1: 학원 수업 효과 극대화를 위한 예습/복습 계획 필수"

  # ========== S2: 시험일정 공지 시점 (D-8주) 관련 룰 ==========
  
  - rule_id: "S2_R1_exam_announcement_confident_unit"
    priority: 95
    description: "시험일정 공지 시 자신 있는 단원 파악"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 56
      - field: "d_day"
        operator: ">="
        value: 50
      - field: "confident_units"
        operator: "!="
        value: null
    action:
      - "analyze: 'confident_unit_strength_analysis'"
      - "recommend_path: '자신 있는 단원 강점 활용 전략'"
      - "display_message: '자신 있는 단원을 바탕으로 시험 대비 전략의 기반을 마련합니다.'"
    confidence: 0.92
    rationale: "S2: 강점 영역 파악으로 전략 수립 시작"

  - rule_id: "S2_R2_exam_announcement_target_score"
    priority: 96
    description: "시험 목표 점수 설정 및 역산 전략"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 56
      - field: "target_score"
        operator: "!="
        value: null
      - field: "current_score"
        operator: "!="
        value: null
    action:
      - "analyze: 'target_score_gap_analysis'"
      - "recommend_path: '목표 점수 달성을 위한 역산 학습 전략'"
      - "display_message: '목표 점수와 현재 점수의 차이를 분석하여 필요한 학습량과 전략을 산정합니다.'"
    confidence: 0.94
    rationale: "S2: 목표점수 기반 역산 전략 수립의 핵심"

  - rule_id: "S2_R3_exam_announcement_time_consuming_unit"
    priority: 93
    description: "시간이 가장 많이 걸린 단원 파악 및 시간 배분 최적화"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 56
      - field: "time_consuming_units"
        operator: "!="
        value: null
    action:
      - "analyze: 'time_consumption_pattern'"
      - "recommend_path: '시간 소모 단원 효율화 전략'"
      - "display_message: '시간이 많이 걸리는 단원의 학습 효율을 높이는 전략을 제안합니다.'"
    confidence: 0.91
    rationale: "S2: 시간 자원 배분 최적화를 위한 핵심 정보"

  - rule_id: "S2_R4_exam_announcement_exam_importance"
    priority: 94
    description: "시험 중요도 파악 및 전략 가중치 설정"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 56
      - field: "exam_importance"
        operator: "!="
        value: null
      - field: "exam_importance_reason"
        operator: "!="
        value: null
    action:
      - "analyze: 'exam_importance_weighting'"
      - "recommend_path: '중요도 기반 학습 전략 가중치 조정'"
      - "display_message: '시험의 중요도와 이유를 바탕으로 학습 전략의 우선순위를 설정합니다.'"
    confidence: 0.92
    rationale: "S2: 중요도 기반 전략 집중도 조정"

  - rule_id: "S2_R5_comprehensive_exam_preparation_start"
    priority: 97
    description: "시험일정 공지 시점 종합 전략 수립 시작 (필수 정보 수집 완료 후)"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 56
      - field: "d_day"
        operator: ">="
        value: 50
      - field: "student_grade"
        operator: "!="
        value: null
      - field: "exam_subjects"
        operator: "!="
        value: null
      - field: "exam_scope_details"
        operator: "!="
        value: null
      - field: "textbooks"
        operator: "!="
        value: null
      - field: "target_score"
        operator: "!="
        value: null
      - field: "confident_units"
        operator: "!="
        value: null
      - field: "exam_importance"
        operator: "!="
        value: null
    action:
      - "analyze: 'grade_level_appropriate_planning'"
      - "analyze: 'subject_scope_content_integration'"
      - "analyze: 'textbook_based_strategy_mapping'"
      - "generate_description: 'comprehensive_exam_preparation_strategy'"
      - "recommend_path: '학년-과목-범위-교재 정보 기반 본격적인 시험대비 전략 시작 - 8주 계획 수립'"
      - "display_message: '수집된 정보(학년, 시험과목/범위, 교재)와 목표점수, 중요도, 단원 난이도를 종합하여 본격적인 시험대비 전략을 시작합니다.'"
    confidence: 0.95
    rationale: "S2: D-8주 시점 최우선 전략 수립 (필수 정보 수집 완료 필수)"
  
  - rule_id: "S2_R6_student_level_based_strategy"
    priority: 96
    description: "학생 수준별 학습 방법 차별화 전략 (하위권/중위권/상위권)"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 56
      - field: "d_day"
        operator: ">="
        value: 50
      - field: "student_level"
        operator: "in"
        value: ["하위권", "중위권", "상위권"]
      - field: "current_score"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_textbook_db.yaml'"
      - "analyze: 'level_based_focus_allocation'"  # 수준별 학습 비중 할당
      - "analyze: 'level_based_textbook_recommendation'"  # 수준별 교재 추천
      - "analyze: 'level_based_learning_method'"  # 수준별 학습 방법
      - "recommend_path: '학생 수준 파악 → 수준별 학습 비중 설정 → 수준별 교재 선택 → 수준별 학습 방법 적용'"
      - "display_message: '학생 수준에 맞는 차별화된 학습 전략을 제안합니다. 하위권: 개념 60% + 유형 30% + 기출 10%, 중위권: 개념 30% + 유형 50% + 심화 10% + 기출 10%, 상위권: 개념 10% + 유형 30% + 심화 40% + 기출 20%'"
      - "question: '현재 수학 성적이 어느 정도인가요? 수준에 맞는 학습 방법을 제안하겠습니다.'"
    confidence: 0.96
    rationale: "S2: 학생 수준별 차별화는 현직 선생님의 핵심 전략 - 하위권은 개념 중심, 상위권은 심화 중심"
  
  - rule_id: "S2_R7_spacing_review_schedule"
    priority: 95
    description: "복습 주기(스페이싱) 실제 적용 - 단원별 권장 복습 일정 생성"
    conditions:
      - field: "exam_scope_details"
        operator: "!="
        value: null
      - field: "student_level"
        operator: "!="
        value: null
      - field: "d_day"
        operator: "<="
        value: 56
    action:
      - "load_db: 'math_textbook_db.yaml'"
      - "analyze: 'unit_difficulty_retrieval'"  # 단원별 난이도 조회
      - "analyze: 'spacing_cycle_determination'"  # 단원별 복습 주기 결정
      - "analyze: 'student_level_cycle_adjustment'"  # 학생 수준별 주기 조정
      - "analyze: 'review_schedule_generation'"  # 복습 일정 생성
      - "recommend_path: '단원별 난이도 기반 복습 주기 설정 → 학생 수준별 조정 → 복습 일정 생성'"
      - "display_message: '단원별 난이도와 학생 수준을 고려하여 복습 일정을 생성합니다. (예: 함수 단원은 1일, 3일, 7일, 14일 후 복습, 통계 단원은 1일, 5일, 14일 후 복습)'"
      - "generate_schedule: 'spacing_review_calendar'"  # 복습 일정 캘린더 생성
    confidence: 0.95
    rationale: "S2: 복습 주기(스페이싱)는 현직 선생님의 핵심 전략 - 함수는 3일 후, 7일 후, 14일 후 복습 배치"
  
  # ========== S3: 계획이 무너졌거나 진도 지연 관련 룰 ==========
  
  - rule_id: "S3_R1_plan_disruption_unfinished_tasks"
    priority: 94
    description: "지난주 계획 중 끝내지 못한 부분 진단"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "unfinished_tasks"
        operator: "!="
        value: null
    action:
      - "analyze: 'unfinished_task_pattern'"
      - "recommend_path: '미완료 과제 원인 분석 및 대응 전략'"
      - "display_message: '끝내지 못한 부분의 패턴을 분석하여 계획 조정 방안을 제시합니다.'"
    confidence: 0.92
    rationale: "S3: 미완료 원인 파악으로 계획 개선"

  - rule_id: "S3_R2_plan_disruption_root_cause"
    priority: 95
    description: "계획 무너짐 근본 원인 진단 (시간 부족/이해 어려움/의욕 저하)"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "disruption_cause"
        operator: "in"
        value: ["시간 부족", "이해 어려움", "의욕 저하"]
    action:
      - "analyze: 'disruption_root_cause'"
      - "recommend_path: '근본 원인별 맞춤 대응 전략'"
      - "display_message: '계획이 무너진 근본 원인에 따라 적절한 대응 전략을 제안합니다.'"
    confidence: 0.93
    rationale: "S3: 원인별 맞춤형 해결책 제시"

  - rule_id: "S3_R3_plan_disruption_feasibility_check"
    priority: 96
    description: "현재 속도로 목표 점수 달성 가능성 검증"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "current_pace"
        operator: "!="
        value: null
      - field: "target_score"
        operator: "!="
        value: null
    action:
      - "analyze: 'pace_target_feasibility'"
      - "recommend_path: '현실성 검증 기반 계획 재조정'"
      - "display_message: '현재 학습 속도로 목표 점수 달성이 가능한지 검증하고, 필요시 계획을 재조정합니다.'"
    confidence: 0.94
    rationale: "S3: 현실성 검증 기반 계획 수정"

  - rule_id: "S3_R4_plan_disruption_routine_reset"
    priority: 93
    description: "하루 공부 루틴 시간대 재조정"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "best_focus_time"
        operator: "!="
        value: null
    action:
      - "recommend_path: '집중 시간대 기반 루틴 리셋'"
      - "display_message: '가장 집중이 잘 되는 시간대를 파악하여 하루 공부 루틴을 재조정합니다.'"
    confidence: 0.91
    rationale: "S3: 루틴 리셋을 통한 효율성 회복"

  - rule_id: "S3_R5_comprehensive_plan_revision"
    priority: 97
    description: "계획 무너짐 시 종합적 계획 재조정 (수학학원 시스템 통합)"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "unfinished_tasks"
        operator: "!="
        value: null
      - field: "disruption_cause"
        operator: "!="
        value: null
      - field: "current_pace"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_homework_completion_rate'"
      - "analyze: 'academy_class_understanding_level'"
      - "generate_description: 'comprehensive_plan_revision_with_academy'"
      - "recommend_path: '학원 과제 우선순위 재조정 + 학원 수업 이해도 향상 전략 + 학원-집 학습 시간 재배분 + 계획 재조정'"
      - "display_message: '계획이 무너진 상황을 종합적으로 분석하여 학원 과제 완료율과 학원 수업 이해도를 고려한 효율화된 새로운 계획을 수립합니다.'"
    confidence: 0.95
    rationale: "S3: 계획 무너짐 시 최우선 대응 (수학학원 시스템 통합)"
  
  - rule_id: "S3_R6_academy_homework_priority_adjustment"
    priority: 95
    description: "학원 과제 미완료 시 우선순위 재조정"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "academy_homework_completion_rate"
        operator: "<"
        value: 0.8
    action:
      - "analyze: 'homework_priority_reallocation'"
      - "recommend_path: '학원 과제 우선순위 상향 + 다른 학습 활동 시간 조정'"
      - "display_message: '학원 과제 완료율이 낮아서 학원 과제를 최우선으로 배치하고 다른 학습 활동 시간을 조정합니다.'"
    confidence: 0.94
    rationale: "S3: 학원 과제는 학원 수업 이해도와 직결되므로 우선순위 최상위"
  
  - rule_id: "S3_R7_spacing_review_reschedule"
    priority: 94
    description: "계획 무너짐 시 복습 주기 재조정"
    conditions:
      - field: "plan_disruption_flag"
        operator: "=="
        value: true
      - field: "spacing_review_schedule"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_textbook_db.yaml'"
      - "analyze: 'review_completion_status'"  # 복습 완료 상태 확인
      - "analyze: 'missed_review_prioritization'"  # 놓친 복습 우선순위화
      - "analyze: 'review_schedule_compression'"  # 복습 일정 압축 (시간 부족 시)
      - "recommend_path: '놓친 복습 우선순위화 → 복습 일정 재조정'"
      - "display_message: '계획이 무너져서 복습 일정이 밀렸다면, 중요 단원 복습을 우선하고 나머지는 압축 일정으로 재조정합니다.'"
    confidence: 0.93
    rationale: "S3: 계획 무너짐 시 복습 주기 재조정으로 학습 효과 유지"
  
  # ========== S4: 모의고사·중간평가 이후 관련 룰 ==========
  
  - rule_id: "S4_R1_mock_exam_difficult_problem_types"
    priority: 95
    description: "모의고사에서 어려웠던 문제 유형 분석"
    conditions:
      - field: "mock_exam_completed"
        operator: "=="
        value: true
      - field: "difficult_problem_types"
        operator: "!="
        value: null
    action:
      - "analyze: 'difficult_problem_type_pattern'"
      - "recommend_path: '취약 유형 재분석 및 집중 보완 전략'"
      - "display_message: '어려웠던 문제 유형을 분석하여 취약 영역을 재설정하고 집중 보완 계획을 수립합니다.'"
    confidence: 0.93
    rationale: "S4: 취약 유형 재분석으로 학습 방향 수정"

  - rule_id: "S4_R2_mock_exam_error_cause_classification"
    priority: 96
    description: "틀린 이유 분류 (개념 미흡/실수/시간 부족) + 수학 특화 차별화 전략"
    conditions:
      - field: "mock_exam_completed"
        operator: "=="
        value: true
      - field: "error_causes"
        operator: "in"
        value: ["개념 미흡", "실수", "시간 부족"]
    action:
      - "analyze: 'error_cause_distribution'"
      - "analyze: 'calculation_error_vs_concept_error_classification'"  # 계산 실수 vs 개념 오류 구분
      - "recommend_path: '오류 원인별 맞춤 대응 전략 - 계산 실수: 반복 연습 모듈, 개념 오류: 개념 재학습 모듈'"
      - "display_message: '틀린 이유를 분류하여 각각에 대한 대응 전략을 제안합니다. 계산 실수는 반복 연습으로, 개념 오류는 개념 재학습으로 보완합니다.'"
      - "question: '틀린 문제 중 계산 실수와 개념 오류를 구분해주세요. 계산 실수는 반복 연습으로, 개념 오류는 개념 재학습으로 보완 계획을 수립합니다.'"
    confidence: 0.94
    rationale: "S4: 오류 원인별 차별화된 전략 수립 - 계산 실수와 개념 오류는 완전히 다른 대응 전략 필요"
  
  - rule_id: "S4_R2_1_calculation_error_strategy"
    priority: 95
    description: "계산 실수 전용 반복 연습 전략"
    conditions:
      - field: "error_type"
        operator: "=="
        value: "calculation_error"
      - field: "calculation_error_count"
        operator: ">="
        value: 3
    action:
      - "load_db: 'math_textbook_db.yaml'"  # 오류 유형 분류 DB 로드
      - "analyze: 'calculation_error_pattern'"  # 계산 실수 패턴 분석
      - "analyze: 'calculation_error_type_classification'"  # 계산 실수 세부 유형 분류
      - "recommend_path: '계산 실수 반복 연습 모듈 - 풀이 과정 단계별 확인, 검산 습관화, 계산 문제 집중 연습, 오류 패턴별 맞춤 연습'"
      - "display_message: '계산 실수가 반복되고 있습니다. 풀이 과정을 단계별로 확인하고 검산 습관을 기르는 반복 연습 모듈을 제안합니다. 계산 실수는 개념 오류와 달리 반복 연습으로 개선 가능합니다.'"
      - "suggest_content: '계산 문제 집중 연습, 풀이 과정 단계별 검토, 검산 연습, 오류 패턴별 맞춤 연습'"
      - "treatment_strategy: '반복 연습 모듈'"  # 오류 유형별 치료 전략
    confidence: 0.95
    rationale: "S4: 계산 실수는 반복 연습과 검산 습관화로 개선 가능 - 개념 오류와 완전히 다른 대응 전략 필요"
  
  - rule_id: "S4_R2_2_concept_error_strategy"
    priority: 95
    description: "개념 오류 전용 개념 재학습 전략"
    conditions:
      - field: "error_type"
        operator: "=="
        value: "concept_error"
      - field: "concept_error_count"
        operator: ">="
        value: 2
    action:
      - "load_db: 'math_textbook_db.yaml'"  # 오류 유형 분류 및 진단목록 DB 로드
      - "load_db: 'math_unit_relations.yaml'"  # 단원 연계성 확인
      - "analyze: 'concept_error_identification'"  # 개념 오류 단원/개념 식별
      - "analyze: 'concept_error_type_classification'"  # 개념 오류 세부 유형 분류 (concept_understanding, concept_confusion 등)
      - "analyze: 'diagnosis_error_pattern_matching'"  # 진단목록 DB와 오류 패턴 매칭
      - "analyze: 'prerequisite_concept_check'"  # 선행 개념 완료 여부 확인
      - "analyze: 'concept_relearning_sequence'"  # 개념 재학습 순서 결정
      - "recommend_path: '개념 재학습 모듈 - 오류 유형별 맞춤 전략: 개념 이해 부족 → 개념 설명 재학습, 개념 혼동 → 개념 비교 학습, 선행 개념 보완'"
      - "display_message: '개념 오류가 발생했습니다. 오류 유형에 따라 맞춤 전략을 제안합니다. 개념 이해 부족은 개념 설명 재학습으로, 개념 혼동은 개념 비교 학습으로, 선행 개념 부족은 선행 개념 보완으로 개선합니다.'"
      - "suggest_content: '개념 설명 재학습, 예제 문제 단계별 이해, 선행 개념 보완, 개념 비교 학습'"
      - "treatment_strategy: '개념 재학습 모듈'"  # 오류 유형별 치료 전략
    confidence: 0.95
    rationale: "S4: 개념 오류는 개념 재학습과 선행 개념 보완으로 개선 가능 - 계산 실수와 완전히 다른 대응 전략 필요"

  - rule_id: "S4_R3_mock_exam_emotional_state_update"
    priority: 94
    description: "모의고사 결과 기반 정서 상태 갱신"
    conditions:
      - field: "mock_exam_completed"
        operator: "=="
        value: true
      - field: "emotional_response"
        operator: "in"
        value: ["자신감 상승", "불안감 증가"]
    action:
      - "analyze: 'emotional_state_update'"
      - "recommend_path: '정서 상태 반영 학습 전략 조정'"
      - "display_message: '모의고사 결과에 대한 정서적 반응을 반영하여 학습 전략을 조정합니다.'"
    confidence: 0.92
    rationale: "S4: 정서+인지 상태 갱신으로 동기 관리"

  - rule_id: "S4_R4_mock_exam_improvement_areas"
    priority: 95
    description: "다음 시험까지 보완하고 싶은 영역 설정"
    conditions:
      - field: "mock_exam_completed"
        operator: "=="
        value: true
      - field: "improvement_areas"
        operator: "!="
        value: null
    action:
      - "analyze: 'improvement_area_priority'"
      - "recommend_path: '보완 영역 중심 실전대비 강화 전략'"
      - "display_message: '보완하고 싶은 영역을 중심으로 실전 대비 전략을 강화합니다.'"
    confidence: 0.93
    rationale: "S4: 목표 지향적 학습 방향 설정"

  - rule_id: "S4_R5_comprehensive_mock_exam_analysis"
    priority: 97
    description: "모의고사·중간평가 이후 종합 분석 및 전략 수정 (수학학원 시스템 통합)"
    conditions:
      - field: "mock_exam_completed"
        operator: "=="
        value: true
      - field: "difficult_problem_types"
        operator: "!="
        value: null
      - field: "error_causes"
        operator: "!="
        value: null
      - field: "improvement_areas"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_mock_exam_ranking'"
      - "analyze: 'academy_textbook_coverage_analysis'"
      - "generate_description: 'comprehensive_mock_exam_analysis_with_academy'"
      - "recommend_path: '학원 등수 기반 취약 영역 재설정 + 학원 교재별 보완 전략 + 실전대비 강화 + 정서+인지 상태 갱신'"
      - "display_message: '학원 모의고사와 학교 시험 결과를 종합적으로 분석하여 학원 등수와 학원 교재 연습 정도를 반영한 학습 방향을 수정합니다.'"
    confidence: 0.95
    rationale: "S4: 모의고사 이후 최우선 전략 수정 (수학학원 시스템 통합)"
  
  - rule_id: "S4_R6_academy_ranking_based_strategy"
    priority: 96
    description: "학원 등수 기반 학습 전략 조정"
    conditions:
      - field: "mock_exam_completed"
        operator: "=="
        value: true
      - field: "academy_mock_exam_ranking"
        operator: "!="
        value: null
      - field: "target_academy_ranking"
        operator: "!="
        value: null
    action:
      - "analyze: 'ranking_gap_analysis'"
      - "recommend_path: '학원 등수 향상을 위한 단원별 집중 전략'"
      - "display_message: '학원 등수와 목표 등수의 차이를 분석하여 학원 교재별 보완 전략을 수립합니다.'"
    confidence: 0.94
    rationale: "S4: 학원 등수는 학원 친구들과의 상대적 위치이므로 중요 지표"

  # ========== S5: 동기·정서 변동 감지 관련 룰 ==========
  
  - rule_id: "S5_R1_emotional_state_assessment"
    priority: 94
    description: "공부할 때 기분 상태 파악 (지루/불안/몰입)"
    conditions:
      - field: "emotional_fluctuation_detected"
        operator: "=="
        value: true
      - field: "study_mood"
        operator: "in"
        value: ["지루", "불안", "몰입"]
    action:
      - "analyze: 'emotional_state_assessment'"
      - "recommend_path: '정서 상태 기반 피드백 제공'"
      - "display_message: '공부할 때의 기분 상태를 파악하여 적절한 정서 지원을 제공합니다.'"
    confidence: 0.92
    rationale: "S5: 정서 기반 피드백 엔진 작동 트리거"

  - rule_id: "S5_R2_mood_change_habits"
    priority: 93
    description: "공부 전후 기분 전환 습관 파악"
    conditions:
      - field: "emotional_fluctuation_detected"
        operator: "=="
        value: true
      - field: "mood_change_habits"
        operator: "!="
        value: null
    action:
      - "analyze: 'mood_management_pattern'"
      - "recommend_path: '기분 전환 습관 활용 루틴 설계'"
      - "display_message: '공부 전후 기분을 바꾸는 습관을 학습 루틴에 통합합니다.'"
    confidence: 0.91
    rationale: "S5: 정서 관리 루틴 최적화"

  - rule_id: "S5_R3_helpful_encouragement"
    priority: 92
    description: "공부가 잘 안 될 때 도움이 되는 말 파악"
    conditions:
      - field: "emotional_fluctuation_detected"
        operator: "=="
        value: true
      - field: "helpful_encouragement"
        operator: "!="
        value: null
    action:
      - "generate_description: 'personalized_encouragement_template'"
      - "recommend_path: '맞춤형 격려 메시지 생성'"
      - "display_message: '공부가 잘 안 될 때 도움이 되는 말을 파악하여 맞춤형 격려를 제공합니다.'"
    confidence: 0.9
    rationale: "S5: 개인화된 정서 지원"

  - rule_id: "S5_R4_pride_moments_recognition"
    priority: 93
    description: "스스로 뿌듯함을 느낀 순간 인식 및 확대"
    conditions:
      - field: "emotional_fluctuation_detected"
        operator: "=="
        value: true
      - field: "pride_moments"
        operator: "!="
        value: null
    action:
      - "analyze: 'success_pattern_recognition'"
      - "recommend_path: '성공 경험 확대 전략'"
      - "display_message: '뿌듯함을 느낀 순간을 인식하여 그런 경험을 더 자주 만들 수 있는 전략을 제안합니다.'"
    confidence: 0.92
    rationale: "S5: 긍정 경험 확대를 통한 동기 강화"

  - rule_id: "S5_R5_comprehensive_emotional_support"
    priority: 95
    description: "동기·정서 변동 감지 시 종합적 정서 보정 및 전략 완화"
    conditions:
      - field: "emotional_fluctuation_detected"
        operator: "=="
        value: true
      - field: "study_mood"
        operator: "!="
        value: null
      - field: "motivation_level"
        operator: "<"
        value: 0.5
    action:
      - "generate_description: 'comprehensive_emotional_support_plan'"
      - "recommend_path: '정서 보정 + 전략 완화·집중 재조정'"
      - "display_message: '동기나 정서 상태 변동을 감지하여 피로·의욕 저하·불안 등에 대응하는 종합적 지원 전략을 제공합니다.'"
    confidence: 0.94
    rationale: "S5: 정서 변동 시 최우선 대응"

  # ========== S6: 학부모 상담 이후 관련 룰 ==========
  
  - rule_id: "S6_R1_parent_consultation_memorable_words"
    priority: 94
    description: "부모님 말씀 중 마음에 남은 부분 파악"
    conditions:
      - field: "parent_consultation_completed"
        operator: "=="
        value: true
      - field: "memorable_parent_words"
        operator: "!="
        value: null
    action:
      - "analyze: 'parent_message_impact'"
      - "recommend_path: '부모 피드백 반영 전략 조정'"
      - "display_message: '부모님이 해주신 말씀 중 마음에 남은 부분을 학습 계획에 반영합니다.'"
    confidence: 0.92
    rationale: "S6: 가정 피드백을 전략에 반영"

  - rule_id: "S6_R2_parent_consultation_emotional_response"
    priority: 95
    description: "부모님 말씀에 대한 정서적 반응 파악 (부담/응원/무관심)"
    conditions:
      - field: "parent_consultation_completed"
        operator: "=="
        value: true
      - field: "parent_message_emotion"
        operator: "in"
        value: ["부담", "응원", "무관심"]
    action:
      - "analyze: 'parent_message_emotional_impact'"
      - "recommend_path: '정서 반응 기반 소통 전략 조정'"
      - "display_message: '부모님 말씀에 대한 정서적 반응을 바탕으로 학습 계획과 소통 방식을 조정합니다.'"
    confidence: 0.93
    rationale: "S6: 정서 맥락 반영 소통 전략"

  - rule_id: "S6_R3_parent_consultation_verification_needs"
    priority: 93
    description: "부모님이 확인하길 바라는 계획 부분 파악"
    conditions:
      - field: "parent_consultation_completed"
        operator: "=="
        value: true
      - field: "parent_verification_needs"
        operator: "!="
        value: null
    action:
      - "recommend_path: '부모 확인 채널 활성화 + 목표 조정'"
      - "display_message: '부모님이 확인하길 바라는 부분을 계획에 명시하고 정기적 피드백 채널을 활성화합니다.'"
    confidence: 0.91
    rationale: "S6: 소통기반 목표 조정"

  - rule_id: "S6_R4_comprehensive_parent_feedback_integration"
    priority: 96
    description: "학부모 상담 이후 종합적 피드백 반영 (수학학원 시스템 통합)"
    conditions:
      - field: "parent_consultation_completed"
        operator: "=="
        value: true
      - field: "memorable_parent_words"
        operator: "!="
        value: null
      - field: "parent_message_emotion"
        operator: "!="
        value: null
      - field: "parent_verification_needs"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_teacher_feedback_integration'"
      - "generate_description: 'comprehensive_parent_feedback_integration_with_academy'"
      - "recommend_path: '학원 선생님 피드백 + 부모 피드백을 전략에 통합 반영 + 소통기반 목표 조정'"
      - "display_message: '학원 선생님 상담과 학부모 상담 내용을 종합하여 학원 선생님의 전문적 조언과 부모의 기대·우려·지원 내용을 학습 전략에 통합 반영합니다.'"
    confidence: 0.94
    rationale: "S6: 학부모 상담 이후 최우선 반영 (수학학원 시스템 통합)"
  
  - rule_id: "S6_R5_academy_teacher_feedback_integration"
    priority: 95
    description: "학원 선생님 피드백 및 특별 지도 계획 반영"
    conditions:
      - field: "parent_consultation_completed"
        operator: "=="
        value: true
      - field: "academy_teacher_feedback"
        operator: "!="
        value: null
    action:
      - "analyze: 'teacher_feedback_strategy_mapping'"
      - "recommend_path: '학원 선생님 제시 학습 방향 반영 + 학원 특별 지도 계획 통합'"
      - "display_message: '학원 선생님이 제시한 학습 방향(예: 쎈 C단계 집중, 블랙라벨 추가)과 특별 지도 계획을 학습 전략에 반영합니다.'"
    confidence: 0.93
    rationale: "S6: 학원 선생님은 전문가이므로 조언 반영 필수"

  # ========== S7: 시험 직전(D-2주~D-3일) 관련 룰 ==========
  
  - rule_id: "S7_R1_exam_imminent_anxious_unit"
    priority: 96
    description: "시험 직전 가장 불안한 단원 파악"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 14
      - field: "d_day"
        operator: ">="
        value: 3
      - field: "anxious_units"
        operator: "!="
        value: null
    action:
      - "analyze: 'anxiety_focused_unit_analysis'"
      - "recommend_path: '불안 단원 집중 보완 전략'"
      - "display_message: '가장 불안한 단원을 파악하여 집중 보완 계획을 수립합니다.'"
    confidence: 0.94
    rationale: "S7: 단기 집중 플랜 핵심 요소"

  - rule_id: "S7_R2_exam_imminent_time_pressure"
    priority: 95
    description: "기출문제 풀 때 시간 압박감 진단"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 14
      - field: "d_day"
        operator: ">="
        value: 3
      - field: "time_pressure_felt"
        operator: "=="
        value: true
    action:
      - "analyze: 'time_management_deficiency'"
      - "recommend_path: '시간 관리 훈련 및 실전 연습 강화'"
      - "display_message: '시간 압박감을 느낀다면 시간 관리 훈련과 실전 연습을 강화합니다.'"
    confidence: 0.93
    rationale: "S7: 실전 감각 향상을 위한 시간 관리"

  - rule_id: "S7_R3_exam_imminent_condition_check"
    priority: 94
    description: "시험 직전 컨디션 점검 (10점 만점)"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 14
      - field: "d_day"
        operator: ">="
        value: 3
      - field: "condition_score"
        operator: ">="
        value: 0
      - field: "condition_score"
        operator: "<="
        value: 10
    action:
      - "analyze: 'condition_assessment'"
      - "recommend_path: '컨디션 보정 전략'"
      - "display_message: '현재 컨디션을 점검하여 컨디션 관리 방안을 제시합니다.'"
    confidence: 0.92
    rationale: "S7: 컨디션 관리로 실전 준비"

  - rule_id: "S7_R4_exam_imminent_final_checklist"
    priority: 95
    description: "시험 전 확인하고 싶은 내용 정리"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 14
      - field: "d_day"
        operator: ">="
        value: 3
      - field: "final_checklist_items"
        operator: "!="
        value: null
    action:
      - "recommend_path: '최종 확인 체크리스트 생성'"
      - "display_message: '시험 전에 꼭 확인하고 싶은 내용을 체크리스트로 정리합니다.'"
    confidence: 0.93
    rationale: "S7: 최종 점검 체계화"

  - rule_id: "S7_R5_comprehensive_final_preparation"
    priority: 97
    description: "시험 직전 종합 단기 집중 마무리 플랜 (수학학원 시스템 통합)"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 14
      - field: "d_day"
        operator: ">="
        value: 3
      - field: "anxious_units"
        operator: "!="
        value: null
      - field: "condition_score"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_school_exam_schedule_alignment'"
      - "analyze: 'academy_textbook_final_review'"
      - "generate_description: 'comprehensive_final_preparation_plan_with_academy'"
      - "recommend_path: '학원-학교 시험 일정 통합 + 학원 교재 기반 마무리 + 학원 수업 복습 + 단기 집중 마무리 플랜 + 컨디션 보정'"
      - "display_message: '학교 시험과 학원 모의고사 일정을 통합하여 학원 교재와 학원 수업 내용을 중심으로 단기 집중 마무리 플랜을 생성합니다.'"
    confidence: 0.95
    rationale: "S7: 시험 직전 최우선 마무리 전략 (수학학원 시스템 통합)"
  
  - rule_id: "S7_R6_academy_textbook_final_review"
    priority: 96
    description: "학원 교재 최종 복습 계획 (쎈, 개념원리 등 미완료 문제)"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 14
      - field: "d_day"
        operator: ">="
        value: 3
      - field: "academy_homework"
        operator: "!="
        value: null
    action:
      - "analyze: 'unfinished_academy_homework'"
      - "recommend_path: '학원 교재 미완료 문제 우선 복습 + 학원 수업 핵심 내용 재정리'"
      - "display_message: '학원 교재(쎈, 개념원리 등)에서 아직 못 푼 문제와 학원 수업에서 배운 핵심 내용을 우선적으로 복습합니다.'"
    confidence: 0.94
    rationale: "S7: 학원 교재는 시험 출제와 직접 연관되므로 최종 복습 필수"

  # ========== S8: 시험 이후(복기) 관련 룰 ==========
  
  - rule_id: "S8_R1_exam_completion_well_solved_types"
    priority: 94
    description: "시험장에서 잘 풀린 문제 유형 분석"
    conditions:
      - field: "exam_completed"
        operator: "=="
        value: true
      - field: "well_solved_problem_types"
        operator: "!="
        value: null
    action:
      - "analyze: 'strength_problem_type_pattern'"
      - "generate_description: 'success_pattern_archive'"
      - "display_message: '잘 풀린 문제 유형을 분석하여 강점 패턴을 기록합니다.'"
    confidence: 0.92
    rationale: "S8: 성찰데이터 저장 - 강점 패턴"

  - rule_id: "S8_R2_exam_completion_blocked_types"
    priority: 95
    description: "막혔던 문제 유형 분석"
    conditions:
      - field: "exam_completed"
        operator: "=="
        value: true
      - field: "blocked_problem_types"
        operator: "!="
        value: null
    action:
      - "analyze: 'weakness_problem_type_pattern'"
      - "generate_description: 'improvement_area_archive'"
      - "display_message: '막혔던 문제 유형을 분석하여 개선이 필요한 영역을 기록합니다.'"
    confidence: 0.93
    rationale: "S8: 성찰데이터 저장 - 약점 패턴"

  - rule_id: "S8_R3_exam_completion_keep_habits"
    priority: 93
    description: "다음에 유지하고 싶은 습관 식별"
    conditions:
      - field: "exam_completed"
        operator: "=="
        value: true
      - field: "habits_to_keep"
        operator: "!="
        value: null
    action:
      - "analyze: 'effective_habit_pattern'"
      - "generate_description: 'habit_retention_plan'"
      - "display_message: '시험 준비 과정에서 효과적이었던 습관을 다음 시험에도 유지할 수 있도록 계획합니다.'"
    confidence: 0.91
    rationale: "S8: 성공 습관 유지 전략"

  - rule_id: "S8_R4_exam_completion_change_areas"
    priority: 94
    description: "다음 시험을 위해 바꾸고 싶은 부분 설정"
    conditions:
      - field: "exam_completed"
        operator: "=="
        value: true
      - field: "areas_to_change"
        operator: "!="
        value: null
    action:
      - "analyze: 'improvement_opportunity'"
      - "generate_description: 'next_exam_preparation_adjustment'"
      - "display_message: '다음 시험을 위해 개선하고 싶은 부분을 설정하여 새로운 학습 루프를 초기화합니다.'"
    confidence: 0.92
    rationale: "S8: 다음 루프 초기화 - 개선점 반영"

  - rule_id: "S8_R5_comprehensive_exam_reflection"
    priority: 96
    description: "시험 이후 종합 복기 및 다음 시험 대비 루프 초기화 (수학학원 시스템 통합)"
    conditions:
      - field: "exam_completed"
        operator: "=="
        value: true
      - field: "well_solved_problem_types"
        operator: "!="
        value: null
      - field: "blocked_problem_types"
        operator: "!="
        value: null
      - field: "habits_to_keep"
        operator: "!="
        value: null
      - field: "areas_to_change"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_exam_effectiveness_analysis'"
      - "analyze: 'academy_textbook_effectiveness_verification'"
      - "generate_description: 'comprehensive_exam_reflection_with_academy'"
      - "recommend_path: '학원 등수 기반 성과 분석 + 학원 교재/수업 효과성 검증 + 학원 선생님 피드백 반영 + 성찰데이터 저장 + 다음 시험 대비 학습 루프 초기화'"
      - "display_message: '학교 시험과 학원 모의고사 결과를 종합적으로 분석하여 학원 교재와 학원 수업의 효과성을 검증하고, 학원 진도와 학교 진도를 연계하여 다음 시험 대비 학습 루프를 초기화합니다.'"
    confidence: 0.94
    rationale: "S8: 시험 이후 최우선 복기 및 루프 초기화 (수학학원 시스템 통합)"
  
  - rule_id: "S8_R6_academy_effectiveness_verification"
    priority: 95
    description: "학원 교재 및 수업 효과성 검증"
    conditions:
      - field: "exam_completed"
        operator: "=="
        value: true
      - field: "academy_name"
        operator: "!="
        value: null
    action:
      - "analyze: 'academy_textbook_problem_coverage'"
      - "analyze: 'academy_class_understanding_impact'"
      - "recommend_path: '학원 교재 활용 방법 개선 + 학원 수업 이해 방법 개선 + 학원 과제 처리 방법 개선'"
      - "display_message: '학원 교재에서 연습한 문제가 시험에 얼마나 도움이 됐는지, 학원 수업에서 배운 내용이 시험에 얼마나 효과적이었는지 분석하여 다음 시험에 반영합니다.'"
    confidence: 0.93
    rationale: "S8: 학원 교재와 수업의 효과성을 검증하여 다음 시험 대비 전략 수립"

  # ========== D-day 기반 전략 룰 ==========
  
  - rule_id: "D_URGENT_intensive_mode"
    priority: 98
    description: "D ≤ 3일 긴급 집중 모드 전략"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 3
      - field: "d_day"
        operator: ">="
        value: 1
    action:
      - "recommend_path: '핵심 개념 + 기출 변형 집중'"
      - "strategy_type: '긴급 집중 모드'"
      - "display_message: '시험이 임박했습니다. 핵심 요약과 기출 변형에 집중합시다.'"
    confidence: 0.96
    rationale: "D-day 기반 전략: 긴급도 최우선"

  - rule_id: "D_MODERATE_balanced_mode"
    priority: 90
    description: "D 4~10일 균형형 전략"
    conditions:
      - field: "d_day"
        operator: "<="
        value: 10
      - field: "d_day"
        operator: ">="
        value: 4
    action:
      - "recommend_path: '개념 60% + 문제 40% 균형'"
      - "strategy_type: '균형형'"
      - "display_message: '이번 주는 개념-문제 6:4 비율로 구성합니다.'"
    confidence: 0.88
    rationale: "D-day 기반 전략: 균형 접근"

  - rule_id: "D_NORMAL_concept_first_mode"
    priority: 85
    description: "D > 10일 개념 정립 후 유형 확장"
    conditions:
      - field: "d_day"
        operator: ">"
        value: 10
    action:
      - "recommend_path: '개념 정립 후 유형 확장'"
      - "strategy_type: '개념 정립형'"
      - "display_message: '충분한 시간이 있으니 개념을 탄탄히 다진 후 유형 연습으로 확장합니다.'"
    confidence: 0.86
    rationale: "D-day 기반 전략: 기초 중심"

  # ========== 메뉴별 전략 룰 ==========
  
  - rule_id: "MENU_VACATION_long_term_plan"
    priority: 87
    description: "방학 기간 장기 학습 계획"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "방학"
    action:
      - "recommend_path: '장기 계획 + 개념선행 + 복습 & 심화'"
      - "strategy_type: '장기 지속 루틴'"
      - "display_message: '방학 기간을 활용하여 체계적이고 장기적인 학습 계획을 수립합니다.'"
    confidence: 0.85
    rationale: "방학 메뉴: 여유로운 시간 활용"

  - rule_id: "MENU_D56_systematic_preparation"
    priority: 89
    description: "D-2개월 체계적 단계별 학습"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "D-2개월"
    action:
      - "recommend_path: '개념공부 > 유형연습 > 심화학습 > 기출문제 풀이 순서'"
      - "strategy_type: '체계적 단계별 학습'"
      - "display_message: '2개월 여유를 두고 체계적으로 단계별 학습을 진행합니다.'"
    confidence: 0.87
    rationale: "D-2개월: 충분한 준비 시간 활용"

  - rule_id: "MENU_D28_efficient_allocation"
    priority: 91
    description: "D-1개월 효율적 시간 배분"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "D-1개월"
    action:
      - "analyze: 'current_progress_diagnosis'"
      - "recommend_path: '현재 진행상황 진단 + 계획 재조정'"
      - "strategy_type: '효율적 집중 루틴'"
      - "display_message: '1개월 집중 학습을 위해 현재 진행 상황을 진단하고 계획을 재조정합니다.'"
    confidence: 0.89
    rationale: "D-1개월: 효율성 중심 재조정"

  - rule_id: "MENU_D14_chunking_strategy"
    priority: 93
    description: "D-2주 단기집중 청킹 전략"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "D-2주"
    action:
      - "analyze: 'current_progress_diagnosis'"
      - "recommend_path: '단기기억 청킹 + 작업기억 청킹 최적화'"
      - "strategy_type: '단기 집중 마무리'"
      - "display_message: '2주 단기집중으로 핵심 개념을 마스터하기 위한 청킹 전략을 적용합니다.'"
    confidence: 0.91
    rationale: "D-2주: 기억 최적화 전략"

  - rule_id: "MENU_D7_customized_strategy"
    priority: 94
    description: "D-1주 맞춤 전략 선택"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "D-1주"
    action:
      - "analyze: 'student_acceptance_feasibility'"
      - "recommend_path: '실전상황 적용도 높이는 맞춤전략'"
      - "strategy_type: '실전 대비 맞춤형'"
      - "display_message: '학생이 실제 실행 가능하고 효과적일 것이라고 느끼는 맞춤 전략을 선택합니다.'"
    confidence: 0.92
    rationale: "D-1주: 실행 가능성 중시"

  - rule_id: "MENU_D3_vulnerability_focus"
    priority: 95
    description: "D-3일 취약점 집중 보완"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "D-3일"
    action:
      - "analyze: 'practice_test_diagnosis'"
      - "recommend_path: '실전 준비상태 진단 + 취약지점 집중보충'"
      - "strategy_type: '최종 마무리 집중'"
      - "display_message: '기출문제를 통하여 실전 준비상태를 진단하고 취약지점을 집중 보완합니다.'"
    confidence: 0.93
    rationale: "D-3일: 취약점 집중 보완"

  - rule_id: "MENU_D1_working_memory_activation"
    priority: 96
    description: "D-1일 작업기억 활성화"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "D-1일"
    action:
      - "recommend_path: '작업기억 활성화 + 워밍업 기반 최적화'"
      - "strategy_type: '멘탈 관리 중심'"
      - "display_message: '작업기억 활성화를 위하여 Speed 서술평가 등을 배치하고 워밍업 과정을 통하여 최적화합니다.'"
    confidence: 0.94
    rationale: "D-1일: 작업기억 최적화 및 멘탈 관리"

  - rule_id: "MENU_NO_EXAM_routine_maintenance"
    priority: 80
    description: "시험없음 평상시 루틴 유지"
    conditions:
      - field: "exam_timeline"
        operator: "=="
        value: "시험없음"
    action:
      - "recommend_path: '현재 진도 중심 학습 + 복습'"
      - "strategy_type: '꾸준한 루틴'"
      - "display_message: '평상시 꾸준한 학습 루틴을 유지하며 현재 진도에 맞춘 학습과 복습을 진행합니다.'"
    confidence: 0.82
    rationale: "시험없음: 일상 루틴 유지"

  # ========== 포괄형 질문 1: 학원·학교·집 학습 정렬 ==========
  
  - rule_id: "Q1_comprehensive_alignment_strategy"
    priority: 150
    description: "포괄형 질문 1: 학원·학교·집 학습 정렬 전략 도출 - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "학원"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "학교"
        - field: "user_message"
          operator: "contains"
          value: "집 학습"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "정렬"
        - field: "user_message"
          operator: "contains"
          value: "엇갈리고"
    action:
    # 1단계: 온톨로지 인스턴스 생성
    - "create_instance: 'mk:ExamSchedule'"
    - "set_property: ('mk:dDay', '{d_day}')"
    - "set_property: ('mk:examSubject', '{exam_subject}')"
    - "set_property: ('mk:examScope', '{exam_scope}')"
    
    - "create_instance: 'mk:AcademySchoolHomeAlignment'"
    - "set_property: ('mk:academyProgress', '{academy_progress}')"
    - "set_property: ('mk:schoolExamScope', '{school_exam_scope}')"
    - "set_property: ('mk:progressGap', '{progress_gap}')"
    - "set_property: ('mk:academyAssignmentTime', '{academy_assignment_time}')"
    - "set_property: ('mk:academyAssignmentFatigue', '{academy_assignment_fatigue}')"
    - "set_property: ('mk:homeStudyRoutine', '{home_study_routine}')"
    
    - "create_instance: 'mk:ProgressGapAnalysis'"
    - "set_property: ('mk:academyProgress', '{academy_progress}')"
    - "set_property: ('mk:schoolExamScope', '{school_exam_scope}')"
    
    - "create_instance: 'mk:TimeResourceAllocation'"
    - "set_property: ('mk:dDay', '{d_day}')"
    - "set_property: ('mk:availableTimeByDDay', '{available_time_by_d_day}')"
    - "set_property: ('mk:academyTime', '{academy_time}')"
    - "set_property: ('mk:schoolTime', '{school_time}')"
    - "set_property: ('mk:homeTime', '{home_time}')"
    
    # 2단계: 의미 기반 추론
    - "reason_over: 'mk:AcademySchoolHomeAlignment'"
    - "reason_over: 'mk:ProgressGapAnalysis'"
    - "reason_over: 'mk:TimeResourceAllocation'"
    
    # 3단계: 정렬 플랜 생성
    - "generate_strategy: 'mk:AlignmentPlan'"
    - "set_property: ('mk:recommendsAlignmentStrategy', 'alignment_strategy')"
    - "set_property: ('mk:recommendsTimeAllocation', 'time_allocation')"
    
    # 4단계: 분석 및 설명 생성
    - "analyze: 'academy_school_home_alignment_analysis'"
    - "analyze: 'progress_gap_analysis'"
    - "analyze: 'time_resource_allocation_analysis'"
    
    - "generate_description: 'comprehensive_alignment_strategy'"
    - "recommend_path: '학원-학교-집 3축 정렬 플랜 및 시간 배분 리셋 루틴'"
    - "display_message: '학원 진도({academy_progress}), 학교 시험 범위({school_exam_scope}), 집 공부 루틴을 종합 분석하여 진도 격차, 과제 소요 시간, 피로도, 시험 D-day별 시간 자원을 분석하고 학원-학교-집 3축 정렬 플랜과 시간 배분 리셋 루틴을 제시합니다.'"
    confidence: 0.95
    rationale: "포괄형 질문 1: 학원·학교·집 학습 정렬 - 온톨로지 기반 의미 추론 및 정렬 전략 생성"

  # ========== 포괄형 질문 2: 시험 8주 루프 점수 상승 잠재력 극대화 ==========

  - rule_id: "Q2_comprehensive_score_improvement"
    priority: 150
    description: "포괄형 질문 2: 시험 8주 루프 점수 상승 잠재력 극대화 전략 도출 - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "시험"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "8주"
        - field: "user_message"
          operator: "contains"
          value: "점수 상승"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "학습 전략 비율"
        - field: "user_message"
          operator: "contains"
          value: "단원 우선순위"
    action:
    # 1단계: 온톨로지 인스턴스 생성
    - "create_instance: 'mk:ExamSchedule'"
    - "set_property: ('mk:dDay', '{d_day}')"
    - "set_property: ('mk:examSubject', '{exam_subject}')"
    
    - "create_instance: 'mk:ScoreImprovementPotential'"
    - "set_property: ('mk:targetScore', '{target_score}')"
    - "set_property: ('mk:currentExpectedScore', '{current_expected_score}')"
    - "set_property: ('mk:unitAccuracyRate', '{unit_accuracy_rate}')"
    - "set_property: ('mk:textbookProgressRate', '{textbook_progress_rate}')"
    - "set_property: ('mk:academyFeedbackData', '{academy_feedback_data}')"
    
    - "create_instance: 'mk:StrategyRatioOptimization'"
    - "set_property: ('mk:conceptRatio', '{concept_ratio}')"
    - "set_property: ('mk:typeRatio', '{type_ratio}')"
    - "set_property: ('mk:advancedRatio', '{advanced_ratio}')"
    - "set_property: ('mk:pastExamRatio', '{past_exam_ratio}')"
    
    - "create_instance: 'mk:UnitPriorityByEfficiency'"
    - "set_property: ('mk:unitAccuracyRate', '{unit_accuracy_rate}')"
    - "set_property: ('mk:timeWeightedEfficiency', '{time_weighted_efficiency}')"
    
    # 2단계: 의미 기반 추론
    - "reason_over: 'mk:ScoreImprovementPotential'"
    - "reason_over: 'mk:StrategyRatioOptimization'"
    - "reason_over: 'mk:UnitPriorityByEfficiency'"
    
    # 3단계: 전략 생성
    - "generate_strategy: 'mk:LearningStrategyRatio'"
    - "set_property: ('mk:recommendsStrategyRatio', 'strategy_ratio')"
    - "set_property: ('mk:recommendsUnitPriority', 'unit_priority')"
    
    # 4단계: 분석 및 설명 생성
    - "analyze: 'score_improvement_potential_analysis'"
    - "analyze: 'strategy_ratio_optimization'"
    - "analyze: 'unit_priority_by_efficiency'"
    
    - "generate_description: 'comprehensive_score_improvement_strategy'"
    - "recommend_path: '개념:유형:심화:기출 비율 재조정 및 단원 우선순위 최적화'"
    - "display_message: '목표 점수({target_score}), 현재 예상 점수({current_expected_score}), 단원별 정답률, 교재별 진도율, 학원 피드백 데이터를 종합하여 학습 전략 비율을 재조정하고 단원 우선순위를 결정합니다.'"
    confidence: 0.94
    rationale: "포괄형 질문 2: 시험 8주 루프 점수 상승 잠재력 극대화 - 온톨로지 기반 의미 추론 및 전략 생성"

  # ========== 포괄형 질문 3: 시험 종료 후 다음 시험 주기 개선 패턴 ==========

  - rule_id: "Q3_comprehensive_improvement_pattern"
    priority: 150
    description: "포괄형 질문 3: 시험 종료 후 다음 시험 주기 개선 패턴 분석 - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "시험"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "끝난"
        - field: "user_message"
          operator: "contains"
          value: "종료"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "개선"
        - field: "user_message"
          operator: "contains"
          value: "다음 시험"
    action:
    # 1단계: 온톨로지 인스턴스 생성
    - "create_instance: 'mk:ExamCycleImprovement'"
    - "set_property: ('mk:academyRank', '{academy_rank}')"
    - "set_property: ('mk:schoolScore', '{school_score}')"
    - "set_property: ('mk:questionTypeSuccessRate', '{question_type_success_rate}')"
    - "set_property: ('mk:textbookCoverage', '{textbook_coverage}')"
    - "set_property: ('mk:examHitRate', '{exam_hit_rate}')"
    - "set_property: ('mk:textbookEffectivenessIndex', '{textbook_effectiveness_index}')"
    
    - "create_instance: 'mk:TextbookEffectivenessAnalysis'"
    - "set_property: ('mk:textbookCoverage', '{textbook_coverage}')"
    - "set_property: ('mk:examHitRate', '{exam_hit_rate}')"
    
    - "create_instance: 'mk:ErrorPattern'"
    - "set_property: ('mk:calculationErrorRatio', '{calculation_error_ratio}')"
    - "set_property: ('mk:conceptErrorRatio', '{concept_error_ratio}')"
    
    - "create_instance: 'mk:RoutineMaintenancePattern'"
    - "set_property: ('mk:routineMaintenanceRate', '{routine_maintenance_rate}')"
    
    # 2단계: 의미 기반 추론
    - "reason_over: 'mk:ExamCycleImprovement'"
    - "reason_over: 'mk:TextbookEffectivenessAnalysis'"
    - "reason_over: 'mk:ErrorPattern'"
    - "reason_over: 'mk:RoutineMaintenancePattern'"
    
    # 3단계: 개선 전략 생성
    - "generate_strategy: 'mk:ImprovementStrategy'"
    - "set_property: ('mk:recommendsImprovementStrategy', 'improvement_strategy')"
    
    # 4단계: 분석 및 설명 생성
    - "analyze: 'exam_cycle_improvement_analysis'"
    - "analyze: 'textbook_effectiveness_analysis'"
    - "analyze: 'error_pattern_analysis'"
    - "analyze: 'routine_maintenance_pattern_analysis'"
    
    - "generate_description: 'comprehensive_improvement_pattern'"
    - "recommend_path: '다음 시험 루프 초기화 전략 및 보완 단원 리스트 생성'"
    - "display_message: '학원 등수({academy_rank}), 학교 성적({school_score}), 문항 유형별 성공률, 학원 교재 효과 지표를 종합 평가하여 다음 시험 루프 초기화 전략과 보완 단원 리스트를 생성합니다.'"
    confidence: 0.93
    rationale: "포괄형 질문 3: 시험 종료 후 다음 시험 주기 개선 패턴 분석 - 온톨로지 기반 의미 추론 및 개선 전략 생성"

# Default fallback rule
default_rule:
  rule_id: "default"
  action:
    - "display_message: '시험 일정 정보를 분석 중입니다.'"
  confidence: 0.5
  rationale: "기본 루틴 적용"

# ========== 데이터 기반 질문 연계 정보 ==========
# 
# 이 rules.yaml 파일은 questions.html의 포괄형 질문과 data_based_questions.js의 데이터 기반 질문과 연계됩니다.
#
# 포괄형 질문 1: "지금 이 학생의 시험 대비 흐름을 보면, 학원·학교·집 학습이 어떻게 엇갈리고 있는지, 어디부터 정렬시켜야 할까?"
#   - 연계 룰: S0_R1~S0_R4 (시험 계획 수립 필수 정보 수집), S1~S8 (D-day별 학습 전략)
#   - 데이터 소스: academy_progress, school_exam_scope, progress_gap, academy_assignment_time, exam_d_day, academy_school_home_alignment
#   - 온톨로지: AcademySchoolHomeAlignment, ProgressGapAnalysis, TimeResourceAllocation
#
# 포괄형 질문 2: "시험 8주 루프 안에서 이 학생의 점수 상승 잠재력을 극대화하려면, 어떤 단원과 학습 전략 비율을 조정해야 할까?"
#   - 연계 룰: S3~S8 (D-day별 학습 전략)
#   - 데이터 소스: target_score, unit_accuracy_rate, textbook_progress_rate, academy_feedback_data, strategy_ratio, unit_priority
#   - 온톨로지: ScoreImprovementPotential, StrategyRatioOptimization, UnitPriorityByEfficiency
#   - 연계 에이전트: Agent 03 (목표 분석), Agent 04 (취약점 분석), Agent 06 (교사 피드백), Agent 09 (학습관리), Agent 18 (시그너처루틴)
#
# 포괄형 질문 3: "시험이 끝난 지금, 학원 데이터와 학교 데이터를 종합했을 때 다음 시험 주기에 가장 먼저 개선해야 할 핵심 패턴은 무엇일까?"
#   - 연계 룰: S8 (시험 종료 후 평가)
#   - 데이터 소스: academy_rank, school_score, question_type_success_rate, textbook_effectiveness_index, repeated_error_pattern, routine_maintenance_rate
#   - 온톨로지: ExamCycleImprovement, TextbookEffectivenessAnalysis, RoutineMaintenancePattern
#   - 연계 에이전트: Agent 04 (취약점 분석), Agent 06 (교사 피드백), Agent 09 (학습관리), Agent 13 (이탈 방지)
#
# 자세한 데이터 기반 질문 정의는 data_based_questions.js의 agent02 섹션을 참조하세요.