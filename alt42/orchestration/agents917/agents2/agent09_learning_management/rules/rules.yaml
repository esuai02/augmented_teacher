# Rules for Agent 09 - Learning Management
# Generated at: 2025-01-27
# Purpose: 현직 수학선생님 수준의 학습관리 역량 구현 (90% 수준 목표)
# Source: teacher_level_evaluation.md 분석 기반

version: "1.0"
scenario: "learning_management"
description: "학습관리 분석: 출결, 목표, 포모도로, 오답노트, 시험 패턴 종합 분석 및 전략 도출"

rules:
  # ========== S0: 필수 데이터 수집 및 패턴 유형 진단 룰 ==========
  
  - rule_id: "S0_R1_learning_data_collection"
    priority: 99
    description: "5가지 핵심 학습 데이터 수집 (출결, 목표, 포모도로, 오답노트, 시험)"
    conditions:
      - OR:
        - field: "attendance_data"
          operator: "=="
          value: null
        - field: "goal_data"
          operator: "=="
          value: null
        - field: "pomodoro_data"
          operator: "=="
          value: null
        - field: "wrong_note_data"
          operator: "=="
          value: null
        - field: "test_data"
          operator: "=="
          value: null
    action:
      - "collect_data: 'attendance'"
      - "collect_data: 'goals'"
      - "collect_data: 'pomodoro'"
      - "collect_data: 'wrong_notes'"
      - "collect_data: 'test_patterns'"
      - "load_db: 'data_access.php'"
      - "validate: '5가지 핵심 데이터 수집 완료 확인'"
      - "display_message: '학습관리 분석을 위해 출결, 목표, 포모도로, 오답노트, 시험 데이터를 수집합니다.'"
    confidence: 0.98
    rationale: "S0: 5가지 핵심 지표는 학습관리 분석의 기초 데이터"
  
  - rule_id: "S0_R2_pattern_type_classification"
    priority: 98
    description: "학습 패턴 유형 자동 분류 (6가지 유형)"
    conditions:
      - field: "attendance_data"
        operator: "!="
        value: null
      - field: "goal_data"
        operator: "!="
        value: null
      - field: "pomodoro_data"
        operator: "!="
        value: null
    action:
      - "analyze: 'pattern_type_classification'"
      - "calculate: 'data_density_score'"  # 데이터 밀도 점수
      - "calculate: 'data_balance_score'"  # 데이터 균형 점수
      - "calculate: 'pattern_stability_score'"  # 패턴 안정도 점수
      - "classify: 'learning_pattern_type'"  # 6가지 유형 중 분류
      - "validate: '패턴 유형은 활동데이터 희박형, 불균형형, 패턴불안정형, 자동화 저항형, 퇴원위험형, 고성취 지속형 중 하나'"
      - "display_message: '학습 패턴 유형을 분석하여 맞춤형 전략을 수립합니다.'"
    confidence: 0.95
    rationale: "S0: 패턴 유형 분류는 개인화 전략의 기초"
  
  - rule_id: "S0_R3_correlation_analysis"
    priority: 97
    description: "데이터 간 상관관계 분석 (출결↔포모도로, 목표↔시험점수 등)"
    conditions:
      - field: "attendance_data"
        operator: "!="
        value: null
      - field: "pomodoro_data"
        operator: "!="
        value: null
      - field: "goal_data"
        operator: "!="
        value: null
      - field: "test_data"
        operator: "!="
        value: null
    action:
      - "analyze: 'attendance_pomodoro_correlation'"  # 출결-포모도로 상관관계
      - "analyze: 'goal_test_score_correlation'"  # 목표-시험점수 상관관계
      - "analyze: 'wrong_note_study_time_correlation'"  # 오답노트-학습시간 상관관계
      - "analyze: 'pomodoro_test_performance_correlation'"  # 포모도로-시험성과 상관관계
      - "calculate: 'overall_consistency_score'"  # 전체 일관성 점수
      - "identify: 'key_correlation_patterns'"  # 핵심 상관관계 패턴
      - "display_message: '데이터 간 상관관계를 분석하여 학습 패턴의 일관성을 평가합니다.'"
    confidence: 0.94
    rationale: "S0: 상관관계 분석은 원인 파악과 전략 수립의 핵심"
  
  - rule_id: "S0_R4_data_reliability_assessment"
    priority: 96
    description: "데이터 신뢰도 평가 (밀도, 일관성, 효과성)"
    conditions:
      - field: "attendance_data"
        operator: "!="
        value: null
    action:
      - "calculate: 'data_density'"  # 데이터 밀도 (일자별/주별 기록 빈도)
      - "calculate: 'data_consistency'"  # 데이터 일관성 (패턴 안정도)
      - "calculate: 'data_effectiveness'"  # 데이터 효과성 (성과와의 연관성)
      - "assess: 'data_reliability_grade'"  # 신뢰도 등급 (A/B/C/D)
      - "validate: '데이터 신뢰도가 낮으면 추가 데이터 수집 필요'"
      - "display_message: '데이터 신뢰도를 평가하여 분석의 정확성을 검증합니다.'"
    confidence: 0.93
    rationale: "S0: 데이터 신뢰도 평가는 분석 품질 보장 필수"
  
  - rule_id: "S0_R5_student_survey_data_collection"
    priority: 95
    description: "데이터 부족 시 학생 설문 자동 생성 및 수집"
    conditions:
      - field: "data_reliability_grade"
        operator: "in"
        value: ["C", "D"]
      - OR:
        - field: "attendance_data"
          operator: "=="
          value: null
        - field: "data_density"
          operator: "<"
          value: 0.5
    action:
      - "generate_survey: 'learning_habits'"  # 학습 습관 설문
      - "generate_survey: 'difficulties'"  # 어려움 설문
      - "generate_survey: 'goals_motivation'"  # 목표 및 동기 설문
      - "generate_survey: 'satisfaction'"  # 만족도 설문
      - "collect_survey_data: 'student_responses'"
      - "analyze: 'survey_pattern_extraction'"  # 설문 패턴 추출
      - "supplement: 'missing_data_with_survey'"  # 설문으로 부족한 데이터 보완
      - "display_message: '데이터가 부족하여 학생 설문을 통해 정보를 수집합니다.'"
    confidence: 0.92
    rationale: "S0: 데이터 부족 시 학생 설문으로 보완 (데이터 부재 시나리오 대응)"
  
  - rule_id: "S0_R6_teacher_checklist_collection"
    priority: 94
    description: "선생님 체크리스트 데이터 수집 및 분석"
    conditions:
      - field: "teacher_checklist_provided"
        operator: "=="
        value: true
    action:
      - "collect_data: 'teacher_observations'"  # 선생님 관찰 내용
      - "collect_data: 'student_status'"  # 학생 상태
      - "collect_data: 'learning_attitude'"  # 학습 태도
      - "collect_data: 'difficulties_strengths'"  # 어려움 및 강점
      - "analyze: 'teacher_checklist_pattern'"  # 체크리스트 패턴 분석
      - "compare: 'system_data_vs_teacher_observation'"  # 시스템 데이터와 선생님 관찰 비교
      - "integrate: 'multi_source_analysis'"  # 다중 소스 통합 분석
      - "display_message: '선생님의 관찰 내용을 분석하여 시스템 데이터와 통합합니다.'"
    confidence: 0.91
    rationale: "S0: 선생님 체크리스트는 정성적 데이터의 중요한 소스"
  
  - rule_id: "S0_R7_text_input_analysis"
    priority: 93
    description: "텍스트 입력 기반 자연어 처리 및 패턴 도출"
    conditions:
      - field: "text_input_provided"
        operator: "=="
        value: true
    action:
      - "collect_data: 'free_text_input'"  # 자유 형식 텍스트 입력
      - "analyze_nlp: 'keyword_extraction'"  # 키워드 추출
      - "analyze_nlp: 'sentiment_analysis'"  # 감정 분석
      - "analyze_nlp: 'topic_analysis'"  # 주제 분석
      - "extract_patterns: 'text_based_patterns'"  # 텍스트 기반 패턴 추출
      - "integrate: 'text_data_with_quantitative'"  # 정량 데이터와 통합
      - "display_message: '텍스트 입력을 분석하여 학습 패턴에 반영합니다.'"
    confidence: 0.90
    rationale: "S0: 텍스트 입력은 자유 형식 피드백 수집에 유용"
  
  - rule_id: "S0_R8_multi_source_data_integration"
    priority: 92
    description: "다중 데이터 소스 통합 분석 (DB + 설문 + 체크리스트 + 텍스트)"
    conditions:
      - OR:
        - field: "student_survey_data"
          operator: "!="
          value: null
        - field: "teacher_checklist_data"
          operator: "!="
          value: null
        - field: "text_input_data"
          operator: "!="
          value: null
    action:
      - "calculate: 'source_reliability_weights'"  # 소스별 신뢰도 가중치
      - "validate: 'data_consistency_across_sources'"  # 소스 간 일관성 검증
      - "integrate: 'weighted_multi_source_analysis'"  # 가중치 기반 통합 분석
      - "generate: 'comprehensive_pattern_report'"  # 종합 패턴 보고서
      - "display_message: '여러 데이터 소스를 통합하여 종합 분석합니다.'"
    confidence: 0.89
    rationale: "S0: 다중 소스 통합은 분석 정확도 향상에 필수"
  
  # ========== S1: 이탈 조기 경고 및 위험도 평가 룰 ==========
  
  - rule_id: "S1_R1_dropout_risk_detection"
    priority: 98
    description: "이탈 징후 탐지 및 위험도 등급 산정"
    conditions:
      - field: "attendance_data"
        operator: "!="
        value: null
      - field: "pomodoro_data"
        operator: "!="
        value: null
      - field: "goal_data"
        operator: "!="
        value: null
    action:
      - "check: 'consecutive_log_gaps'"  # 연속 로그 공백 확인
      - "check: 'pomodoro_non_completion'"  # 포모도로 미작성 확인
      - "check: 'goal_abandonment'"  # 목표 포기 확인
      - "check: 'activity_data_sparsity'"  # 활동 데이터 희박도 확인
      - "calculate: 'dropout_risk_score'"  # 이탈 위험도 점수
      - "classify: 'risk_level'"  # 위험도 등급 (주의/경고/긴급)
      - "validate: '위험도 등급은 주의(1단계), 경고(2단계), 긴급(3단계) 중 하나'"
      - "display_message: '이탈 징후를 분석하여 위험도를 평가합니다.'"
    confidence: 0.96
    rationale: "S1: 이탈 조기 경고는 학습 지속성 보장의 핵심"
  
  - rule_id: "S1_R2_early_warning_system"
    priority: 97
    description: "이탈 조기 경고 시스템 (3단계 경고 체계)"
    conditions:
      - field: "risk_level"
        operator: "!="
        value: "low"
    action:
      - if_risk_level: "주의"
        then:
          - "send_message: '격려_메시지'"
          - "recommend: '경미한_개입_전략'"
      - if_risk_level: "경고"
        then:
          - "send_alert: '개별_상담_권장'"
          - "recommend: '중간_개입_전략'"
          - "notify: 'teacher'"  # 선생님에게 알림
      - if_risk_level: "긴급"
        then:
          - "send_urgent_alert: '긴급_개입_필요'"
          - "recommend: '심각_개입_전략'"
          - "notify: 'teacher'"
          - "escalate: 'management'"  # 관리자에게 에스컬레이션
      - "display_message: '이탈 위험도에 따라 적절한 경고와 개입 전략을 제시합니다.'"
    confidence: 0.95
    rationale: "S1: 단계별 경고 체계는 적절한 시점에 적절한 개입 가능"
  
  - rule_id: "S1_R3_dropout_cause_analysis"
    priority: 96
    description: "이탈 원인 다차원 분석 (학습 어려움/동기 저하/시간 부족/환경 변화)"
    conditions:
      - field: "risk_level"
        operator: "in"
        value: ["경고", "긴급"]
    action:
      - "analyze: 'learning_difficulty_cause'"  # 학습 어려움 원인 분석
      - "analyze: 'motivation_decline_cause'"  # 동기 저하 원인 분석
      - "analyze: 'time_constraint_cause'"  # 시간 부족 원인 분석
      - "analyze: 'environment_change_cause'"  # 환경 변화 원인 분석
      - "identify: 'root_cause'"  # 근본 원인 도출
      - "prioritize: 'cause_priority'"  # 원인 우선순위 평가
      - "display_message: '이탈 원인을 다차원적으로 분석하여 근본 원인을 파악합니다.'"
    confidence: 0.94
    rationale: "S1: 원인 분석은 효과적인 개입 전략 수립의 기초"
  
  - rule_id: "S1_R4_intervention_strategy_selection"
    priority: 95
    description: "이탈 위험도별 개입 전략 선택"
    conditions:
      - field: "risk_level"
        operator: "!="
        value: "low"
      - field: "root_cause"
        operator: "!="
        value: null
    action:
      - "select_strategy: 'mild_intervention'"  # 경미한 개입: 격려 메시지, 쉬운 목표 제시
      - "select_strategy: 'moderate_intervention'"  # 중간 개입: 개별 상담, 루틴 조정
      - "select_strategy: 'severe_intervention'"  # 심각 개입: 긴급 상담, 재진입 경로 설계
      - "recommend: 'customized_intervention_plan'"  # 맞춤형 개입 계획
      - "link_agent: 'agent16_interaction_preparation'"  # Agent 16 (개입 준비) 연결
      - "display_message: '이탈 위험도와 원인에 맞는 개입 전략을 제시합니다.'"
    confidence: 0.93
    rationale: "S1: 맞춤형 개입 전략은 이탈 예방 효과 극대화"
  
  - rule_id: "S1_R5_reentry_strategy_design"
    priority: 94
    description: "이탈 학생 재진입 유도 전략 설계"
    conditions:
      - field: "risk_level"
        operator: "=="
        value: "긴급"
      - field: "dropout_duration"
        operator: ">="
        value: 14  # 2주 이상 이탈
    action:
      - "design: 'easy_goal_path'"  # 쉬운 목표부터 시작
      - "design: 'achievement_experience'"  # 성취 경험 제공
      - "design: 'gradual_reengagement'"  # 점진적 재참여
      - "design: 'motivation_reactivation'"  # 동기 재활성화
      - "recommend: 'reentry_routine'"  # 재진입 루틴
      - "display_message: '이탈 학생의 재진입을 위한 단계별 전략을 설계합니다.'"
    confidence: 0.92
    rationale: "S1: 재진입 전략은 이탈 학생 복귀의 핵심"
  
  # ========== S2: 수학 교과 특화 관리 룰 ==========
  
  - rule_id: "S2_R1_math_unit_error_analysis"
    priority: 97
    description: "수학 단원별 오류 분석 및 취약점 매핑"
    conditions:
      - field: "wrong_note_data"
        operator: "!="
        value: null
      - field: "subject"
        operator: "=="
        value: "수학"
    action:
      - "load_db: 'math_unit_relations.yaml'"  # 수학 단원 연계성 DB 로드
      - "analyze: 'math_unit_error_distribution'"  # 단원별 오류 분포 분석
      - "analyze: 'concept_error_mapping'"  # 개념별 오류 매핑
      - "identify: 'weak_math_units'"  # 취약 수학 단원 식별
      - "identify: 'weak_math_concepts'"  # 취약 수학 개념 식별
      - "recommend: 'math_unit_review_priority'"  # 단원별 복습 우선순위
      - "display_message: '수학 단원별 오류를 분석하여 취약점을 파악합니다.'"
    confidence: 0.95
    rationale: "S2: 수학 단원별 분석은 수학 특화 관리의 핵심"
  
  - rule_id: "S2_R2_math_learning_routine_specialization"
    priority: 96
    description: "수학 학습 루틴 특화 (개념-유형-심화 순서)"
    conditions:
      - field: "math_unit_error_analysis"
        operator: "!="
        value: null
      - field: "student_level"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_learning_routine_template.yaml'"  # 수학 학습 루틴 템플릿
      - "design: 'concept_first_routine'"  # 개념 우선 루틴 (하위권)
      - "design: 'type_practice_routine'"  # 유형 연습 루틴 (중위권)
      - "design: 'advanced_problem_routine'"  # 심화 문제 루틴 (상위권)
      - "calculate: 'math_unit_study_time'"  # 단원별 학습 시간 산정
      - "calculate: 'math_review_cycle'"  # 수학 복습 주기 (1일/3일/7일)
      - "recommend: 'math_specialized_routine'"  # 수학 특화 루틴
      - "display_message: '수학 학습 특성에 맞는 루틴을 설계합니다.'"
    confidence: 0.94
    rationale: "S2: 수학 학습 루틴 특화는 수학 성취도 향상에 필수"
  
  - rule_id: "S2_R3_math_learning_efficiency_metrics"
    priority: 95
    description: "수학 학습 효율성 지표 산정 (개념 마스터링 속도, 문제 풀이 속도)"
    conditions:
      - field: "wrong_note_data"
        operator: "!="
        value: null
      - field: "test_data"
        operator: "!="
        value: null
    action:
      - "calculate: 'concept_mastery_speed'"  # 개념 마스터링 속도 (일/개념)
      - "calculate: 'problem_solving_speed'"  # 문제 풀이 속도 (분/문제)
      - "calculate: 'error_reduction_rate'"  # 오류 감소율 (%/주)
      - "calculate: 'math_learning_efficiency_score'"  # 수학 학습 효율성 점수
      - "compare: 'efficiency_vs_benchmark'"  # 효율성 벤치마크 비교
      - "identify: 'efficiency_improvement_areas'"  # 효율성 개선 영역
      - "display_message: '수학 학습 효율성을 측정하여 개선점을 파악합니다.'"
    confidence: 0.93
    rationale: "S2: 수학 학습 효율성 지표는 학습 방법 개선의 기준"
  
  - rule_id: "S2_R4_math_learning_habit_assessment"
    priority: 94
    description: "수학 학습 습관 평가 (풀이 과정 기록, 개념 정리, 오답 분석 깊이)"
    conditions:
      - field: "wrong_note_data"
        operator: "!="
        value: null
      - field: "student_survey_data"
        operator: "!="
        value: null
    action:
      - "assess: 'solution_process_recording'"  # 풀이 과정 기록 여부
      - "assess: 'concept_organization_pattern'"  # 개념 정리 패턴
      - "assess: 'error_analysis_depth'"  # 오답 분석 깊이
      - "assess: 'math_note_quality'"  # 수학 노트 품질
      - "calculate: 'math_learning_habit_score'"  # 수학 학습 습관 점수
      - "identify: 'habit_improvement_recommendations'"  # 습관 개선 권장사항
      - "display_message: '수학 학습 습관을 평가하여 개선점을 도출합니다.'"
    confidence: 0.92
    rationale: "S2: 수학 학습 습관 평가는 기본기 강화의 기초"
  
  # ========== S3: 개인화 루틴 설계 루틴 ==========
  
  - rule_id: "S3_R1_personalized_routine_generation"
    priority: 96
    description: "개인 특성 기반 루틴 생성 (학습 스타일, 집중 시간대, 목표 선호도)"
    conditions:
      - field: "pattern_type"
        operator: "!="
        value: null
      - field: "pomodoro_data"
        operator: "!="
        value: null
      - field: "goal_data"
        operator: "!="
        value: null
    action:
      - "analyze: 'learning_style_preference'"  # 학습 스타일 선호도 분석
      - "identify: 'optimal_time_slots'"  # 최적 학습 시간대 식별
      - "analyze: 'goal_preference_pattern'"  # 목표 선호도 패턴 분석
      - "calculate: 'focus_duration_capacity'"  # 집중 지속 시간 용량
      - "generate: 'personalized_daily_routine'"  # 개인화 일일 루틴
      - "generate: 'personalized_weekly_routine'"  # 개인화 주간 루틴
      - "validate: 'routine_feasibility'"  # 루틴 실행 가능성 검증
      - "display_message: '개인 특성에 맞는 학습 루틴을 설계합니다.'"
    confidence: 0.94
    rationale: "S3: 개인화 루틴은 학습 지속성과 효과성 향상의 핵심"
  
  - rule_id: "S3_R2_routine_adjustment_timing"
    priority: 95
    description: "루틴 조정 시점 판단 (패턴 안정도 평가 기반)"
    conditions:
      - field: "current_routine"
        operator: "!="
        value: null
      - field: "pattern_stability_score"
        operator: "!="
        value: null
    action:
      - "evaluate: 'pattern_stability'"  # 패턴 안정도 평가
      - "calculate: 'routine_effectiveness'"  # 루틴 효과성 계산
      - "decide: 'adjustment_necessity'"  # 조정 필요성 판단
      - "calculate: 'optimal_adjustment_cycle'"  # 최적 조정 주기 계산
      - "if_stable: 'fix_routine'"  # 안정적이면 루틴 고정
      - "if_unstable: 'continue_adjustment'"  # 불안정하면 계속 조정
      - "display_message: '패턴 안정도를 평가하여 루틴 조정 시점을 결정합니다.'"
    confidence: 0.93
    rationale: "S3: 적절한 조정 시점은 루틴 효과성 극대화"
  
  - rule_id: "S3_R3_routine_feasibility_verification"
    priority: 94
    description: "루틴 실행 가능성 검증 (일일 시간 예산, 과부하 방지)"
    conditions:
      - field: "personalized_routine"
        operator: "!="
        value: null
    action:
      - "calculate: 'daily_time_budget'"  # 일일 시간 예산 계산
      - "calculate: 'routine_time_requirement'"  # 루틴 시간 요구량 계산
      - "check: 'overload_prevention'"  # 과부하 방지 확인
      - "adjust: 'routine_if_overload'"  # 과부하 시 루틴 조정
      - "validate: 'student_acceptance'"  # 학생 수용성 검증
      - "collect_feedback: 'routine_acceptance'"  # 루틴 수용 피드백 수집
      - "display_message: '루틴 실행 가능성을 검증하여 현실적인 계획을 수립합니다.'"
    confidence: 0.92
    rationale: "S3: 실행 가능성 검증은 루틴 이행률 향상에 필수"
  
  - rule_id: "S3_R4_routine_effectiveness_tracking"
    priority: 93
    description: "루틴 효과 추적 및 개선 피드백 루프"
    conditions:
      - field: "routine_applied"
        operator: "=="
        value: true
      - field: "routine_start_date"
        operator: "<="
        value: "7_days_ago"  # 루틴 적용 후 7일 경과
    action:
      - "track: 'routine_execution_rate'"  # 루틴 실행률 추적
      - "measure: 'learning_outcomes'"  # 학습 성과 측정
      - "compare: 'before_after_comparison'"  # 적용 전후 비교
      - "calculate: 'routine_effectiveness_score'"  # 루틴 효과성 점수
      - "generate: 'improvement_recommendations'"  # 개선 권장사항 생성
      - "adjust: 'routine_based_on_results'"  # 결과 기반 루틴 조정
      - "display_message: '루틴 효과를 추적하여 지속적으로 개선합니다.'"
    confidence: 0.91
    rationale: "S3: 효과 추적은 루틴 지속적 개선의 핵심"
  
  # ========== S4: 원인 분석 다차원 룰 ==========
  
  - rule_id: "S4_R1_multi_dimensional_cause_analysis"
    priority: 95
    description: "학습 저하 원인 다차원 분석 (시간관리/동기/환경/학습능력)"
    conditions:
      - field: "learning_decline_detected"
        operator: "=="
        value: true
    action:
      - "analyze: 'time_management_cause'"  # 시간관리 원인 분석
      - "analyze: 'motivation_cause'"  # 동기 원인 분석
      - "analyze: 'environment_cause'"  # 환경 원인 분석
      - "analyze: 'learning_ability_cause'"  # 학습능력 원인 분석
      - "analyze: 'external_factors_cause'"  # 외부 요인 원인 분석
      - "identify: 'root_cause'"  # 근본 원인 도출
      - "prioritize: 'cause_priority'"  # 원인 우선순위 평가
      - "display_message: '학습 저하 원인을 다차원적으로 분석합니다.'"
    confidence: 0.93
    rationale: "S4: 다차원 원인 분석은 정확한 대응 전략 수립의 기초"
  
  - rule_id: "S4_R2_cause_verification_with_survey"
    priority: 94
    description: "학생 설문 기반 원인 확인 및 검증"
    conditions:
      - field: "root_cause"
        operator: "!="
        value: null
      - field: "student_survey_enabled"
        operator: "=="
        value: true
    action:
      - "generate_survey: 'cause_verification'"  # 원인 확인 설문 생성
      - "collect_survey: 'student_cause_input'"  # 학생 원인 입력 수집
      - "compare: 'system_analysis_vs_student_input'"  # 시스템 분석 vs 학생 입력 비교
      - "validate: 'cause_consistency'"  # 원인 일관성 검증
      - "adjust: 'cause_analysis_if_discrepancy'"  # 불일치 시 원인 분석 조정
      - "display_message: '학생 설문을 통해 원인 분석을 검증합니다.'"
    confidence: 0.92
    rationale: "S4: 학생 설문은 원인 분석 정확도 향상에 필수"
  
  # ========== S5: 학생/선생님 피드백 수집 룰 ==========
  
  - rule_id: "S5_R1_student_feedback_collection"
    priority: 94
    description: "학생 피드백 수집 (제안 수용 여부, 실행 여부, 만족도)"
    conditions:
      - field: "strategy_recommended"
        operator: "=="
        value: true
      - field: "feedback_collection_due"
        operator: "=="
        value: true
    action:
      - "generate_survey: 'strategy_acceptance'"  # 전략 수용 여부 설문
      - "generate_survey: 'strategy_execution'"  # 전략 실행 여부 설문
      - "generate_survey: 'satisfaction'"  # 만족도 설문
      - "collect_feedback: 'student_responses'"  # 학생 응답 수집
      - "analyze: 'feedback_patterns'"  # 피드백 패턴 분석
      - "adjust: 'strategy_based_on_feedback'"  # 피드백 기반 전략 조정
      - "display_message: '학생 피드백을 수집하여 전략을 개선합니다.'"
    confidence: 0.91
    rationale: "S5: 학생 피드백은 전략 효과성 향상에 필수"
  
  - rule_id: "S5_R2_teacher_checklist_integration"
    priority: 93
    description: "선생님 체크리스트 통합 및 분석 반영"
    conditions:
      - field: "teacher_checklist_provided"
        operator: "=="
        value: true
    action:
      - "integrate: 'teacher_observations'"  # 선생님 관찰 통합
      - "compare: 'system_vs_teacher_assessment'"  # 시스템 vs 선생님 평가 비교
      - "adjust: 'analysis_with_teacher_input'"  # 선생님 입력 기반 분석 조정
      - "generate: 'integrated_recommendations'"  # 통합 권장사항 생성
      - "display_message: '선생님의 관찰 내용을 분석에 반영합니다.'"
    confidence: 0.90
    rationale: "S5: 선생님 체크리스트는 정성적 평가의 핵심"
  
  - rule_id: "S5_R3_text_feedback_processing"
    priority: 92
    description: "텍스트 피드백 자연어 처리 및 패턴 추출"
    conditions:
      - field: "text_feedback_provided"
        operator: "=="
        value: true
    action:
      - "process_nlp: 'text_feedback'"  # 텍스트 피드백 처리
      - "extract: 'key_insights'"  # 핵심 인사이트 추출
      - "identify: 'improvement_areas'"  # 개선 영역 식별
      - "integrate: 'text_feedback_into_analysis'"  # 텍스트 피드백 분석 통합
      - "display_message: '텍스트 피드백을 분석하여 개선점을 도출합니다.'"
    confidence: 0.89
    rationale: "S5: 텍스트 피드백은 자유 형식 의견 수집에 유용"
  
  # ========== S6: 개선 피드백 루프 룰 ==========
  
  - rule_id: "S6_R1_strategy_execution_tracking"
    priority: 93
    description: "전략 실행 추적 및 효과 측정"
    conditions:
      - field: "strategy_applied"
        operator: "=="
        value: true
    action:
      - "track: 'strategy_execution_rate'"  # 전략 실행률 추적
      - "measure: 'outcome_metrics'"  # 성과 지표 측정
      - "compare: 'baseline_vs_current'"  # 기준선 vs 현재 비교
      - "calculate: 'effectiveness_score'"  # 효과성 점수 계산
      - "identify: 'improvement_areas'"  # 개선 영역 식별
      - "display_message: '전략 실행을 추적하여 효과를 측정합니다.'"
    confidence: 0.91
    rationale: "S6: 실행 추적은 전략 효과성 평가의 기초"
  
  - rule_id: "S6_R2_improvement_feedback_loop"
    priority: 92
    description: "개선 피드백 루프 (결과 기반 자동 조정)"
    conditions:
      - field: "effectiveness_score"
        operator: "<"
        value: 0.7  # 효과성 70% 미만
    action:
      - "analyze: 'failure_reasons'"  # 실패 원인 분석
      - "generate: 'improved_strategy'"  # 개선된 전략 생성
      - "recommend: 'strategy_adjustment'"  # 전략 조정 권장
      - "track: 'improvement_cycle'"  # 개선 사이클 추적
      - "display_message: '효과가 낮은 전략을 분석하여 개선합니다.'"
    confidence: 0.90
    rationale: "S6: 피드백 루프는 지속적 개선의 핵심"
  
  - rule_id: "S6_R3_periodic_review_schedule"
    priority: 91
    description: "정기 리뷰 일정 및 평가 (1주일/2주일/1개월)"
    conditions:
      - field: "last_review_date"
        operator: "<="
        value: "review_due_date"
    action:
      - "schedule: 'weekly_review'"  # 주간 리뷰 스케줄
      - "schedule: 'biweekly_review'"  # 격주 리뷰 스케줄
      - "schedule: 'monthly_review'"  # 월간 리뷰 스케줄
      - "conduct: 'comprehensive_review'"  # 종합 리뷰 수행
      - "generate: 'review_report'"  # 리뷰 보고서 생성
      - "update: 'strategy_based_on_review'"  # 리뷰 기반 전략 업데이트
      - "display_message: '정기 리뷰를 통해 전략을 평가하고 개선합니다.'"
    confidence: 0.89
    rationale: "S6: 정기 리뷰는 전략 지속적 개선의 필수"
  
  # ========== S7: 패턴 변화 추적 룰 ==========
  
  - rule_id: "S7_R1_time_series_analysis"
    priority: 90
    description: "시계열 분석 및 패턴 변화 추적"
    conditions:
      - field: "data_history"
        operator: ">="
        value: "30_days"  # 30일 이상 데이터
    action:
      - "analyze: 'time_series_trend'"  # 시계열 추세 분석
      - "calculate: 'change_rate'"  # 변화율 계산
      - "detect: 'pattern_shifts'"  # 패턴 변화 탐지
      - "identify: 'trend_direction'"  # 추세 방향 식별
      - "predict: 'future_trend'"  # 미래 추세 예측
      - "display_message: '시계열 분석을 통해 패턴 변화를 추적합니다.'"
    confidence: 0.88
    rationale: "S7: 시계열 분석은 장기 패턴 파악에 필수"
  
  - rule_id: "S7_R2_anomaly_detection"
    priority: 89
    description: "이상 징후 탐지 및 경고"
    conditions:
      - field: "pattern_change_rate"
        operator: ">"
        value: 0.3  # 30% 이상 변화
    action:
      - "detect: 'anomalies'"  # 이상 징후 탐지
      - "classify: 'anomaly_type'"  # 이상 유형 분류
      - "assess: 'anomaly_severity'"  # 이상 심각도 평가
      - "alert: 'anomaly_warning'"  # 이상 경고 발송
      - "recommend: 'anomaly_response'"  # 이상 대응 권장
      - "display_message: '이상 징후를 탐지하여 경고합니다.'"
    confidence: 0.87
    rationale: "S7: 이상 징후 탐지는 조기 대응의 핵심"
  
  # ========== S8: 학생 수준별 차별화 룰 ==========
  
  - rule_id: "S8_R1_level_based_strategy_differentiation"
    priority: 88
    description: "학생 수준별 학습 전략 차별화 (하/중/상위권)"
    conditions:
      - field: "student_level"
        operator: "!="
        value: null
    action:
      - if_level: "하위권"
        then:
          - "recommend: 'concept_focused_learning'"  # 개념 중심 학습
          - "recommend: 'repetitive_practice'"  # 반복 연습
          - "recommend: 'short_frequent_sessions'"  # 짧은 시간 자주
      - if_level: "중위권"
        then:
          - "recommend: 'type_practice_focused'"  # 유형 연습 중심
          - "recommend: 'moderate_duration_frequency'"  # 중간 시간 중간 빈도
      - if_level: "상위권"
        then:
          - "recommend: 'advanced_problem_focused'"  # 심화 문제 중심
          - "recommend: 'long_concentrated_sessions'"  # 긴 시간 집중
      - "display_message: '학생 수준에 맞는 학습 전략을 제시합니다.'"
    confidence: 0.86
    rationale: "S8: 수준별 차별화는 학습 효과성 향상에 필수"
  
  - rule_id: "S8_R2_level_change_detection"
    priority: 87
    description: "학생 수준 변화 감지 및 전략 자동 조정"
    conditions:
      - field: "current_level"
        operator: "!="
        value: "previous_level"
    action:
      - "detect: 'level_change'"  # 수준 변화 감지
      - "validate: 'level_change_consistency'"  # 수준 변화 일관성 검증
      - "adjust: 'strategy_for_new_level'"  # 새 수준에 맞는 전략 조정
      - "update: 'learning_routine'"  # 학습 루틴 업데이트
      - "display_message: '학생 수준 변화를 감지하여 전략을 조정합니다.'"
    confidence: 0.85
    rationale: "S8: 수준 변화 대응은 지속적 성장 지원의 핵심"

default_rule:
  rule_id: "default"
  action:
    - "display_message: '학습관리 분석을 시작합니다. 데이터를 수집하고 패턴을 분석하겠습니다.'"
    - "recommend: 'start_with_data_collection'"
  confidence: 0.5
  rationale: "기본 룰: 데이터 수집부터 시작"
