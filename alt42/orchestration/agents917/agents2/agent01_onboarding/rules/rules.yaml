# Rules for Agent 01 - Onboarding
# Generated at: 2025-01-27
# Purpose: 정교한 질문 대응을 위한 온보딩 룰셋
# Source: questions.md 시나리오 기반 확장

version: "1.0"
scenario: "onboarding"
description: "학생 온보딩 기반 초기 상태 분석 및 맞춤형 루틴/진단 설계 - questions.md 시나리오별 정교한 질문 대응"

rules:
  # ========== S0: 수학학원 시스템 특화 필수 정보 수집 룰 ==========
  
  - rule_id: "S0_R1_math_learning_style_collection"
    priority: 99
    description: "수학 학습 스타일 분류 수집 (계산형/개념형/응용형) - 온톨로지 연동"
    conditions:
      - field: "math_learning_style"
        operator: "=="
        value: null
      - OR:
        - field: "new_student_flag"
          operator: "=="
          value: true
        - field: "profile_update_flag"
          operator: "=="
          value: true
    action:
      - "collect_info: 'math_learning_style'"
      - "validate: '수학 학습 스타일은 계산형, 개념형, 응용형 중 하나여야 합니다'"
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk:MathLearningStyle'"
      - "set_property: ('mk:mathLearningStyle', '{math_learning_style}')"
      - "display_message: '수학 문제를 풀 때 어떤 방식이 편하신지 파악하여 맞춤형 학습 계획을 수립합니다.'"
      - "question: '수학 문제를 풀 때 어떤 방식이 편하신가요? (A) 계산을 정확하게 하는 것이 중요해요 (B) 개념을 이해하고 연결하는 것이 중요해요 (C) 다양한 문제 유형을 풀어보는 것이 중요해요'"
    confidence: 0.97
    rationale: "S0: 수학 학습 스타일은 수학 특화 정보로 MBTI와는 별개로 수집 필요 - 온톨로지 인스턴스 생성"
  
  - rule_id: "S0_R2_academy_info_collection"
    priority: 98
    description: "수학학원 정보 수집 (학원명, 등급, 수업 일정) - 온톨로지 연동"
    conditions:
      - OR:
        - field: "academy_name"
          operator: "=="
          value: null
        - field: "academy_grade"
          operator: "=="
          value: null
        - field: "academy_schedule"
          operator: "=="
          value: null
      - OR:
        - field: "new_student_flag"
          operator: "=="
          value: true
        - field: "profile_update_flag"
          operator: "=="
          value: true
    action:
      - "collect_info: 'academy_info'"
      - "validate: '학원 정보는 학원명, 학원 등급(반), 학원 수업 일정을 포함해야 합니다'"
      # 온톨로지 인스턴스 생성 (질문 1 연계)
      - "create_instance: 'mk:OnboardingContext'"
      - "set_property: ('mk:hasStudentGrade', '{student_grade}')"
      - "set_property: ('mk:hasSchool', '{school_name}')"
      - "set_property: ('mk:hasAcademy', '{academy_name}')"
      - "set_property: ('mk:hasAcademyGrade', '{academy_grade}')"
      - "set_property: ('mk:hasAcademySchedule', '{academy_schedule}')"
      - "display_message: '수학학원 정보를 수집하여 학원-학교-집 학습을 연계한 맞춤형 계획을 수립합니다.'"
      - "question: '다니고 계신 수학학원이 있나요? 있다면 학원명, 학원 등급(반), 학원 수업 일정을 알려주세요.'"
    confidence: 0.96
    rationale: "S0: 수학학원 시스템 특화 - 학원 정보는 필수 - OnboardingContext 인스턴스 생성 - academy_grade, academy_schedule 추가"
  
  - rule_id: "S0_R3_math_performance_quantification"
    priority: 97
    description: "수학 성적/수준 정량화 수집 (최근 시험 점수, 등수, 취약 단원)"
    conditions:
      - field: "math_recent_score"
        operator: "=="
        value: null
      - OR:
        - field: "new_student_flag"
          operator: "=="
          value: true
        - field: "profile_update_flag"
          operator: "=="
          value: true
    action:
      - "collect_info: 'math_performance'"
      - "validate: '수학 성적 정보는 최근 시험 점수, 등수, 취약 단원을 포함해야 합니다'"
      - "display_message: '최근 수학 시험 성적과 취약한 단원을 파악하여 정확한 수준 진단을 합니다.'"
      - "question: '최근 수학 시험 성적과 취약한 단원을 알려주세요. (예: 최근 시험 85점, 등수 15등, 취약 단원: 함수)'"
    confidence: 0.95
    rationale: "S0: 수학 성적 정량화는 수준별 차별화 전략의 기초"
  
  - rule_id: "S0_R4_textbook_info_collection"
    priority: 96
    description: "학습 교재 정보 수집 (학교 교과서, 학원 교재, 문제집)"
    conditions:
      - field: "textbooks"
        operator: "=="
        value: null
      - OR:
        - field: "new_student_flag"
          operator: "=="
          value: true
        - field: "profile_update_flag"
          operator: "=="
          value: true
    action:
      - "collect_info: 'textbooks'"
      - "validate: '교재 정보는 학교 교과서, 학원 교재(쎈, 개념원리 등), 문제집을 포함해야 합니다'"
      - "display_message: '사용 중인 수학 교재를 파악하여 교재 기반 맞춤형 학습 계획을 수립합니다.'"
      - "question: '사용 중인 수학 교재를 알려주세요. (학교 교과서, 학원 교재: 쎈/개념원리/RPM 등, 문제집)'"
    confidence: 0.94
    rationale: "S0: 교재 정보는 교재별 특성 반영 학습 계획의 기초"
  
  - rule_id: "S0_R5_math_unit_mastery_collection"
    priority: 95
    description: "단원별 마스터링 수준 수집 (완료 단원, 진행 중 단원, 미완료 단원) - 온톨로지 연동"
    conditions:
      - field: "math_unit_mastery"
        operator: "=="
        value: null
      - field: "student_grade"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"  # 단원 연계성 DB 로드
      - "collect_info: 'math_unit_mastery'"
      - "analyze: 'unit_prerequisite_check'"  # 선행 단원 완료 여부 확인
      # 온톨로지 인스턴스 생성 (질문 2 연계)
      - "create_instance: 'mk:LearningContextIntegration'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:hasUnitMastery', '{math_unit_mastery}')"
      - "set_property: ('mk:hasCurrentPosition', '{current_progress_position}')"
      - "validate: '단원별 마스터링 정보는 완료 단원, 진행 중 단원, 미완료 단원을 포함해야 합니다'"
      - "display_message: '단원별 학습 수준을 파악하여 선후관계를 고려한 학습 계획을 수립합니다.'"
      - "question: '지금까지 배운 수학 단원 중 완료한 단원, 진행 중인 단원, 아직 배우지 않은 단원을 알려주세요.'"
    confidence: 0.93
    rationale: "S0: 단원별 마스터링 수준은 단원 연계성 기반 학습 순서 최적화에 필수 - LearningContextIntegration 인스턴스 생성"
  
  - rule_id: "S0_R6_comprehensive_math_profile_verification"
    priority: 99
    description: "수학 특화 프로필 종합 검증 및 수집 완료 확인"
    conditions:
      # 첫 수업 관련 질문이 아닐 때만 매칭 (Q1 룰이 우선)
      - field: "user_message"
        operator: "not_contains"
        value: "첫 수업"
      - OR:
          - field: "math_learning_style"
            operator: "=="
            value: null
          - field: "academy_name"
            operator: "=="
            value: null
          - field: "math_recent_score"
            operator: "=="
            value: null
          - field: "textbooks"
            operator: "=="
            value: null
    action:
      - "analyze: 'missing_math_profile_info'"
      - "generate_description: 'math_profile_collection_checklist'"
      - "recommend_path: '수학 특화 정보 수집 완료 후 맞춤형 학습 계획 수립 진행'"
      - "display_message: '수학 학습에 특화된 맞춤형 계획을 수립하기 위해 다음 정보가 필요합니다: 수학 학습 스타일, 학원 정보, 수학 성적, 교재 정보{system_health_report}'"
      - "validate_all: ['math_learning_style', 'academy_name', 'math_recent_score', 'textbooks']"
    confidence: 0.96
    rationale: "S0: 수학 특화 정보가 모두 수집되어야 정확한 맞춤형 계획 수립 가능"
  
  # ========== S1: 신규 학생 등록 직후 관련 룰 ==========
  
  - rule_id: "S1_R0_first_class_question"
    priority: 100
    description: "첫 수업 관련 질문 대응 (사용자 메시지 기반)"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "첫"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "수업"
        - field: "user_message"
          operator: "contains"
          value: "시작"
        - field: "user_message"
          operator: "contains"
          value: "준비"
    action:
      - "display_message: '첫 수업을 시작하기 위해 학생의 현재 수학 학습 상태를 파악하겠습니다.{system_health_report}'"
      - "question: '현재 수학 진도는 어디까지 진행하셨나요? (예: 중등수학 2-1, 고등수학 상 등)'"
      - "question: '수학 학습 스타일은 어떤가요? (A) 계산 연습 중심 (B) 개념 이해 중심 (C) 문제 풀이 중심'"
      - "recommend_path: '첫 수업 준비 가이드'"
    confidence: 0.95
    rationale: "S1: 사용자가 첫 수업에 대해 질문한 경우 즉시 대응"
  
  - rule_id: "S1_R1_comprehensive_profile_summary"
    priority: 95
    description: "수학 진도와 학습 스타일을 한 번에 요약 제공"
    conditions:
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "advanced_progress"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
    action:
      - "generate_description: 'comprehensive_profile_summary'"
      - "analyze: 'progress_and_style_overview'"
      - "display_message: '학생의 수학 진도(개념: {concept_progress}, 심화: {advanced_progress})와 학습 스타일({study_style})을 종합하여 요약해 제공합니다.'"
    confidence: 0.92
    rationale: "S1: '한 번에 요약해줄 수 있나요?' 질문에 대한 종합 대응"

  - rule_id: "S1_R2_initial_class_preparation_guide"
    priority: 93
    description: "초기 수업 준비 내용 중심 추천 - 온톨로지 기반 전략 생성"
    conditions:
      - field: "math_level"
        operator: "!="
        value: null
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
    action:
      # 온톨로지 기반 추론 및 전략 생성
      - "reason_over: 'mk:LearningContextIntegration'"
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:hasMathLevel', '{math_level}')"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasStudyStyle', '{study_style}')"
      
      - "recommend_path: 'initial_class_content'"
      - "generate_description: 'initial_class_preparation_guide'"
      - "analyze: 'content_focus_areas'"
      - "display_message: '초기 수업은 {concept_progress} 개념 진도 범위를 중심으로, {study_style} 학습 스타일에 맞춰 {math_level} 수준에 적합한 난이도로 준비하시면 좋습니다.'"
    confidence: 0.91
    rationale: "S1: '초기 수업을 시작할 때 어떤 내용을 중심으로 준비하면 좋을까요?' 질문 대응 - 온톨로지 기반 전략 생성"

  - rule_id: "S1_R3_new_student_complete_summary"
    priority: 96
    description: "신규 학생 등록 시 완전한 종합 요약 (수학학원 시스템 특화 + 수학 학습 스타일 반영)"
    conditions:
      - field: "math_level"
        operator: "!="
        value: null
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "advanced_progress"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
      - field: "exam_style"
        operator: "!="
        value: null
      - field: "math_confidence"
        operator: "!="
        value: null
      - field: "math_learning_style"
        operator: "!="
        value: null
      - field: "academy_name"
        operator: "!="
        value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"  # 단원 연계성 DB 로드
      - "analyze: 'math_learning_style_based_strategy'"  # 수학 학습 스타일 기반 전략
      - "analyze: 'academy_school_alignment'"  # 학원-학교 정렬 분석
      - "generate_description: 'complete_student_profile_summary_with_math_specialization'"
      - "recommend_path: '수학 학습 스타일 반영 + 학원-학교 연계 + 단원 연계성 고려 초기 학습 계획'"
      - "analyze: 'student_comprehensive_profile'"
      - "display_message: '신규 학생의 수학 수준({math_level}), 개념 진도({concept_progress}), 심화 진도({advanced_progress}), 학습 스타일({study_style}), 수학 학습 스타일({math_learning_style}), 시험 대비 성향({exam_style}), 수학 자신감({math_confidence}/10), 학원 정보({academy_name})를 종합하여 수학 특화 맞춤형 학습 계획을 수립합니다.{system_health_report}'"
    confidence: 0.94
    rationale: "S1: 신규 학생 등록 직후 가장 우선순위 높은 종합 분석 (수학학원 시스템 특화 + 수학 학습 스타일 반영)"

  # ========== S2: 수업 전 학습 설계 관련 룰 ==========
  
  - rule_id: "S2_R1_integrated_routine_recommendation"
    priority: 94
    description: "시험 스타일, 수학 자신감, 부모 개입 종합 루틴 제안"
    conditions:
      - field: "exam_style"
        operator: "!="
        value: null
      - field: "math_confidence"
        operator: "!="
        value: null
      - field: "parent_style"
        operator: "!="
        value: null
    action:
      - "recommend_path: 'comprehensive_routine_design'"
      - "generate_description: 'integrated_routine_strategy'"
      - "analyze: 'routine_factors_integration'"
      - "display_message: '시험 스타일({exam_style}), 수학 자신감({math_confidence}/10), 부모 개입 스타일({parent_style})을 종합하여 {exam_style}에 맞는 {math_confidence_level} 수준의 루틴을 설계하며, {parent_style} 부모 스타일에 맞는 피드백 방식을 적용합니다.'"
    confidence: 0.93
    rationale: "S2: '시험 스타일, 수학 자신감, 부모 개입 정도를 종합해서 어떤 루틴이 적절할까요?' 질문 대응"

  - rule_id: "S2_R2_concept_vs_problem_solving_decision"
    priority: 92
    description: "개념 강의 위주 vs 문제풀이 우선 판단 (수학 학습 스타일 반영)"
    conditions:
      - field: "math_level"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
      - field: "math_confidence"
        operator: "!="
        value: null
      - field: "math_learning_style"
        operator: "!="
        value: null
    action:
      - "analyze: 'math_learning_style_based_teaching_method'"  # 수학 학습 스타일 기반 교수법 결정
      - "recommend: 'teaching_method_priority'"
      - "generate_description: 'concept_vs_problem_solving_analysis_with_math_style'"
      - "analyze: 'teaching_approach_decision'"
      - "display_message: '학생의 수학 수준({math_level}), 학습 스타일({study_style}), 수학 학습 스타일({math_learning_style}), 자신감({math_confidence}/10)을 종합하여 {recommended_approach} 방식을 우선 추천합니다. 수학 학습 스타일이 {math_learning_style}이므로 이에 맞는 교수법을 적용합니다.'"
    confidence: 0.91
    rationale: "S2: 수학 학습 스타일(계산형/개념형/응용형)에 따라 교수법 차별화 필요"

  - rule_id: "S2_R3_concept_first_for_struggling_students"
    priority: 91
    description: "수학이 어려운 학생에게 개념 강의 우선 추천"
    conditions:
      - field: "math_level"
        operator: "=="
        value: "수학이 어려워요"
      - field: "math_confidence"
        operator: "<="
        value: 5
    action:
      - "recommend: 'concept_lecture_first'"
      - "generate_description: 'concept_foundation_building'"
      - "display_message: '수학이 어렵고 자신감이 낮은 학생이므로 개념 강의를 먼저 진행하는 것을 강력히 추천합니다. 기초 개념 이해 후 문제풀이로 이어가는 단계적 접근이 효과적입니다.'"
    confidence: 0.92
    rationale: "S2: 어려움을 겪는 학생에게 개념 우선 접근 필요"

  - rule_id: "S2_R4_problem_solving_first_for_advanced"
    priority: 88
    description: "상위권 학생에게 문제풀이 우선 추천"
    conditions:
      - field: "math_level"
        operator: "in"
        value: ["상위권", "상위권 이상"]
      - field: "math_confidence"
        operator: ">="
        value: 7
    action:
      - "recommend: 'problem_solving_first'"
      - "generate_description: 'problem_based_concept_expansion'"
      - "display_message: '상위권 학생이고 자신감이 높으므로 문제풀이를 먼저 진행하고 필요시 개념을 보완하는 방식을 추천합니다. 문제를 통해 개념을 확장하는 것이 효율적입니다.'"
    confidence: 0.89
    rationale: "S2: 상위권 학생은 문제풀이 중심 접근이 효율적"

  - rule_id: "S2_R5_balanced_approach_for_mid_level"
    priority: 87
    description: "중위권 학생에게 균형잡힌 접근 추천"
    conditions:
      - field: "math_level"
        operator: "=="
        value: "중위권"
      - field: "study_style"
        operator: "!="
        value: null
    action:
      - "recommend: 'balanced_teaching_approach'"
      - "generate_description: 'concept_and_problem_balance'"
      - "display_message: '중위권 학생이므로 개념 설명과 문제풀이를 균형있게 병행하는 것을 추천합니다. {study_style} 학습 스타일에 맞춰 조정합니다.'"
    confidence: 0.86
    rationale: "S2: 중위권 학생은 균형잡힌 접근 필요"

  # ========== S3: 개념/심화 진도 판단 관련 룰 ==========
  
  - rule_id: "S3_R1_progress_balance_analysis"
    priority: 90
    description: "개념 진도와 심화 진도 비교 분석 (단원 연계성 고려) - 레벨 정보 포함"
    conditions:
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "advanced_progress"
        operator: "!="
        value: null
      - field: "math_unit_mastery"
        operator: "!="
        value: null
      # 레벨 정보 필드 추가 (DB 적용 + 테이블 있음) - dataindex.php 인식을 위해 conditions에 명시
      - OR:
        - field: "concept_level"
          operator: "!="
          value: null
        - field: "advanced_level"
          operator: "!="
          value: null
        - field: "course_level"
          operator: "!="
          value: null
        - field: "grade_detail"
          operator: "!="
          value: null
    action:
      - "load_db: 'math_unit_relations.yaml'"  # 단원 연계성 DB 로드
      - "analyze: 'unit_prerequisite_check_for_progress'"  # 진도에 대한 단원 선후관계 검증
      - "analyze: 'progress_balance'"
      - "analyze: 'level_progress_alignment'"  # concept_level, advanced_level, course_level 비교 분석
      - "generate_description: 'concept_advanced_progress_comparison_with_unit_relations'"
      - "recommend: 'progress_adjustment_guide'"
      - "display_message: '개념 진도({concept_progress}, 레벨: {concept_level})와 심화 진도({advanced_progress}, 레벨: {advanced_level})를 단원 선후관계를 고려하여 비교 분석합니다. 과정 레벨({course_level})과 학년 상세 정보({grade_detail})를 반영하여 선행 단원 완료 여부를 확인하고 진도 격차와 학습 안정성을 평가합니다.'"
    confidence: 0.91
    rationale: "S3: 단원 선후관계를 고려한 진도 분석이 더 정확함 - 방정식을 먼저 해야 함수를 제대로 할 수 있음 - concept_level, advanced_level, course_level, grade_detail 추가 (conditions에 명시하여 dataindex.php 인식)"

  - rule_id: "S3_R2_confusion_concept_prediction"
    priority: 89
    description: "현재 진도에서 혼란을 겪을 가능성이 높은 개념 예측 (단원 난이도 DB 활용)"
    conditions:
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "math_level"
        operator: "in"
        value: ["수학이 어려워요", "중위권"]
      - field: "math_confidence"
        operator: "<="
        value: 6
    action:
      - "load_db: 'math_unit_relations.yaml'"  # 단원 연계성 및 난이도 DB 로드
      - "analyze: 'unit_difficulty_based_confusion_prediction'"  # 단원 난이도 기반 혼란 개념 예측
      - "analyze: 'prerequisite_concept_missing_check'"  # 선행 개념 부족 여부 확인
      - "analyze: 'potential_confusion_areas'"
      - "generate_description: 'confusion_concept_forecast_with_unit_db'"
      - "recommend: 'preventive_intervention_points'"
      - "display_message: '현재 {concept_progress} 진도에서 단원 난이도 DB를 활용하여 자주 혼란을 겪는 개념을 예측합니다. 선행 개념 부족 여부도 확인하고, {math_level} 수준과 낮은 자신감을 고려한 핵심 개념을 우선 강화합니다.'"
    confidence: 0.90
    rationale: "S3: 단원 난이도 DB를 활용한 혼란 개념 예측이 더 정확함 - 선생님의 경험 기반 지식 활용"

  - rule_id: "S3_R3_progress_gap_warning"
    priority: 88
    description: "개념과 심화 진도 격차 경고"
    conditions:
      - field: "advanced_progress"
        operator: "!="
        value: null
      - field: "concept_progress"
        operator: "matches"
        value: "중등[1-2]-[1-2]"
      - field: "advanced_progress"
        operator: "in"
        value: ["미적분1", "미적분2", "기하"]
    action:
      - "alert: '진도 격차 경고'"
      - "analyze: 'foundation_stability_risk'"
      - "generate_description: 'progress_gap_analysis'"
      - "display_message: '개념 진도({concept_progress})에 비해 심화 진도({advanced_progress})가 빠르게 진행되어 기초가 탄탄하지 않을 수 있습니다. 개념 진도 보완을 우선 추천합니다.'"
    confidence: 0.89
    rationale: "S3: 진도 불균형은 학습 안정성에 위험 요소"

  - rule_id: "S3_R4_appropriate_progress_balance"
    priority: 85
    description: "적절한 진도 밸런스 확인"
    conditions:
      - field: "concept_progress"
        operator: "matches"
        value: "고등[1-2]-[1-2]"
      - field: "advanced_progress"
        operator: "in"
        value: ["공통수학1", "공통수학2", "대수"]
    action:
      - "analyze: 'progress_alignment_status'"
      - "generate_description: 'balanced_progress_confirmation'"
      - "display_message: '개념 진도와 심화 진도가 적절하게 균형을 이루고 있습니다. 현재 진도 유지가 적합합니다.'"
    confidence: 0.87
    rationale: "S3: 적절한 진도 밸런스 확인 및 안정성 평가"

  # ========== S4: 학부모 상담 정보 관련 룰 ==========
  
  - rule_id: "S4_R1_parent_consultation_strategy"
    priority: 87
    description: "학생 성향과 부모 스타일 기반 상담 전략 제안"
    conditions:
      - field: "parent_style"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
      - field: "math_level"
        operator: "!="
        value: null
    action:
      - "generate_description: 'parent_consultation_strategy'"
      - "analyze: 'parent_student_alignment'"
      - "recommend: 'consultation_communication_guide'"
      - "display_message: '학생의 학습 성향({study_style})과 부모님의 스타일({parent_style})을 바탕으로 효과적인 상담 전략을 제안합니다. 학생의 {math_level} 수준을 고려한 맞춤형 커뮤니케이션 방식을 제시합니다.'"
    confidence: 0.89
    rationale: "S4: '이 학생의 학습 성향과 부모님의 스타일을 바탕으로 상담 전략을 알려주세요.' 질문 대응"

  - rule_id: "S4_R2_feedback_routine_necessity"
    priority: 86
    description: "학부모 피드백 루틴 필요성 판단 - 피드백 선호도 반영"
    conditions:
      - field: "parent_style"
        operator: "in"
        value: ["적극 개입", "부분 지원"]
      - field: "math_level"
        operator: "in"
        value: ["수학이 어려워요", "중위권"]
    action:
      - "recommend: 'parent_feedback_routine'"
      - "analyze: 'feedback_frequency_calculation'"
      - "analyze: 'feedback_preference_alignment'"  # 피드백 선호도 분석
      - "generate_description: 'feedback_routine_design'"
      - "display_message: '학부모님과의 주기적인 피드백 루틴이 필요한 학생입니다. {parent_style} 스타일에 맞춰 정기적인 소통 채널을 활성화하고, {math_level} 수준에 적합한 피드백 내용을 설계합니다. 피드백 선호도({feedback_preference})를 반영하여 맞춤형 피드백 방식을 제안합니다.'"
    confidence: 0.88
    rationale: "S4: '학부모님과 주기적인 피드백 루틴이 필요한 학생인가요?' 질문 대응 - feedback_preference 추가"

  - rule_id: "S4_R3_minimal_feedback_for_autonomous"
    priority: 82
    description: "자율 존중 부모 스타일의 최소 피드백"
    conditions:
      - field: "parent_style"
        operator: "=="
        value: "자율 존중"
      - field: "math_level"
        operator: "in"
        value: ["상위권", "상위권 이상"]
    action:
      - "communication_mode: '최소 개입 모드'"
      - "generate_description: 'autonomous_support_strategy'"
      - "display_message: '학생의 자율성을 존중하며 필요한 시점에만 간헐적 피드백을 제공합니다. 학생이 요청할 때 중심으로 지원합니다.'"
    confidence: 0.84
    rationale: "S4: 자율 존중 스타일은 과도한 개입을 피해야 함"

  - rule_id: "S4_R4_parent_student_conflict_detection"
    priority: 85
    description: "부모 스타일과 학생 성향 충돌 감지"
    conditions:
      - field: "parent_style"
        operator: "=="
        value: "적극 개입"
      - field: "study_style"
        operator: "=="
        value: "자율 학습 선호"
      - field: "math_confidence"
        operator: ">="
        value: 7
    action:
      - "alert: '스타일 충돌 감지'"
      - "analyze: 'parent_student_tension_points'"
      - "generate_description: 'conflict_mediation_strategy'"
      - "display_message: '부모님의 적극 개입 스타일과 학생의 자율 학습 선호 성향 간 잠재적 충돌이 감지됩니다. 중재 전략을 제안합니다.'"
    confidence: 0.86
    rationale: "S4: 부모-학생 스타일 충돌은 상담 시 핵심 이슈"

  # ========== S5: 장기 목표 기반 설계 관련 룰 ==========
  
  - rule_id: "S5_R1_goal_trait_connection_analysis"
    priority: 88
    description: "장기 목표와 현재 성향 연결 분석"
    conditions:
      - field: "goals.long_term"
        operator: "!="
        value: null
      - field: "math_level"
        operator: "!="
        value: null
      - field: "study_hours_per_week"
        operator: "!="
        value: null
    action:
      - "analyze: 'goal_trait_alignment'"
      - "generate_description: 'goal_current_state_connection'"
      - "recommend: 'goal_achievement_pathway'"
      - "display_message: '학생의 장기 목표({goals.long_term})와 현재 성향(수학 수준: {math_level}, 주간 학습 시간: {study_hours_per_week}시간)을 연결하여 신경 써야 할 요소를 분석합니다.'"
    confidence: 0.91
    rationale: "S5: '이 학생의 장기 목표와 현재 성향을 연결해서 신경 써야 할 요소가 있다면 알려주세요.' 질문 대응"

  - rule_id: "S5_R2_competition_prep_feasibility"
    priority: 90
    description: "경시대회 준비 현실성 평가"
    conditions:
      - field: "goals.long_term"
        operator: "=="
        value: "경시대회 준비해 보기"
      - field: "math_level"
        operator: "!="
        value: null
      - field: "study_hours_per_week"
        operator: "!="
        value: null
    action:
      - "analyze: 'competition_prep_feasibility'"
      - "generate_description: 'competition_preparation_roadmap'"
      - "recommend: 'competition_prep_milestones'"
      - "display_message: '경시대회 준비 목표에 대해 현재 상태(수학 수준: {math_level}, 주간 학습 시간: {study_hours_per_week}시간)를 바탕으로 현실적인 접근 방식을 제안합니다. 필요한 학습 시간과 진도 계획을 수립합니다.'"
    confidence: 0.92
    rationale: "S5: '경시대회 준비가 목표라고 했는데, 지금 상태로 보면 어떤 접근이 현실적일까요?' 질문 대응"

  - rule_id: "S5_R3_goal_achievement_requirements"
    priority: 87
    description: "장기 목표 달성을 위한 필수 요건 분석"
    conditions:
      - field: "goals.long_term"
        operator: "in"
        value: ["심화 문제도 풀 수 있는 실력 쌓기", "수학을 잘해서 원하는 학교 가기"]
      - field: "math_level"
        operator: "!="
        value: null
      - field: "study_hours_per_week"
        operator: "!="
        value: null
    action:
      - "analyze: 'goal_requirements'"
      - "generate_description: 'long_term_goal_prerequisites'"
      - "recommend: 'requirement_fulfillment_plan'"
      - "display_message: '장기 목표({goals.long_term}) 달성을 위해 필요한 학습 요소와 개선 포인트를 분석합니다. 현재 상태와 목표 간 격차를 평가하고 단계별 계획을 제시합니다.'"
    confidence: 0.89
    rationale: "S5: 목표 달성을 위한 구체적 요건 제시"

  - rule_id: "S5_R4_realistic_goal_adjustment"
    priority: 84
    description: "현실성 없는 목표 조정 제안"
    conditions:
      - field: "goals.long_term"
        operator: "=="
        value: "경시대회 준비해 보기"
      - field: "math_level"
        operator: "=="
        value: "수학이 어려워요"
      - field: "study_hours_per_week"
        operator: "<"
        value: 15
    action:
      - "alert: '목표 현실성 경고'"
      - "analyze: 'goal_reality_check'"
      - "generate_description: 'adjusted_goal_recommendation'"
      - "display_message: '경시대회 준비 목표는 현재 수학 수준과 학습 시간을 고려할 때 현실성이 낮습니다. 단계적 목표 조정을 제안합니다.'"
    confidence: 0.85
    rationale: "S5: 비현실적 목표는 조정이 필요"

  # ========== 학습 감정/상태 관련 룰 ==========
  
  - rule_id: "S6_R1_learning_emotion_state_analysis"
    priority: 85
    description: "학습 감정 상태 종합 분석 (지루함, 평온함, 속도 불안감, 만족도)"
    conditions:
      - OR:
        - field: "boredom"
          operator: "!="
          value: null
        - field: "calmness"
          operator: "!="
          value: null
        - field: "pace_anxiety"
          operator: "!="
          value: null
        - field: "satisfaction"
          operator: "!="
          value: null
      - field: "math_confidence"
        operator: "!="
        value: null
      - field: "stress_level"
        operator: "!="
        value: null
    action:
      - "analyze: 'learning_emotion_comprehensive_state'"
      - "analyze: 'emotion_confidence_correlation'"  # 감정과 자신감 상관관계 분석
      - "analyze: 'emotion_stress_correlation'"  # 감정과 스트레스 상관관계 분석
      - "generate_description: 'learning_emotion_diagnosis'"
      - "recommend: 'emotion_based_motivation_strategy'"
      - "display_message: '학습 감정 상태를 종합 분석합니다. 지루함({boredom}), 평온함({calmness}), 속도 불안감({pace_anxiety}), 만족도({satisfaction})를 수학 자신감({math_confidence}/10)과 스트레스 수준({stress_level}/10)과 연계하여 학습 동기 유지 전략을 제안합니다.'"
    confidence: 0.87
    rationale: "학습 감정 상태는 학습 동기와 밀접한 관련이 있음 - questions.md 연계 질문 반영"
  
  - rule_id: "S6_R2_learning_method_optimization"
    priority: 83
    description: "학습 방법 최적화 (뽀모도로, 학습 메모, 피드백 선호도)"
    conditions:
      - OR:
        - field: "pomodoro"
          operator: "!="
          value: null
        - field: "learning_notes"
          operator: "!="
          value: null
        - field: "feedback_preference"
          operator: "!="
          value: null
      - field: "study_hours_per_week"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
    action:
      - "analyze: 'learning_method_effectiveness'"
      - "analyze: 'self_directed_learning_capability'"  # 자기주도 학습 능력 평가
      - "generate_description: 'learning_method_optimization_plan'"
      - "recommend: 'personalized_learning_routine'"
      - "display_message: '학습 방법을 최적화합니다. 뽀모도로 기법 사용({pomodoro}), 학습 메모 작성 습관({learning_notes}), 피드백 선호도({feedback_preference})를 주당 학습 시간({study_hours_per_week}시간)과 학습 스타일({study_style})과 연계하여 효과적인 학습 루틴을 제안합니다.'"
    confidence: 0.85
    rationale: "학습 방법은 학습 효율성에 직접적인 영향 - questions.md 연계 질문 반영"

  # ========== S7: 인지/집중력/협업 역량 분석 관련 룰 ==========

  - rule_id: "S7_R1_cognitive_concentration_session_optimization"
    priority: 86
    description: "인지 능력과 집중력 기반 학습 세션 최적화"
    conditions:
      - field: "cognitive_total"
        operator: "!="
        value: null
      - field: "concentration_score"
        operator: "!="
        value: null
      - field: "stress_level"
        operator: "!="
        value: null
      - field: "weekly_hours"
        operator: "!="
        value: null
    action:
      - "analyze: 'cognitive_concentration_correlation'"
      - "analyze: 'optimal_session_duration_calculation'"
      - "generate_description: 'learning_session_optimization_plan'"
      - "recommend: 'session_duration_and_break_intervals'"
      - "display_message: '인지 능력 총점({cognitive_total})과 집중력 점수({concentration_score})를 종합 분석합니다. 스트레스 수준({stress_level}/10)과 주당 학습 시간({weekly_hours}시간)을 고려하여 최적의 학습 세션 시간과 휴식 간격을 제안합니다.'"
    confidence: 0.88
    rationale: "S7: 인지 능력과 집중력은 학습 세션 설계의 핵심 요소 - questions.md 인지/집중력/협업 역량 연계 질문 반영"

  - rule_id: "S7_R2_cognitive_difficulty_adjustment_strategy"
    priority: 85
    description: "인지 능력과 완료 시간 기반 문제 난이도 조절 전략"
    conditions:
      - field: "cognitive_total"
        operator: "!="
        value: null
      - field: "completion_time"
        operator: "!="
        value: null
      - field: "math_learning_style"
        operator: "!="
        value: null
      - field: "math_confidence"
        operator: "!="
        value: null
    action:
      - "analyze: 'cognitive_completion_time_pattern'"
      - "analyze: 'difficulty_level_calibration'"
      - "generate_description: 'adaptive_difficulty_strategy'"
      - "recommend: 'problem_difficulty_progression'"
      - "display_message: '인지 능력({cognitive_total})과 학습 완료 시간 패턴({completion_time}분)을 분석합니다. 수학 학습 스타일({math_learning_style})과 수학 자신감({math_confidence}/10)을 연계하여 적절한 문제 난이도 조절 전략을 제안합니다.'"
    confidence: 0.87
    rationale: "S7: 완료 시간은 인지 부하와 난이도 적절성의 지표 - questions.md 연계 질문 반영"

  - rule_id: "S7_R3_collaboration_learning_mode_decision"
    priority: 84
    description: "협업 점수 기반 그룹/개인 학습 모드 결정"
    conditions:
      - field: "collaboration_score"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
      - field: "exam_style"
        operator: "!="
        value: null
    action:
      - "analyze: 'collaboration_study_style_compatibility'"
      - "analyze: 'group_vs_individual_learning_effectiveness'"
      - "generate_description: 'learning_mode_recommendation'"
      - "recommend: 'optimal_learning_environment'"
      - "display_message: '협업 점수({collaboration_score})와 학습 스타일({study_style})을 종합 분석합니다. 시험 대비 스타일({exam_style})을 반영하여 그룹 학습과 개인 학습 중 효과적인 학습 모드를 판단합니다.'"
    confidence: 0.85
    rationale: "S7: 협업 역량은 학습 환경 선택에 중요한 요소 - questions.md 연계 질문 반영"

  - rule_id: "S7_R4_concentration_fatigue_prediction"
    priority: 86
    description: "집중력 점수와 완료 시간 기반 학습 피로도 예측"
    conditions:
      - field: "concentration_score"
        operator: "!="
        value: null
      - field: "completion_time"
        operator: "!="
        value: null
      - field: "stress_level"
        operator: "!="
        value: null
      - field: "math_confidence"
        operator: "!="
        value: null
    action:
      - "analyze: 'concentration_fatigue_correlation'"
      - "analyze: 'completion_time_fatigue_pattern'"
      - "predict: 'learning_fatigue_onset_point'"
      - "generate_description: 'fatigue_prevention_strategy'"
      - "recommend: 'proactive_rest_schedule'"
      - "display_message: '집중력 점수({concentration_score})와 완료 시간({completion_time}분) 데이터를 분석합니다. 스트레스 수준({stress_level}/10)과 수학 자신감({math_confidence}/10)을 고려하여 학습 피로도를 예측하고 예방 전략을 제시합니다.'"
    confidence: 0.87
    rationale: "S7: 피로 예측은 지속 가능한 학습의 핵심 - questions.md 연계 질문 반영"

  - rule_id: "S7_R5_comprehensive_learning_capability_profile"
    priority: 88
    description: "인지/집중력/협업 역량 종합 프로필 생성"
    conditions:
      - field: "cognitive_total"
        operator: "!="
        value: null
      - field: "concentration_score"
        operator: "!="
        value: null
      - field: "collaboration_score"
        operator: "!="
        value: null
      - field: "completion_time"
        operator: "!="
        value: null
    action:
      - "analyze: 'comprehensive_capability_assessment'"
      - "analyze: 'strength_weakness_identification'"
      - "create_instance: 'mk:LearningCapabilityProfile'"
      - "set_property: ('mk:hasCognitiveTotal', '{cognitive_total}')"
      - "set_property: ('mk:hasConcentrationScore', '{concentration_score}')"
      - "set_property: ('mk:hasCollaborationScore', '{collaboration_score}')"
      - "set_property: ('mk:hasCompletionTime', '{completion_time}')"
      - "generate_description: 'learning_capability_profile_summary'"
      - "recommend: 'strength_based_learning_strategy'"
      - "display_message: '학습 역량 프로필을 종합 생성합니다. 인지 능력 총점({cognitive_total}), 집중력 점수({concentration_score}), 협업 점수({collaboration_score}), 평균 완료 시간({completion_time}분)을 분석하여 강점과 약점을 파악하고 맞춤 학습 전략을 제안합니다.'"
    confidence: 0.90
    rationale: "S7: 종합 역량 프로필은 맞춤형 학습 설계의 기초 - questions.md 연계 질문 반영 - 온톨로지 인스턴스 생성"

  - rule_id: "S7_R6_low_concentration_intervention"
    priority: 89
    description: "낮은 집중력 점수에 대한 개입 전략"
    conditions:
      - field: "concentration_score"
        operator: "<="
        value: 40
      - field: "cognitive_total"
        operator: "!="
        value: null
      - field: "stress_level"
        operator: "!="
        value: null
    action:
      - "alert: '집중력 저하 경고'"
      - "analyze: 'concentration_deficit_root_cause'"
      - "analyze: 'stress_concentration_correlation'"
      - "generate_description: 'concentration_improvement_plan'"
      - "recommend: 'short_burst_learning_strategy'"
      - "display_message: '집중력 점수({concentration_score})가 낮습니다. 인지 능력({cognitive_total})과 스트레스 수준({stress_level}/10)을 분석하여 집중력 향상을 위한 단기 집중 학습 전략을 제안합니다.'"
    confidence: 0.88
    rationale: "S7: 낮은 집중력은 즉각적인 개입이 필요 - 학습 효율성 저하 방지"

  - rule_id: "S7_R7_high_cognitive_advanced_content"
    priority: 84
    description: "높은 인지 능력 학생을 위한 심화 콘텐츠 추천"
    conditions:
      - field: "cognitive_total"
        operator: ">="
        value: 80
      - field: "concentration_score"
        operator: ">="
        value: 70
      - field: "math_confidence"
        operator: ">="
        value: 7
    action:
      - "analyze: 'advanced_content_readiness'"
      - "generate_description: 'advanced_learning_pathway'"
      - "recommend: 'challenging_problem_sets'"
      - "display_message: '인지 능력({cognitive_total})과 집중력({concentration_score})이 높고 수학 자신감({math_confidence}/10)도 충분합니다. 도전적인 심화 콘텐츠와 경시 수준 문제를 권장합니다.'"
    confidence: 0.86
    rationale: "S7: 높은 인지 능력 학생은 적절한 도전이 필요 - 학습 동기 유지"

  # ========== 복합 상황 대응 룰 ==========
  
  - rule_id: "C1_struggling_low_confidence_comprehensive"
    priority: 95
    description: "수학 어려움 + 낮은 자신감 복합 대응"
    conditions:
      - field: "math_level"
        operator: "=="
        value: "수학이 어려워요"
      - field: "math_confidence"
        operator: "<="
        value: 5
    action:
      - "initialize_support_mode: true"
      - "boost_mode: '정서 강화 루틴'"
      - "recommend_path: '개념 이해 중심 학습 + 정서 지원 + 짧은 주기 피드백'"
      - "generate_description: 'comprehensive_support_plan'"
      - "display_message: '수학이 어렵고 자신감이 낮은 학생에게 종합적인 지원 루틴을 제공합니다. 개념 강화와 정서 지원을 병행합니다.'"
    confidence: 0.94
    rationale: "복합 요인을 가진 학생에게 우선순위 높은 개입"

  - rule_id: "C2_high_potential_time_constraint"
    priority: 89
    description: "잠재력 있으나 시간 부족 학생 대응"
    conditions:
      - field: "math_level"
        operator: "in"
        value: ["상위권", "상위권 이상"]
      - field: "study_hours_per_week"
        operator: "<"
        value: 10
    action:
      - "alert: '잠재력 활용 경고'"
      - "recommend_path: '집중도 높은 효율 학습 루틴'"
      - "analyze: 'efficiency_optimization_points'"
      - "display_message: '높은 잠재력을 가지고 있으나 학습 시간이 부족합니다. 효율적인 학습 루틴과 집중도 향상 전략을 제안합니다.'"
    confidence: 0.88
    rationale: "잠재력과 시간 불일치 시 효율성 강화"

  - rule_id: "C3_exam_cramming_weak_foundation"
    priority: 92
    description: "벼락치기 성향 + 약한 기초 복합 대응"
    conditions:
      - field: "exam_style"
        operator: "=="
        value: "벼락치기"
      - field: "math_level"
        operator: "in"
        value: ["수학이 어려워요", "중위권"]
      - field: "math_confidence"
        operator: "<="
        value: 6
    action:
      - "strategy_type: '단기 집중 루틴 + 기초 보완'"
      - "alert: '기초 강화 필요'"
      - "recommend: 'foundation_building_with_exam_prep'"
      - "display_message: '벼락치기 성향이지만 기초가 약하므로 단기 집중 루틴과 함께 핵심 개념 보완을 병행합니다.'"
    confidence: 0.91
    rationale: "벼락치기 성향과 약한 기초는 전략적 개입 필요"

  # ========== 기본 루틴 추천 룰 ==========
  
  - rule_id: "B1_math_level_based_routine"
    priority: 85
    description: "수학 수준 기반 기본 루틴 추천"
    conditions:
      - field: "math_level"
        operator: "=="
        value: "수학이 어려워요"
    action:
      - "recommend_path: '개념 이해 중심 학습 + 짧은 주기 피드백 루프'"
      - "display_message: '기초 개념 강화 루틴을 우선 추천합니다.'"
    confidence: 0.90
    rationale: "수학이 어려운 학생에게 개입 우선순위 높음"

  - rule_id: "B2_confidence_based_routine"
    priority: 83
    description: "자신감 수준 기반 루틴 제공"
    conditions:
      - field: "math_confidence"
        operator: "<="
        value: 5
    action:
      - "boost_mode: '정서 강화 루틴'"
      - "display_message: '자신감 회복을 위한 작은 성공 경험을 설계합니다.'"
    confidence: 0.88
    rationale: "자신감 부족은 루틴 설계에서 핵심 변수"

  - rule_id: "B3_exam_style_routine"
    priority: 84
    description: "시험 스타일 기반 루틴 제안"
    conditions:
      - field: "exam_style"
        operator: "=="
        value: "벼락치기"
    action:
      - "strategy_type: '단기 집중 루틴'"
      - "display_message: '시험 D-2주 기준으로 전략적 개입을 준비합니다.'"
    confidence: 0.86
    rationale: "시험 스타일에 따라 루틴 유형 달라져야 함"

  - rule_id: "B4_study_time_warning"
    priority: 80
    description: "학습 시간 부족 경고"
    conditions:
      - field: "study_hours_per_week"
        operator: "<"
        value: 10
    action:
      - "alert: '학습시간 부족 경고'"
      - "display_message: '학습 시간 보완을 위한 최소 루틴을 제안합니다.'"
    confidence: 0.84
    rationale: "학습 시간은 루틴 설계의 하한선"

  - rule_id: "B5_parent_style_communication"
    priority: 81
    description: "부모 스타일 기반 커뮤니케이션 모드 설정"
    conditions:
      - field: "parent_style"
        operator: "=="
        value: "적극 개입"
    action:
      - "communication_mode: '부모 피드백 채널 동기화'"
      - "display_message: '부모님과의 주기적 피드백 루프를 활성화합니다.'"
    confidence: 0.85
    rationale: "학습 개입은 보호자 스타일과의 조화 필요"

  # ========== 포괄형 질문 1: 첫 수업 시작 전략 ==========
  
  - rule_id: "Q1_comprehensive_first_class_strategy"
    priority: 150
    description: "포괄형 질문 1: 첫 수업 종합 전략 도출 (수업 도입 루틴, 설명 전략, 자료 유형 포함) - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "첫 수업"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "어떻게 시작"
        - field: "user_message"
          operator: "contains"
          value: "시작해야 할지"
    action:
      # 1단계: 온톨로지 인스턴스 생성 (지식 객체 생성)
      - "create_instance: 'mk:OnboardingContext'"
      - "set_property: ('mk:hasStudentGrade', '{gradeLevel}')"
      - "set_property: ('mk:hasSchool', '{schoolName}')"
      - "set_property: ('mk:hasAcademy', '{academyName}')"
      - "set_property: ('mk:hasAcademyGrade', '{academyGrade}')"
      
      - "create_instance: 'mk:LearningContextIntegration'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:hasUnitMastery', '{math_unit_mastery}')"
      - "set_property: ('mk:hasCurrentPosition', '{current_progress_position}')"
      
      # 2단계: 의미 기반 추론 (온톨로지 그래프 탐색)
      - "load_db: 'math_unit_relations.yaml'"
      - "reason_over: 'mk:LearningContextIntegration'"
      - "reason_over: 'mk:OnboardingContext'"
      
      # 3단계: 전략 생성 (온톨로지 기반 전략 객체 생성)
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:hasMathLearningStyle', '{math_learning_style}')"
      - "set_property: ('mk:hasStudyStyle', '{study_style}')"
      - "set_property: ('mk:hasExamStyle', '{exam_style}')"
      - "set_property: ('mk:hasMathConfidence', '{math_confidence}')"
      
      # 4단계: 시나리오 자동 생성 (절차 생성)
      - "generate_procedure: 'mk:LessonProcedure'"
      
      # 기존 분석 액션 (온톨로지 추론 결과 활용)
      - "analyze: 'comprehensive_learning_context_integration'"
      - "analyze: 'first_class_introduction_routine_design'"
      - "analyze: 'explanation_strategy_selection'"
      - "analyze: 'material_type_recommendation'"
      
      - "generate_description: 'comprehensive_first_class_strategy'"
      - "recommend_path: '첫 수업 종합 전략: 도입 루틴 + 설명 전략 + 자료 유형'"
      - "display_message: '학생의 현재 수학 학습 맥락을 종합 분석합니다. 온보딩 정보(수학 수준: {math_level}, 개념 진도: {concept_progress}, 심화 진도: {advanced_progress}), 학습 스타일({study_style}, {math_learning_style}), 시험 대비 성향({exam_style}), 자신감 수준({math_confidence}/10)을 반영하여 수업 도입 루틴, 설명 전략, 자료 유형을 포함한 총체적 개입 전략을 도출합니다.{system_health_report}'"
    confidence: 0.96
    rationale: "포괄형 질문 1: 첫 수업 시작 전략 종합 대응 - 온톨로지 기반 의미 추론 및 전략 생성"
  
  - rule_id: "Q1_introduction_routine_question"
    priority: 149
    description: "첫 수업 도입 루틴 질문 대응 (자신감 수준별) - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "첫 수업"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "도입 루틴"
        - field: "user_message"
          operator: "contains"
          value: "도입"
    action:
      # 1단계: 온톨로지 인스턴스 생성 (지식 객체 생성)
      - "create_instance: 'mk:OnboardingContext'"
      - "set_property: ('mk:hasStudentGrade', '{gradeLevel}')"
      - "set_property: ('mk:hasSchool', '{schoolName}')"
      - "set_property: ('mk:hasAcademy', '{academyName}')"
      - "set_property: ('mk:hasAcademyGrade', '{academyGrade}')"
      
      - "create_instance: 'mk:IntroductionRoutine'"
      - "set_property: ('mk:hasMathConfidence', '{math_confidence}')"
      - "set_property: ('mk:hasConfidenceLevel', '{confidence_level}')"
      
      # 자신감 수준별 분기 (온톨로지 관계 활용)
      - "set_property: ('mk:forLowConfidence', 'mk:SupportiveIntroduction')"
      - "set_property: ('mk:forMediumConfidence', 'mk:BalancedIntroduction')"
      - "set_property: ('mk:forHighConfidence', 'mk:ChallengingIntroduction')"
      
      # 2단계: 의미 기반 추론 (온톨로지 그래프 탐색)
      - "reason_over: 'mk:IntroductionRoutine'"
      - "reason_over: 'mk:OnboardingContext'"
      
      # 3단계: 전략 생성 (온톨로지 기반 전략 객체 생성)
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:hasMathConfidence', '{math_confidence}')"
      - "set_property: ('mk:recommendsIntroductionRoutine', 'confidence_based_routine')"
      - "set_property: ('mk:recommendsInteractionStyle', 'confidence_based_interaction')"
      
      # 4단계: 분석 및 설명 생성
      - "analyze: 'introduction_routine_by_confidence_level'"
      - "generate_description: 'confidence_based_introduction_routine'"
      - "recommend_path: '첫 수업 도입 루틴: 자신감 수준별 맞춤형 설계'"
      - "display_message: '학생의 자신감 수준({math_confidence}/10)을 반영하여 첫 수업 도입 루틴을 설계합니다. 자신감 수준에 맞춘 부드러운 도입 또는 도전적 도입 방식을 선택하여 최적의 학습 환경을 제공합니다.{system_health_report}'"
    confidence: 0.95
    rationale: "사용자가 직접 도입 루틴을 질문한 경우 - 온톨로지 기반 자신감 수준별 루틴 생성"
  
  - rule_id: "Q1_explanation_strategy_question"
    priority: 148
    description: "첫 수업 설명 전략 질문 대응 (학습 스타일별) - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "첫 수업"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "설명 전략"
        - field: "user_message"
          operator: "contains"
          value: "설명"
        - field: "user_message"
          operator: "contains"
          value: "전략"
    action:
      # 1단계: 온톨로지 인스턴스 생성 (지식 객체 생성)
      - "create_instance: 'mk:LearningContextIntegration'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:hasUnitMastery', '{math_unit_mastery}')"
      - "set_property: ('mk:hasCurrentPosition', '{current_progress_position}')"
      
      - "create_instance: 'mk:ExplanationStrategy'"
      - "set_property: ('mk:hasMathLearningStyle', '{math_learning_style}')"
      - "set_property: ('mk:hasStudyStyle', '{study_style}')"
      
      # 스타일별 매핑 (온톨로지 관계 활용)
      - "set_property: ('mk:forCalculationType', 'mk:StepByStepCalculation')"
      - "set_property: ('mk:forConceptType', 'mk:ConceptualExplanation')"
      - "set_property: ('mk:forApplicationType', 'mk:ProblemBasedLearning')"
      
      # 2단계: 의미 기반 추론 (온톨로지 그래프 탐색)
      - "reason_over: 'mk:ExplanationStrategy'"
      - "reason_over: 'mk:LearningContextIntegration'"
      
      # 3단계: 전략 생성 (온톨로지 기반 전략 객체 생성)
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:hasMathLearningStyle', '{math_learning_style}')"
      - "set_property: ('mk:hasStudyStyle', '{study_style}')"
      - "set_property: ('mk:recommendsExplanationStrategy', 'learning_style_based_explanation')"
      
      # 4단계: 분석 및 설명 생성
      - "analyze: 'learning_style_based_explanation_method'"
      - "generate_description: 'explanation_strategy_by_learning_style'"
      - "recommend_path: '첫 수업 설명 전략: 학습 스타일별 맞춤형 설명 방식'"
      - "display_message: '학생의 수학 학습 스타일({math_learning_style})과 학습 스타일({study_style})을 반영하여 첫 수업 설명 전략을 설계합니다. {math_learning_style} 스타일에 최적화된 설명 방식을 적용하여 학습 효율을 극대화합니다.{system_health_report}'"
    confidence: 0.95
    rationale: "사용자가 직접 설명 전략을 질문한 경우 - 온톨로지 기반 학습 스타일별 설명 전략 생성"
  
  - rule_id: "Q1_material_type_question"
    priority: 147
    description: "첫 수업 자료 유형 질문 대응 (진도별) - 온톨로지 기반 추론"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "첫 수업"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "자료 유형"
        - field: "user_message"
          operator: "contains"
          value: "자료"
        - field: "user_message"
          operator: "contains"
          value: "유형"
    action:
      # 1단계: 온톨로지 인스턴스 생성 (지식 객체 생성)
      - "create_instance: 'mk:LearningContextIntegration'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:hasUnitMastery', '{math_unit_mastery}')"
      - "set_property: ('mk:hasCurrentPosition', '{current_progress_position}')"
      
      - "create_instance: 'mk:MaterialType'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:hasTextbooks', '{textbooks}')"
      
      # 진도별 매핑 (온톨로지 관계 활용)
      - "set_property: ('mk:forAheadAcademy', 'mk:AdvancedMaterial')"
      - "set_property: ('mk:forAheadSchool', 'mk:StandardMaterial')"
      - "set_property: ('mk:forAligned', 'mk:BasicMaterial')"
      
      # 2단계: 의미 기반 추론 (온톨로지 그래프 탐색)
      - "reason_over: 'mk:MaterialType'"
      - "reason_over: 'mk:LearningContextIntegration'"
      
      # 3단계: 전략 생성 (온톨로지 기반 전략 객체 생성)
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:recommendsMaterialType', 'progress_based_material')"
      - "set_property: ('mk:recommendsTextbook', '{textbooks}')"
      
      # 4단계: 분석 및 설명 생성
      - "analyze: 'progress_based_material_selection'"
      - "generate_description: 'material_recommendation_by_progress'"
      - "recommend_path: '첫 수업 자료 유형: 진도별 맞춤형 자료 추천'"
      - "display_message: '학생의 개념 진도({concept_progress})와 심화 진도({advanced_progress})를 반영하여 첫 수업에 적합한 자료 유형을 추천합니다. 진도 수준에 맞춘 기본/표준/심화 자료를 선정하여 학습 효과를 극대화합니다.{system_health_report}'"
    confidence: 0.94
    rationale: "사용자가 직접 자료 유형을 질문한 경우 - 온톨로지 기반 진도별 자료 유형 추천"
  
  - rule_id: "Q1_introduction_routine_by_confidence"
    priority: 98
    description: "자신감 수준별 수업 도입 루틴 설계 - 온톨로지 기반"
    conditions:
      - field: "math_confidence"
        operator: "<="
        value: 5
      - field: "concept_progress"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk:IntroductionRoutine'"
      - "set_property: ('mk:hasMathConfidence', '{math_confidence}')"
      - "set_property: ('mk:hasConfidenceLevel', 'low')"
      - "set_property: ('mk:forLowConfidence', 'mk:SupportiveRoutine')"
      
      # 의미 기반 추론
      - "reason_over: 'mk:IntroductionRoutine'"
      
      # 전략 생성
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:recommendsIntroductionRoutine', 'mk:SupportiveRoutine')"
      - "set_property: ('mk:recommendsInteractionStyle', 'mk:GentleInteraction')"
      
      - "recommend: 'gentle_introduction_routine'"
      - "analyze: 'low_confidence_warm_up_design'"
      - "generate_description: 'confidence_building_introduction'"
      - "display_message: '자신감이 낮은 학생({math_confidence}/10)을 위해 부드러운 도입 루틴을 설계합니다. 쉬운 문제로 시작하여 성공 경험을 제공하고, 개념 진도({concept_progress})에 맞춘 친숙한 주제부터 접근합니다.'"
    confidence: 0.94
    rationale: "낮은 자신감 학생은 도입 단계가 중요 - 온톨로지 기반 루틴 생성"
  
  - rule_id: "Q1_explanation_strategy_by_learning_style"
    priority: 97
    description: "학습 스타일별 설명 전략 선택 - 온톨로지 기반"
    conditions:
      - field: "math_learning_style"
        operator: "!="
        value: null
      - field: "study_style"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk:ExplanationStrategy'"
      - "set_property: ('mk:hasMathLearningStyle', '{math_learning_style}')"
      - "set_property: ('mk:hasStudyStyle', '{study_style}')"
      
      # 스타일별 매핑 (온톨로지 관계 활용)
      - "set_property: ('mk:forCalculationType', 'mk:StepByStepExplanation')"
      - "set_property: ('mk:forConceptType', 'mk:PrincipleBasedExplanation')"
      - "set_property: ('mk:forApplicationType', 'mk:ProblemBasedExplanation')"
      
      # 의미 기반 추론
      - "reason_over: 'mk:ExplanationStrategy'"
      
      # 전략 생성
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:recommendsExplanationStrategy', '{math_learning_style}_explanation')"
      
      - "analyze: 'learning_style_based_explanation_method'"
      - "recommend: 'personalized_explanation_strategy'"
      - "generate_description: 'explanation_strategy_by_style'"
      - "display_message: '학생의 수학 학습 스타일({math_learning_style})과 학습 스타일({study_style})에 맞춘 설명 전략을 선택합니다. {math_learning_style} 스타일에 최적화된 설명 방식을 적용합니다.'"
    confidence: 0.95
    rationale: "학습 스타일에 맞는 설명 전략이 효과적 - 온톨로지 기반 매핑"
  
  - rule_id: "Q1_material_type_by_progress"
    priority: 96
    description: "진도별 자료 유형 추천 - 온톨로지 기반"
    conditions:
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "advanced_progress"
        operator: "!="
        value: null
      - field: "textbooks"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk:MaterialType'"
      - "set_property: ('mk:hasConceptProgress', '{concept_progress}')"
      - "set_property: ('mk:hasAdvancedProgress', '{advanced_progress}')"
      - "set_property: ('mk:hasTextbooks', '{textbooks}')"
      
      # 의미 기반 추론 (진도-자료 매핑)
      - "reason_over: 'mk:MaterialType'"
      - "reason_over: 'mk:LearningContextIntegration'"
      
      # 전략 생성
      - "generate_strategy: 'mk:FirstClassStrategy'"
      - "set_property: ('mk:recommendsMaterialType', 'progress_based_material')"
      - "set_property: ('mk:recommendsTextbook', '{textbooks}')"
      
      - "analyze: 'progress_based_material_selection'"
      - "recommend: 'optimal_material_types'"
      - "generate_description: 'material_recommendation_by_progress'"
      - "display_message: '개념 진도({concept_progress})와 심화 진도({advanced_progress})를 고려하여 적합한 자료 유형을 추천합니다. 사용 중인 교재({textbooks})와 연계하여 자료를 선정합니다.'"
    confidence: 0.93
    rationale: "진도에 맞는 자료 선택이 학습 효율 향상 - 온톨로지 기반 추론"

  # ========== 포괄형 질문 2: 커리큘럼과 루틴 최적화 ==========
  
  - rule_id: "Q2_comprehensive_curriculum_routine_optimization"
    priority: 100
    description: "포괄형 질문 2: 커리큘럼과 루틴 최적화 전략 (진도별 우선순위, 학습 흐름, 문제 유형 비중 조절)"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "커리큘럼"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "루틴"
        - field: "user_message"
          operator: "contains"
          value: "최적화"
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:CurriculumOptimization'"
      - "set_property: ('mk-a01-mod:hasProgressPriority', '{progress_priority}')"
      
      # GoalBasedCurriculum 생성
      - "create_instance: 'mk-a01-mod:GoalBasedCurriculum'"
      - "set_property: ('mk-a01-mod:hasShortTermGoal', '{short_term_goal}')"
      - "set_property: ('mk-a01-mod:hasMidTermGoal', '{mid_term_goal}')"
      - "set_property: ('mk-a01-mod:hasLongTermGoal', '{long_term_goal}')"
      
      # LearningFlow 생성
      - "create_instance: 'mk-a01-mod:LearningFlow'"
      - "set_property: ('mk-a01-mod:hasStyleBasedFlow', '{study_style}')"
      
      # ProblemTypeRatio 생성
      - "create_instance: 'mk-a01-mod:ProblemTypeRatio'"
      
      # DifficultyAdjustmentStrategy 생성
      - "create_instance: 'mk-a01-mod:DifficultyAdjustmentStrategy'"
      - "set_property: ('mk-a01-mod:hasConfidenceLevel', '{math_confidence}')"
      
      # ParentInvolvementStrategy 생성
      - "create_instance: 'mk-a01-mod:ParentInvolvementStrategy'"
      - "set_property: ('mk-a01-mod:hasParentStyle', '{parent_style}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:CurriculumOptimization'"
      - "reason_over: 'mk-a01-mod:GoalBasedCurriculum'"
      - "reason_over: 'mk-a01-mod:LearningFlow'"
      
      # 분석 및 설명 생성
      - "analyze: 'comprehensive_curriculum_routine_optimization'"
      - "analyze: 'progress_priority_calculation'"
      - "analyze: 'learning_flow_design'"
      - "analyze: 'problem_type_ratio_adjustment'"
      - "generate_description: 'curriculum_routine_optimization_strategy'"
      - "recommend_path: '커리큘럼 최적화: 진도 우선순위 + 학습 흐름 + 문제 유형 비중'"
      - "display_message: '학생의 성향과 목표를 종합 분석합니다. 목표(단기: {short_term_goal}, 중기: {mid_term_goal}, 장기: {long_term_goal}), 학습 성향({study_style}, {math_learning_style}), 스트레스/자신감(자신감: {math_confidence}/10, 스트레스: {stress_level}), 부모 개입도({parent_style})를 고려하여 진도별 우선순위, 학습 흐름, 문제 유형 비중 조절 등 커스터마이징 설계를 도출합니다.{system_health_report}'"
    confidence: 0.96
    rationale: "포괄형 질문 2: 커리큘럼과 루틴 최적화 종합 대응 - 온톨로지 연동 완료"
  
  - rule_id: "Q2_progress_priority_by_goals"
    priority: 99
    description: "목표 기반 진도별 우선순위 설정"
    conditions:
      - field: "long_term_goal"
        operator: "!="
        value: null
      - field: "concept_progress"
        operator: "!="
        value: null
      - field: "advanced_progress"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:GoalBasedCurriculum'"
      - "set_property: ('mk-a01-mod:hasShortTermGoal', '{short_term_goal}')"
      - "set_property: ('mk-a01-mod:hasMidTermGoal', '{mid_term_goal}')"
      - "set_property: ('mk-a01-mod:hasLongTermGoal', '{long_term_goal}')"
      
      # CurriculumOptimization에 연결
      - "create_instance: 'mk-a01-mod:CurriculumOptimization'"
      - "set_property: ('mk-a01-mod:hasProgressPriority', '{progress_priority}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:GoalBasedCurriculum'"
      
      # 분석 및 설명 생성
      - "analyze: 'goal_based_progress_priority'"
      - "recommend: 'priority_sequence_design'"
      - "generate_description: 'progress_priority_by_goal_alignment'"
      - "display_message: '장기 목표({long_term_goal})를 달성하기 위해 개념 진도({concept_progress})와 심화 진도({advanced_progress})의 우선순위를 설정합니다. 목표 달성에 필요한 핵심 진도를 우선 배치합니다.'"
    confidence: 0.95
    rationale: "목표 달성을 위한 진도 우선순위가 중요 - 온톨로지 연동 완료"
  
  - rule_id: "Q2_learning_flow_by_style"
    priority: 98
    description: "학습 성향 기반 학습 흐름 설계"
    conditions:
      - field: "study_style"
        operator: "!="
        value: null
      - field: "math_learning_style"
        operator: "!="
        value: null
      - field: "exam_style"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:LearningFlow'"
      - "set_property: ('mk-a01-mod:hasFlowSequence', '{learning_sequence}')"
      - "set_property: ('mk-a01-mod:hasStyleBasedFlow', '{study_style}')"
      
      # TimeAllocation 생성
      - "create_instance: 'mk-a01-mod:TimeAllocation'"
      - "set_property: ('mk-a01-mod:hasWeeklyAllocation', '{weekly_allocation}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:LearningFlow'"
      
      # 분석 및 설명 생성
      - "analyze: 'style_based_learning_flow'"
      - "recommend: 'personalized_learning_sequence'"
      - "generate_description: 'learning_flow_optimization'"
      - "display_message: '학습 성향({study_style}, {math_learning_style})과 시험 대비 성향({exam_style})을 반영하여 최적의 학습 흐름을 설계합니다. 개념-문제풀이-심화의 비중과 순서를 조정합니다.'"
    confidence: 0.94
    rationale: "학습 성향에 맞는 흐름이 효율적 - 온톨로지 연동 완료"
  
  - rule_id: "Q2_problem_type_ratio_by_confidence"
    priority: 97
    description: "자신감과 스트레스 기반 문제 유형 비중 조절"
    conditions:
      - field: "math_confidence"
        operator: "!="
        value: null
      - field: "stress_level"
        operator: "!="
        value: null
      - field: "math_level"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:ProblemTypeRatio'"
      - "set_property: ('mk-a01-mod:hasConceptRatio', '{concept_ratio}')"
      - "set_property: ('mk-a01-mod:hasTypeRatio', '{type_ratio}')"
      - "set_property: ('mk-a01-mod:hasAdvancedRatio', '{advanced_ratio}')"
      - "set_property: ('mk-a01-mod:hasPastExamRatio', '{past_exam_ratio}')"
      
      # DifficultyAdjustmentStrategy 생성
      - "create_instance: 'mk-a01-mod:DifficultyAdjustmentStrategy'"
      - "set_property: ('mk-a01-mod:hasStressLevel', '{stress_level}')"
      - "set_property: ('mk-a01-mod:hasConfidenceLevel', '{math_confidence}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:ProblemTypeRatio'"
      - "reason_over: 'mk-a01-mod:DifficultyAdjustmentStrategy'"
      
      # 분석 및 설명 생성
      - "analyze: 'confidence_stress_based_problem_ratio'"
      - "recommend: 'problem_type_distribution'"
      - "generate_description: 'problem_type_ratio_optimization'"
      - "display_message: '자신감({math_confidence}/10)과 스트레스 수준({stress_level})을 고려하여 기초:기본:심화 문제의 비중을 조절합니다. {math_level} 수준에 맞춘 문제 유형 분배를 제안합니다.'"
    confidence: 0.93
    rationale: "자신감과 스트레스는 문제 유형 선택의 핵심 변수 - 온톨로지 연동 완료"
  
  - rule_id: "Q2_parent_involvement_integration"
    priority: 96
    description: "부모 개입도 반영 커리큘럼 조정"
    conditions:
      - field: "parent_style"
        operator: "!="
        value: null
      - field: "weekly_hours"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:ParentInvolvementStrategy'"
      - "set_property: ('mk-a01-mod:hasParentStyle', '{parent_style}')"
      - "set_property: ('mk-a01-mod:hasInvolvementLevel', '{involvement_level}')"
      - "set_property: ('mk-a01-mod:hasFeedbackMethod', '{feedback_method}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:ParentInvolvementStrategy'"
      
      # 분석 및 설명 생성
      - "analyze: 'parent_involvement_curriculum_adjustment'"
      - "recommend: 'family_integrated_learning_plan'"
      - "generate_description: 'parent_style_curriculum_integration'"
      - "display_message: '부모 개입 스타일({parent_style})을 반영하여 커리큘럼을 조정합니다. 주간 학습 시간({weekly_hours}시간)과 부모 스타일에 맞춘 학습 계획을 수립합니다.'"
    confidence: 0.92
    rationale: "부모 개입도는 커리큘럼 실행에 영향 - 온톨로지 연동 완료"

  - rule_id: "Q2_routine_design_by_time_environment"
    priority: 95
    description: "학습 시간과 환경 기반 루틴 설계"
    conditions:
      - field: "study_hours_per_week"
        operator: "!="
        value: null
      - field: "learning_environment"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:RoutineDesign'"
      - "set_property: ('mk-a01-mod:hasStudyHoursPerWeek', '{study_hours_per_week}')"
      - "set_property: ('mk-a01-mod:hasLearningEnvironment', '{learning_environment}')"
      - "set_property: ('mk-a01-mod:hasRoutineStructure', '{routine_structure}')"
      
      # TimeAllocation 생성
      - "create_instance: 'mk-a01-mod:TimeAllocation'"
      - "set_property: ('mk-a01-mod:hasDailyAllocation', '{daily_allocation}')"
      - "set_property: ('mk-a01-mod:hasWeeklyAllocation', '{weekly_allocation}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:RoutineDesign'"
      - "reason_over: 'mk-a01-mod:TimeAllocation'"
      
      # 분석 및 설명 생성
      - "analyze: 'time_environment_based_routine_design'"
      - "recommend: 'personalized_routine_structure'"
      - "generate_description: 'routine_design_by_time_environment'"
      - "display_message: '학습 시간({study_hours_per_week}시간/주)과 학습 환경({learning_environment})을 고려하여 루틴을 설계합니다. 시간 배분과 환경 특성에 맞춘 학습 구조를 제안합니다.'"
    confidence: 0.91
    rationale: "학습 시간과 환경은 루틴 설계의 핵심 요소 - 온톨로지 연동 완료"

  # ========== 포괄형 질문 3: 중장기 성장 전략 ==========
  
  - rule_id: "Q3_comprehensive_long_term_growth_strategy"
    priority: 100
    description: "포괄형 질문 3: 중장기 성장 전략 (경시 준비, 진학 목표, 자존감 성장, 피로 방지, 루틴 유지)"
    conditions:
      - field: "user_message"
        operator: "contains"
        value: "중장기"
      - OR:
        - field: "user_message"
          operator: "contains"
          value: "성장"
        - field: "user_message"
          operator: "contains"
          value: "신경 써야 할까"
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:LongTermGrowthStrategy'"
      - "set_property: ('mk-a01-mod:hasGrowthPlan', '{growth_plan}')"
      
      # RiskPrediction 생성
      - "create_instance: 'mk-a01-mod:RiskPrediction'"
      - "set_property: ('mk-a01-mod:hasRiskFactors', '{risk_factors}')"
      
      # TrackingPriority 생성
      - "create_instance: 'mk-a01-mod:TrackingPriority'"
      - "set_property: ('mk-a01-mod:hasPriorityList', '{priority_list}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:LongTermGrowthStrategy'"
      - "reason_over: 'mk-a01-mod:RiskPrediction'"
      
      # 분석 및 설명 생성
      - "analyze: 'comprehensive_long_term_growth_analysis'"
      - "analyze: 'early_risk_prediction'"
      - "analyze: 'tracking_priority_elements'"
      - "generate_description: 'long_term_growth_strategy'"
      - "recommend_path: '중장기 성장 전략: 리스크 예측 + 트래킹 우선요소'"
      - "display_message: '학생의 중장기 성장을 종합 분석합니다. 경시 준비 여부, 진학 목표({long_term_goal}), 수학 자존감 성장(현재: {math_confidence}/10), 피로 누적 방지, 루틴 유지 여부 등을 포괄적으로 분석하여 조기 리스크 예측 및 트래킹 우선요소를 추천합니다.{system_health_report}'"
    confidence: 0.96
    rationale: "포괄형 질문 3: 중장기 성장 전략 종합 대응 - 온톨로지 연동 완료"
  
  - rule_id: "Q3_competition_prep_risk_assessment"
    priority: 99
    description: "경시 준비 관련 리스크 평가 및 대응 전략"
    conditions:
      - field: "long_term_goal"
        operator: "contains"
        value: "경시"
      - OR:
        - field: "long_term_goal"
          operator: "contains"
          value: "경시대회"
        - field: "long_term_goal"
          operator: "contains"
          value: "올림피아드"
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:CompetitionPrepStrategy'"
      - "set_property: ('mk-a01-mod:hasCompetitionType', '{competition_type}')"
      - "set_property: ('mk-a01-mod:hasPrepPeriod', '{prep_period}')"
      
      # RiskPrediction 생성
      - "create_instance: 'mk-a01-mod:RiskPrediction'"
      - "set_property: ('mk-a01-mod:hasRiskFactors', '{risk_factors}')"
      - "set_property: ('mk-a01-mod:hasRiskLevel', '{risk_level}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:CompetitionPrepStrategy'"
      - "reason_over: 'mk-a01-mod:RiskPrediction'"
      
      # 분석 및 설명 생성
      - "analyze: 'competition_prep_feasibility_assessment'"
      - "analyze: 'competition_prep_risk_factors'"
      - "recommend: 'competition_prep_strategy'"
      - "generate_description: 'competition_preparation_risk_analysis'"
      - "display_message: '경시 준비 목표를 분석합니다. 현재 수학 수준({math_level}), 자신감({math_confidence}/10), 주간 학습 시간({weekly_hours}시간)을 고려하여 경시 준비의 현실성과 리스크를 평가하고, 필요한 학습 시간과 진도 계획을 수립합니다.'"
    confidence: 0.95
    rationale: "경시 준비는 현실성 평가와 리스크 관리가 중요 - 온톨로지 연동 완료"
  
  - rule_id: "Q3_university_goal_alignment"
    priority: 98
    description: "진학 목표 정렬 및 달성 경로 설계"
    conditions:
      - field: "long_term_goal"
        operator: "contains"
        value: "학교"
      - OR:
        - field: "long_term_goal"
          operator: "contains"
          value: "대학"
        - field: "long_term_goal"
          operator: "contains"
          value: "진학"
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:UniversityGoalStrategy'"
      - "set_property: ('mk-a01-mod:hasUniversityGoal', '{long_term_goal}')"
      - "set_property: ('mk-a01-mod:hasTargetScore', '{target_score}')"
      
      # LearningRoadmap 생성
      - "create_instance: 'mk-a01-mod:LearningRoadmap'"
      - "set_property: ('mk-a01-mod:hasMilestones', '{milestones}')"
      - "set_property: ('mk-a01-mod:hasTimeline', '{timeline}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:UniversityGoalStrategy'"
      - "reason_over: 'mk-a01-mod:LearningRoadmap'"
      
      # 분석 및 설명 생성
      - "analyze: 'university_goal_alignment_analysis'"
      - "analyze: 'achievement_pathway_design'"
      - "recommend: 'university_prep_milestones'"
      - "generate_description: 'university_goal_strategy'"
      - "display_message: '진학 목표({long_term_goal})를 달성하기 위한 경로를 설계합니다. 현재 수학 수준({math_level})과 목표 간 격차를 분석하고, 단계별 마일스톤을 설정합니다.'"
    confidence: 0.94
    rationale: "진학 목표는 단계적 접근이 필요 - 온톨로지 연동 완료"
  
  - rule_id: "Q3_math_confidence_growth_strategy"
    priority: 97
    description: "수학 자존감 성장 전략 및 트래킹"
    conditions:
      - field: "math_confidence"
        operator: "<="
        value: 6
      - field: "math_level"
        operator: "in"
        value: ["수학이 어려워요", "중위권"]
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:MathConfidenceGrowth'"
      - "set_property: ('mk-a01-mod:hasCurrentConfidence', '{math_confidence}')"
      - "set_property: ('mk-a01-mod:hasConfidenceGrowthPlan', '{confidence_growth_plan}')"
      - "set_property: ('mk-a01-mod:hasInterventionStrategy', '{intervention_strategy}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:MathConfidenceGrowth'"
      
      # 분석 및 설명 생성
      - "analyze: 'confidence_growth_pathway'"
      - "recommend: 'confidence_building_interventions'"
      - "generate_description: 'math_confidence_growth_plan'"
      - "display_message: '수학 자존감 성장을 위한 전략을 수립합니다. 현재 자신감({math_confidence}/10)이 낮으므로 작은 성공 경험을 설계하고, {math_level} 수준에 맞춘 점진적 난이도 상승 계획을 제시합니다.'"
    confidence: 0.93
    rationale: "자존감 성장은 중장기 성장의 기초 - 온톨로지 연동 완료"
  
  - rule_id: "Q3_fatigue_accumulation_prevention"
    priority: 96
    description: "피로 누적 방지 전략 및 모니터링 포인트"
    conditions:
      - field: "stress_level"
        operator: "in"
        value: ["높음", "매우 높음"]
      - OR:
        - field: "weekly_hours"
          operator: ">="
          value: 20
        - field: "exam_style"
          operator: "=="
          value: "벼락치기"
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:FatiguePreventionStrategy'"
      - "set_property: ('mk-a01-mod:hasFatiguePattern', '{fatigue_pattern}')"
      - "set_property: ('mk-a01-mod:hasPreventionPlan', '{prevention_plan}')"
      - "set_property: ('mk-a01-mod:hasRecoveryStrategy', '{recovery_strategy}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:FatiguePreventionStrategy'"
      
      # 분석 및 설명 생성
      - "analyze: 'fatigue_accumulation_pattern_analysis'"
      - "recommend: 'fatigue_prevention_interventions'"
      - "generate_description: 'fatigue_prevention_strategy'"
      - "display_message: '피로 누적 패턴을 분석하고 방지 전략을 수립합니다. 스트레스 수준({stress_level}), 주간 학습 시간({weekly_hours}시간), 시험 대비 성향({exam_style})을 고려하여 피로 누적을 방지하고 회복 전략을 제시합니다.'"
    confidence: 0.92
    rationale: "피로 누적 방지는 장기 학습 지속성의 핵심 - 온톨로지 연동 완료"
    action:
      - "analyze: 'fatigue_risk_assessment'"
      - "recommend: 'fatigue_prevention_routine'"
      - "generate_description: 'fatigue_management_strategy'"
      - "display_message: '피로 누적 방지를 위한 전략을 수립합니다. 스트레스 수준({stress_level})이 높고 주간 학습 시간({weekly_hours}시간)이 많으므로 휴식 루틴과 피로 모니터링 포인트를 설정합니다.'"
    confidence: 0.92
    rationale: "피로 누적은 학습 지속성에 위험"
  
  - rule_id: "Q3_routine_sustainability_check"
    priority: 95
    description: "루틴 유지 가능성 평가 및 지속성 전략"
    conditions:
      - field: "study_hours_per_week"
        operator: "!="
        value: null
      - field: "exam_style"
        operator: "!="
        value: null
      - field: "parent_style"
        operator: "!="
        value: null
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:RoutineSustainability'"
      - "set_property: ('mk-a01-mod:hasSustainabilityScore', '{sustainability_score}')"
      - "set_property: ('mk-a01-mod:hasMaintenancePlan', '{maintenance_plan}')"
      - "set_property: ('mk-a01-mod:hasStabilityIndicators', '{stability_indicators}')"
      
      # RoutineMonitoring 생성
      - "create_instance: 'mk-a01-mod:RoutineMonitoring'"
      - "set_property: ('mk-a01-mod:hasMonitoringMetrics', '{monitoring_metrics}')"
      - "set_property: ('mk-a01-mod:hasCheckFrequency', '{check_frequency}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:RoutineSustainability'"
      - "reason_over: 'mk-a01-mod:RoutineMonitoring'"
      
      # 분석 및 설명 생성
      - "analyze: 'routine_sustainability_assessment'"
      - "analyze: 'routine_maintenance_factors'"
      - "recommend: 'sustainable_routine_design'"
      - "generate_description: 'routine_sustainability_strategy'"
      - "display_message: '루틴 유지 가능성을 평가합니다. 주간 학습 시간({study_hours_per_week}시간), 시험 스타일({exam_style}), 부모 스타일({parent_style})을 고려하여 지속 가능한 루틴을 설계하고, 유지 장애 요인을 사전에 예측합니다.'"
    confidence: 0.91
    rationale: "루틴 유지는 중장기 성장의 핵심 - 온톨로지 연동 완료"
  
  - rule_id: "Q3_early_risk_prediction_comprehensive"
    priority: 94
    description: "조기 리스크 예측 및 트래킹 우선요소 추천"
    conditions:
      - field: "math_confidence"
        operator: "<="
        value: 5
      - OR:
        - field: "stress_level"
          operator: "in"
          value: ["높음", "매우 높음"]
        - field: "study_hours_per_week"
          operator: "<"
          value: 10
    action:
      # 온톨로지 인스턴스 생성
      - "create_instance: 'mk-a01-mod:RiskPrediction'"
      - "set_property: ('mk-a01-mod:hasRiskFactors', '{risk_factors}')"
      - "set_property: ('mk-a01-mod:hasRiskLevel', '{risk_level}')"
      - "set_property: ('mk-a01-mod:hasEarlyWarningSignals', '{early_warning_signals}')"
      
      # TrackingPriority 생성
      - "create_instance: 'mk-a01-mod:TrackingPriority'"
      - "set_property: ('mk-a01-mod:hasPriorityList', '{priority_list}')"
      - "set_property: ('mk-a01-mod:hasTrackingFrequency', '{tracking_frequency}')"
      - "set_property: ('mk-a01-mod:hasKeyIndicators', '{key_indicators}')"
      
      # 의미 기반 추론
      - "reason_over: 'mk-a01-mod:RiskPrediction'"
      - "reason_over: 'mk-a01-mod:TrackingPriority'"
      
      # 분석 및 설명 생성
      - "analyze: 'comprehensive_risk_prediction'"
      - "analyze: 'tracking_priority_identification'"
      - "recommend: 'risk_mitigation_interventions'"
      - "generate_description: 'early_risk_prediction_and_tracking'"
      - "display_message: '조기 리스크를 예측합니다. 낮은 자신감({math_confidence}/10), 높은 스트레스({stress_level}), 부족한 학습 시간({study_hours_per_week}시간) 등 위험 요소를 식별하고, 우선적으로 트래킹해야 할 요소를 추천합니다.'"
    confidence: 0.90
    rationale: "조기 리스크 예측은 중장기 성장의 핵심 - 온톨로지 연동 완료"

# Default fallback rule
default_rule:
  rule_id: "default"
  action:
    - "display_message: '온보딩 정보를 분석 중입니다. 추가 정보가 필요할 수 있습니다.{system_health_report}'"
  confidence: 0.5
  rationale: "기본 루틴 적용 - 조건 불일치 시 사용"

# ========== 필드 메타데이터 정의 ==========
# dataindex_user.php에서 필드 타입 식별을 위한 메타데이터
# source_type: interface = 사용자 인터페이스 입력 (uidata)
# source_type: survey = 설문 조사 데이터 (survdata)
# source_type: system = 시스템 자동 생성 데이터 (sysdata)
# source_type: generated = LLM 모델링 생성 데이터 (gendata)

fields:
  # 선호/취미 정보 (mdl_alt42g_additional_info)
  - field: "favorite_food"
    source_type: "interface"
    description: "좋아하는 음식"
  - field: "favorite_fruit"
    source_type: "interface"
    description: "좋아하는 과일"
  - field: "favorite_snack"
    source_type: "interface"
    description: "좋아하는 과자"
  - field: "hobbies_interests"
    source_type: "interface"
    description: "취미/관심사"
  - field: "fandom_yn"
    source_type: "interface"
    description: "팬덤 여부"
  - field: "data_consent"
    source_type: "interface"
    description: "데이터 수집 동의"
  
  # 학습 진도 정보 (mdl_alt42g_learning_progress)
  - field: "notes"
    source_type: "interface"
    description: "학습 메모"
  - field: "weekly_hours"
    source_type: "interface"
    description: "주별 공부 시간"
  - field: "academy_experience"
    source_type: "interface"
    description: "학원 경험"
  
  # 학습 목표 정보 (mdl_alt42g_learning_goals)
  - field: "short_term_goal"
    source_type: "interface"
    description: "단기 목표"
  - field: "mid_term_goal"
    source_type: "interface"
    description: "중기 목표"
  - field: "long_term_goal"
    source_type: "interface"
    description: "장기 목표"
  - field: "goal_note"
    source_type: "interface"
    description: "목표 관련 메모"
  
  # 학원 정보 (mdl_alt42o_onboarding)
  - field: "academy_grade"
    source_type: "survey"
    description: "학원 등급(반)"
  - field: "academy_schedule"
    source_type: "survey"
    description: "학원 수업 일정"
  
  # 진도 레벨 정보 (mdl_alt42o_onboarding)
  - field: "advanced_level"
    source_type: "survey"
    description: "심화 레벨"
  - field: "concept_level"
    source_type: "survey"
    description: "개념 레벨"
  - field: "course_level"
    source_type: "survey"
    description: "과정 레벨"
  - field: "grade_detail"
    source_type: "survey"
    description: "학년 상세 정보"
  
  # 학습 메모 및 피드백 (mdl_alt42o_onboarding)
  - field: "learning_notes"
    source_type: "survey"
    description: "학습 메모"
  - field: "feedback_preference"
    source_type: "survey"
    description: "피드백 선호도"
  
  # 학습 감정/상태 (설문 데이터)
  - field: "boredom"
    source_type: "survey"
    description: "지루함 수준"
  - field: "calmness"
    source_type: "survey"
    description: "평온함 수준"
  - field: "pace_anxiety"
    source_type: "survey"
    description: "학습 속도 불안감"
  - field: "satisfaction"
    source_type: "survey"
    description: "학습 만족도"
  
  # 학습 방법 (설문 데이터)
  - field: "pomodoro"
    source_type: "survey"
    description: "뽀모도로 기법 사용 여부"

  # 인지/집중력/협업 역량 (학습 평가 결과 데이터 - mdl_alt42o_learning_assessment_results)
  - field: "cognitive_total"
    source_type: "survey"
    description: "인지 능력 총점"
    table: "mdl_alt42o_learning_assessment_results"
  - field: "collaboration_score"
    source_type: "survey"
    description: "협업 점수"
    table: "mdl_alt42o_learning_assessment_results"
  - field: "completion_time"
    source_type: "survey"
    description: "학습 완료 시간"
    table: "mdl_alt42o_learning_assessment_results"
  - field: "concentration_score"
    source_type: "survey"
    description: "집중력 점수"
    table: "mdl_alt42o_learning_assessment_results"

# ========== 데이터 기반 질문 연계 정보 ==========
# 
# 이 rules.yaml 파일은 questions.html의 포괄형 질문과 data_based_questions.js의 데이터 기반 질문과 연계됩니다.
#
# 포괄형 질문 1: "이 학생의 현재 수학 학습 맥락을 종합해서, 첫 수업에서 무엇을 어떻게 시작해야 할지 알려줘."
#   - 연계 룰: Q1_comprehensive_first_class_strategy (종합 전략), Q1_introduction_routine_by_confidence (도입 루틴), 
#             Q1_explanation_strategy_by_learning_style (설명 전략), Q1_material_type_by_progress (자료 유형),
#             S0_R1~S0_R6 (수학 특화 정보 수집), S1_R1~S1_R3 (첫 수업 준비 가이드)
#   - 데이터 소스: onboarding_info, concept_progress, advanced_progress, math_learning_style, exam_style, math_confidence,
#                 study_style, textbooks, academy_name, notes, weekly_hours
#   - 출력: 수업 도입 루틴, 설명 전략, 자료 유형을 포함한 총체적 개입 전략
#   - 온톨로지: OnboardingContext, FirstClassStrategy, LearningContextIntegration
#
# 포괄형 질문 2: "이 학생의 성향과 목표를 기반으로, 커리큘럼과 루틴을 어떤 방향으로 최적화해야 할까?"
#   - 연계 룰: Q2_comprehensive_curriculum_routine_optimization (종합 최적화), Q2_progress_priority_by_goals (진도 우선순위),
#             Q2_learning_flow_by_style (학습 흐름), Q2_problem_type_ratio_by_confidence (문제 유형 비중),
#             Q2_parent_involvement_integration (부모 개입 통합), S2_R1~S2_R5 (수업 전 학습 설계), S3_R1~S3_R4 (진도 판단)
#   - 데이터 소스: short_term_goal, mid_term_goal, long_term_goal, study_style, math_learning_style, math_confidence, 
#                 stress_level, parent_style, weekly_hours, concept_progress, advanced_progress, exam_style
#   - 출력: 진도별 우선순위, 학습 흐름, 문제 유형 비중 조절 등 커스터마이징 설계
#   - 온톨로지: CurriculumOptimization, RoutineCustomization, GoalBasedCurriculum
#   - 연계 에이전트: Agent 03 (목표 분석), Agent 05 (감정), Agent 09 (학습관리), Agent 18 (시그너처루틴)
#
# 포괄형 질문 3: "이 학생이 중장기적으로 성장하기 위해 지금부터 어떤 부분을 특히 신경 써야 할까?"
#   - 연계 룰: Q3_comprehensive_long_term_growth_strategy (종합 성장 전략), Q3_competition_prep_risk_assessment (경시 준비),
#             Q3_university_goal_alignment (진학 목표), Q3_math_confidence_growth_strategy (자존감 성장),
#             Q3_fatigue_accumulation_prevention (피로 방지), Q3_routine_sustainability_check (루틴 유지),
#             Q3_early_risk_prediction_comprehensive (조기 리스크 예측), S3_R1~S3_R4 (진도 판단), C1~C3 (복합 상황 대응)
#   - 데이터 소스: long_term_goal, math_confidence, stress_level, weekly_hours, exam_style, parent_style,
#                 math_level, concept_progress, advanced_progress, academy_experience
#   - 출력: 조기 리스크 예측 및 트래킹 우선요소 추천
#   - 온톨로지: LongTermGrowthStrategy, RiskPrediction, RoutineSustainability, MathConfidenceGrowth
#   - 연계 에이전트: Agent 03 (목표), Agent 05 (감정), Agent 09 (학습관리), Agent 12 (휴식), Agent 13 (이탈 방지), Agent 18 (루틴)
#
# 자세한 데이터 기반 질문 정의는 data_based_questions.js의 agent01 섹션을 참조하세요.
