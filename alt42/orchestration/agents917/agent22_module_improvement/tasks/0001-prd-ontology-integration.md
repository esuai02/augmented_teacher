# PRD: Agent22 Module Improvement 온톨로지 통합

**생성일**: 2025-01-27  
**버전**: 1.0  
**상태**: 초안

---

## 1. Introduction/Overview

Agent22 Module Improvement UI (`index.php`)는 21개 에이전트를 실행하는 통합 인터페이스입니다. 현재 Agent01(온보딩)만 온톨로지 기반으로 동작하고 있으며, 나머지 에이전트들은 온톨로지 없이 동작하고 있습니다. 

이 PRD는 Agent22 Module Improvement UI와 모든 에이전트가 온톨로지 기반으로 완전히 동작하도록 하는 통합 작업을 정의합니다.

### 문제 정의

1. **온톨로지 파일과 실행 코드 간의 연결 부재**: `agent22.owl` 파일은 존재하지만 실제로 로드되거나 사용되지 않음
2. **에이전트별 온톨로지 엔진 부재**: Agent01 외 다른 에이전트들은 온톨로지 엔진이 없음
3. **온톨로지 액션 미처리**: Rules.yaml에 정의된 온톨로지 액션들이 실제로 처리되지 않음
4. **온톨로지 인스턴스 미생성**: 온톨로지 기반 지식 객체가 생성되지 않음
5. **온톨로지 기반 추론 미수행**: 의미 기반 추론이 수행되지 않음

---

## 2. Goals

1. **Agent22 Module Improvement UI의 온톨로지 통합**
   - 모든 에이전트가 온톨로지 기반으로 동작하도록 통합
   - 온톨로지 파일(.owl) 로드 및 검증 기능 구현

2. **범용 온톨로지 엔진 구축**
   - Agent01의 OntologyEngine을 기반으로 범용 온톨로지 엔진 구축
   - 모든 에이전트가 공통으로 사용할 수 있는 온톨로지 엔진 제공

3. **온톨로지 액션 처리 시스템 구축**
   - Rules.yaml의 온톨로지 액션을 실제로 처리하는 시스템 구축
   - `create_instance`, `reason_over`, `generate_strategy` 등 액션 처리

4. **온톨로지 인스턴스 관리 시스템 구축**
   - 온톨로지 인스턴스 생성, 조회, 업데이트, 삭제 기능
   - JSON-LD 형식으로 인스턴스 저장 및 관리

5. **온톨로지 기반 추론 엔진 구축**
   - 온톨로지 그래프 탐색 기반 추론
   - 제약조건 검증 및 의미 기반 추론

---

## 3. User Stories

### US-1: 에이전트 개발자로서
**As a** 에이전트 개발자  
**I want** 온톨로지 엔진을 쉽게 사용할 수 있도록  
**So that** 새로운 에이전트를 개발할 때 온톨로지 기반 기능을 빠르게 통합할 수 있다

### US-2: 시스템 관리자로서
**As a** 시스템 관리자  
**I want** 모든 에이전트가 온톨로지 기반으로 동작하도록  
**So that** 시스템의 일관성과 확장성을 확보할 수 있다

### US-3: 사용자로서
**As a** 사용자  
**I want** 에이전트가 온톨로지 기반으로 더 정확하고 의미 있는 답변을 제공하도록  
**So that** 더 나은 학습 경험을 얻을 수 있다

### US-4: 데이터 분석가로서
**As a** 데이터 분석가  
**I want** 온톨로지 인스턴스가 생성되고 관리되도록  
**So that** 학습 데이터를 구조화된 형태로 분석할 수 있다

---

## 4. Functional Requirements

### FR-1: 온톨로지 파일 로드 및 검증
- **FR-1.1**: 시스템은 각 에이전트의 온톨로지 파일(.owl)을 로드할 수 있어야 함
- **FR-1.2**: 시스템은 온톨로지 파일의 유효성을 검증할 수 있어야 함
- **FR-1.3**: 시스템은 온톨로지 파일이 없거나 손상된 경우 적절한 에러 메시지를 제공해야 함

### FR-2: 범용 온톨로지 엔진
- **FR-2.1**: 시스템은 모든 에이전트가 공통으로 사용할 수 있는 온톨로지 엔진을 제공해야 함
- **FR-2.2**: 온톨로지 엔진은 에이전트별 온톨로지 파일을 동적으로 로드할 수 있어야 함
- **FR-2.3**: 온톨로지 엔진은 온톨로지 인스턴스 생성, 조회, 업데이트, 삭제 기능을 제공해야 함

### FR-3: 온톨로지 액션 처리
- **FR-3.1**: 시스템은 Rules.yaml에 정의된 `create_instance` 액션을 처리할 수 있어야 함
- **FR-3.2**: 시스템은 Rules.yaml에 정의된 `set_property` 액션을 처리할 수 있어야 함
- **FR-3.3**: 시스템은 Rules.yaml에 정의된 `reason_over` 액션을 처리할 수 있어야 함
- **FR-3.4**: 시스템은 Rules.yaml에 정의된 `generate_strategy` 액션을 처리할 수 있어야 함
- **FR-3.5**: 시스템은 Rules.yaml에 정의된 `generate_procedure` 액션을 처리할 수 있어야 함

### FR-4: 온톨로지 인스턴스 관리
- **FR-4.1**: 시스템은 온톨로지 인스턴스를 JSON-LD 형식으로 저장할 수 있어야 함
- **FR-4.2**: 시스템은 학생별로 온톨로지 인스턴스를 조회할 수 있어야 함
- **FR-4.3**: 시스템은 온톨로지 인스턴스를 업데이트할 수 있어야 함
- **FR-4.4**: 시스템은 온톨로지 인스턴스 간의 관계를 설정할 수 있어야 함

### FR-5: 온톨로지 기반 추론
- **FR-5.1**: 시스템은 온톨로지 그래프를 탐색하여 의미 기반 추론을 수행할 수 있어야 함
- **FR-5.2**: 시스템은 온톨로지 제약조건을 검증할 수 있어야 함
- **FR-5.3**: 시스템은 추론 결과를 응답에 반영할 수 있어야 함

### FR-6: 에이전트 통합
- **FR-6.1**: 시스템은 Agent01 외 다른 에이전트들도 온톨로지 엔진을 사용할 수 있도록 통합해야 함
- **FR-6.2**: 시스템은 에이전트별 온톨로지 파일 경로를 자동으로 찾을 수 있어야 함
- **FR-6.3**: 시스템은 에이전트별 온톨로지 액션을 자동으로 감지하고 처리할 수 있어야 함

### FR-7: 에러 처리 및 로깅
- **FR-7.1**: 시스템은 온톨로지 관련 에러를 명확하게 로깅해야 함
- **FR-7.2**: 시스템은 에러 발생 시 파일 경로와 라인 번호를 포함한 상세 정보를 제공해야 함
- **FR-7.3**: 시스템은 온톨로지 액션 실패 시 기본 동작을 유지해야 함

---

## 5. Non-Goals (Out of Scope)

1. **Python 룰 엔진의 온톨로지 파서 통합**: 이번 작업에서는 PHP 레벨에서의 온톨로지 처리에 집중하며, Python 룰 엔진의 온톨로지 파서 통합은 별도 작업으로 분리
2. **온톨로지 파일 생성/수정 기능**: 온톨로지 파일은 이미 존재하는 것으로 가정하며, 생성/수정 기능은 포함하지 않음
3. **온톨로지 시각화 기능**: 온톨로지 그래프 시각화는 이번 작업 범위에 포함하지 않음
4. **온톨로지 버전 관리**: 온톨로지 파일의 버전 관리 기능은 별도 작업으로 분리
5. **다른 에이전트의 Rules.yaml 수정**: 다른 에이전트의 Rules.yaml에 온톨로지 액션을 추가하는 작업은 별도 작업으로 분리

---

## 6. Design Considerations

### 6.1 아키텍처 설계

```
[Agent Garden UI (index.php)]
    ↓
[Agent Garden Controller]
    ↓
[Agent Garden Service]
    ↓
[Universal Ontology Engine] ← [Agent-specific Ontology Files (.owl)]
    ↓
[Ontology Action Handler]
    ↓
[Ontology Instance Storage (DB)]
```

### 6.2 파일 구조

```
agent22_module_improvement/
├── ui/
│   ├── index.php (기존)
│   ├── agent_garden.controller.php (기존)
│   ├── agent_garden.service.php (수정)
│   └── ...
├── ontology/
│   ├── UniversalOntologyEngine.php (신규)
│   ├── OntologyActionHandler.php (신규, Agent01 기반)
│   ├── OntologyFileLoader.php (신규)
│   └── OntologyValidator.php (신규)
└── ...
```

### 6.3 데이터베이스 스키마

기존 `alt42_ontology_instances` 테이블을 활용하되, 에이전트별 구분을 위한 `agent_id` 컬럼 추가 검토

---

## 7. Technical Considerations

### 7.1 기술 스택
- **PHP**: 7.1.9
- **MySQL**: 5.7
- **온톨로지 형식**: OWL 2.0 (RDF/XML)
- **인스턴스 저장 형식**: JSON-LD

### 7.2 의존성
- Agent01의 `OntologyEngine.php`를 기반으로 범용 엔진 구축
- `ontology_engineering/modules/` 디렉토리의 온톨로지 파일들 활용

### 7.3 성능 고려사항
- 온톨로지 파일은 메모리에 캐싱하여 반복 로드 방지
- 인스턴스 조회 시 인덱스 활용

### 7.4 보안 고려사항
- 온톨로지 파일 경로 검증
- SQL 인젝션 방지 (Moodle DB API 활용)

---

## 8. Success Metrics

1. **온톨로지 파일 로드 성공률**: 100% (모든 에이전트의 온톨로지 파일이 정상적으로 로드됨)
2. **온톨로지 액션 처리 성공률**: 95% 이상 (온톨로지 액션이 정상적으로 처리됨)
3. **온톨로지 인스턴스 생성률**: Rules.yaml에 정의된 모든 `create_instance` 액션이 인스턴스를 생성함
4. **에러 발생률**: 5% 이하 (온톨로지 관련 에러가 전체 요청의 5% 이하)
5. **응답 시간**: 기존 대비 20% 이내 증가 (온톨로지 처리로 인한 성능 저하 최소화)

---

## 9. Open Questions

1. **에이전트별 온톨로지 파일 경로 규칙**: 모든 에이전트가 동일한 경로 규칙을 따르는가?
2. **온톨로지 인스턴스 저장소**: 기존 `alt42_ontology_instances` 테이블을 그대로 사용할 것인가, 아니면 에이전트별로 분리할 것인가?
3. **온톨로지 파일 버전 관리**: 온톨로지 파일이 업데이트될 경우 기존 인스턴스와의 호환성은 어떻게 보장할 것인가?
4. **온톨로지 추론 성능**: 대량의 인스턴스가 있을 경우 추론 성능은 어떻게 보장할 것인가?
5. **에이전트별 온톨로지 액션 정의**: 모든 에이전트가 동일한 온톨로지 액션을 사용하는가, 아니면 에이전트별로 다른 액션이 필요한가?

---

**PRD 작성일**: 2025-01-27  
**작성자**: AI Assistant  
**검토 필요**: 예

