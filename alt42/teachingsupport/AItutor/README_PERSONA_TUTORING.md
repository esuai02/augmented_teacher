# 페르소나 기반 맞춤 지도 시스템

페르소나 식별 및 스위칭을 통한 맞춤형 지도 시스템

## 주요 기능

### 1. 자동 페르소나 식별
- 학생의 상호작용 히스토리 분석
- 행동 패턴 매칭 점수 계산
- 가장 적합한 페르소나 자동 식별

### 2. 실시간 페르소나 스위칭
- 지도 중 상호작용 변화 감지
- 새로운 페르소나 점수 재평가
- 임계값(15%) 초과 시 자동 스위칭
- 스위칭 이벤트 기록

### 3. 맞춤형 지도 전략
- 페르소나별 응답 톤 조정
- 페르소나별 개입 전략 적용
- 페르소나별 질문 및 제안 생성
- 페르소나별 다음 단계 결정

## 작동 흐름

```
사용자 입력
  ↓
페르소나 식별/업데이트
  ↓
페르소나 스위칭 확인
  ↓
개입 전략 결정
  ↓
맞춤형 응답 생성
  ↓
페르소나별 지도 적용
  ↓
결과 반환
```

## 페르소나별 맞춤 지도 특징

### 막힘-회피형 (P001)
- **톤**: 지원적
- **접근**: 단계별 분해, 시각적 가이드
- **질문**: "어느 부분이 막히나요?", "이 단계만 먼저 해볼까요?"
- **다음 단계**: 문제를 작은 단위로 나누어 풀기

### 확인요구형 (P002)
- **톤**: 격려적
- **접근**: 진행도 피드백 강화
- **질문**: "지금까지 잘하고 있어요. 다음 단계는?"
- **다음 단계**: 스몰 스텝 성공 경험 축적

### 감정출렁형 (P003)
- **톤**: 공감적
- **접근**: 즉시 공감, 정서 레이블링
- **질문**: "아, 좀 어려웠나요? 괜찮아요."
- **다음 단계**: 난이도 미세조절로 안정감 확보

### 빠른데 허술형 (P004)
- **톤**: 구조화된
- **접근**: 검증 루틴 도입
- **질문**: "잠깐, 마지막 10초만 검증해볼까요?"
- **다음 단계**: 마지막 10초 검증 루틴 실행

### 집중 튐형 (P005)
- **톤**: 집중 유도
- **접근**: 시선 리다이렉션, 하이라이트 가이드
- **질문**: "여기를 집중해서 봐볼까요?"
- **다음 단계**: 시선 리다이렉션 및 하이라이트 가이드

### 패턴추론형 (P006)
- **톤**: 지적
- **접근**: 구조 먼저 제시, 원리 탐색
- **질문**: "전체 구조는 이렇습니다."
- **다음 단계**: 심화 문제 제공

### 최대한 쉬운길 찾기형 (P007)
- **톤**: 효율적
- **접근**: 핵심 규칙 20% 먼저 제시
- **질문**: "핵심 규칙은 이것이에요."
- **다음 단계**: 유형화 기반 반복

### 불안과몰입형 (P008)
- **톤**: 진정시키는
- **접근**: 시간제한, 확인 규칙
- **질문**: "5분만 더 확인하고 넘어가볼까요?"
- **다음 단계**: 확인 시간 제한

### 추상-언어 약함형 (P009)
- **톤**: 구체적
- **접근**: 예시 → 규칙 → 적용 순서
- **질문**: "예시를 하나 더 볼까요?"
- **다음 단계**: 다양한 구체적 사례 제공

### 상호작용 의존형 (P010)
- **톤**: 상호작용적
- **접근**: 외부 자극 제공, 단계별 피드백
- **질문**: "다음 단계는 이거예요."
- **다음 단계**: 지속적인 상호작용 유지

### 무기력·저동기형 (P011)
- **톤**: 동기부여
- **접근**: 초단위 목표, 즉각 강화
- **질문**: "지금 막힌 이유가 뭘까요?", "이 한 문제만 풀어볼까요?"
- **다음 단계**: 작은 성공 경험 제공

### 메타인지 고수형 (P012)
- **톤**: 도전적
- **접근**: 고난도 전략, 심화 학습
- **질문**: "다른 방법으로도 풀어볼까요?", "이 문제의 핵심은 무엇일까요?"
- **다음 단계**: 도전적 과제 제시

## 페르소나 스위칭

### 스위칭 조건
- 현재 페르소나와 다른 페르소나가 더 높은 점수
- 점수 차이가 임계값(15%) 초과
- 자동으로 페르소나 변경 및 저장

### 스위칭 기록
- `persona_switches` 테이블에 기록
- 이전 페르소나 → 새 페르소나
- 점수 차이 및 컨텍스트 저장

## 사용 예시

```php
require_once('includes/persona_based_tutoring.php');

$tutoringEngine = new PersonaBasedTutoring($rules, $ontology, $context);

// 페르소나 기반 맞춤 지도 처리
$result = $tutoringEngine->processPersonaBasedTutoring(
    $userInput,
    $studentId,
    $currentState
);

// 결과
// - response: 맞춤형 응답
// - persona: 현재 페르소나 정보 (스위칭 여부 포함)
// - intervention_strategy: 개입 전략
// - customized_guidance: 맞춤 지도 정보
// - next_steps: 페르소나별 다음 단계
```

## API 사용

```javascript
// 페르소나 기반 맞춤 지도
const response = await fetch('api/interact.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        user_input: '몰라요...',
        student_id: 1,
        rules: [...],
        ontology: {...},
        context: {...}
    })
});

const result = await response.json();

// 페르소나 정보
console.log(result.data.persona.current); // 현재 페르소나
console.log(result.data.persona.switched); // 스위칭 여부
console.log(result.data.customized_guidance); // 맞춤 지도 정보
```

## 데이터 저장

- **페르소나 매칭**: `student_personas` 테이블
- **페르소나 스위칭**: `persona_switches` 테이블
- **상호작용 히스토리**: `interactions` 테이블

## 주의사항

- 페르소나 스위칭은 점수 차이가 15% 이상일 때만 발생
- 스위칭이 너무 빈번하면 안정성 저하 가능
- 페르소나 히스토리를 통해 변화 추적 가능

