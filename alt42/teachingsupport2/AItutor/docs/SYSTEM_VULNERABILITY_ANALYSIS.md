# AI 튜터 시스템 취약점 분석

## 분석 대상
현재 룰과 온톨로지가 **12가지 학습자 페르소나**와 **42가지 개입 활동**에 기반한 상황별 대응에서 취약한 부분을 분석

---

## 1. 룰 시스템 취약점

### 1.1 정적 조건-액션 구조의 한계

**현재 구조**:
```php
// rule_evaluator.php
"conditions": [{"field": "field_name", "operator": "==", "value": "value"}],
"action": ["action1", "action2"]
```

**취약점**:
| 문제 | 설명 | 영향 |
|------|------|------|
| **실시간 상태 변화 미반영** | 조건이 스냅샷 기반으로 평가됨 | 감정 변화(P003)나 집중력 저하(P005) 감지 불가 |
| **시간적 패턴 미지원** | "3초 이상 멈춤", "5초 이상 멈춤" 등 시간 조건 없음 | 인지 부하 대기(INT_1_1) 트리거 불가능 |
| **행동 시퀀스 미분석** | 단일 입력만 평가 | "지우기 3회 이상"(필기 기반 튜터) 감지 불가 |
| **OR 조건 제한** | 중첩 OR 조건 지원이 불완전 | 복합 트리거 신호 처리 어려움 |

**개선 필요**:
```yaml
# 시간 기반 조건 추가 필요
conditions:
  - type: temporal
    field: pause_duration
    operator: ">="
    value: 5  # 5초 이상 멈춤
  - type: sequence
    field: erase_count
    operator: ">="
    value: 3  # 지우기 3회 이상
```

---

### 1.2 페르소나-룰 연결 부재

**현재 상태**:
```php
// openai_analyzer.php - 시스템 프롬프트
"teaching_rules": [
  {
    "rule_id": "U0_R1_prerequisite_check",
    "priority": 99,
    "conditions": [...],
    "action": [...]
  }
]
// 페르소나 정보 없음!
```

**취약점**:
| 문제 | 설명 |
|------|------|
| **페르소나별 룰 가중치 없음** | 같은 룰이 모든 페르소나에 동일 적용 |
| **룰 생성 시 페르소나 미고려** | OpenAI 분석에서 페르소나 정보 미제공 |
| **동적 룰 우선순위 미지원** | P003(감정출렁형)에게 정서 조절 룰 우선 적용 불가 |

**현재 intervention_manager.php의 persona_mapping**:
```php
'persona_mapping' => ['P001', 'P005', 'P009']
```
→ 개입 활동에는 페르소나 매핑이 있으나, **생성되는 교수법 룰에는 없음**

---

### 1.3 룰 간 상호작용 부재

**취약점**:
- 룰 간 충돌 해결 메커니즘 없음
- 룰 체이닝 (A 룰 → B 룰 트리거) 미지원
- 룰 실행 결과 피드백 루프 없음

**예시 상황**:
```
P004(빠른데 허술형) 학생에게:
1. INT_6_1 즉시 교정 룰 → "잠깐! 계산 오류"
2. INT_7_1 노력 인정 룰 → "열심히 생각했네"

→ 두 룰이 동시 매칭 시 어떤 것을 먼저 적용할지 결정 로직 없음
```

---

## 2. 온톨로지 취약점

### 2.1 정적 OIW 모델

**현재 구조**:
```json
"ontology": {
  "will": { "core": [...], "constraints": [...] },
  "intent": { "session_goal": "...", "short_term": "...", "long_term": "..." },
  "reasoning": { "cosmology": {...} },
  "ontology": [{ "class": "mk:UnitLearningContext", "stage": "Context", ... }]
}
```

**취약점**:
| 계층 | 문제 | 영향 |
|------|------|------|
| **Will Layer** | 세션 시작 시 1회 설정 | 학생 상태 변화에 따른 동적 가치 조정 불가 |
| **Intent Layer** | goal이 고정됨 | P011(무기력형)의 "초단위 목표"로 전환 불가 |
| **Reasoning Layer** | cosmology가 추상적 | 구체적 추론 규칙으로 변환 미흡 |
| **Ontology Nodes** | Context 노드만 주로 생성 | Decision/Execution 노드 자동 생성 부족 |

---

### 2.2 페르소나-온톨로지 매핑 부재

**현재 상태**:
- 온톨로지에 학생 페르소나 정보 미포함
- 페르소나 변화가 온톨로지에 반영되지 않음

**필요한 구조**:
```json
{
  "id": "AIT_StudentPersonaContext",
  "class": "mk:StudentPersonaContext",
  "stage": "Context",
  "properties": {
    "hasCurrentPersona": "P003",
    "personaConfidence": 0.85,
    "recentSwitches": ["P001→P003"],
    "triggerPatterns": ["감정출렁", "표정다운"]
  }
}
```

---

### 2.3 동적 온톨로지 업데이트 부재

**현재 코드 (interaction_engine.php)**:
```php
private function updateOntologyFromContext() {
    // 컨텍스트 변경사항을 온톨로지에 반영
    if (isset($this->context['current_unit']) && isset($this->ontology['ontology'])) {
        foreach ($this->ontology['ontology'] as &$node) {
            if ($node['class'] === 'mk:UnitLearningContext') {
                $node['properties']['hasCurrentUnit'] = $this->context['current_unit'];
            }
        }
    }
}
```

**취약점**:
- `current_unit`만 업데이트
- 페르소나 변화, 이해도 변화, 감정 상태 등 미반영
- 새로운 온톨로지 노드 동적 생성 불가

---

## 3. 페르소나 식별/스위칭 취약점

### 3.1 단순 키워드 매칭 의존

**현재 코드 (persona_based_tutoring.php)**:
```php
private function extractTriggerSignals($userInput, $currentState) {
    $signalPatterns = [
        '네?' => '되묻기',
        '다시요?' => '되묻기',
        '모르겠어요' => '막연한 모름',
        // ...
    ];
    
    foreach ($signalPatterns as $pattern => $signal) {
        if (stripos($inputLower, $pattern) !== false) {
            $signals[] = $signal;
        }
    }
}
```

**취약점**:
| 문제 | 설명 |
|------|------|
| **정확한 표현만 매칭** | "잘 모르겠어요" → 매칭 실패 |
| **맥락 무시** | "모르겠어요"가 질문인지 포기인지 구분 불가 |
| **비언어적 신호 미감지** | 시선, 표정, 멈춤 시간 등 미분석 |
| **LLM 활용 부재** | 의미론적 분석 없음 |

---

### 3.2 스위칭 로직 단순화

**현재 코드**:
```php
$scoreDiff = ($newScore - $currentScore) / max($newScore, 1);

if ($scoreDiff > $this->switchingThreshold) { // 0.15
    $this->currentPersona = $topMatch['persona'];
}
```

**취약점**:
- 점수 차이만으로 스위칭 결정
- 스위칭 빈도 제한 없음 (과도한 스위칭 가능)
- 스위칭 후 적응 기간 고려 없음
- 컨텍스트 연속성 미보장

---

## 4. 상황별 대응 취약점

### 4.1 트리거 신호 추출 한계

**42개 개입 활동의 트리거 신호 vs 현재 감지 가능 신호**:

| 트리거 신호 (필요) | 현재 감지 가능 | 갭 |
|------------------|--------------|-----|
| 눈 깜빡임 증가 | ❌ | 비전 분석 필요 |
| 시선 고정 | ❌ | 아이트래킹 필요 |
| 멍한 표정 | ❌ | 비전 분석 필요 |
| 고개 숙임 | ❌ | 비전 분석 필요 |
| 펜 움직임 | ❌ | 필기 패턴 분석 필요 |
| 한숨 | ❌ | 오디오 분석 필요 |
| 펜 내려놓음 | ❌ | 필기 패턴 분석 필요 |
| "네?", "다시요?" | ⭕ | 텍스트 매칭 |
| "모르겠어요" | ⭕ | 텍스트 매칭 |
| 3~5초 멈춤 | ❌ | 시간 추적 필요 |

**결론**: 42개 개입 활동 중 **텍스트 기반 트리거만 약 30% 감지 가능**

---

### 4.2 시간적 패턴 분석 부재

**필기 기반 튜터 설계의 요구사항**:
```
| 상황 | AI 행동 |
|------|---------|
| 멈춤 3초 | 관찰만 |
| 멈춤 5초 | 여백에 "생각 중?" 표시 |
| 멈춤 10초 | "막혔으면 ? 그려줘" |
| 멈춤 15초 + 무반응 | "힌트 줄까?" |
```

**현재 시스템**: 시간 기반 조건 처리 완전 부재

---

### 4.3 맥락적 상황 인식 부족

**예시: "모르겠어요"의 다양한 맥락**

| 맥락 | 의미 | 필요한 개입 |
|------|------|------------|
| 문제 읽은 직후 | 시작점 모름 | INT_5_5 힌트 질문 |
| 풀이 중간 | 진행 막힘 | INT_2_3 단계 분해 |
| 반복 실패 후 | 포기 신호 | INT_7_1 노력 인정 |
| 설명 들은 직후 | 이해 불가 | INT_2_1 동일 반복 |

**현재 시스템**: 모든 "모르겠어요"에 동일 대응

---

## 5. 개입 활동(42개) 실행 취약점

### 5.1 개입 활동 선택 로직 단순화

**현재 코드 (intervention_manager.php)**:
```php
public function selectInterventionBySignals($signals, $personaId = null) {
    foreach ($allInterventions as $intervention) {
        // 트리거 신호 매칭
        foreach ($signals as $signal) {
            if (stripos($trigger, $signal) !== false) {
                $score += 3;
            }
        }
        // 페르소나 매칭
        if ($personaId && in_array($personaId, $intervention['persona_mapping'])) {
            $score += 5;
        }
    }
}
```

**취약점**:
- 단순 문자열 매칭
- 개입 효과 이력 미반영
- 개입 간 시너지/충돌 미고려
- 학생별 개입 효과 학습 없음

---

### 5.2 개입 효과 피드백 부재

**현재 상태**:
```php
return $db->insert('intervention_executions', [
    'effectiveness' => 0.5, // 기본값, 나중에 업데이트
]);
```

**필요한 구조**:
- 개입 후 학생 반응 추적
- 효과성 점수 업데이트
- 학생별 개입 효과 프로파일 구축
- 효과 높은 개입 우선 선택

---

## 6. 개선 우선순위 제안

### 즉시 개선 (High Priority)

| # | 항목 | 영향도 | 난이도 |
|---|------|--------|--------|
| 1 | 시간 기반 조건 추가 | 높음 | 중 |
| 2 | 페르소나-룰 가중치 연결 | 높음 | 중 |
| 3 | LLM 기반 트리거 신호 분석 | 높음 | 중 |
| 4 | 온톨로지 페르소나 노드 추가 | 중 | 낮음 |

### 중기 개선 (Medium Priority)

| # | 항목 | 영향도 | 난이도 |
|---|------|--------|--------|
| 5 | 개입 효과 피드백 루프 | 높음 | 높음 |
| 6 | 스위칭 로직 고도화 | 중 | 중 |
| 7 | 동적 온톨로지 업데이트 | 중 | 높음 |
| 8 | 맥락적 트리거 분석 | 높음 | 높음 |

### 장기 개선 (Low Priority)

| # | 항목 | 영향도 | 난이도 |
|---|------|--------|--------|
| 9 | 비전 기반 신호 감지 | 높음 | 매우 높음 |
| 10 | 필기 패턴 실시간 분석 | 높음 | 매우 높음 |
| 11 | 개입 간 시너지 모델링 | 중 | 높음 |

---

## 7. 권장 아키텍처 개선안

### 7.1 확장된 룰 구조

```yaml
rule:
  id: "R001_cognitive_pause"
  priority: 95
  
  # 시간 기반 조건 추가
  conditions:
    - type: temporal
      field: pause_duration
      operator: ">="
      value: 5
    - type: persona
      field: current_persona
      operator: "in"
      value: ["P001", "P005", "P009"]
    - type: context
      field: last_input_type
      operator: "=="
      value: "question"
  
  # 페르소나별 가중치
  persona_weights:
    P001: 1.5  # 막힘-회피형에 1.5배 적용
    P005: 1.3
    P009: 1.2
  
  # 개입 활동 연결
  interventions:
    primary: "INT_1_1"  # 인지 부하 대기
    fallback: "INT_1_3"  # 사고 여백 제공
  
  # 효과 추적
  effectiveness:
    track: true
    feedback_window: "30s"
```

### 7.2 확장된 온톨로지 구조

```json
{
  "ontology": {
    "persona_context": {
      "class": "mk:StudentPersonaContext",
      "current_persona": "P003",
      "confidence": 0.85,
      "switch_history": ["P001", "P002", "P003"],
      "trigger_patterns": {
        "emotional": 0.8,
        "cognitive": 0.3
      }
    },
    "temporal_context": {
      "class": "mk:TemporalContext",
      "last_input_time": "2025-01-27T10:30:00",
      "pause_duration": 5.2,
      "interaction_pace": "slow",
      "session_duration": 1200
    },
    "intervention_context": {
      "class": "mk:InterventionContext",
      "last_intervention": "INT_7_1",
      "intervention_count": 3,
      "effectiveness_trend": "improving"
    }
  }
}
```

---

## 8. 결론

현재 시스템은 **기본적인 룰-온톨로지 구조**를 갖추고 있으나, **12가지 페르소나**와 **42가지 개입 활동**을 효과적으로 활용하기 위해서는 다음 핵심 개선이 필요합니다:

1. **시간 기반 조건 처리** 추가
2. **페르소나-룰 연결** 강화
3. **LLM 기반 맥락 분석** 도입
4. **개입 효과 피드백 루프** 구축
5. **동적 온톨로지 업데이트** 메커니즘

---

**작성일**: 2025-01-27  
**분석 대상 버전**: 2.0 (MySQL 버전)

