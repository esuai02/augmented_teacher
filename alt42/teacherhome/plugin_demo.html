<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTM í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë°ëª¨</title>
    <link rel="stylesheet" href="plugin_settings_styles.css">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 24px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header p {
            margin: 8px 0 0 0;
            color: #64748b;
            font-size: 16px;
        }
        
        .main-content {
            padding: 40px 0;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 40px;
        }
        
        .demo-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #f1f5f9;
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 20px;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-content {
            padding: 24px;
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #475569;
            transition: all 0.2s ease;
        }
        
        .quick-action-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .quick-action-btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .quick-action-btn.primary:hover {
            background: #2563eb;
            border-color: #2563eb;
        }
        
        .plugin-examples {
            display: grid;
            gap: 16px;
        }
        
        .example-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .example-card:hover {
            background: #f1f5f9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .example-card h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .example-card p {
            margin: 0 0 12px 0;
            color: #64748b;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .code-snippet {
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px 16px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 12px 0;
            white-space: pre;
            line-height: 1.5;
        }
        
        .try-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 6px 12px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .try-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .info-box {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            margin: 0 0 8px 0;
            color: #1d4ed8;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-box ul {
            margin: 0;
            padding-left: 24px;
            color: #3730a3;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 20px;
            font-size: 13px;
            color: #14532d;
            margin-left: auto;
        }
        
        .status-indicator::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #22c55e;
            border-radius: 50%;
            display: inline-block;
        }
        
        .debug-console {
            background: #0f172a;
            color: #94a3b8;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .debug-line {
            margin: 4px 0;
            padding: 2px 0;
        }
        
        .debug-time {
            color: #64748b;
            margin-right: 12px;
        }
        
        .debug-success {
            color: #34d399;
        }
        
        .debug-error {
            color: #f87171;
        }
        
        .debug-info {
            color: #60a5fa;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .quick-action-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>
                ğŸ”Œ KTM í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë°ëª¨
                <span class="status-indicator">ì‹œìŠ¤í…œ í™œì„±</span>
            </h1>
            <p>í”ŒëŸ¬ê·¸ì¸ì„ ìƒì„±í•˜ê³  í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” í†µí•© ë°ëª¨ í˜ì´ì§€ì…ë‹ˆë‹¤</p>
        </div>
    </div>
    
    <div class="main-content">
        <div class="container">
            <div class="demo-grid">
                <div class="demo-section">
                    <div class="section-header">
                        <h2>ğŸ›ï¸ í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬</h2>
                    </div>
                    <div class="section-content">
                        <div class="info-box">
                            <h3>ğŸ“Œ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ</h3>
                            <ul>
                                <li>ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìƒ˜í”Œ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</li>
                                <li>ìƒì„±ëœ í”ŒëŸ¬ê·¸ì¸ì„ ëª©ë¡ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                <li>í¸ì§‘ ë²„íŠ¼ìœ¼ë¡œ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                <li>PHP ì—ì´ì „íŠ¸ëŠ” ì„œë²„ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤</li>
                            </ul>
                        </div>
                        
                        <div class="quick-actions">
                            <button class="quick-action-btn primary" onclick="clearAllPlugins()">
                                ğŸ—‘ï¸ ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ ì‚­ì œ
                            </button>
                            <button class="quick-action-btn" onclick="addQuickPlugin('internal')">
                                ğŸ”— ë‚´ë¶€ë§í¬ ì¶”ê°€
                            </button>
                            <button class="quick-action-btn" onclick="addQuickPlugin('external')">
                                ğŸŒ ì™¸ë¶€ë§í¬ ì¶”ê°€
                            </button>
                            <button class="quick-action-btn" onclick="addQuickPlugin('message')">
                                ğŸ’¬ ë©”ì‹œì§€ ì¶”ê°€
                            </button>
                            <button class="quick-action-btn" onclick="addQuickPlugin('agent')">
                                ğŸ¤– PHP ì—ì´ì „íŠ¸ ì¶”ê°€
                            </button>
                        </div>
                        
                        <div id="pluginSettingsContainer"></div>
                    </div>
                </div>
                
                <div class="demo-section">
                    <div class="section-header">
                        <h2>ğŸ“š í”ŒëŸ¬ê·¸ì¸ ì˜ˆì œ</h2>
                    </div>
                    <div class="section-content">
                        <div class="plugin-examples">
                            <div class="example-card">
                                <h4>ğŸ§® ì ìˆ˜ í†µê³„ ë¶„ì„ê¸°</h4>
                                <p>í•™ìƒë“¤ì˜ ì ìˆ˜ë¥¼ ë¶„ì„í•˜ì—¬ í‰ê· , ìµœê³ ì , ìµœì €ì ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
                                <div class="code-snippet">$scores = [85, 92, 78, 95, 88];
return [
    'average' => array_sum($scores) / count($scores),
    'max' => max($scores),
    'min' => min($scores)
];</div>
                                <button class="try-btn" onclick="tryExample('score_analyzer')">ì‹¤í–‰</button>
                            </div>
                            
                            <div class="example-card">
                                <h4>ğŸ“… ë‚ ì§œ ê³„ì‚°ê¸°</h4>
                                <p>í˜„ì¬ ë‚ ì§œì™€ íŠ¹ì • ë‚ ì§œ ê°„ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
                                <div class="code-snippet">$target = new DateTime('2024-12-31');
$today = new DateTime();
$diff = $today->diff($target);

return "D-Day: {$diff->days}ì¼";</div>
                                <button class="try-btn" onclick="tryExample('date_calculator')">ì‹¤í–‰</button>
                            </div>
                            
                            <div class="example-card">
                                <h4>ğŸ² ë¡œë˜ ë²ˆí˜¸ ìƒì„±ê¸°</h4>
                                <p>1ë¶€í„° 45ê¹Œì§€ì˜ ìˆ«ì ì¤‘ 6ê°œë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ íƒí•©ë‹ˆë‹¤.</p>
                                <div class="code-snippet">$numbers = range(1, 45);
shuffle($numbers);
$selected = array_slice($numbers, 0, 6);
sort($selected);

return $selected;</div>
                                <button class="try-btn" onclick="tryExample('lotto_generator')">ì‹¤í–‰</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="demo-section">
                <div class="section-header">
                    <h2>ğŸ–¥ï¸ ë””ë²„ê·¸ ì½˜ì†”</h2>
                </div>
                <div class="section-content">
                    <div id="debugConsole" class="debug-console">
                        <div class="debug-line debug-info">
                            <span class="debug-time">[ì‹œìŠ¤í…œ]</span>
                            í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="plugin_settings_client.js"></script>
    <script>
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
        function debugLog(message, type = 'info') {
            const console = document.getElementById('debugConsole');
            const time = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `debug-line debug-${type}`;
            line.innerHTML = `<span class="debug-time">[${time}]</span> ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', async function() {
            const container = document.getElementById('pluginSettingsContainer');
            if (window.ktmPluginSettings) {
                await window.ktmPluginSettings.createPluginSettingsUI(container, 'demo');
                debugLog('í”ŒëŸ¬ê·¸ì¸ ì„¤ì • UIê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                debugLog('í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        });
        
        // ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ ì‚­ì œ
        async function clearAllPlugins() {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            debugLog('ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ ì‚­ì œ ì¤‘...', 'info');
            
            try {
                const container = document.getElementById('pluginSettingsContainer');
                container.innerHTML = '';
                await window.ktmPluginSettings.createPluginSettingsUI(container, 'demo');
                debugLog('ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (error) {
                debugLog('í”ŒëŸ¬ê·¸ì¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message, 'error');
            }
        }
        
        // ë¹ ë¥¸ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€
        async function addQuickPlugin(type) {
            let pluginId, config;
            
            switch(type) {
                case 'internal':
                    pluginId = 'internal_link';
                    config = {
                        plugin_name: 'í•™ìŠµ ëŒ€ì‹œë³´ë“œ',
                        internal_url: '/dashboard',
                        open_new_tab: false
                    };
                    break;
                    
                case 'external':
                    pluginId = 'external_link';
                    config = {
                        plugin_name: 'KTM ë¬¸ì„œ',
                        external_url: 'https://docs.ktm.com',
                        open_new_tab: true
                    };
                    break;
                    
                case 'message':
                    pluginId = 'send_message';
                    config = {
                        plugin_name: 'ì¼ì¼ ë™ê¸°ë¶€ì—¬',
                        message_content: 'ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! ğŸ’ª',
                        message_type: 'success'
                    };
                    break;
                    
                case 'agent':
                    pluginId = 'agent';
                    config = {
                        plugin_name: 'í•™ìŠµ ì§„ë„ ë¶„ì„',
                        agent_type: 'php',
                        agent_code: `// í•™ìŠµ ì§„ë„ ë¶„ì„
$completed = rand(60, 95);
$remaining = 100 - $completed;
$days_left = rand(5, 15);

return [
    'progress' => $completed . '%',
    'remaining' => $remaining . '%',
    'estimated_days' => $days_left,
    'status' => $completed >= 80 ? 'ìš°ìˆ˜' : 'ì–‘í˜¸',
    'message' => "í˜„ì¬ ì§„ë„ìœ¨ì€ {$completed}%ì´ë©°, ì•½ {$days_left}ì¼ í›„ ì™„ë£Œ ì˜ˆì •ì…ë‹ˆë‹¤."
];`,
                        agent_description: 'í˜„ì¬ í•™ìŠµ ì§„ë„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤',
                        agent_parameters: '{}'
                    };
                    break;
            }
            
            debugLog(`${type} í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ ì¤‘...`, 'info');
            
            try {
                const settingName = config.plugin_name.toLowerCase().replace(/\s+/g, '_');
                const result = await window.ktmPluginSettings.saveUserSetting(
                    pluginId,
                    settingName,
                    config,
                    'demo'
                );
                
                if (result.success) {
                    debugLog(`âœ… "${config.plugin_name}" í”ŒëŸ¬ê·¸ì¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    
                    // UI ìƒˆë¡œê³ ì¹¨
                    const container = document.getElementById('pluginSettingsContainer');
                    container.innerHTML = '';
                    await window.ktmPluginSettings.createPluginSettingsUI(container, 'demo');
                } else {
                    debugLog(`í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                debugLog(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        }
        
        // ì˜ˆì œ ì‹¤í–‰
        async function tryExample(exampleType) {
            let code, name;
            
            switch(exampleType) {
                case 'score_analyzer':
                    name = 'ì ìˆ˜ í†µê³„ ë¶„ì„ê¸°';
                    code = `$scores = [85, 92, 78, 95, 88];
return [
    'average' => array_sum($scores) / count($scores),
    'max' => max($scores),
    'min' => min($scores)
];`;
                    break;
                    
                case 'date_calculator':
                    name = 'ë‚ ì§œ ê³„ì‚°ê¸°';
                    code = `$target = new DateTime('2024-12-31');
$today = new DateTime();
$diff = $today->diff($target);

return "D-Day: {$diff->days}ì¼";`;
                    break;
                    
                case 'lotto_generator':
                    name = 'ë¡œë˜ ë²ˆí˜¸ ìƒì„±ê¸°';
                    code = `$numbers = range(1, 45);
shuffle($numbers);
$selected = array_slice($numbers, 0, 6);
sort($selected);

return $selected;`;
                    break;
            }
            
            debugLog(`"${name}" ì˜ˆì œ ì‹¤í–‰ ì¤‘...`, 'info');
            
            try {
                const response = await fetch('execute_agent_code.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: code,
                        parameters: {}
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    debugLog(`âœ… ì‹¤í–‰ ì„±ê³µ: ${JSON.stringify(result.result)}`, 'success');
                    
                    // ê²°ê³¼ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œ
                    if (window.ktmPluginSettings && window.ktmPluginSettings.showAgentResult) {
                        window.ktmPluginSettings.showAgentResult({
                            plugin_name: name,
                            result: result
                        });
                    }
                } else {
                    debugLog(`ì‹¤í–‰ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                debugLog(`ì˜ˆì œ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>