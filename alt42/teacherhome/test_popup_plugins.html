<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plugin Popup Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .info-box {
            background: #e6f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .plugin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .plugin-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .plugin-card:hover {
            background: #e9ecef;
            border-color: #6c757d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .plugin-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .plugin-title {
            font-size: 18px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 5px;
        }
        .plugin-type {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        .plugin-description {
            font-size: 14px;
            color: #495057;
        }
        .status-message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .status-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>í”ŒëŸ¬ê·¸ì¸ íŒì—… í…ŒìŠ¤íŠ¸</h1>
        
        <div class="info-box">
            <strong>í…ŒìŠ¤íŠ¸ ì•ˆë‚´:</strong>
            <p>ì•„ë˜ í”ŒëŸ¬ê·¸ì¸ ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ê° íƒ€ì…ì— ë§ëŠ” íŒì—…ì´ ì—´ë¦½ë‹ˆë‹¤.</p>
            <p>ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ì´ íŒì—…ìœ¼ë¡œ ì—´ë¦¬ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
        
        <div class="plugin-grid">
            <!-- ì—ì´ì „íŠ¸ íƒ€ì… (ìƒë‹´ê´€ë¦¬ ì˜ˆì‹œ) -->
            <div class="plugin-card" onclick="testPlugin('agent', {
                agent_type: 'onboarding_item',
                plugin_name: 'ì‹ ê·œ í•™ìƒ ìƒë‹´ ë° ë ˆë²¨ í…ŒìŠ¤íŠ¸',
                agent_config: {
                    title: 'ê³ 3',
                    description: 'íŒì—…ì°½ì—ì„œ ë©€í‹°í„´ ì‘ì—… ì‹¤í–‰'
                },
                agent_prompt: 'ì‹ ê·œ í•™ìƒì˜ ìƒë‹´ê³¼ ë ˆë²¨ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
            })">
                <div class="plugin-icon">ğŸ¤–</div>
                <div class="plugin-title">ì‹ ê·œ í•™ìƒ ìƒë‹´</div>
                <div class="plugin-type">Agent (ì˜¨ë³´ë”©)</div>
                <div class="plugin-description">íŒì—…ì°½ì—ì„œ ë©€í‹°í„´ ì‘ì—… ì‹¤í–‰</div>
            </div>
            
            <!-- íŒŒì¼ ê¸°ë°˜ ì—ì´ì „íŠ¸ -->
            <div class="plugin-card" onclick="testPlugin('agent', {
                fileName: 'consultation_agent.php',
                plugin_name: 'í•™ìŠµ ìƒë‹´ ì—ì´ì „íŠ¸'
            })">
                <div class="plugin-icon">ğŸ¤–</div>
                <div class="plugin-title">í•™ìŠµ ìƒë‹´ ì—ì´ì „íŠ¸</div>
                <div class="plugin-type">Agent (íŒŒì¼)</div>
                <div class="plugin-description">PHP íŒŒì¼ ê¸°ë°˜ ì—ì´ì „íŠ¸</div>
            </div>
            
            <!-- ê¸°ë³¸ ì¹´ë“œ -->
            <div class="plugin-card" onclick="testPlugin('default_card', {
                url: 'https://mathking.kr/moodle/local/augmented_teacher/alt42/teacherhome/weekly/weekly_report.html',
                plugin_name: 'ì£¼ê°„ ë¦¬í¬íŠ¸'
            })">
                <div class="plugin-icon">ğŸ“‹</div>
                <div class="plugin-title">ì£¼ê°„ ë¦¬í¬íŠ¸</div>
                <div class="plugin-type">Default Card</div>
                <div class="plugin-description">ì£¼ê°„ í•™ìŠµ í˜„í™© ë¦¬í¬íŠ¸</div>
            </div>
            
            <!-- ì™¸ë¶€ ë§í¬ -->
            <div class="plugin-card" onclick="testPlugin('external_link', {
                external_url: 'https://www.mathking.kr',
                plugin_name: 'ë§¤ìŠ¤í‚¹ í™ˆí˜ì´ì§€'
            })">
                <div class="plugin-icon">ğŸŒ</div>
                <div class="plugin-title">ë§¤ìŠ¤í‚¹ í™ˆí˜ì´ì§€</div>
                <div class="plugin-type">External Link</div>
                <div class="plugin-description">ì™¸ë¶€ ì›¹ì‚¬ì´íŠ¸ ë§í¬</div>
            </div>
            
            <!-- ë‚´ë¶€ ë§í¬ -->
            <div class="plugin-card" onclick="testPlugin('internal_link', {
                internal_url: '../studenthome/index.php',
                plugin_name: 'í•™ìƒ í™ˆ'
            })">
                <div class="plugin-icon">ğŸ </div>
                <div class="plugin-title">í•™ìƒ í™ˆ</div>
                <div class="plugin-type">Internal Link</div>
                <div class="plugin-description">ë‚´ë¶€ PHP í˜ì´ì§€</div>
            </div>
            
            <!-- ë©”ì‹œì§€ -->
            <div class="plugin-card" onclick="testPlugin('send_message', {
                message_content: 'ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.',
                message_type: 'success',
                plugin_name: 'í•™ìŠµ ì™„ë£Œ ë©”ì‹œì§€'
            })">
                <div class="plugin-icon">ğŸ’¬</div>
                <div class="plugin-title">í•™ìŠµ ì™„ë£Œ ë©”ì‹œì§€</div>
                <div class="plugin-type">Send Message</div>
                <div class="plugin-description">ì„±ê³µ ë©”ì‹œì§€ íŒì—…</div>
            </div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
    </div>
    
    <script>
        // executePluginAction í•¨ìˆ˜ ë³µì‚¬
        function executePluginAction(pluginId, config) {
            console.log('Executing plugin action:', pluginId, config);
            
            if (pluginId === 'default_card') {
                // ê¸°ë³¸ ì¹´ë“œì— URLì´ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ íŒì—…ìœ¼ë¡œ ì—´ê¸°
                if (config.url) {
                    window.open(config.url, '_blank', 'width=1200,height=800,resizable=yes,scrollbars=yes');
                }
                // URLì´ ì—†ìœ¼ë©´ ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•ŠìŒ
                return;
            } else if (pluginId === 'external_link') {
                if (config.external_url || config.url) {
                    const url = config.external_url || config.url;
                    window.open(url, '_blank', 'width=1200,height=800,resizable=yes,scrollbars=yes');
                }
            } else if (pluginId === 'internal_link') {
                if (config.internal_url || config.url) {
                    const url = config.internal_url || config.url;
                    // ë‚´ë¶€ ë§í¬ë„ íŒì—…ìœ¼ë¡œ ì—´ê¸°
                    window.open(url, '_blank', 'width=1200,height=800,resizable=yes,scrollbars=yes');
                }
            } else if (pluginId === 'send_message') {
                // ë©”ì‹œì§€ ë°œì†¡ ê¸°ëŠ¥ - íŒì—…ìœ¼ë¡œ ë©”ì‹œì§€ í‘œì‹œ
                showTestMessage(config);
                return;
            } else if (pluginId === 'agent') {
                // ì˜¨ë³´ë”© ì¹´ë“œì—ì„œ ë³€í™˜ëœ ì—ì´ì „íŠ¸ íƒ€ì… í™•ì¸
                if (config.agent_type === 'onboarding_item') {
                    // ì˜¨ë³´ë”© ì¹´ë“œ ì—ì´ì „íŠ¸ ì‹¤í–‰
                    showAgentPopupDemo(config);
                    return;
                }
                
                // ê¸°ì¡´ íŒŒì¼ ê¸°ë°˜ ì—ì´ì „íŠ¸
                if (config.fileName) {
                    // ê¸°ë³¸ URL ê²½ë¡œì— íŒŒì¼ëª… ì¶”ê°€
                    const baseUrl = 'https://mathking.kr/moodle/local/augmented_teacher/alt42/teacherhome/agents/';
                    const fullUrl = baseUrl + config.fileName;
                    
                    // ì—ì´ì „íŠ¸ë„ íŒì—…ìœ¼ë¡œ ì—´ê¸°
                    window.open(fullUrl, '_blank', 'width=1200,height=800,resizable=yes,scrollbars=yes');
                }
            }
        }
        
        function testPlugin(pluginId, config) {
            try {
                executePluginAction(pluginId, config);
                showStatus(`${config.plugin_name} í”ŒëŸ¬ê·¸ì¸ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            } catch (error) {
                showStatus(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type}`;
            
            setTimeout(() => {
                statusDiv.className = 'status-message';
            }, 3000);
        }
        
        function showTestMessage(config) {
            alert(`[${config.message_type.toUpperCase()}] ${config.plugin_name}\n\n${config.message_content}`);
        }
        
        function showAgentPopupDemo(config) {
            const popupContent = `
                <h2>${config.plugin_name}</h2>
                <p><strong>íƒ€ì…:</strong> ${config.agent_config.title}</p>
                <p><strong>ì„¤ëª…:</strong> ${config.agent_config.description}</p>
                <p><strong>í”„ë¡¬í”„íŠ¸:</strong> ${config.agent_prompt}</p>
            `;
            
            const popup = window.open('', '_blank', 'width=800,height=600,resizable=yes,scrollbars=yes');
            popup.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${config.plugin_name}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h2 { color: #333; }
                        p { margin: 10px 0; }
                    </style>
                </head>
                <body>${popupContent}</body>
                </html>
            `);
            popup.document.close();
        }
    </script>
</body>
</html>