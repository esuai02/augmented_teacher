<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë“œ í‘œì‹œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .test-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .test-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        .card-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        .card-type {
            font-size: 12px;
            color: #999;
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #cce5ff;
            color: #004085;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ì¹´ë“œ í‘œì‹œ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>1. í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ìƒíƒœ</h2>
        <div id="pluginStatus" class="status info">í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ í™•ì¸ ì¤‘...</div>
        <button onclick="loadPluginSystem()">í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë¡œë“œ</button>
        <button onclick="checkPluginTypes()">í”ŒëŸ¬ê·¸ì¸ íƒ€ì… í™•ì¸</button>
    </div>
    
    <div class="test-section">
        <h2>2. ì¹´ë“œ ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="loadConsultationCards()">ìƒë‹´ê´€ë¦¬ ì¹´ë“œ ë¡œë“œ</button>
        <button onclick="loadAllCards()">ëª¨ë“  ì¹´ë“œ ë¡œë“œ</button>
        <div id="cardStatus" class="status info">ì¹´ë“œë¥¼ ë¡œë“œí•˜ë ¤ë©´ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>
        <div id="cardGrid" class="card-grid"></div>
    </div>
    
    <div class="test-section">
        <h2>3. ë””ë²„ê·¸ ì •ë³´</h2>
        <div id="debugInfo" class="debug-info">ë””ë²„ê·¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>

    <!-- í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="plugin_settings_client.js"></script>
    
    <script>
        let ktmPluginClient;
        let pluginTypes = [];
        
        // í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë¡œë“œ
        async function loadPluginSystem() {
            const status = document.getElementById('pluginStatus');
            const debug = document.getElementById('debugInfo');
            
            try {
                // í”ŒëŸ¬ê·¸ì¸ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
                ktmPluginClient = new KTMPluginSettingsClient('plugin_settings_api_real.php');
                ktmPluginClient.setUserId(1); // í…ŒìŠ¤íŠ¸ìš© ì‚¬ìš©ì ID
                
                // í”ŒëŸ¬ê·¸ì¸ íƒ€ì… ë¡œë“œ
                await ktmPluginClient.loadPluginTypes();
                pluginTypes = ktmPluginClient.pluginTypes;
                
                status.className = 'status success';
                status.textContent = `âœ“ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ (${pluginTypes.length}ê°œ íƒ€ì…)`;
                
                debug.textContent = 'í”ŒëŸ¬ê·¸ì¸ íƒ€ì…:\n' + JSON.stringify(pluginTypes, null, 2);
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âœ— í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                debug.textContent = `ì˜¤ë¥˜ ìƒì„¸:\n${error.stack}`;
            }
        }
        
        // í”ŒëŸ¬ê·¸ì¸ íƒ€ì… í™•ì¸
        function checkPluginTypes() {
            const debug = document.getElementById('debugInfo');
            const agentPlugin = pluginTypes.find(p => p.id === 'agent');
            
            if (agentPlugin) {
                debug.textContent = 'ì—ì´ì „íŠ¸ í”ŒëŸ¬ê·¸ì¸ ì •ë³´:\n' + JSON.stringify(agentPlugin, null, 2);
            } else {
                debug.textContent = 'ì—ì´ì „íŠ¸ í”ŒëŸ¬ê·¸ì¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
            }
        }
        
        // ìƒë‹´ê´€ë¦¬ ì¹´ë“œ ë¡œë“œ
        async function loadConsultationCards() {
            await loadCards('consultation');
        }
        
        // ëª¨ë“  ì¹´ë“œ ë¡œë“œ
        async function loadAllCards() {
            const categories = ['quarterly', 'weekly', 'daily', 'realtime', 'interaction', 'bias', 'development', 'consultation'];
            const allCards = [];
            
            for (const category of categories) {
                try {
                    await ktmPluginClient.loadCardSettings(category);
                    const cards = ktmPluginClient.getCardSettings(category) || [];
                    allCards.push(...cards.map(card => ({ ...card, category })));
                } catch (error) {
                    console.error(`${category} ì¹´ë“œ ë¡œë“œ ì‹¤íŒ¨:`, error);
                }
            }
            
            displayCards(allCards);
        }
        
        // ì¹´ë“œ ë¡œë“œ
        async function loadCards(category) {
            const status = document.getElementById('cardStatus');
            const debug = document.getElementById('debugInfo');
            
            if (!ktmPluginClient) {
                status.className = 'status error';
                status.textContent = 'í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œì„ ë¨¼ì € ë¡œë“œí•˜ì„¸ìš”';
                return;
            }
            
            try {
                status.className = 'status info';
                status.textContent = `${category} ì¹´ë“œ ë¡œë“œ ì¤‘...`;
                
                // ì¹´ë“œ ì„¤ì • ë¡œë“œ
                await ktmPluginClient.loadCardSettings(category);
                const cards = ktmPluginClient.getCardSettings(category) || [];
                
                status.className = 'status success';
                status.textContent = `âœ“ ${cards.length}ê°œì˜ ì¹´ë“œë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤`;
                
                // ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
                const agentCards = cards.filter(card => card.plugin_id === 'agent');
                debug.textContent = `${category} ì—ì´ì „íŠ¸ ì¹´ë“œ (${agentCards.length}ê°œ):\n`;
                agentCards.forEach(card => {
                    const config = card.plugin_config || {};
                    debug.textContent += `\n- ${config.plugin_name}:\n`;
                    debug.textContent += `  card_description: ${config.card_description || 'ì—†ìŒ'}\n`;
                    debug.textContent += `  description: ${config.description || 'ì—†ìŒ'}\n`;
                });
                
                // ì¹´ë“œ í‘œì‹œ
                displayCards(cards.map(card => ({ ...card, category })));
                
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âœ— ì¹´ë“œ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                debug.textContent = `ì˜¤ë¥˜ ìƒì„¸:\n${error.stack}`;
            }
        }
        
        // ì¹´ë“œ í‘œì‹œ
        function displayCards(cards) {
            const grid = document.getElementById('cardGrid');
            grid.innerHTML = '';
            
            cards.forEach(card => {
                const config = card.plugin_config || {};
                const plugin = pluginTypes.find(p => p.id === card.plugin_id);
                
                // ì¹´ë“œ ì œëª©ê³¼ ì„¤ëª… ê²°ì •
                const title = config.plugin_name || config.card_title || 'ì œëª© ì—†ìŒ';
                const description = config.card_description || 
                                  config.description || 
                                  (config.agent_config && config.agent_config.description) ||
                                  (plugin ? plugin.description : 'ì„¤ëª… ì—†ìŒ');
                
                const cardElement = document.createElement('div');
                cardElement.className = 'test-card';
                cardElement.innerHTML = `
                    <div class="card-icon">${plugin ? plugin.icon : 'ğŸ”Œ'}</div>
                    <div class="card-title">${title}</div>
                    <div class="card-description">${description}</div>
                    <div class="card-type">${card.category} / ${plugin ? plugin.title : card.plugin_id}</div>
                `;
                
                // í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
                cardElement.onclick = () => {
                    const debug = document.getElementById('debugInfo');
                    debug.textContent = `ì¹´ë“œ ìƒì„¸ ì •ë³´:\n${JSON.stringify(card, null, 2)}`;
                };
                
                grid.appendChild(cardElement);
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ìë™ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', () => {
            loadPluginSystem();
        });
    </script>
</body>
</html>