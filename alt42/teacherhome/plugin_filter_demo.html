<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”ŒëŸ¬ê·¸ì¸ í•„í„°ë§ ì‹œìŠ¤í…œ ë°ëª¨</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            color: #333;
        }
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .page-header h1 {
            margin: 0;
            font-size: 32px;
            font-weight: 600;
        }
        
        .page-header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .demo-section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .feature-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .feature-card h3 {
            margin: 0 0 12px 0;
            font-size: 18px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-card p {
            margin: 0;
            color: #666;
            line-height: 1.6;
        }
        
        .demo-controls {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            margin-right: 10px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .filter-container {
            min-height: 600px;
        }
        
        .selected-plugin {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .selected-plugin h4 {
            margin: 0 0 8px 0;
            color: #0c5460;
        }
        
        .selected-plugin pre {
            background: white;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0;
            font-size: 12px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #007bff;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>ğŸ” í”ŒëŸ¬ê·¸ì¸ í•„í„°ë§ ì‹œìŠ¤í…œ</h1>
        <p>íƒ­ë³„ë¡œ í”ŒëŸ¬ê·¸ì¸ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ê²€ìƒ‰í•˜ì„¸ìš”</p>
    </div>
    
    <div class="container">
        <!-- ê¸°ëŠ¥ ì†Œê°œ -->
        <div class="demo-section">
            <h2 class="section-title">ì£¼ìš” ê¸°ëŠ¥</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>ğŸ“‚ ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§</h3>
                    <p>ìˆ˜í•™êµì‹¤, í•™ìƒê´€ë¦¬, í•™ê¸‰ìš´ì˜ ë“± ì¹´í…Œê³ ë¦¬ë³„ë¡œ í”ŒëŸ¬ê·¸ì¸ì„ í•„í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ“‘ íƒ­ë³„ ê²©ë¦¬</h3>
                    <p>ê° íƒ­ì— ì†í•œ í”ŒëŸ¬ê·¸ì¸ë§Œ í‘œì‹œë˜ì–´ ì²´ê³„ì ì¸ ê´€ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ” ì‹¤ì‹œê°„ ê²€ìƒ‰</h3>
                    <p>í”ŒëŸ¬ê·¸ì¸ ì´ë¦„ì´ë‚˜ ì„¤ëª…ìœ¼ë¡œ ì¦‰ì‹œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ·ï¸ íƒ€ì…ë³„ ë¶„ë¥˜</h3>
                    <p>ë‚´ë¶€ ë§í¬, ì™¸ë¶€ ë§í¬, ë©”ì‹œì§€, ì—ì´ì „íŠ¸ ë“± íƒ€ì…ë³„ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤.</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ’¾ í•„í„° ìƒíƒœ ì €ì¥</h3>
                    <p>ë§ˆì§€ë§‰ í•„í„° ì„¤ì •ì´ ìë™ìœ¼ë¡œ ì €ì¥ë˜ì–´ ë‹¤ìŒ ë°©ë¬¸ ì‹œ ë³µì›ë©ë‹ˆë‹¤.</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ¯ ì‹œê°ì  í”¼ë“œë°±</h3>
                    <p>í™œì„± í•„í„°ê°€ íƒœê·¸ë¡œ í‘œì‹œë˜ê³  ì‰½ê²Œ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
        
        <!-- ë°ëª¨ ì»¨íŠ¸ë¡¤ -->
        <div class="demo-section">
            <h2 class="section-title">ë°ëª¨ ì»¨íŠ¸ë¡¤</h2>
            <div class="demo-controls">
                <div class="control-group">
                    <label>ìƒ˜í”Œ ë°ì´í„° ìƒì„±</label>
                    <button class="btn btn-success" onclick="createSampleData()">ìƒ˜í”Œ í”ŒëŸ¬ê·¸ì¸ ìƒì„±</button>
                    <button class="btn btn-secondary" onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
                </div>
                
                <div class="control-group">
                    <label>í•„í„° í”„ë¦¬ì…‹</label>
                    <button class="btn" onclick="applyPreset('math')">ìˆ˜í•™êµì‹¤ í•„í„°</button>
                    <button class="btn" onclick="applyPreset('student')">í•™ìƒê´€ë¦¬ í•„í„°</button>
                    <button class="btn" onclick="applyPreset('agent')">ì—ì´ì „íŠ¸ë§Œ í‘œì‹œ</button>
                    <button class="btn" onclick="applyPreset('inactive')">ë¹„í™œì„± í”ŒëŸ¬ê·¸ì¸</button>
                </div>
                
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPlugins">0</div>
                        <div class="stat-label">ì „ì²´ í”ŒëŸ¬ê·¸ì¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="filteredPlugins">0</div>
                        <div class="stat-label">í•„í„°ë§ëœ í”ŒëŸ¬ê·¸ì¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeFilters">0</div>
                        <div class="stat-label">í™œì„± í•„í„°</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- í•„í„°ë§ ì‹œìŠ¤í…œ -->
        <div class="demo-section">
            <h2 class="section-title">í”ŒëŸ¬ê·¸ì¸ í•„í„°ë§ ì‹œìŠ¤í…œ</h2>
            <div id="filterSystem" class="filter-container"></div>
            
            <div id="selectedPlugin" style="display: none;" class="selected-plugin">
                <h4>ì„ íƒëœ í”ŒëŸ¬ê·¸ì¸ ì •ë³´</h4>
                <pre id="pluginInfo"></pre>
            </div>
        </div>
    </div>
    
    <script src="plugin_settings_client.js"></script>
    <script src="plugin_filter_system.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let pluginFilter;
        const userId = 1;
        
        // í˜ì´ì§€ ì´ˆê¸°í™”
        window.onload = function() {
            // KTM í”ŒëŸ¬ê·¸ì¸ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
            if (window.ktmPluginClient) {
                window.ktmPluginClient.setUserId(userId);
            }
            
            // í•„í„°ë§ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            pluginFilter = new PluginFilterSystem('filterSystem');
            
            // ì½œë°± ì„¤ì •
            pluginFilter.onFilterChange((filters) => {
                console.log('í•„í„° ë³€ê²½:', filters);
                updateStats();
            });
            
            pluginFilter.onPluginSelect((pluginId) => {
                showPluginDetails(pluginId);
            });
            
            // ì´ˆê¸° í†µê³„ ì—…ë°ì´íŠ¸
            updateStats();
        };
        
        // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        async function createSampleData() {
            if (!window.ktmPluginClient) {
                alert('í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const categories = {
                'menu_tab': ['ë§ì¶¤í˜• í•™ìŠµ', 'í‰ê°€ì‹œìŠ¤í…œ', 'AI ë„ìš°ë¯¸', 'í•™ìŠµ ë¶„ì„'],
                'student_management': ['ìƒë‹´ê´€ë¦¬', 'ê±´ê°•ê´€ë¦¬', 'ì§„ë¡œì§„í•™', 'íŠ¹ë³„í™œë™'],
                'class_management': ['í•™ê¸‰ì¡°ì§', 'í•™ê¸‰íšŒì˜', 'ë³´ìƒì‹œìŠ¤í…œ', 'í•™ê¸‰í™œë™']
            };
            
            const pluginTypes = ['internal_link', 'external_link', 'send_message', 'agent'];
            const sampleNames = [
                'í•™ìŠµ ëŒ€ì‹œë³´ë“œ', 'ì„±ì  ë¶„ì„', 'AI íŠœí„°', 'ì§„ë„ ê´€ë¦¬',
                'ìƒë‹´ ì¼ì§€', 'ê±´ê°• ì²´í¬', 'ì§„ë¡œ ìƒë‹´', 'ë™ì•„ë¦¬ ê´€ë¦¬',
                'ì¢Œì„ ë°°ì¹˜', 'íšŒì˜ë¡', 'í¬ì¸íŠ¸ ì‹œìŠ¤í…œ', 'í–‰ì‚¬ ê´€ë¦¬'
            ];
            
            let createdCount = 0;
            
            for (const [category, tabs] of Object.entries(categories)) {
                for (const tab of tabs) {
                    // ê° íƒ­ì— 3-5ê°œì˜ ëœë¤ í”ŒëŸ¬ê·¸ì¸ ìƒì„±
                    const pluginCount = Math.floor(Math.random() * 3) + 3;
                    
                    for (let i = 0; i < pluginCount; i++) {
                        const pluginType = pluginTypes[Math.floor(Math.random() * pluginTypes.length)];
                        const name = sampleNames[Math.floor(Math.random() * sampleNames.length)] + ` ${i + 1}`;
                        
                        const config = {
                            plugin_name: name,
                            card_description: `${category}/${tab}ì˜ ${name} í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.`
                        };
                        
                        // íƒ€ì…ë³„ ì¶”ê°€ ì„¤ì •
                        switch (pluginType) {
                            case 'internal_link':
                                config.internal_url = `/sample/${category}/${tab}/${i}`;
                                config.open_new_tab = Math.random() > 0.5;
                                break;
                            case 'external_link':
                                config.external_url = `https://example.com/${category}/${tab}/${i}`;
                                config.open_new_tab = true;
                                break;
                            case 'send_message':
                                config.message_content = `${name}ì— ëŒ€í•œ ì•Œë¦¼ ë©”ì‹œì§€ì…ë‹ˆë‹¤.`;
                                config.message_type = ['info', 'success', 'warning'][Math.floor(Math.random() * 3)];
                                break;
                            case 'agent':
                                config.agent_type = 'custom';
                                config.agent_description = `${name} AI ì—ì´ì „íŠ¸`;
                                config.agent_prompt = `ë‹¹ì‹ ì€ ${name} ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” AI ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.`;
                                break;
                        }
                        
                        try {
                            await window.ktmPluginClient.saveCardSetting(
                                category,
                                tab,
                                i,
                                pluginType,
                                config,
                                i
                            );
                            createdCount++;
                        } catch (error) {
                            console.error('í”ŒëŸ¬ê·¸ì¸ ìƒì„± ì‹¤íŒ¨:', error);
                        }
                    }
                }
            }
            
            alert(`${createdCount}ê°œì˜ ìƒ˜í”Œ í”ŒëŸ¬ê·¸ì¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            pluginFilter.applyFilters();
        }
        
        // ëª¨ë“  ë°ì´í„° ì‚­ì œ
        async function clearAllData() {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch('clear_plugin_data.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: 'confirm=yes'
                });
                
                const text = await response.text();
                if (text.includes('ì´ˆê¸°í™” ì™„ë£Œ')) {
                    alert('ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    pluginFilter.applyFilters();
                } else {
                    alert('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í•„í„° í”„ë¦¬ì…‹ ì ìš©
        function applyPreset(preset) {
            pluginFilter.resetFilters();
            
            switch (preset) {
                case 'math':
                    document.getElementById('categoryFilter').value = 'menu_tab';
                    pluginFilter.filters.category = 'menu_tab';
                    pluginFilter.updateTabOptions();
                    break;
                    
                case 'student':
                    document.getElementById('categoryFilter').value = 'student_management';
                    pluginFilter.filters.category = 'student_management';
                    pluginFilter.updateTabOptions();
                    break;
                    
                case 'agent':
                    document.getElementById('pluginTypeFilter').value = 'agent';
                    pluginFilter.filters.pluginType = 'agent';
                    break;
                    
                case 'inactive':
                    document.getElementById('activeFilter').checked = false;
                    pluginFilter.filters.isActive = false;
                    break;
            }
            
            pluginFilter.applyFilters();
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        async function updateStats() {
            try {
                // ì „ì²´ í”ŒëŸ¬ê·¸ì¸ ìˆ˜
                const allResponse = await fetch('plugin_settings_api_real.php?action=getCardSettings&user_id=1');
                const allResult = await allResponse.json();
                const totalCount = allResult.success ? allResult.data.length : 0;
                document.getElementById('totalPlugins').textContent = totalCount;
                
                // í•„í„°ë§ëœ í”ŒëŸ¬ê·¸ì¸ ìˆ˜
                const filteredCount = document.querySelectorAll('.plugin-card').length;
                document.getElementById('filteredPlugins').textContent = filteredCount;
                
                // í™œì„± í•„í„° ìˆ˜
                const activeFilterCount = document.querySelectorAll('.filter-tag').length;
                document.getElementById('activeFilters').textContent = activeFilterCount;
                
            } catch (error) {
                console.error('í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }
        
        // í”ŒëŸ¬ê·¸ì¸ ìƒì„¸ ì •ë³´ í‘œì‹œ
        async function showPluginDetails(pluginId) {
            try {
                const response = await fetch('plugin_settings_api_real.php?action=getCardSettings&user_id=1');
                const result = await response.json();
                
                if (result.success) {
                    const plugin = result.data.find(p => p.id === pluginId);
                    if (plugin) {
                        document.getElementById('selectedPlugin').style.display = 'block';
                        document.getElementById('pluginInfo').textContent = JSON.stringify(plugin, null, 2);
                        
                        // ì„ íƒëœ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                        document.getElementById('selectedPlugin').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest' 
                        });
                    }
                }
            } catch (error) {
                console.error('í”ŒëŸ¬ê·¸ì¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
    </script>
</body>
</html>