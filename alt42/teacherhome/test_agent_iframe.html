<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ì´ì „íŠ¸ iframe í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #1976D2;
        }
        .agent-card {
            display: inline-block;
            padding: 15px;
            margin: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
            text-align: center;
        }
        .agent-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .agent-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .agent-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .agent-description {
            font-size: 12px;
            color: #666;
        }
        .status {
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– ì—ì´ì „íŠ¸ iframe ìŠ¬ë¼ì´ë”© íŒ¨ë„ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h2>
        <p>ì—ì´ì „íŠ¸ í”ŒëŸ¬ê·¸ì¸ì„ í´ë¦­í•˜ë©´ agent_urlì„ ì½ì–´ì™€ì„œ ìš°ì¸¡ì—ì„œ ìŠ¬ë¼ì´ë“œë¡œ iframeì´ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <div id="status" class="status" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>ì—ì´ì „íŠ¸ ì¹´ë“œ ì‹œë®¬ë ˆì´ì…˜</h2>
        <p>ì•„ë˜ ì¹´ë“œë“¤ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”:</p>
        
        <div class="agent-card" onclick="testAgent1()">
            <div class="agent-icon">ğŸ¤–</div>
            <div class="agent-title">AI í•™ìŠµ ë„ìš°ë¯¸</div>
            <div class="agent-description">agent_urlì´ ìˆëŠ” ì—ì´ì „íŠ¸</div>
        </div>
        
        <div class="agent-card" onclick="testAgent2()">
            <div class="agent-icon">ğŸ“Š</div>
            <div class="agent-title">ì„±ì  ë¶„ì„ ì—ì´ì „íŠ¸</div>
            <div class="agent-description">ì™¸ë¶€ URL ì—ì´ì „íŠ¸</div>
        </div>
        
        <div class="agent-card" onclick="testAgent3()">
            <div class="agent-icon">ğŸ’¬</div>
            <div class="agent-title">ëŒ€í™”í˜• íŠœí„°</div>
            <div class="agent-description">URL ì—†ëŠ” ì—ì´ì „íŠ¸ (ì±„íŒ… í´ë°±)</div>
        </div>
        
        <div class="agent-card" onclick="testAgent4()">
            <div class="agent-icon">ğŸ“</div>
            <div class="agent-title">í•™ìŠµ ê³„íš ìƒì„±ê¸°</div>
            <div class="agent-description">ìƒëŒ€ ê²½ë¡œ íŒŒì¼</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ì§ì ‘ í…ŒìŠ¤íŠ¸</h2>
        <button class="test-button" onclick="testDirectCall()">openAgentPanelWithIframe ì§ì ‘ í˜¸ì¶œ</button>
        <button class="test-button" onclick="testExecutePlugin()">executePluginAction í˜¸ì¶œ</button>
        <button class="test-button" onclick="checkFunctions()">í•¨ìˆ˜ ì¡´ì¬ í™•ì¸</button>
    </div>
    
    <!-- ë©”ì¸ í˜ì´ì§€ì˜ ìŠ¤í¬ë¦½íŠ¸ì™€ ìŠ¤íƒ€ì¼ ë¡œë“œ -->
    <link rel="stylesheet" href="styles.css">
    <script src="plugin_settings_client.js"></script>
    <script src="script.js"></script>
    
    <script>
        function showStatus(message, isSuccess = true) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isSuccess ? 'success' : 'error');
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
        
        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 1: agent_urlì´ ìˆëŠ” ì—ì´ì „íŠ¸
        function testAgent1() {
            const config = {
                plugin_name: 'AI í•™ìŠµ ë„ìš°ë¯¸',
                agent_url: 'https://mathking.kr/moodle/local/augmented_teacher/alt42/studenthome/index.php',
                agent_type: 'api',
                agent_config: {
                    title: 'AI íŠœí„°',
                    description: 'í•™ìŠµì„ ë„ì™€ë“œë¦½ë‹ˆë‹¤'
                }
            };
            
            console.log('Testing Agent 1:', config);
            showStatus('ì—ì´ì „íŠ¸ 1 ì‹¤í–‰ ì¤‘...');
            
            if (typeof executePluginAction === 'function') {
                executePluginAction('agent', config);
                showStatus('âœ… ì—ì´ì „íŠ¸ 1 ì‹¤í–‰ë¨ - iframe íŒ¨ë„ì´ ì—´ë ¤ì•¼ í•©ë‹ˆë‹¤');
            } else {
                showStatus('âŒ executePluginAction í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', false);
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2: ì™¸ë¶€ URL ì—ì´ì „íŠ¸
        function testAgent2() {
            const config = {
                plugin_name: 'ì„±ì  ë¶„ì„ ì—ì´ì „íŠ¸',
                agent_url: 'https://www.google.com',
                agent_type: 'api'
            };
            
            console.log('Testing Agent 2:', config);
            showStatus('ì—ì´ì „íŠ¸ 2 ì‹¤í–‰ ì¤‘...');
            
            if (typeof executePluginAction === 'function') {
                executePluginAction('agent', config);
                showStatus('âœ… ì—ì´ì „íŠ¸ 2 ì‹¤í–‰ë¨ - Googleì´ iframeì— ë¡œë“œë˜ì–´ì•¼ í•©ë‹ˆë‹¤');
            } else {
                showStatus('âŒ executePluginAction í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', false);
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 3: URL ì—†ëŠ” ì—ì´ì „íŠ¸ (ì±„íŒ… í´ë°±)
        function testAgent3() {
            const config = {
                plugin_name: 'ëŒ€í™”í˜• íŠœí„°',
                agent_type: 'javascript',
                agent_prompt: 'í•™ìƒì˜ ì§ˆë¬¸ì— ë‹µë³€í•´ë“œë¦½ë‹ˆë‹¤',
                agent_config: {
                    title: 'ëŒ€í™”í˜• íŠœí„°',
                    description: 'ì§ˆë¬¸ê³¼ ë‹µë³€'
                }
            };
            
            console.log('Testing Agent 3:', config);
            showStatus('ì—ì´ì „íŠ¸ 3 ì‹¤í–‰ ì¤‘...');
            
            if (typeof executePluginAction === 'function') {
                executePluginAction('agent', config);
                showStatus('âœ… ì—ì´ì „íŠ¸ 3 ì‹¤í–‰ë¨ - ì±„íŒ… íŒ¨ë„ì´ ì—´ë ¤ì•¼ í•©ë‹ˆë‹¤ (URL ì—†ìŒ)');
            } else {
                showStatus('âŒ executePluginAction í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', false);
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 4: ìƒëŒ€ ê²½ë¡œ íŒŒì¼
        function testAgent4() {
            const config = {
                plugin_name: 'í•™ìŠµ ê³„íš ìƒì„±ê¸°',
                agent_url: 'weekly/weekly_report.html',
                agent_type: 'custom'
            };
            
            console.log('Testing Agent 4:', config);
            showStatus('ì—ì´ì „íŠ¸ 4 ì‹¤í–‰ ì¤‘...');
            
            if (typeof executePluginAction === 'function') {
                executePluginAction('agent', config);
                showStatus('âœ… ì—ì´ì „íŠ¸ 4 ì‹¤í–‰ë¨ - ìƒëŒ€ ê²½ë¡œ íŒŒì¼ì´ iframeì— ë¡œë“œë˜ì–´ì•¼ í•©ë‹ˆë‹¤');
            } else {
                showStatus('âŒ executePluginAction í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', false);
            }
        }
        
        // ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸
        function testDirectCall() {
            console.log('Testing direct call to openAgentPanelWithIframe');
            
            if (typeof openAgentPanelWithIframe === 'function') {
                openAgentPanelWithIframe({
                    url: 'https://mathking.kr/moodle/local/augmented_teacher/alt42/omniui/omniui_teacher_api.php',
                    title: 'ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸'
                });
                showStatus('âœ… openAgentPanelWithIframe ì§ì ‘ í˜¸ì¶œ ì„±ê³µ');
            } else {
                showStatus('âŒ openAgentPanelWithIframe í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', false);
            }
        }
        
        // executePluginAction í˜¸ì¶œ í…ŒìŠ¤íŠ¸
        function testExecutePlugin() {
            console.log('Testing executePluginAction with agent type');
            
            if (typeof executePluginAction === 'function') {
                const testConfig = {
                    plugin_name: 'executePluginAction í…ŒìŠ¤íŠ¸',
                    agent_url: 'test_content.html',
                    agent_type: 'custom'
                };
                
                executePluginAction('agent', testConfig);
                showStatus('âœ… executePluginAction í˜¸ì¶œ ì„±ê³µ');
            } else {
                showStatus('âŒ executePluginAction í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', false);
            }
        }
        
        // í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
        function checkFunctions() {
            const functionsToCheck = [
                'executePluginAction',
                'openAgentPanel',
                'closeAgentPanel',
                'openAgentPanelWithIframe',
                'openChatPanelWithAgent'
            ];
            
            let allFound = true;
            let results = [];
            
            functionsToCheck.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results.push(`âœ… ${funcName}`);
                } else {
                    results.push(`âŒ ${funcName}`);
                    allFound = false;
                }
            });
            
            const message = results.join('\n');
            console.log('Function check results:\n' + message);
            
            if (allFound) {
                showStatus('ëª¨ë“  í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                showStatus('ì¼ë¶€ í•¨ìˆ˜ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.', false);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('load', () => {
            console.log('Test page loaded. Checking environment...');
            checkFunctions();
        });
    </script>
</body>
</html>