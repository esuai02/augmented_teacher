<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>탭 표시 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .data-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .menu-simulation {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .menu-list {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            min-width: 200px;
        }
        .menu-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .menu-item:hover {
            background: #007bff;
            color: white;
        }
        .menu-content {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 4px;
            min-height: 300px;
        }
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-button {
            padding: 8px 16px;
            background: #e9ecef;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .tab-button.active {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <h1>탭 표시 테스트</h1>
    
    <div class="test-section">
        <h2>1. 모듈 로딩 상태</h2>
        <button onclick="checkModules()">모듈 상태 확인</button>
        <div id="moduleStatus" class="test-result info">버튼을 클릭하여 모듈 상태를 확인하세요</div>
    </div>
    
    <div class="test-section">
        <h2>2. 카테고리 데이터 확인</h2>
        <button onclick="checkCategoryData('quarterly')">분기활동</button>
        <button onclick="checkCategoryData('weekly')">주간활동</button>
        <button onclick="checkCategoryData('daily')">오늘활동</button>
        <button onclick="checkCategoryData('consultation')">상담관리</button>
        <button onclick="checkAllCategories()">모든 카테고리</button>
        <div id="categoryStatus" class="test-result info">카테고리를 선택하세요</div>
        <div id="categoryData" class="data-display" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>3. 메뉴 인터페이스 시뮬레이션</h2>
        <div class="menu-simulation">
            <div class="menu-list">
                <h3>카테고리</h3>
                <div class="menu-item" onclick="simulateMenuClick('quarterly')">1. 분기활동</div>
                <div class="menu-item" onclick="simulateMenuClick('weekly')">2. 주간활동</div>
                <div class="menu-item" onclick="simulateMenuClick('daily')">3. 오늘활동</div>
                <div class="menu-item" onclick="simulateMenuClick('realtime')">4. 실시간 관리</div>
                <div class="menu-item" onclick="simulateMenuClick('interaction')">5. 상호작용 관리</div>
                <div class="menu-item" onclick="simulateMenuClick('bias')">6. 인지관성 개선</div>
                <div class="menu-item" onclick="simulateMenuClick('development')">7. 컨텐츠 및 앱개발</div>
                <div class="menu-item" onclick="simulateMenuClick('viral')">8. 바이럴 마케팅</div>
                <div class="menu-item" onclick="simulateMenuClick('consultation')">9. 상담관리</div>
            </div>
            <div class="menu-content" id="menuContent">
                <p>카테고리를 클릭하세요</p>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>4. 콘솔 로그</h2>
        <button onclick="clearConsole()">콘솔 지우기</button>
        <div id="consoleLog" class="data-display"></div>
    </div>

    <!-- 모듈 로더 -->
    <script src="module_loader.js"></script>
    
    <!-- 모듈들 로드 -->
    <script src="quarterly/quarterly.js"></script>
    <script src="weekly/weekly.js"></script>
    <script src="daily/daily.js"></script>
    <script src="realtime/realtime.js"></script>
    <script src="interaction/interaction.js"></script>
    <script src="bias/bias.js"></script>
    <script src="development/development.js"></script>
    <script src="consultation/consultation.js"></script>
    
    <!-- 메인 스크립트 -->
    <script src="script.js"></script>
    
    <script>
        // 콘솔 로그 캡처
        const logContainer = document.getElementById('consoleLog');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logContainer.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            addLog(args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            addLog(args.join(' '), 'warn');
            originalWarn.apply(console, args);
        };
        
        // 1. 모듈 상태 확인
        function checkModules() {
            const statusDiv = document.getElementById('moduleStatus');
            const modules = [
                'quarterlyModule', 'weeklyModule', 'dailyModule', 
                'realtimeModule', 'interactionModule', 'biasModule',
                'developmentModule', 'consultationModule'
            ];
            
            const results = [];
            modules.forEach(moduleName => {
                const exists = window[moduleName] !== undefined;
                const hasGetData = exists && typeof window[moduleName].getData === 'function';
                results.push(`${moduleName}: ${exists ? '✓' : '✗'} (getData: ${hasGetData ? '✓' : '✗'})`);
            });
            
            statusDiv.className = 'test-result success';
            statusDiv.innerHTML = results.join('<br>');
        }
        
        // 2. 카테고리 데이터 확인
        async function checkCategoryData(category) {
            const statusDiv = document.getElementById('categoryStatus');
            const dataDiv = document.getElementById('categoryData');
            
            try {
                const menuStructure = getMenuStructure();
                const data = menuStructure[category];
                
                if (data) {
                    statusDiv.className = 'test-result success';
                    statusDiv.textContent = `✓ ${category} 데이터 로드 성공`;
                    
                    // 탭 정보 표시
                    const tabInfo = data.tabs ? 
                        `탭 수: ${data.tabs.length}\n탭 목록: ${data.tabs.map(t => t.title).join(', ')}` :
                        '탭 데이터 없음';
                    
                    dataDiv.style.display = 'block';
                    dataDiv.textContent = `제목: ${data.title}\n설명: ${data.description}\n${tabInfo}\n\n전체 데이터:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    statusDiv.className = 'test-result error';
                    statusDiv.textContent = `✗ ${category} 데이터를 찾을 수 없습니다`;
                    dataDiv.style.display = 'none';
                }
            } catch (error) {
                statusDiv.className = 'test-result error';
                statusDiv.textContent = `✗ 오류: ${error.message}`;
                dataDiv.style.display = 'none';
            }
        }
        
        // 모든 카테고리 확인
        async function checkAllCategories() {
            const categories = ['quarterly', 'weekly', 'daily', 'realtime', 
                              'interaction', 'bias', 'development', 'viral', 'consultation'];
            
            for (const category of categories) {
                await checkCategoryData(category);
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        }
        
        // 3. 메뉴 클릭 시뮬레이션
        async function simulateMenuClick(category) {
            const contentDiv = document.getElementById('menuContent');
            
            try {
                // selectCategory 함수가 하는 일을 시뮬레이션
                const menuStructure = getMenuStructure();
                const categoryData = menuStructure[category];
                
                if (!categoryData) {
                    contentDiv.innerHTML = `<div class="error">카테고리 데이터를 찾을 수 없습니다: ${category}</div>`;
                    return;
                }
                
                // 탭 버튼 표시
                contentDiv.innerHTML = `
                    <h2>${categoryData.title}</h2>
                    <p>${categoryData.description}</p>
                    <div class="tab-container">
                        ${categoryData.tabs && categoryData.tabs.length > 0 ? 
                            categoryData.tabs.map((tab, index) => 
                                `<button class="tab-button ${index === 0 ? 'active' : ''}" 
                                         onclick="selectTab('${tab.id}', '${tab.title}')">
                                    ${tab.title}
                                </button>`
                            ).join('') :
                            '<p>탭이 없습니다</p>'
                        }
                    </div>
                    <div id="tabContent">
                        ${categoryData.tabs && categoryData.tabs.length > 0 ? 
                            `<p>첫 번째 탭: ${categoryData.tabs[0].title}</p>` :
                            '<p>표시할 탭이 없습니다</p>'
                        }
                    </div>
                `;
                
                console.log(`카테고리 선택됨: ${category}, 탭 수: ${categoryData.tabs ? categoryData.tabs.length : 0}`);
                
            } catch (error) {
                contentDiv.innerHTML = `<div class="error">오류: ${error.message}</div>`;
                console.error('메뉴 클릭 시뮬레이션 오류:', error);
            }
        }
        
        // 탭 선택
        function selectTab(tabId, tabTitle) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tabContent').innerHTML = `<p>선택된 탭: ${tabTitle} (ID: ${tabId})</p>`;
        }
        
        // 콘솔 지우기
        function clearConsole() {
            logContainer.innerHTML = '';
        }
        
        // 페이지 로드 시 초기 확인
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('=== 탭 표시 테스트 시작 ===');
            
            // 모듈 로더 확인
            if (window.moduleLoader) {
                console.log('✓ 모듈 로더 로드됨');
            } else {
                console.error('✗ 모듈 로더를 찾을 수 없습니다');
            }
            
            // 초기 모듈 상태 확인
            setTimeout(() => {
                checkModules();
            }, 1000);
        });
    </script>
</body>
</html>