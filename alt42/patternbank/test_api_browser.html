<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI API Browser Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .api-key-input {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        input[type="password"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input[type="password"]:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #444;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin-left: 10px;
        }
        .status.pending { background: #e0e0e0; color: #666; }
        .status.testing { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ffeeba;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #bee5eb;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ OpenAI API ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">Chat Completions API (GPT-4o-mini) ì§ì ‘ í…ŒìŠ¤íŠ¸</p>
        
        <div class="warning">
            âš ï¸ <strong>ë³´ì•ˆ ê²½ê³ :</strong> ì´ í˜ì´ì§€ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”. 
            í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” API í‚¤ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”.
        </div>
        
        <div class="info">
            â„¹ï¸ <strong>ì‚¬ìš©ë²•:</strong> OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ê³  í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”. 
            API í‚¤ëŠ” <code>sk-proj-</code>ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
        </div>
        
        <div class="api-key-input">
            <input type="password" id="apiKey" 
                   placeholder="OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (sk-proj-...)" 
                   value="">
            <button onclick="saveApiKey()">API í‚¤ ì €ì¥</button>
        </div>
        
        <div class="test-section">
            <h3>1. API ì—°ê²° í…ŒìŠ¤íŠ¸ <span id="status1" class="status pending">ëŒ€ê¸°ì¤‘</span></h3>
            <button onclick="testConnection()" id="testBtn1">ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>2. ìœ ì‚¬ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸ <span id="status2" class="status pending">ëŒ€ê¸°ì¤‘</span></h3>
            <button onclick="testProblemGeneration()" id="testBtn2">ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>3. ì¢…í•© ì§„ë‹¨ <span id="status3" class="status pending">ëŒ€ê¸°ì¤‘</span></h3>
            <button onclick="runFullDiagnostics()" id="testBtn3">ì¢…í•© ì§„ë‹¨ ì‹¤í–‰</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // API í‚¤ ì €ì¥/ë¡œë“œ
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey) {
                localStorage.setItem('openai_api_key', apiKey);
                alert('API í‚¤ê°€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì €ì¥ëœ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = function() {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
        };
        
        // 1. API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const statusEl = document.getElementById('status1');
            const resultEl = document.getElementById('result1');
            const btnEl = document.getElementById('testBtn1');
            
            statusEl.className = 'status testing';
            statusEl.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            resultEl.style.display = 'block';
            resultEl.textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...\n';
            btnEl.disabled = true;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a helpful assistant.'
                            },
                            {
                                role: 'user',
                                content: '1+1ì€ ë¬´ì—‡ì¸ê°€ìš”? í•œ ë‹¨ì–´ë¡œ ë‹µí•´ì£¼ì„¸ìš”.'
                            }
                        ],
                        max_tokens: 10,
                        temperature: 0.5
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    statusEl.className = 'status success';
                    statusEl.textContent = 'ì„±ê³µ';
                    resultEl.textContent = `âœ… ì—°ê²° ì„±ê³µ!\n\n`;
                    resultEl.textContent += `ëª¨ë¸: gpt-4o-mini\n`;
                    resultEl.textContent += `ì‘ë‹µ: ${data.choices[0].message.content}\n`;
                    resultEl.textContent += `\ní† í° ì‚¬ìš©ëŸ‰:\n`;
                    resultEl.textContent += `- í”„ë¡¬í”„íŠ¸: ${data.usage.prompt_tokens}\n`;
                    resultEl.textContent += `- ì™„ë£Œ: ${data.usage.completion_tokens}\n`;
                    resultEl.textContent += `- ì´í•©: ${data.usage.total_tokens}`;
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'ì‹¤íŒ¨';
                    resultEl.textContent = `âŒ API ì˜¤ë¥˜\n\n`;
                    resultEl.textContent += `ìƒíƒœ ì½”ë“œ: ${response.status}\n`;
                    resultEl.textContent += `ì˜¤ë¥˜ íƒ€ì…: ${data.error?.type || 'unknown'}\n`;
                    resultEl.textContent += `ì˜¤ë¥˜ ë©”ì‹œì§€: ${data.error?.message || 'No message'}\n`;
                    
                    if (data.error?.message.includes('Incorrect API key')) {
                        resultEl.textContent += `\nğŸ’¡ í•´ê²° ë°©ë²•: API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.`;
                    } else if (data.error?.message.includes('quota')) {
                        resultEl.textContent += `\nğŸ’¡ í•´ê²° ë°©ë²•: OpenAI ê³„ì •ì˜ í¬ë ˆë”§ì„ í™•ì¸í•˜ì„¸ìš”.`;
                    }
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'ì˜¤ë¥˜';
                resultEl.textContent = `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n\n${error.message}`;
            } finally {
                btnEl.disabled = false;
            }
        }
        
        // 2. ìœ ì‚¬ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸
        async function testProblemGeneration() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const statusEl = document.getElementById('status2');
            const resultEl = document.getElementById('result2');
            const btnEl = document.getElementById('testBtn2');
            
            statusEl.className = 'status testing';
            statusEl.textContent = 'ìƒì„± ì¤‘...';
            resultEl.style.display = 'block';
            resultEl.textContent = 'ìœ ì‚¬ë¬¸ì œ ìƒì„± ì¤‘...\n';
            btnEl.disabled = true;
            
            const prompt = `ë‹¤ìŒ ìˆ˜í•™ ë¬¸ì œë¥¼ ë°”íƒ•ìœ¼ë¡œ ìœ ì‚¬í•œ ë¬¸ì œë¥¼ 1ê°œ ìƒì„±í•´ì£¼ì„¸ìš”.

ì›ë³¸ ë¬¸ì œ:
ë¬¸ì œ: ë‹¤ìŒ ìˆ˜ì—´ì˜ ì¼ë°˜í•­ì„ êµ¬í•˜ì‹œì˜¤: 3, 6, 12, 24, ...
í•´ì„¤: ì²«ì§¸í•­ì´ 3ì´ê³  ê³µë¹„ê°€ 2ì¸ ë“±ë¹„ìˆ˜ì—´ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì¼ë°˜í•­ì€ a_n = 3 Ã— 2^(n-1)ì…ë‹ˆë‹¤.

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:
ë¬¸ì œ: [ë¬¸ì œ ë‚´ìš©]
í•´ì„¤: [í’€ì´ ê³¼ì •ê³¼ ë‹µ]`;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a helpful math tutor that creates practice problems in Korean.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    statusEl.className = 'status success';
                    statusEl.textContent = 'ì„±ê³µ';
                    resultEl.textContent = `âœ… ë¬¸ì œ ìƒì„± ì„±ê³µ!\n\n`;
                    resultEl.textContent += `ìƒì„±ëœ ë¬¸ì œ:\n${data.choices[0].message.content}\n`;
                    resultEl.textContent += `\ní† í° ì‚¬ìš©ëŸ‰: ${data.usage.total_tokens}`;
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'ì‹¤íŒ¨';
                    resultEl.textContent = `âŒ ìƒì„± ì‹¤íŒ¨\n\n${data.error?.message || 'Unknown error'}`;
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'ì˜¤ë¥˜';
                resultEl.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ\n\n${error.message}`;
            } finally {
                btnEl.disabled = false;
            }
        }
        
        // 3. ì¢…í•© ì§„ë‹¨
        async function runFullDiagnostics() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const statusEl = document.getElementById('status3');
            const resultEl = document.getElementById('result3');
            const btnEl = document.getElementById('testBtn3');
            
            statusEl.className = 'status testing';
            statusEl.textContent = 'ì§„ë‹¨ ì¤‘...';
            resultEl.style.display = 'block';
            resultEl.textContent = 'ì¢…í•© ì§„ë‹¨ ì‹œì‘...\n\n';
            btnEl.disabled = true;
            
            let allPassed = true;
            
            // API í‚¤ í˜•ì‹ ê²€ì‚¬
            resultEl.textContent += '1. API í‚¤ í˜•ì‹ ê²€ì‚¬... ';
            if (apiKey.startsWith('sk-proj-') || apiKey.startsWith('sk-')) {
                resultEl.textContent += 'âœ… ì •ìƒ\n';
            } else {
                resultEl.textContent += 'âŒ ì˜ëª»ëœ í˜•ì‹\n';
                allPassed = false;
            }
            
            // API ì—°ê²° í…ŒìŠ¤íŠ¸
            resultEl.textContent += '2. API ì—°ê²° í…ŒìŠ¤íŠ¸... ';
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                
                if (response.ok) {
                    resultEl.textContent += 'âœ… ì—°ê²° ì„±ê³µ\n';
                } else {
                    const data = await response.json();
                    resultEl.textContent += `âŒ ì‹¤íŒ¨ (${data.error?.message || 'Unknown'})\n`;
                    allPassed = false;
                }
            } catch (error) {
                resultEl.textContent += `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n`;
                allPassed = false;
            }
            
            // ëª¨ë¸ ì‚¬ìš© ê°€ëŠ¥ í™•ì¸
            resultEl.textContent += '3. GPT-4o-mini ëª¨ë¸ í™•ì¸... ';
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{role: 'user', content: 'test'}],
                        max_tokens: 1
                    })
                });
                
                if (response.ok) {
                    resultEl.textContent += 'âœ… ì‚¬ìš© ê°€ëŠ¥\n';
                } else {
                    resultEl.textContent += 'âŒ ì‚¬ìš© ë¶ˆê°€\n';
                    allPassed = false;
                }
            } catch (error) {
                resultEl.textContent += 'âŒ ì˜¤ë¥˜\n';
                allPassed = false;
            }
            
            // ìµœì¢… ê²°ê³¼
            resultEl.textContent += '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            if (allPassed) {
                statusEl.className = 'status success';
                statusEl.textContent = 'ì •ìƒ';
                resultEl.textContent += 'âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!\n';
                resultEl.textContent += 'PatternBankê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.\n';
                resultEl.textContent += '\në‹¤ìŒ ë‹¨ê³„:\n';
                resultEl.textContent += '1. config/api_keys.php íŒŒì¼ì— API í‚¤ ì €ì¥\n';
                resultEl.textContent += '2. test_api_simple.php ì‹¤í–‰í•˜ì—¬ ì„œë²„ ì¸¡ í…ŒìŠ¤íŠ¸\n';
                resultEl.textContent += '3. PatternBank ì‹œìŠ¤í…œ ì‚¬ìš© ì‹œì‘';
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'ë¬¸ì œ ë°œê²¬';
                resultEl.textContent += 'âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\n';
                resultEl.textContent += 'ìœ„ì˜ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”.';
            }
            
            btnEl.disabled = false;
        }
    </script>
</body>
</html>