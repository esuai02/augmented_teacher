===============================================================================
                        학생 중심 학습 지원 시스템 (Confidence Booster)
                              상세 시스템 문서 및 개발 가이드
===============================================================================

■ 시스템 개요
===============================================================================

【시스템명】 Confidence Booster - 학생 중심 학습 지원 시스템
【개발목적】 고등학교 2학년 이현선 학생을 위한 개인맞춤형 학습 관리 도구
【접속경로】 https://mathking.kr/moodle/local/augmented_teacher/alt42/omniui/local/confidence_booster/
【개발기간】 2024년 9월 (현재 운영 중)
【대상사용자】 MathKing LMS 등록 학생 및 교사

【핵심기능】
- 실시간 학습 시간 측정 및 관리
- 오늘의 학습 목표 설정 및 추적
- 즉시 요약 작성 및 저장 (인라인 편집)
- 즉시 오답노트 작성 및 분류 저장
- 실제 Moodle 데이터 기반 학습 현황 표시
- 반응형 웹 디자인 (모바일/태블릿/PC 지원)

■ 시스템 아키텍처
===============================================================================

【기술 스택】
- 백엔드: PHP 7.4+ / PDO (MySQL 연결)
- 프론트엔드: HTML5, CSS3, JavaScript (ES6+)
- UI 프레임워크: Tailwind CSS 3.0
- 아이콘: Font Awesome 6.4.0
- 데이터베이스: MySQL 5.7+ (MathKing/Moodle DB)
- 세션 관리: PHP Session + localStorage

【시스템 구조】
```
/local/confidence_booster/
├── index.php                    # 메인 학습 대시보드
├── config.php                   # 데이터베이스 설정
├── save_summary.php             # 상세 요약 작성 페이지
├── save_error.php              # 상세 오답노트 작성 페이지
├── learning_tracker.php        # 학습 추적 분석 페이지
└── ajax/                       # AJAX 핸들러
    ├── save_goal.php           # 목표 저장
    ├── quick_save_summary.php  # 빠른 요약 저장
    └── quick_save_error.php    # 빠른 오답노트 저장
```

■ 데이터베이스 연동 정보
===============================================================================

【주요 데이터베이스】

1. MathKing 메인 DB (mathking)
   - Host: 58.180.27.46
   - User: moodle
   - Password: @MCtrigd7128
   - Charset: utf8mb4
   - Prefix: mdl_

2. Alt42t 시험 관리 DB (alt42t)
   - Host: localhost
   - User: root
   - Password: (empty)
   - Prefix: (none)

【사용 중인 핵심 테이블】

■ mdl_user (사용자 기본정보)
  - id: 사용자 고유 ID (PRIMARY KEY)
  - username: 로그인 아이디
  - firstname, lastname: 이름
  - email: 이메일 주소
  - password: bcrypt 암호화 비밀번호
  - deleted: 삭제 여부 (0=활성, 1=삭제)

■ mdl_abessi_today (일일 학습 데이터)
  - id: PRIMARY KEY
  - userid: 사용자 ID (mdl_user.id 참조)
  - date: 날짜 (YYYY-MM-DD)
  - goals: JSON 데이터 (목표, 요약 등)
  - timecreated: 생성 시간 (Unix timestamp)
  - timemodified: 수정 시간 (Unix timestamp)

■ mdl_abessi_mathtalk (수학토크/오답분석)
  - id: PRIMARY KEY
  - userid: 사용자 ID
  - type: 데이터 타입 ('error_analysis' 등)
  - content: JSON 데이터 (오답 정보)
  - timecreated: 생성 시간

■ mdl_logstore_standard_log (Moodle 활동 로그)
  - userid: 사용자 ID
  - eventname: 이벤트 이름
  - timecreated: 활동 시간
  - courseid: 코스 ID

■ mdl_quiz_attempts (퀴즈 시도 기록)
  - userid: 사용자 ID
  - quiz: 퀴즈 ID
  - state: 상태 ('finished' 등)
  - sumgrades: 총 점수
  - timestart, timefinish: 시작/완료 시간

■ mdl_assign_submission (과제 제출)
  - userid: 사용자 ID
  - assignment: 과제 ID
  - status: 제출 상태 ('submitted' 등)
  - timemodified: 수정 시간

■ 핵심 기능 상세 설명
===============================================================================

【1. 실시간 학습 타이머】
- 기능: 공부 시간을 실시간으로 측정 (시:분:초 형식)
- 제어: 시작/일시정지/리셋 버튼
- 구현: JavaScript setInterval() 사용
- 저장: 클라이언트 측 메모리 (새로고침 시 초기화)

```javascript
let timerInterval = null;
let seconds = 0;

function startTimer() {
    if (!timerInterval) {
        timerInterval = setInterval(() => {
            seconds++;
            updateTimerDisplay();
        }, 1000);
    }
}
```

【2. 오늘의 목표 설정】
- 기능: 하루 단위 학습 목표 설정 및 저장
- 저장위치: PHP 세션 ($_SESSION['today_goal'])
- AJAX: ajax/save_goal.php
- 실시간 저장: 텍스트 입력 후 저장 버튼 클릭

```php
// 세션에 저장
$_SESSION['today_goal'] = $goal;

echo json_encode([
    'success' => true,
    'message' => '목표가 저장되었습니다.'
], JSON_UNESCAPED_UNICODE);
```

【3. 빠른 요약 작성】
- 기능: 학습 내용을 단원별로 간단히 요약 작성
- 입력필드: 단원명, 요약내용
- 저장위치: mdl_abessi_today 테이블 (JSON 형식)
- AJAX: ajax/quick_save_summary.php

데이터 저장 형식:
```json
{
    "summaries": [
        {
            "chapter": "미분의 정의",
            "content": "극한을 이용한 미분의 정의를 학습함",
            "time": "14:30",
            "timestamp": 1693903800
        }
    ]
}
```

【4. 빠른 오답노트 작성】
- 기능: 틀린 문제를 즉시 분석하여 저장
- 입력필드: 문제내용, 오답이유, 정답풀이
- 자동분류: 계산실수/개념부족/응용부족/부주의
- 저장위치: mdl_abessi_mathtalk 테이블
- AJAX: ajax/quick_save_error.php

오답 자동 분류 로직:
```php
$error_type = 'careless'; // 기본값
if (strpos($error_reason, '개념') !== false) {
    $error_type = 'concept';
} elseif (strpos($error_reason, '계산') !== false) {
    $error_type = 'calculation';
} elseif (strpos($error_reason, '응용') !== false) {
    $error_type = 'application';
}
```

【5. 실제 학습 데이터 표시】
- 최근 퀴즈 결과: mdl_quiz_attempts 테이블에서 실시간 조회
- 과제 제출 현황: mdl_assign_submission 테이블에서 실시간 조회
- 표시정보: 퀴즈명, 점수, 완료시간 / 과제명, 제출상태, 제출시간

쿼리 예시:
```sql
SELECT q.name, qa.sumgrades, qa.timefinish
FROM mdl_quiz_attempts qa
JOIN mdl_quiz q ON q.id = qa.quiz
WHERE qa.userid = ? AND qa.state = 'finished'
ORDER BY qa.timefinish DESC LIMIT 5
```

■ 사용자 인터페이스 (UI/UX)
===============================================================================

【디자인 컨셉】
- Glass Morphism: 반투명 유리 효과
- 그라데이션 배경: 보라색 계열 (#667eea → #764ba2)
- 반응형 디자인: 모바일 퍼스트 접근법
- 직관적 아이콘: Font Awesome 활용

【레이아웃 구조】
1. 헤더: 환영 메시지 + 돌아가기 버튼
2. 학습 계획: 타이머 + 목표 설정 (2열 그리드)
3. 실용 도구: 요약 작성 + 오답노트 (2열 그리드)
4. 학습 현황: 퀴즈 결과 + 과제 현황 (2열 그리드)
5. 빠른 실행: 상세 페이지 이동 버튼들

【반응형 브레이크포인트】
- 모바일: ~768px (1열 레이아웃)
- 태블릿: 768px~1024px (2열 레이아웃)
- 데스크톱: 1024px+ (2-3열 레이아웃)

CSS 클래스:
```css
.glass {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
}
```

■ 보안 및 인증
===============================================================================

【세션 관리】
- PHP 세션 기반 사용자 인증
- 로그인 확인: $_SESSION['user_id'] 존재 여부
- 자동 리디렉션: 미로그인 시 login.php로 이동

인증 체크 코드:
```php
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (!isset($_SESSION['user_id'])) {
    header('Location: login.php');
    exit;
}
```

【데이터베이스 보안】
- PDO Prepared Statement 사용 (SQL Injection 방지)
- 입력 데이터 검증 및 필터링
- 에러 로깅: error_log() 함수 활용
- HTML 출력 시 htmlspecialchars() 적용

안전한 쿼리 예시:
```php
$stmt = $pdo->prepare("
    INSERT INTO mdl_abessi_today (userid, date, goals, timecreated)
    VALUES (?, ?, ?, ?)
");
$stmt->execute([$user_id, $today, $goals_json, $timestamp]);
```

■ 성능 최적화
===============================================================================

【데이터베이스 최적화】
- LIMIT 절 활용: 불필요한 대량 데이터 조회 방지
- 인덱스 활용: userid, timecreated 등 자주 조회되는 컬럼
- 예외 처리: try-catch 블록으로 DB 연결 오류 처리

【프론트엔드 최적화】
- CDN 활용: Tailwind CSS, Font Awesome 외부 CDN
- 이미지 최적화: 아이콘은 Font Awesome으로 대체
- JavaScript 최소화: 필요한 기능만 구현
- 로컬스토리지 활용: 체크리스트 상태는 클라이언트 저장

【캐싱 전략】
- PHP 세션: 목표 설정 등 임시 데이터
- localStorage: 체크리스트 상태 (제거됨)
- 데이터베이스: 영구 저장이 필요한 요약/오답노트

■ 에러 처리 및 로깅
===============================================================================

【에러 처리 패턴】
```php
try {
    // 데이터베이스 작업
    $pdo = get_mathking_db_connection();
    // ... 쿼리 실행
} catch (PDOException $e) {
    error_log("Database error: " . $e->getMessage());
    echo json_encode([
        'success' => false,
        'error' => '처리 중 오류가 발생했습니다.'
    ]);
} catch (Exception $e) {
    error_log("General error: " . $e->getMessage());
    // 적절한 사용자 메시지 표시
}
```

【로그 관리】
- 에러 로그: PHP error_log() 함수 사용
- 사용자 피드백: JSON 형태의 성공/실패 메시지
- 디버깅: 개발 모드에서만 상세 에러 정보 표시

■ 확장 가능성 및 향후 개발 방향
===============================================================================

【추가 가능한 기능】
1. 학습 통계 및 분석 차트
   - Chart.js를 활용한 시각화
   - 일별/주별/월별 학습 패턴 분석
   - 오답 유형별 통계

2. 알림 및 리마인더 시스템
   - 목표 달성 알림
   - 학습 시간 알림
   - 시험일 임박 알림

3. 교사 관리 기능
   - 학생별 학습 현황 모니터링
   - 개별 피드백 제공
   - 학습 리포트 생성

4. 모바일 앱 연동
   - PWA (Progressive Web App) 지원
   - 푸시 알림
   - 오프라인 모드

【기술적 개선사항】
- Redis 캐싱 도입으로 성능 향상
- WebSocket을 통한 실시간 업데이트
- API 표준화 (RESTful API)
- 단위 테스트 및 자동화 테스트 도입

■ 시스템 운영 및 유지보수
===============================================================================

【배포 환경】
- 서버: MathKing 운영 서버
- 웹서버: Apache/Nginx
- PHP 버전: 7.4+
- 데이터베이스: MySQL 5.7+

【모니터링】
- 접속 로그 확인
- 에러 로그 정기 점검
- 데이터베이스 성능 모니터링
- 사용자 피드백 수집

【백업 및 복원】
- 데이터베이스 정기 백업
- 소스 코드 버전 관리 (Git)
- 설정 파일 별도 관리

■ 개발 히스토리 및 변경사항
===============================================================================

【주요 개발 단계】
1. 초기 설계 (2024.09.05)
   - 기본 구조 설계
   - 데이터베이스 연동 설정

2. 실제 데이터 연동 (2024.09.05)
   - Moodle 테이블 연동
   - 실제 학습 데이터 표시

3. 학생 중심 기능 개편 (2024.09.05)
   - 활동 로그 중심 → 실용적 도구 중심
   - 인라인 요약/오답노트 작성 기능
   - 실시간 타이머 추가

4. UI/UX 개선 및 최적화 (2024.09.05)
   - 불필요한 섹션 제거 (체크리스트, 학습팁)
   - 그리드 레이아웃 최적화 (3열→2열)
   - 반응형 디자인 완성

【제거된 기능】
- 오늘 꼭 할 일 체크리스트
- 오늘의 학습 팁
- 관련 JavaScript 이벤트 핸들러

【현재 운영 상태】
- 메인 기능: 정상 작동
- 데이터베이스 연동: 안정적
- 사용자 피드백: 긍정적

■ 개발자 참고사항
===============================================================================

【코딩 컨벤션】
- PHP: PSR-12 표준 준수
- JavaScript: ES6+ 문법 사용
- CSS: Tailwind CSS 유틸리티 클래스 활용
- 들여쓰기: 4칸 스페이스

【필수 확인사항】
1. config.php 설정 확인
2. 데이터베이스 연결 테스트
3. 세션 관리 정상 작동 확인
4. AJAX 응답 형식 일관성 유지
5. 에러 처리 및 로깅 구현

【주요 파일별 역할】
- index.php: 메인 대시보드 (사용자 인터페이스)
- config.php: 데이터베이스 연결 설정
- ajax/*.php: 데이터 처리 API 엔드포인트
- save_*.php: 상세 입력 페이지

【데이터베이스 연결 함수】
```php
function get_mathking_db_connection() {
    try {
        $dsn = "mysql:host=" . MATHKING_DB_HOST . ";dbname=" . MATHKING_DB_NAME . ";charset=utf8mb4";
        $pdo = new PDO($dsn, MATHKING_DB_USER, MATHKING_DB_PASS, [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
        ]);
        return $pdo;
    } catch (PDOException $e) {
        error_log("DB Connection Error: " . $e->getMessage());
        return null;
    }
}
```

■ 문제 해결 가이드
===============================================================================

【자주 발생하는 문제】

1. 데이터베이스 연결 실패
   - config.php 설정 확인
   - 네트워크 연결 상태 점검
   - 데이터베이스 서버 상태 확인

2. 세션 관련 오류
   - session_start() 호출 확인
   - 세션 타임아웃 설정 점검
   - 쿠키 설정 확인

3. AJAX 요청 실패
   - 네트워크 탭에서 응답 확인
   - JSON 형식 검증
   - 서버 에러 로그 점검

4. UI 표시 오류
   - CSS 캐싱 문제
   - JavaScript 에러 확인
   - 브라우저 호환성 점검

【디버깅 방법】
- PHP 에러 로그 확인: error_log() 함수 활용
- 브라우저 개발자 도구: Console, Network 탭
- 데이터베이스 쿼리 직접 실행
- var_dump(), print_r() 디버깅 출력

===============================================================================
                              문서 작성일: 2024년 9월 5일
                              최종 업데이트: 2024년 9월 5일
                              작성자: Claude (AI Assistant)
                              버전: 1.0
===============================================================================