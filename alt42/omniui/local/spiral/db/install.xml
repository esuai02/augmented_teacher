<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="local/spiral/db" VERSION="20240101" COMMENT="Curriculum Spiral Scheduler plugin database tables"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <!-- 스파이럴 스케줄 마스터 테이블 -->
    <TABLE NAME="spiral_schedules" COMMENT="Master table for spiral learning schedules">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="teacher_id" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="student_id" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="exam_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="schedule_type" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="status" TYPE="char" LENGTH="30" NOTNULL="true" DEFAULT="draft" SEQUENCE="false"/>
        <FIELD NAME="ratio_preview" TYPE="number" LENGTH="3" DECIMALS="2" NOTNULL="true" DEFAULT="0.70" SEQUENCE="false"/>
        <FIELD NAME="ratio_review" TYPE="number" LENGTH="3" DECIMALS="2" NOTNULL="true" DEFAULT="0.30" SEQUENCE="false"/>
        <FIELD NAME="total_hours" TYPE="number" LENGTH="5" DECIMALS="2" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="start_date" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="end_date" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="schedule_data" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="teacher_fk" TYPE="foreign" FIELDS="teacher_id" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="student_fk" TYPE="foreign" FIELDS="student_id" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_student" UNIQUE="false" FIELDS="student_id"/>
        <INDEX NAME="idx_teacher" UNIQUE="false" FIELDS="teacher_id"/>
        <INDEX NAME="idx_dates" UNIQUE="false" FIELDS="start_date, end_date"/>
        <INDEX NAME="idx_status" UNIQUE="false" FIELDS="status"/>
      </INDEXES>
    </TABLE>

    <!-- 학습 세션 상세 테이블 -->
    <TABLE NAME="spiral_sessions" COMMENT="Individual learning session details">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="schedule_id" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="session_date" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="session_time" TYPE="char" LENGTH="8" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="duration_minutes" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="30" SEQUENCE="false"/>
        <FIELD NAME="session_type" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="preview" SEQUENCE="false"/>
        <FIELD NAME="unit_id" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="unit_name" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="difficulty_level" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="3" SEQUENCE="false"/>
        <FIELD NAME="completion_status" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="pending" SEQUENCE="false"/>
        <FIELD NAME="actual_duration" TYPE="int" LENGTH="4" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="performance_score" TYPE="number" LENGTH="5" DECIMALS="2" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="notes" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="schedule_fk" TYPE="foreign" FIELDS="schedule_id" REFTABLE="spiral_schedules" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_schedule_date" UNIQUE="false" FIELDS="schedule_id, session_date"/>
        <INDEX NAME="idx_session_type" UNIQUE="false" FIELDS="session_type"/>
        <INDEX NAME="idx_completion" UNIQUE="false" FIELDS="completion_status"/>
      </INDEXES>
    </TABLE>

    <!-- 충돌 로그 테이블 -->
    <TABLE NAME="spiral_conflicts" COMMENT="Schedule conflict detection and resolution log">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="schedule_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="conflict_type" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="conflict_data" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="resolution_type" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="resolved_by" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timeresolved" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="schedule_fk" TYPE="foreign" FIELDS="schedule_id" REFTABLE="spiral_schedules" REFFIELDS="id"/>
        <KEY NAME="resolver_fk" TYPE="foreign" FIELDS="resolved_by" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_schedule" UNIQUE="false" FIELDS="schedule_id"/>
        <INDEX NAME="idx_conflict_type" UNIQUE="false" FIELDS="conflict_type"/>
      </INDEXES>
    </TABLE>

    <!-- 스케줄 템플릿 테이블 -->
    <TABLE NAME="spiral_templates" COMMENT="Reusable schedule templates for teachers">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="teacher_id" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="template_name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="grade_level" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="subject" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="exam_type" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="template_data" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="usage_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="is_public" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="teacher_fk" TYPE="foreign" FIELDS="teacher_id" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_teacher" UNIQUE="false" FIELDS="teacher_id"/>
        <INDEX NAME="idx_public" UNIQUE="false" FIELDS="is_public"/>
        <INDEX NAME="idx_grade_subject" UNIQUE="false" FIELDS="grade_level, subject"/>
      </INDEXES>
    </TABLE>
  </TABLES>
</XMLDB>