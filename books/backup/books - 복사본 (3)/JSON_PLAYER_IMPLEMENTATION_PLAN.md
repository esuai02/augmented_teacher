# JSON 기반 절차기억 플레이어 UI 구현 계획

## 📋 개요
mynote_json_player.php - JSON 구조화된 절차기억 나레이션을 레벨별로 재생할 수 있는 플레이어

## 🎯 구현 작업 목록

### Task 1: 기본 파일 구조 생성
**목표**: mynote_json_player.php 파일 생성 및 기본 구조 설정

**단계**:
1. mynotepause.php 복사하여 mynote_json_player.php 생성
2. PHP 헤더 설정 (Moodle config, DB 연결, 사용자 인증)
3. contentsid, contentstype 파라미터 처리
4. DB에서 절차기억 데이터 로드 (reflections1 필드)

**검증**:
- 파일 접근 가능 확인
- DB 연결 정상 확인
- 데이터 로드 성공 확인

---

### Task 2: JSON 데이터 파싱 및 버튼 생성
**목표**: JSON 구조를 분석하여 버튼 목록 생성

**단계**:
1. JSON 데이터 파싱 (proceduraldata 필드)
2. 파일 목록 순회하며 버튼 데이터 생성
3. 버튼 타입별 분류:
   - Q (문제설명) - 파란색 원형 중간
   - B (기본지시문) - 주황색 원형 중간
   - E (보조지시문) - 회색 원형 작게
   - T (전체정리) - 보라색 둥근사각형 중간
   - K (핵심정리) - 보라색 둥근사각형 중간
   - S (구조기억) - 보라색 둥근사각형 중간
4. parent-child 관계 설정 (E는 해당 B의 자식)

**검증**:
- JSON 파싱 성공 확인
- 버튼 데이터 구조 출력 확인
- 타입별 분류 정확성 확인

---

### Task 3: 레벨 선택 UI 구현
**목표**: 기본/상세 모드 토글 기능

**단계**:
1. 상단에 레벨 토글 버튼 추가
   ```html
   <div id="level-selector">
     <button id="basic-mode" class="active">기본 모드</button>
     <button id="detail-mode">상세 모드</button>
   </div>
   ```
2. CSS 스타일 정의
3. JavaScript 토글 이벤트 핸들러:
   - 기본 모드: Q + B만 표시
   - 상세 모드: Q + B + E 모두 표시
4. 버튼 표시/숨김 로직

**검증**:
- 토글 버튼 클릭 시 모드 전환 확인
- 기본 모드에서 E 버튼 숨김 확인
- 상세 모드에서 모든 버튼 표시 확인

---

### Task 4: 버튼 시각 디자인 구현
**목표**: 타입별 차별화된 버튼 디자인

**단계**:
1. CSS 클래스 정의:
   ```css
   .audio-btn-Q { /* 파란색 원형 중간 */ }
   .audio-btn-B { /* 주황색 원형 중간 */ }
   .audio-btn-E { /* 회색 원형 작게 */ }
   .audio-btn-T { /* 보라색 둥근사각형 중간 */ }
   .audio-btn-K { /* 보라색 둥근사각형 중간 */ }
   .audio-btn-S { /* 보라색 둥근사각형 중간 */ }
   ```
2. 크기 설정:
   - 중간: 50px
   - 작게: 35px
3. 호버 효과 추가
4. 활성 상태 표시 (현재 재생 중)

**검증**:
- 각 타입별 색상 정확성 확인
- 크기 차이 시각적 확인
- 호버 효과 동작 확인

---

### Task 5: 오디오 재생 로직 구현
**목표**: 버튼 클릭 시 해당 음성 파일 재생

**단계**:
1. HTML5 Audio 플레이어 추가
2. 버튼 클릭 이벤트 핸들러:
   - 현재 재생 중이면 정지
   - 새 파일 로드 및 재생
   - 활성 버튼 표시 업데이트
3. 재생 완료 시 다음 버튼 활성화 (선택적)
4. 재생 진행률 표시

**검증**:
- 버튼 클릭 시 음성 재생 확인
- 다른 버튼 클릭 시 전환 확인
- 재생 완료 이벤트 처리 확인

---

### Task 6: 순차 재생 기능 (선택적)
**목표**: 자동 순차 재생 모드

**단계**:
1. "순차 재생" 토글 버튼 추가
2. 재생 완료 시 다음 파일 자동 재생
3. 레벨에 따라 건너뛰기:
   - 기본 모드: Q → B1 → B2 → ... → T → K → S
   - 상세 모드: Q → B1 → E1_1 → E1_2 → B2 → ...
4. 정지/재시작 기능

**검증**:
- 순차 재생 동작 확인
- 레벨별 건너뛰기 확인
- 정지/재시작 정상 동작

---

## 🔍 전체 시스템 검증

### 통합 테스트 시나리오

1. **시나리오 1: JSON 생성 → 플레이어 재생**
   - openai_tts_pmemory.php에서 JSON 나레이션 생성
   - 음성 파일 생성 확인
   - mynote_json_player.php에서 데이터 로드
   - 모든 버튼 표시 확인
   - 각 버튼 재생 테스트

2. **시나리오 2: 레벨 전환 테스트**
   - 기본 모드로 시작
   - 상세 모드로 전환
   - 보조지시문 버튼 표시 확인
   - 다시 기본 모드로 전환
   - 보조지시문 버튼 숨김 확인

3. **시나리오 3: 다양한 JSON 구조 테스트**
   - 기본지시문 3개 케이스
   - 기본지시문 5개 + 보조지시문 많은 케이스
   - 최소 구조 (문제설명 + 구조기억만) 케이스

### 성능 테스트
- 20개 이상 버튼 렌더링 속도
- 음성 파일 로딩 시간
- 레벨 전환 반응 속도

### 사용성 테스트
- 버튼 클릭 용이성
- 색상 구분 명확성
- 모바일 반응형 확인

---

## 📦 배치 실행 계획

**Batch 1** (Tasks 1-2): 기본 파일 구조 + 데이터 파싱
**Batch 2** (Tasks 3-4): 레벨 선택 + 버튼 디자인
**Batch 3** (Task 5): 오디오 재생 로직
**Batch 4** (Task 6 + 통합 테스트): 순차 재생 + 전체 검증

---

## 🎨 UI 레이아웃 스케치

```
┌─────────────────────────────────────────┐
│  [기본 모드] [상세 모드]  [순차재생 □]  │ ← 레벨 선택
├─────────────────────────────────────────┤
│                                         │
│  (Q1) 문제설명                          │ ← 파란색 원형
│                                         │
│  (B1) 기본지시문1                       │ ← 주황색 원형
│    (E1_1) (E1_2) (E1_3)                │ ← 회색 작은 원형 (상세모드만)
│                                         │
│  (B2) 기본지시문2                       │
│    (E2_1) (E2_2)                       │
│                                         │
│  [T1] 전체정리                          │ ← 보라색 둥근사각형
│                                         │
│  [K1] 핵심정리                          │
│                                         │
│  [S1] 구조기억                          │
│                                         │
├─────────────────────────────────────────┤
│  <audio controls id="player">          │ ← 오디오 플레이어
│  ━━━━━━━━━━━━━━━━━━━━ 00:45 / 01:30    │
└─────────────────────────────────────────┘
```

---

**작성일**: 2025-10-23
**작성자**: Claude Code
**참고 파일**: mynotepause.php, openai_tts_pmemory.php
