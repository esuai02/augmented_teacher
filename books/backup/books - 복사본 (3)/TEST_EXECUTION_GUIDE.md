# 🧪 JSON 절차기억 나레이션 시스템 테스트 실행 가이드

## 📋 테스트 준비

**날짜**: 2025-10-23
**테스트 환경**: https://mathking.kr/moodle/
**테스터**: _______________

---

## 🎯 Scenario 1: End-to-End Workflow Test

### Step 1: 나레이션 생성 페이지 접근

**URL**:
```
https://mathking.kr/moodle/local/augmented_teacher/books/openai_tts_pmemory.php?cid=TEST001&ctype=1
```

**예상 결과**:
- ✅ 페이지 정상 로드
- ✅ "🎓 절차기억 나레이션 생성" 버튼 표시
- ✅ 텍스트 입력 영역 표시

**실제 결과**:
```
[ ] 성공
[ ] 실패 - 오류 내용: _______________
```

---

### Step 2: 테스트 문제 입력

**입력할 내용**:
```
문제: 다음 식을 간단히 하시오. (x²+2x+1)/(x+1)

풀이:
x²+2x+1 = (x+1)² 이므로,
(x+1)²/(x+1) = x+1

답: x+1
```

**액션**: 텍스트를 입력 영역에 붙여넣기

**실제 결과**:
```
[ ] 입력 완료
```

---

### Step 3: 나레이션 생성 버튼 클릭

**액션**: "🎓 절차기억 나레이션 생성" 버튼 클릭

**예상 결과**:
- ✅ GPT API 호출 시작 메시지
- ✅ JSON 포맷 출력 확인
- ✅ 다음과 같은 구조가 보여야 함:

```json
{
  "문제설명": "...",
  "기본지시문1": "...",
  "보조지시문1": [...],
  "기본지시문2": "...",
  ...
  "전체정리": "...",
  "핵심정리": "...",
  "구조기억": "..."
}
```

**실제 결과**:
```
[ ] JSON 포맷 출력 성공
[ ] 일반 텍스트 출력 (JSON 실패)
[ ] 에러 발생 - 내용: _______________

출력된 JSON 구조 (처음 5줄만):
_______________
_______________
_______________
_______________
_______________
```

---

### Step 4: DB 저장 확인

**DB 쿼리 실행** (phpMyAdmin 또는 SQL 클라이언트):
```sql
SELECT * FROM mdl_abrainalignment_gptresults
WHERE type='pmemory' AND contentsid='TEST001'
ORDER BY id DESC LIMIT 1;
```

**예상 결과**:
- ✅ 레코드 존재
- ✅ `outputtext` 필드에 JSON 문자열 저장
- ✅ JSON 유효성 확인 (`{`로 시작, `}`로 끝남)

**실제 결과**:
```
[ ] DB 저장 성공
[ ] DB 저장 실패
[ ] outputtext 내용 (처음 100자): _______________
```

---

### Step 5: TTS 음성 생성 버튼 클릭

**액션**: "🎵 음성 생성" 버튼 클릭 (나레이션 생성 후 나타남)

**예상 결과**:
- ✅ "🎯 JSON 절차기억 모드" 메시지 출력
- ✅ 순차 생성 진행 메시지:
  ```
  [Q1] 문제설명 음성 생성 중...
  ✅ Q1 생성 완료
  [B1] 기본지시문1 음성 생성 중...
  ✅ B1 생성 완료
  [E1_1] 보조지시문1-1 음성 생성 중...
  ...
  ```
- ✅ "DB 저장 완료" 메시지

**실제 결과**:
```
[ ] JSON 모드 인식 성공
[ ] 순차 생성 진행 확인
[ ] 생성된 파일 개수: _____개
[ ] DB 저장 완료 메시지 확인

에러 발생 시:
_______________
```

---

### Step 6: DB 음성 파일 정보 확인

**DB 쿼리 실행**:
```sql
SELECT * FROM mdl_reflections1
WHERE contentsid='TEST001' AND contentstype='1'
ORDER BY id DESC LIMIT 1;
```

**예상 결과**:
- ✅ 레코드 존재
- ✅ `audiourls` 필드에 JSON 데이터 저장
- ✅ JSON 구조 확인:
  ```json
  {
    "mode": "procedural_json",
    "files": [
      {"key": "Q1", "url": "...", "text": "...", "type": "문제설명"},
      {"key": "B1", "url": "...", "text": "...", "type": "기본지시문"},
      ...
    ],
    "json_structure": {...}
  }
  ```

**실제 결과**:
```
[ ] DB 저장 성공
[ ] mode 값: _______________
[ ] files 배열 개수: _____개
[ ] json_structure 존재: [ ] 예 [ ] 아니오

audiourls 내용 (처음 200자):
_______________
_______________
_______________
```

---

### Step 7: 플레이어 페이지 접근

**URL**:
```
https://mathking.kr/moodle/local/augmented_teacher/books/mynote_json_player.php?contentsid=TEST001&contentstype=1
```

**예상 결과**:
- ✅ 페이지 정상 로드
- ✅ "총 N개 음성 파일" 메시지 표시
- ✅ 레벨 선택 버튼 2개 표시 ("📘 기본 모드", "📗 상세 모드")
- ✅ 오디오 버튼들이 타입별로 렌더링됨

**실제 결과**:
```
[ ] 페이지 로드 성공
[ ] 음성 파일 개수 표시: _____개
[ ] 레벨 선택 버튼 표시 확인
[ ] 오디오 버튼 렌더링 확인

에러 발생 시:
_______________
```

---

### Step 8: 버튼 타입별 시각 확인

**확인 사항**:

| 버튼 타입 | 색상 | 모양 | 크기 | 실제 결과 |
|----------|------|------|------|-----------|
| Q1 (문제설명) | 파란색 그라디언트 | 원형 | 50px | [ ] 일치 [ ] 불일치 |
| B1 (기본지시문) | 주황색 그라디언트 | 원형 | 50px | [ ] 일치 [ ] 불일치 |
| E1_1 (보조지시문) | 회색 그라디언트 | 원형 | 35px | [ ] 일치 [ ] 불일치 |
| T1 (전체정리) | 보라색 그라디언트 | 둥근사각형 | 50px | [ ] 일치 [ ] 불일치 |
| K1 (핵심정리) | 보라색 그라디언트 | 둥근사각형 | 50px | [ ] 일치 [ ] 불일치 |
| S1 (구조기억) | 보라색 그라디언트 | 둥근사각형 | 50px | [ ] 일치 [ ] 불일치 |

**실제 스크린샷** (선택사항):
```
스크린샷 첨부 위치: _______________
```

---

### Step 9: 기본 모드 테스트

**액션**: "📘 기본 모드" 버튼이 활성화된 상태 확인

**예상 결과**:
- ✅ 기본 모드 버튼이 파란색으로 활성화
- ✅ Q, B, T, K, S 버튼만 표시
- ✅ E (보조지시문) 버튼 숨김

**실제 결과**:
```
[ ] 기본 모드 활성화 확인
[ ] E 버튼 숨김 확인
[ ] 표시되는 버튼 개수: _____개
```

---

### Step 10: 상세 모드 테스트

**액션**: "📗 상세 모드" 버튼 클릭

**예상 결과**:
- ✅ 상세 모드 버튼이 파란색으로 활성화
- ✅ 모든 버튼 표시 (Q, B, E, T, K, S)
- ✅ E 버튼들이 해당 B 버튼 아래에 배치

**실제 결과**:
```
[ ] 상세 모드 활성화 확인
[ ] E 버튼 표시 확인
[ ] E 버튼 위치 적절성: [ ] 적절 [ ] 부적절
[ ] 표시되는 버튼 개수: _____개
```

---

### Step 11: 오디오 재생 테스트

**액션**: Q1 버튼 클릭

**예상 결과**:
- ✅ "🎵 재생 중: Q1" 메시지 표시
- ✅ 오디오 자동 재생 시작
- ✅ Q1 버튼에 `pulse` 애니메이션 적용
- ✅ 음성 내용이 문제설명과 일치

**실제 결과**:
```
[ ] 재생 메시지 표시 확인
[ ] 오디오 재생 시작 확인
[ ] 버튼 애니메이션 확인
[ ] 음성 내용 일치: [ ] 일치 [ ] 불일치 [ ] 확인 불가

에러 발생 시:
_______________
```

---

### Step 12: 버튼 전환 테스트

**액션**: Q1 재생 중에 B1 버튼 클릭

**예상 결과**:
- ✅ Q1 애니메이션 즉시 종료
- ✅ B1 애니메이션 시작
- ✅ "🎵 재생 중: B1" 메시지로 변경
- ✅ 오디오 즉시 전환 (Q1 중단, B1 시작)

**실제 결과**:
```
[ ] Q1 애니메이션 종료 확인
[ ] B1 애니메이션 시작 확인
[ ] 재생 메시지 변경 확인
[ ] 오디오 전환 확인

전환 지연 시간: _____ms (목표: <500ms)
```

---

### Step 13: 재생 완료 테스트

**액션**: 짧은 음성 파일을 끝까지 재생

**예상 결과**:
- ✅ "✅ 재생 완료" 메시지 표시
- ✅ 버튼 애니메이션 종료

**실제 결과**:
```
[ ] 재생 완료 메시지 확인
[ ] 애니메이션 종료 확인
```

---

## 📊 Scenario 1 테스트 결과 요약

### 전체 통과율
```
통과한 단계: _____/13
통과율: _____%

PASS / FAIL: _______________
```

### 발견된 버그
```
1. 버그 설명: _______________
   재현 방법: _______________
   우선순위: [ ] High [ ] Medium [ ] Low

2. 버그 설명: _______________
   재현 방법: _______________
   우선순위: [ ] High [ ] Medium [ ] Low

3. 버그 설명: _______________
   재현 방법: _______________
   우선순위: [ ] High [ ] Medium [ ] Low
```

### 개선 제안
```
1. _______________
2. _______________
3. _______________
```

---

## 🔍 추가 테스트 시나리오 (선택사항)

### Scenario 2-1: 최소 구조 테스트
**입력 문제**:
```
문제: 2+3 = ?
답: 5
```

**예상**: 문제설명 + 구조기억만 생성 (2개 버튼)

**결과**: _______________

---

### Scenario 2-2: 대량 구조 테스트
**입력 문제**: 복잡한 증명 문제 (피타고라스 정리 등)

**예상**: 기본지시문 5개 이상, 보조지시문 각 3개씩

**결과**: _______________

---

### Scenario 3-1: 하위 호환성 테스트
**입력 텍스트**:
```
첫 번째 구간@두 번째 구간@세 번째 구간
```

**예상**: @ 기호 방식으로 자동 전환, 정상 음성 생성

**결과**: _______________

---

### Scenario 3-2: 존재하지 않는 contentsid 테스트
**URL**:
```
https://mathking.kr/moodle/local/augmented_teacher/books/mynote_json_player.php?contentsid=NOTEXIST&contentstype=1
```

**예상**: "📭 데이터 없음" 메시지, 나레이션 생성 페이지 링크 제공

**결과**: _______________

---

## ✅ 최종 체크리스트

### 필수 항목 (Must Have)
- [ ] 전체 워크플로우 정상 동작
- [ ] 모든 버튼 타입 렌더링 성공
- [ ] 오디오 재생 정상
- [ ] 레벨 전환 정상
- [ ] 에러 핸들링 동작

### 권장 항목 (Should Have)
- [ ] 모바일 반응형 완벽 (Chrome DevTools 모바일 시뮬레이션)
- [ ] 성능 최적화 (페이지 로드 <2초)
- [ ] 접근성 점수 90+ (Lighthouse)

---

**테스트 완료 시간**: _______________
**테스터 서명**: _______________
