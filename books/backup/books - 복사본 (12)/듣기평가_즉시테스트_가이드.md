# 🚀 듣기평가 시스템 - 즉시 테스트 가이드

## ✅ 모든 수정 완료!

다음 수정이 완료되었습니다:
- ✅ 실시간 디버깅 정보 표시 (대본 분석, @ 개수 확인)
- ✅ 사용법 안내 박스 추가 (페이지 상단)
- ✅ 명확한 버튼 텍스트
- ✅ 모든 경로 오류 수정

---

## 🎯 즉시 테스트 - 3단계

### 1️⃣ 음성 생성 페이지 열기
```
https://mathking.kr/moodle/local/augmented_teacher/books/openai_tts_pmemory.php?cid=30101&ctype=1
```

페이지가 열리면 **노란색 안내 박스**가 보일 것입니다:
```
🎧 듣기평가 모드 사용법:
1. 아래 텍스트 영역에 @ 기호로 구간을 구분하세요
2. 예: "첫 번째 구간 내용@두 번째 구간 내용@세 번째 구간 내용"
3. "음성 생성" 버튼 클릭
4. ✅ 듣기평가 정보 DB 저장 완료! 메시지 확인 (중요!)
```

### 2️⃣ 테스트 대본 입력

**기존 텍스트를 모두 삭제**하고 아래 테스트 대본을 복사해서 붙여넣으세요:

```
오늘은 피타고라스 정리에 대해 알아보겠습니다. 직각삼각형에서 빗변의 제곱은 두 직각변의 제곱의 합과 같다는 중요한 정리입니다.@이제 예제를 풀어보겠습니다. 직각삼각형의 두 변이 3과 4일 때, 빗변의 길이를 구하세요.@빗변의 제곱은 3의 제곱 더하기 4의 제곱입니다. 9 더하기 16은 25입니다.@따라서 빗변의 길이는 루트 25, 즉 5입니다. 피타고라스 정리를 이용하면 쉽게 구할 수 있습니다.
```

### 3️⃣ "🎵 음성 생성" 버튼 클릭

버튼 클릭 후 **반드시 다음 메시지들을 확인**하세요:

#### ✅ 정상 작동 시 표시되는 메시지:

```
📋 대본 분석 중...
대본 길이: 176자
@ 기호 개수: 3개

🎯 듣기평가 모드: @ 기호로 구간을 분리합니다.
총 4개 구간으로 분리되었습니다.

[구간 1/4] 음성 생성 중...
"오늘은 피타고라스 정리에 대해 알아보겠습니다..."
✅ 구간 1 음성 생성 완료
🔄 구간 1 서버 업로드 중...
✅ 구간 1 업로드 완료!

[구간 2/4] 음성 생성 중...
...
✅ 구간 2 업로드 완료!

[구간 3/4] 음성 생성 중...
...
✅ 구간 3 업로드 완료!

[구간 4/4] 음성 생성 중...
...
✅ 구간 4 업로드 완료!

🎉 모든 구간의 음성 생성 및 업로드 완료!
✅ 총 4개 파일이 서버에 업로드되었습니다.
🔄 듣기평가 정보를 DB에 저장 중...

⭐ ✅ 듣기평가 정보 DB 저장 완료!  ← 이 메시지가 제일 중요!
→ mynotepause.php 페이지에서 듣기평가 인터페이스를 사용할 수 있습니다.

첫 번째 구간 재생을 시작합니다...
```

**🔴 중요:** "✅ 듣기평가 정보 DB 저장 완료!" 메시지가 나와야 합니다!

---

## 🎧 듣기평가 인터페이스 확인

음성 생성이 완료되면 **mynotepause.php** 페이지로 이동:

```
https://mathking.kr/moodle/local/augmented_teacher/books/mynotepause.php?cid=30101&nch=7&cmid=87729&page=6&studentid=2&quizid=
```

### ✅ 정상 작동 시:

```
🔍 디버깅 정보:
reflections1 내용: {"mode":"listening_test","sections":["https://mathking.kr/Contents/audiofiles/pmemory/cid30101ct1_section1.wav","https://mathking.kr/Contents/audiofiles/pmemory/cid30101ct1_section2.wav",...

┌──────────────────────────────────────┐
│ 듣기평가 모드 - 구간 1/4              │
├──────────────────────────────────────┤
│ 🔊 [오디오 자동 재생]                 │
│                                      │
│ 📝 현재 구간:                         │
│ "오늘은 피타고라스 정리에 대해..."     │
│                                      │
│ [다음 구간 (2/4)] ← 재생 완료 후 활성화 │
└──────────────────────────────────────┘
```

- 첫 번째 구간이 **자동으로 재생**됩니다
- 재생이 완료되면 **"다음 구간" 버튼이 활성화**됩니다
- 버튼을 클릭하면 다음 구간으로 이동합니다

---

## ❌ 문제 발생 시

### 1. "@ 기호 개수: 0개" 라고 나옴
**원인:** @ 기호를 입력하지 않았습니다  
**해결:** 대본에 반드시 @ 기호를 포함하세요

### 2. "❌ DB 저장 실패" 메시지
**원인:** check_status.php 경로 또는 권한 문제  
**해결:** 
1. 브라우저 콘솔(F12) 열기
2. Console 탭에서 에러 메시지 확인
3. 에러 메시지를 복사해서 알려주세요

### 3. mynotepause.php에서 "reflections1 필드가 비어있습니다"
**원인:** 
- @ 기호 없이 음성을 생성했거나
- "✅ DB 저장 완료!" 메시지가 안 나왔음

**해결:**
1. openai_tts_pmemory.php로 다시 돌아가기
2. @ 기호 포함된 대본으로 **다시** 음성 생성
3. "✅ DB 저장 완료!" 메시지 확인

---

## 🔍 브라우저 콘솔 확인 방법

문제가 발생하면:

1. **F12** 키를 누르세요
2. **Console** 탭을 클릭하세요
3. 빨간색 에러 메시지를 확인하세요
4. 에러 메시지를 복사해서 알려주시면 바로 해결해드립니다!

---

## 📊 파일 생성 확인

듣기평가 모드로 정상 생성되면 서버에 다음 파일들이 생성됩니다:

```
/home/moodle/public_html/Contents/audiofiles/pmemory/
├── cid30101ct1_section1.wav  ← 첫 번째 구간
├── cid30101ct1_section2.wav  ← 두 번째 구간
├── cid30101ct1_section3.wav  ← 세 번째 구간
└── cid30101ct1_section4.wav  ← 네 번째 구간
```

**일반 모드**(@ 없이)로 생성하면:
```
cid30101ct1_pmemory.wav  ← 전체 하나로 합쳐진 파일 (듣기평가 X)
```

---

## 🎯 최종 체크리스트

음성 생성 페이지에서:
- [ ] 노란색 안내 박스가 보인다
- [ ] 대본에 @ 기호가 포함되어 있다
- [ ] "📋 대본 분석 중... @ 기호 개수: X개" 메시지가 나온다 (X > 0)
- [ ] "🎯 듣기평가 모드" 메시지가 나온다
- [ ] 각 구간별로 "✅ 구간 X 업로드 완료!" 메시지가 나온다
- [ ] **"✅ 듣기평가 정보 DB 저장 완료!"** 메시지가 나온다 ⭐

mynotepause.php 페이지에서:
- [ ] "🔍 디버깅 정보" 노란색 박스가 나온다
- [ ] "듣기평가 모드 - 구간 1/X" 텍스트가 보인다
- [ ] 오디오가 자동으로 재생된다
- [ ] 재생 완료 후 "다음 구간" 버튼이 활성화된다

**모든 항목이 체크되면 성공!** 🎉

---

## 💡 팁

### 짧은 테스트용 대본 (빠른 확인용)
```
첫번째 구간입니다.@두번째 구간입니다.@세번째 구간입니다.
```

### 실전용 긴 대본
위에 제공된 피타고라스 정리 대본 사용

### URL 바로가기
- 음성 생성: `https://mathking.kr/moodle/local/augmented_teacher/books/openai_tts_pmemory.php?cid=30101&ctype=1`
- 재생 확인: `https://mathking.kr/moodle/local/augmented_teacher/books/mynotepause.php?cid=30101&nch=7&cmid=87729&page=6&studentid=2&quizid=`

---

**지금 바로 테스트해보세요!** 🚀

문제가 발생하면 F12 콘솔의 에러 메시지를 알려주시면 바로 해결해드립니다!


