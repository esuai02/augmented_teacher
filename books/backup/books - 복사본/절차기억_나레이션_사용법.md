# 🎓 절차기억 나레이션 생성 시스템 - 사용 가이드

## ✅ 기능 개요

GPT-4를 사용하여 수학 문제와 풀이를 **절차기억 형성용 듣기평가 나레이션**으로 자동 변환하는 시스템입니다.

### 주요 특징
- 🤖 GPT-4 기반 자동 나레이션 생성
- 🎯 절차 중심의 구조화된 설명
- 👨‍🏫 도제학습 스타일의 질문-답변 방식
- 👁️ 시각적 관찰 지시 포함
- 🔄 절차기억 형성 활동 자동 추가
- 🎧 @ 기호로 자동 구간 분리 (듣기평가용)

---

## 🚀 사용 방법

### 1️⃣ 페이지 접속
```
https://mathking.kr/moodle/local/augmented_teacher/books/openai_tts_pmemory.php?cid=30101&ctype=1
```

### 2️⃣ 원본 문제/풀이 입력

**텍스트 영역에 수학 문제와 풀이를 입력**하세요. 예시:

```
문제: 한 변의 길이가 x인 정육면체를 5개 쌓아 만든 입체도형이 있다.
이 입체의 부피를 A, 겉넓이를 B라 할 때, A = 2B - 320을 만족하는 x의 값을 구하시오.

풀이:
1. 정육면체 한 개의 부피: x³
2. 전체 부피 A = 5x³
3. 겉넓이 계산:
   - 맞닿은 면 제외
   - 드러난 면 개수 세기
   - B = (면 개수) × x²
4. 조건 대입: 5x³ = 2B - 320
5. x 값 구하기 (양수 조건)
```

### 3️⃣ "🎓 절차기억 나레이션 생성" 버튼 클릭

버튼을 클릭하면:

1. **GPT-4가 나레이션 생성 중...**
   - 버튼이 "⏳ GPT 나레이션 생성 중..."으로 변경
   - 약 10-20초 소요

2. **생성 완료**
   - ✅ 성공 메시지 표시
   - 텍스트 영역에 나레이션 자동 입력
   - @ 기호로 구간 자동 분리

### 4️⃣ 생성된 나레이션 확인

텍스트 영역에 다음과 같은 나레이션이 자동으로 채워집니다:

```
지금 문제의 전체 그림을 천천히 훑어보세요. 무엇을 구하라는지 본문에서 찾아서 한 줄로 직접 써보세요. 맞아요! 정육면체를 엑스 길이로 오 개 쌓아 만든 입체에서, 부피를 에이, 겉넓이를 비로 두고, 에이가 이 비 빼기 삼백 이십과 같을 때의 엑스를 찾는 문제예요. 그럼 이제, 왜 에이와 비를 엑스로 표현해야 하는지 이유를 짧게 적어보세요.@

지금 그림의 오른쪽 위를 보세요. 가장 위에 있는 정육면체 하나를 손가락으로 가리키듯 마음속으로 표시하고...
```

**주의:** 
- 모든 숫자가 한글로 변환됨 (1→일, 2→이, 3→삼)
- 각 단락 끝에 @ 기호가 자동 추가됨
- 절차기억 형성 활동이 자동으로 포함됨

### 5️⃣ 음성 생성

나레이션 확인 후 **"🎵 음성 생성" 버튼** 클릭:

```
📋 대본 분석 중...
@ 기호 개수: 12개

🎯 듣기평가 모드: @ 기호로 구간을 분리합니다.
총 13개 구간으로 분리되었습니다.

[구간 1/13] 음성 생성 중...
✅ 구간 1 업로드 완료!
...
✅ 듣기평가 정보 DB 저장 완료!
```

### 6️⃣ mynotepause.php에서 듣기평가 실행

```
https://mathking.kr/moodle/local/augmented_teacher/books/mynotepause.php?cid=30101&...
```

듣기평가 인터페이스가 표시되고 구간별 순차 재생이 시작됩니다!

---

## 🎯 나레이션 생성 규칙

### GPT 프롬프트 핵심

1. **수학 문제 → 절차기억 나레이션**
   - 계산보다 절차와 구조 강조
   - 도제학습 스타일 (질문 → 답변 → 실행)

2. **시각적 지시 포함**
   - "지금 그림의 오른쪽 위를 보세요"
   - "손가락으로 가리키세요"
   - "스케치로 그려보세요"

3. **절차기억 형성 활동**
   - "절차기억 형성활동을 시작합니다" 전환 문구
   - 앞의 내용 재정리 및 강조
   - 스스로 풀어보기 유도

4. **한글 전용**
   - 모든 숫자/기호를 한글로 변환
   - 1,2,3 → 일, 이, 삼 (하나, 둘, 셋 X)
   - 0.35 → 영점삼오
   - 3/4 → 사분의 삼

5. **@ 기호 자동 추가**
   - 각 단락 끝에 @ 기호
   - 음성 일시정지 지점 표시

---

## 📊 나레이션 구조

### 1단계: 문제 탐구 (도입)
```
지금 문제의 전체 그림을 천천히 훑어보세요.
무엇을 구하라는지 본문에서 찾아서 한 줄로 직접 써보세요.
맞아요! [문제 요약]
그럼 이제, [다음 사고 유도]@
```

### 2단계: 단계별 관찰 및 실행
```
지금 그림의 [위치]를 보세요.
[관찰 대상] 손가락으로 가리키듯 마음속으로 표시하고...
맞아요! [핵심 개념]
그럼 이제, [실행 지시]@
```

### 3단계: 절차기억 형성
```
절차기억 형성활동을 시작합니다.@

방금의 절차를 다시 써보세요.
[5단계 절차 요약]
맞아요! [강화 메시지]@

이제 중요한 사실을 굵게 다시 써보세요.
일, [중요사실1]
이, [중요사실2]
삼, [중요사실3]@

이제 스스로 풀어보기를 유도합니다.
[요약 반복]
마지막 줄에는 "이제 문제만 보고 풀 수 있는지 생각해 보세요.
스스로 머릿속으로 풀어 보세요."라고 직접 적고...@
```

---

## 🔍 샘플 입력 & 출력

### 입력 (원본 문제):
```
정육면체를 x 길이로 5개 쌓은 입체도형.
부피 A, 겉넓이 B, A = 2B - 320일 때 x를 구하시오.
```

### 출력 (생성된 나레이션):
```
지금 문제의 전체 그림을 먼저 바라보세요. 무엇을 구하라고 했는지 귀로 또렷하게 말해볼까요? 맞아요! 옆모습 그림처럼 정육면체를 엑스 길이로 오개 쌓아 만든 입체도형에서, 부피를 에이, 겉넓이를 비라 두고, 에이가 이비 빼기 삼백이십과 같을 때 엑스를 찾으라는 것이에요. 그럼 이제, 왜 부피와 겉넓이를 엑스로 표현해야 하는지 떠올려 보세요.@

지금 그림의 오른쪽 위를 보세요. 가장 위에 놓인 정육면체가 보이나요? 맞아요! 정육면체 하나의 부피는 변이 엑스인 정육면체의 기본식으로 표현돼요...
```

---

## ⚙️ 기술 스펙

### 파일 구조
```
books/
├── openai_tts_pmemory.php          # 메인 페이지 (버튼 추가됨)
├── generate_procedural_narration.php  # GPT API 호출 백엔드
└── 절차기억_나레이션_사용법.md      # 이 문서
```

### API 호출
- **모델:** GPT-4o
- **Temperature:** 0.7
- **Max Tokens:** 3000
- **System Prompt:** 상세한 나레이션 생성 규칙 포함

### 응답 형식
```json
{
  "success": true,
  "narration": "생성된 나레이션 전체 텍스트...",
  "sectionCount": 13,
  "message": "절차기억 나레이션 생성 완료! (총 13개 구간)"
}
```

---

## ❌ 문제 해결

### 1. "변환할 문제와 풀이를 입력하세요"
**원인:** 텍스트 영역이 비어있음  
**해결:** 문제와 풀이를 입력 후 버튼 클릭

### 2. "GPT API 호출 실패"
**원인:** API 키 문제 또는 네트워크 오류  
**해결:** 
- `generate_procedural_narration.php`의 API 키 확인
- 서버 네트워크 상태 확인

### 3. "@ 기호가 없어요"
**원인:** GPT가 @ 기호를 누락  
**해결:** 
- 프롬프트에 "각 단락 끝에 반드시 @ 추가" 명시됨
- 생성된 텍스트를 직접 수정해서 @ 추가 가능

### 4. "나레이션이 너무 짧아요"
**원인:** 입력 문제가 너무 간단함  
**해결:** 더 상세한 문제/풀이를 입력

---

## 💡 활용 팁

### 1. 최적의 입력 형식
```
문제: [구체적인 문제 설명]
조건: [주어진 조건들]
구하는 것: [무엇을 구할 것인가]

풀이:
1. [1단계]
2. [2단계]
3. [3단계]
...
```

### 2. 나레이션 커스터마이징
- 생성 후 텍스트를 직접 수정 가능
- @ 기호 위치 조정 가능
- 불필요한 부분 삭제 가능

### 3. 여러 문제 일괄 처리
- 각 문제마다 별도로 생성
- 나레이션을 합쳐서 한 번에 음성 생성 가능

---

## 🎯 효과적인 사용 사례

### 사례 1: 복잡한 기하 문제
```
입력: 정육면체, 원기둥이 결합된 입체도형 부피/겉넓이 문제
출력: "지금 그림의 왼쪽을 보세요. 정육면체 부분을..."
효과: 시각적 관찰 지시로 공간 이해력 향상
```

### 사례 2: 다단계 계산 문제
```
입력: 방정식을 풀고, 그 해로 함수값 구하는 문제
출력: "첫째, 방정식의 구조를... 둘째, 해를 구한 뒤..."
효과: 절차적 흐름 명확화
```

### 사례 3: 증명 문제
```
입력: 수학적 증명이 필요한 문제
출력: "왜 이것이 성립할까요? 맞아요, 조건을 하나씩..."
효과: 사고 과정의 구조화
```

---

## 📈 기대 효과

1. **절차기억 형성**
   - 반복적인 질문-답변-실행 패턴
   - 핵심 절차의 자동화

2. **메타인지 강화**
   - "왜?"를 묻는 탐구적 접근
   - 스스로 점검하는 습관

3. **시각적 이해**
   - 구체적 관찰 지시
   - 공간 감각 향상

4. **듣기 학습**
   - 음성으로 듣는 단계별 설명
   - @ 기호로 사고 시간 확보

---

**작성일:** 2025-10-13  
**버전:** 1.0  
**개발:** GPT-4o + 듣기평가 시스템 통합


